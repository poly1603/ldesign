<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS变量修复测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--color-background-primary, #ffffff);
            color: var(--color-text-primary, #333333);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid var(--color-border, #e0e0e0);
            border-radius: 8px;
            background: var(--color-background-secondary, #fafafa);
        }
        
        .color-box {
            width: 100px;
            height: 50px;
            margin: 10px;
            display: inline-block;
            border-radius: 4px;
            border: 1px solid var(--color-border, #e0e0e0);
        }
        
        .primary { background: var(--color-primary, #1890ff); }
        .success { background: var(--color-success, #52c41a); }
        .warning { background: var(--color-warning, #faad14); }
        .danger { background: var(--color-danger, #ff4d4f); }
        
        .text-primary { color: var(--color-text-primary, #333333); }
        .text-secondary { color: var(--color-text-secondary, #666666); }
        .text-tertiary { color: var(--color-text-tertiary, #999999); }
        
        .shadow-box {
            padding: 20px;
            margin: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--color-shadow, rgba(0, 0, 0, 0.12));
        }
        
        #css-variables-display {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        button {
            background: var(--color-primary, #1890ff);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: var(--color-primary-hover, #40a9ff);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CSS变量修复测试</h1>
        
        <div class="test-section">
            <h2>主题颜色测试</h2>
            <div class="color-box primary" title="Primary"></div>
            <div class="color-box success" title="Success"></div>
            <div class="color-box warning" title="Warning"></div>
            <div class="color-box danger" title="Danger"></div>
        </div>
        
        <div class="test-section">
            <h2>文本颜色测试</h2>
            <p class="text-primary">主要文本颜色 (text-primary)</p>
            <p class="text-secondary">次要文本颜色 (text-secondary)</p>
            <p class="text-tertiary">第三级文本颜色 (text-tertiary)</p>
        </div>
        
        <div class="test-section">
            <h2>阴影测试</h2>
            <div class="shadow-box">这个盒子应该有阴影效果</div>
        </div>
        
        <div class="test-section">
            <h2>主题切换测试</h2>
            <button onclick="setTheme('default')">默认主题</button>
            <button onclick="setTheme('blue')">蓝色主题</button>
            <button onclick="setTheme('green')">绿色主题</button>
            <button onclick="toggleMode()">切换明暗模式</button>
        </div>
        
        <div class="test-section">
            <h2>当前CSS变量</h2>
            <div id="css-variables-display">加载中...</div>
            <button onclick="refreshCSSVariables()">刷新CSS变量</button>
        </div>
    </div>

    <script type="module">
        import { createThemeManager } from './packages/color/es/index.js';

        let themeManager;
        let currentMode = 'light';

        async function initTheme() {
            try {
                console.log('初始化主题管理器...');
                themeManager = createThemeManager();
                
                // 注册测试主题
                themeManager.registerTheme({
                    name: 'default',
                    displayName: '默认主题',
                    light: { primary: '#1890ff' },
                    dark: { primary: '#177ddc' }
                });
                
                themeManager.registerTheme({
                    name: 'blue',
                    displayName: '蓝色主题',
                    light: { primary: '#2f54eb' },
                    dark: { primary: '#1d39c4' }
                });
                
                themeManager.registerTheme({
                    name: 'green',
                    displayName: '绿色主题',
                    light: { primary: '#52c41a' },
                    dark: { primary: '#389e0d' }
                });
                
                console.log('设置默认主题...');
                await themeManager.setTheme('default', 'light');
                
                console.log('主题初始化完成');
                refreshCSSVariables();
                
            } catch (error) {
                console.error('主题初始化失败:', error);
                document.getElementById('css-variables-display').textContent = 
                    '主题初始化失败: ' + error.message;
            }
        }

        window.setTheme = async function(themeName) {
            try {
                console.log('切换主题到:', themeName);
                await themeManager.setTheme(themeName, currentMode);
                refreshCSSVariables();
            } catch (error) {
                console.error('主题切换失败:', error);
            }
        };

        window.toggleMode = async function() {
            try {
                currentMode = currentMode === 'light' ? 'dark' : 'light';
                console.log('切换模式到:', currentMode);
                const currentTheme = themeManager.getCurrentTheme();
                await themeManager.setTheme(currentTheme, currentMode);
                refreshCSSVariables();
            } catch (error) {
                console.error('模式切换失败:', error);
            }
        };

        window.refreshCSSVariables = function() {
            const styleElement = document.getElementById('ldesign-color-variables');
            const display = document.getElementById('css-variables-display');
            
            if (styleElement) {
                const cssText = styleElement.textContent || styleElement.innerHTML;
                display.textContent = cssText || '样式标签为空';
                console.log('CSS变量内容:', cssText);
            } else {
                display.textContent = '未找到CSS变量样式标签';
                console.log('未找到样式标签');
            }
            
            // 同时显示计算后的CSS变量
            const computedStyles = getComputedStyle(document.documentElement);
            const cssVars = [];
            for (let i = 0; i < computedStyles.length; i++) {
                const prop = computedStyles[i];
                if (prop.startsWith('--color')) {
                    cssVars.push(`${prop}: ${computedStyles.getPropertyValue(prop)}`);
                }
            }
            
            if (cssVars.length > 0) {
                display.textContent += '\n\n计算后的CSS变量:\n' + cssVars.join('\n');
            }
        };

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initTheme);
    </script>
</body>
</html>
