<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LDesign QR Code - æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-section {
            background: white;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .test-item {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            background: #fafafa;
        }
        
        .test-item h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .qr-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 220px;
            background: white;
            border: 1px dashed #ccc;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.loading {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 5px;
            font-size: 14px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .browser-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .performance-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .error-log {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 100px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ” LDesign QR Code æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•</h1>
        <p>æµ‹è¯•äºŒç»´ç ç”Ÿæˆåº“åœ¨ä¸åŒæµè§ˆå™¨ç¯å¢ƒä¸­çš„åŠŸèƒ½å’Œæ€§èƒ½</p>
        <div class="browser-info" id="browserInfo">
            <strong>æµè§ˆå™¨ä¿¡æ¯:</strong> <span id="userAgent"></span>
        </div>
    </div>

    <div class="controls">
        <button onclick="runAllTests()">ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
        <button onclick="downloadResults()">ğŸ“¥ ä¸‹è½½ç»“æœ</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š åŸºç¡€åŠŸèƒ½æµ‹è¯•</h2>
        <div class="test-grid" id="basicTests">
            <!-- åŸºç¡€æµ‹è¯•é¡¹ç›®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ¨ æ ·å¼å’Œæ ¼å¼æµ‹è¯•</h2>
        <div class="test-grid" id="styleTests">
            <!-- æ ·å¼æµ‹è¯•é¡¹ç›®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <div class="test-section">
        <h2>âš¡ æ€§èƒ½æµ‹è¯•</h2>
        <div id="performanceResults">
            <div class="performance-info">
                <div>ç”Ÿæˆæ—¶é—´: <span id="generationTime">-</span></div>
                <div>å†…å­˜ä½¿ç”¨: <span id="memoryUsage">-</span></div>
                <div>ç¼“å­˜æ•ˆæœ: <span id="cacheEffect">-</span></div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ› é”™è¯¯æ—¥å¿—</h2>
        <div class="error-log" id="errorLog">
            æš‚æ— é”™è¯¯
        </div>
    </div>

    <script>
        // æµè§ˆå™¨ä¿¡æ¯
        document.getElementById('userAgent').textContent = navigator.userAgent;

        // æµ‹è¯•é…ç½®
        const testConfigs = {
            basic: [
                { name: 'åŸºç¡€æ–‡æœ¬', data: 'Hello World', options: { size: 200 } },
                { name: 'URLé“¾æ¥', data: 'https://example.com', options: { size: 200 } },
                { name: 'ä¸­æ–‡æ–‡æœ¬', data: 'ä½ å¥½ä¸–ç•Œ', options: { size: 200 } },
                { name: 'é•¿æ–‡æœ¬', data: 'A'.repeat(100), options: { size: 200 } },
            ],
            style: [
                { name: 'Canvasæ ¼å¼', data: 'Canvas Test', options: { size: 200, format: 'canvas' } },
                { name: 'SVGæ ¼å¼', data: 'SVG Test', options: { size: 200, format: 'svg' } },
                { name: 'Imageæ ¼å¼', data: 'Image Test', options: { size: 200, format: 'image' } },
                { name: 'å¤§å°ºå¯¸', data: 'Large Size', options: { size: 400 } },
            ]
        };

        // é”™è¯¯æ—¥å¿—
        const errorLog = [];
        function logError(message) {
            const timestamp = new Date().toLocaleTimeString();
            errorLog.push(`[${timestamp}] ${message}`);
            document.getElementById('errorLog').innerHTML = errorLog.join('<br>');
        }

        // æ¨¡æ‹ŸäºŒç»´ç ç”Ÿæˆï¼ˆå› ä¸ºå®é™…çš„åº“å¯èƒ½éœ€è¦æ„å»ºï¼‰
        async function generateQRCode(data, options = {}) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    try {
                        // åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„äºŒç»´ç å…ƒç´ 
                        const canvas = document.createElement('canvas');
                        canvas.width = options.size || 200;
                        canvas.height = options.size || 200;
                        
                        const ctx = canvas.getContext('2d');
                        
                        // ç»˜åˆ¶ç®€å•çš„æ¨¡æ‹ŸäºŒç»´ç 
                        ctx.fillStyle = '#000';
                        const cellSize = canvas.width / 25;
                        
                        for (let i = 0; i < 25; i++) {
                            for (let j = 0; j < 25; j++) {
                                if (Math.random() > 0.5) {
                                    ctx.fillRect(i * cellSize, j * cellSize, cellSize, cellSize);
                                }
                            }
                        }
                        
                        // æ·»åŠ è¾¹æ¡†
                        ctx.strokeStyle = '#000';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(0, 0, canvas.width, canvas.height);
                        
                        // æ·»åŠ æ–‡æœ¬æ ‡è¯†
                        ctx.fillStyle = '#fff';
                        ctx.font = '12px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(data.substring(0, 10), canvas.width / 2, canvas.height / 2);
                        
                        resolve({
                            element: canvas,
                            data: canvas.toDataURL(),
                            format: options.format || 'canvas',
                            size: options.size || 200,
                            timestamp: Date.now()
                        });
                    } catch (error) {
                        reject(error);
                    }
                }, Math.random() * 100 + 50); // æ¨¡æ‹Ÿç”Ÿæˆæ—¶é—´
            });
        }

        // åˆ›å»ºæµ‹è¯•é¡¹ç›®
        function createTestItem(config, category) {
            const item = document.createElement('div');
            item.className = 'test-item';
            item.innerHTML = `
                <h4>${config.name}</h4>
                <div class="status loading" id="status-${category}-${config.name}">ç­‰å¾…æµ‹è¯•</div>
                <div class="qr-container" id="qr-${category}-${config.name}">
                    <span style="color: #666;">ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"å¼€å§‹</span>
                </div>
                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                    æ•°æ®: ${config.data.substring(0, 30)}${config.data.length > 30 ? '...' : ''}
                </div>
            `;
            return item;
        }

        // åˆå§‹åŒ–æµ‹è¯•é¡¹ç›®
        function initializeTests() {
            const basicContainer = document.getElementById('basicTests');
            const styleContainer = document.getElementById('styleTests');
            
            testConfigs.basic.forEach(config => {
                basicContainer.appendChild(createTestItem(config, 'basic'));
            });
            
            testConfigs.style.forEach(config => {
                styleContainer.appendChild(createTestItem(config, 'style'));
            });
        }

        // è¿è¡Œå•ä¸ªæµ‹è¯•
        async function runSingleTest(config, category) {
            const statusId = `status-${category}-${config.name}`;
            const containerId = `qr-${category}-${config.name}`;
            const statusEl = document.getElementById(statusId);
            const containerEl = document.getElementById(containerId);
            
            try {
                statusEl.textContent = 'ç”Ÿæˆä¸­...';
                statusEl.className = 'status loading';
                
                const startTime = performance.now();
                const result = await generateQRCode(config.data, config.options);
                const endTime = performance.now();
                
                containerEl.innerHTML = '';
                containerEl.appendChild(result.element);
                
                statusEl.textContent = `æˆåŠŸ (${(endTime - startTime).toFixed(1)}ms)`;
                statusEl.className = 'status success';
                
                return { success: true, time: endTime - startTime };
            } catch (error) {
                statusEl.textContent = `å¤±è´¥: ${error.message}`;
                statusEl.className = 'status error';
                containerEl.innerHTML = `<span style="color: #dc3545;">ç”Ÿæˆå¤±è´¥</span>`;
                logError(`${category}-${config.name}: ${error.message}`);
                return { success: false, error: error.message };
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            const startTime = performance.now();
            const results = { basic: [], style: [] };
            
            // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯æ—¥å¿—
            errorLog.length = 0;
            document.getElementById('errorLog').textContent = 'æš‚æ— é”™è¯¯';
            
            // è¿è¡ŒåŸºç¡€æµ‹è¯•
            for (const config of testConfigs.basic) {
                const result = await runSingleTest(config, 'basic');
                results.basic.push(result);
            }
            
            // è¿è¡Œæ ·å¼æµ‹è¯•
            for (const config of testConfigs.style) {
                const result = await runSingleTest(config, 'style');
                results.style.push(result);
            }
            
            const totalTime = performance.now() - startTime;
            
            // æ›´æ–°æ€§èƒ½ä¿¡æ¯
            updatePerformanceInfo(results, totalTime);
        }

        // æ›´æ–°æ€§èƒ½ä¿¡æ¯
        function updatePerformanceInfo(results, totalTime) {
            const allResults = [...results.basic, ...results.style];
            const successCount = allResults.filter(r => r.success).length;
            const avgTime = allResults
                .filter(r => r.success)
                .reduce((sum, r) => sum + r.time, 0) / successCount;
            
            document.getElementById('generationTime').textContent = 
                `å¹³å‡ ${avgTime.toFixed(1)}ms (æ€»è®¡ ${totalTime.toFixed(1)}ms)`;
            
            document.getElementById('memoryUsage').textContent = 
                `${(performance.memory ? (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1) : 'ä¸æ”¯æŒ')} MB`;
            
            document.getElementById('cacheEffect').textContent = 
                `${successCount}/${allResults.length} æˆåŠŸ`;
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.querySelectorAll('.status').forEach(el => {
                el.textContent = 'ç­‰å¾…æµ‹è¯•';
                el.className = 'status loading';
            });
            
            document.querySelectorAll('.qr-container').forEach(el => {
                el.innerHTML = '<span style="color: #666;">ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"å¼€å§‹</span>';
            });
            
            document.getElementById('generationTime').textContent = '-';
            document.getElementById('memoryUsage').textContent = '-';
            document.getElementById('cacheEffect').textContent = '-';
            
            errorLog.length = 0;
            document.getElementById('errorLog').textContent = 'æš‚æ— é”™è¯¯';
        }

        // ä¸‹è½½ç»“æœ
        function downloadResults() {
            const results = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                tests: [],
                errors: [...errorLog]
            };
            
            document.querySelectorAll('.test-item').forEach(item => {
                const title = item.querySelector('h4').textContent;
                const status = item.querySelector('.status').textContent;
                results.tests.push({ title, status });
            });
            
            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `qrcode-test-results-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // åˆå§‹åŒ–é¡µé¢
        initializeTests();
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„æç¤º
        console.log('ğŸ” LDesign QR Code æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•é¡µé¢å·²åŠ è½½');
        console.log('ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"æŒ‰é’®å¼€å§‹æµ‹è¯•');
    </script>
</body>
</html>
