# @ldesign/size æ¶æ„è®¾è®¡

## ğŸ—ï¸ æ•´ä½“æ¶æ„

### æ¶æ„æ¦‚è§ˆ

@ldesign/size é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä»åº•å±‚çš„å·¥å…·å‡½æ•°åˆ°é¡¶å±‚çš„æ¡†æ¶é›†æˆï¼Œæ¯ä¸€å±‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£å’Œè¾¹ç•Œã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Framework Layer                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚    Vue      â”‚  â”‚   React     â”‚  â”‚  Angular    â”‚     â”‚
â”‚  â”‚  Plugin     â”‚  â”‚   Hooks     â”‚  â”‚  Services   â”‚     â”‚
â”‚  â”‚ Components  â”‚  â”‚ Components  â”‚  â”‚ Directives  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Core Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚    Size     â”‚  â”‚    CSS      â”‚  â”‚    CSS      â”‚     â”‚
â”‚  â”‚  Manager    â”‚  â”‚ Generator   â”‚  â”‚  Injector   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Foundation Layer                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Presets   â”‚  â”‚    Utils    â”‚  â”‚    Types    â”‚     â”‚
â”‚  â”‚  Configs    â”‚  â”‚ Functions   â”‚  â”‚ Definitions â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„ç‰¹ç‚¹

1. **åˆ†å±‚æ¸…æ™°**ï¼šæ¯å±‚èŒè´£æ˜ç¡®ï¼Œä¾èµ–å…³ç³»å•å‘
2. **æ¾è€¦åˆ**ï¼šæ¨¡å—é—´é€šè¿‡æ¥å£é€šä¿¡ï¼Œé™ä½è€¦åˆåº¦
3. **é«˜å†…èš**ï¼šç›¸å…³åŠŸèƒ½èšåˆåœ¨åŒä¸€æ¨¡å—å†…
4. **å¯æ‰©å±•**ï¼šæ”¯æŒæ’ä»¶å’Œè‡ªå®šä¹‰æ‰©å±•
5. **å¯æµ‹è¯•**ï¼šæ¯å±‚éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•

## ğŸ”§ æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 1. Size Manager (å°ºå¯¸ç®¡ç†å™¨)

**èŒè´£**ï¼š

- ç®¡ç†å½“å‰å°ºå¯¸æ¨¡å¼çŠ¶æ€
- åè°ƒå„ä¸ªå­æ¨¡å—çš„å·¥ä½œ
- æä¾›ç»Ÿä¸€çš„å¯¹å¤–æ¥å£
- å¤„ç†äº‹ä»¶çš„å‘å¸ƒå’Œè®¢é˜…

**è®¾è®¡æ¨¡å¼**ï¼š

- **å•ä¾‹æ¨¡å¼**ï¼šå…¨å±€ç®¡ç†å™¨å®ä¾‹
- **è§‚å¯Ÿè€…æ¨¡å¼**ï¼šäº‹ä»¶ç›‘å¬å’Œé€šçŸ¥
- **ç­–ç•¥æ¨¡å¼**ï¼šä¸åŒå°ºå¯¸æ¨¡å¼çš„å¤„ç†ç­–ç•¥
- **å¤–è§‚æ¨¡å¼**ï¼šç®€åŒ–å¤æ‚å­ç³»ç»Ÿçš„æ¥å£

**æ ¸å¿ƒæ¥å£**ï¼š

```typescript
interface SizeManager {
  // çŠ¶æ€ç®¡ç†
  getCurrentMode(): SizeMode
  setMode(mode: SizeMode): void
  getConfig(mode?: SizeMode): SizeConfig

  // CSSæ“ä½œ
  generateCSSVariables(mode?: SizeMode): Record<string, string>
  injectCSS(mode?: SizeMode): void
  removeCSS(): void

  // äº‹ä»¶ç³»ç»Ÿ
  onSizeChange(callback: SizeChangeCallback): UnsubscribeFunction

  // ç”Ÿå‘½å‘¨æœŸ
  destroy(): void
}
```

**çŠ¶æ€ç®¡ç†**ï¼š

```typescript
class SizeManagerImpl implements SizeManager {
  private currentMode: SizeMode = 'medium'
  private listeners: SizeChangeCallback[] = []
  private cssGenerator: CSSVariableGenerator
  private cssInjector: CSSInjector

  // çŠ¶æ€å˜æ›´æ—¶çš„å¤„ç†æµç¨‹
  setMode(mode: SizeMode): void {
    const previousMode = this.currentMode
    this.currentMode = mode

    // 1. æ›´æ–°CSS
    if (this.options.autoInject) {
      this.injectCSS(mode)
    }

    // 2. è§¦å‘äº‹ä»¶
    this.emitSizeChange({
      previousMode,
      currentMode: mode,
      timestamp: Date.now(),
    })
  }
}
```

### 2. CSS Variable Generator (CSS å˜é‡ç”Ÿæˆå™¨)

**èŒè´£**ï¼š

- æ ¹æ®å°ºå¯¸é…ç½®ç”Ÿæˆ CSS å˜é‡
- ç®¡ç† CSS å˜é‡çš„å‘½åè§„èŒƒ
- æä¾› CSS å­—ç¬¦ä¸²çš„æ ¼å¼åŒ–

**è®¾è®¡æ¨¡å¼**ï¼š

- **å»ºé€ è€…æ¨¡å¼**ï¼šé€æ­¥æ„å»º CSS å˜é‡é›†åˆ
- **æ¨¡æ¿æ–¹æ³•æ¨¡å¼**ï¼šå®šä¹‰ç”Ÿæˆæµç¨‹çš„éª¨æ¶

**æ ¸å¿ƒç®—æ³•**ï¼š

```typescript
class CSSVariableGenerator {
  generateVariables(config: SizeConfig): Record<string, string> {
    const variables: Record<string, string> = {}

    // 1. ç”Ÿæˆå­—ä½“å˜é‡
    this.generateFontVariables(config.fontSize, variables)

    // 2. ç”Ÿæˆé—´è·å˜é‡
    this.generateSpacingVariables(config.spacing, variables)

    // 3. ç”Ÿæˆç»„ä»¶å˜é‡
    this.generateComponentVariables(config.component, variables)

    // 4. ç”Ÿæˆå…¶ä»–å˜é‡
    this.generateBorderRadiusVariables(config.borderRadius, variables)
    this.generateShadowVariables(config.shadow, variables)

    return variables
  }
}
```

**å˜é‡å‘½åè§„èŒƒ**ï¼š

```
å‰ç¼€-ç±»åˆ«-å°ºå¯¸-å˜ä½“
--ls-font-size-base
--ls-spacing-lg
--ls-button-height-medium
--ls-border-radius-sm
```

### 3. CSS Injector (CSS æ³¨å…¥å™¨)

**èŒè´£**ï¼š

- å°† CSS å˜é‡æ³¨å…¥åˆ° DOM ä¸­
- ç®¡ç†æ ·å¼æ ‡ç­¾çš„ç”Ÿå‘½å‘¨æœŸ
- å¤„ç†æ ·å¼çš„æ›´æ–°å’Œç§»é™¤

**è®¾è®¡æ¨¡å¼**ï¼š

- **å•ä¾‹æ¨¡å¼**ï¼šç¡®ä¿æ ·å¼æ ‡ç­¾çš„å”¯ä¸€æ€§
- **å‘½ä»¤æ¨¡å¼**ï¼šå°è£… CSS æ“ä½œå‘½ä»¤

**æ³¨å…¥ç­–ç•¥**ï¼š

```typescript
class CSSInjector {
  injectVariables(variables: Record<string, string>): void {
    // 1. æ£€æŸ¥ç¯å¢ƒ
    if (typeof document === 'undefined') {
      console.warn('CSS injection is only available in browser environment')
      return
    }

    // 2. ç§»é™¤æ—§æ ·å¼
    this.removeCSS()

    // 3. åˆ›å»ºæ–°æ ·å¼
    const styleElement = document.createElement('style')
    styleElement.id = this.options.styleId
    styleElement.textContent = this.generateCSSString(variables)

    // 4. æ’å…¥åˆ°DOM
    document.head.appendChild(styleElement)

    this.styleElement = styleElement
  }
}
```

## ğŸ¨ Vue é›†æˆæ¶æ„

### 1. Plugin (æ’ä»¶)

**è®¾è®¡ç›®æ ‡**ï¼š

- æä¾›å…¨å±€çš„å°ºå¯¸ç®¡ç†èƒ½åŠ›
- é›†æˆåˆ° Vue çš„ç”Ÿå‘½å‘¨æœŸä¸­
- æä¾›å…¨å±€å±æ€§å’Œæ–¹æ³•

**å®ç°æ¶æ„**ï¼š

```typescript
const VueSizePlugin: Plugin = {
  install(app: App, options: VueSizePluginOptions = {}) {
    // 1. åˆ›å»ºç®¡ç†å™¨å®ä¾‹
    const sizeManager = createSizeManager(options)

    // 2. æä¾›ç»™å­ç»„ä»¶
    app.provide(VueSizeSymbol, sizeManager)

    // 3. æ·»åŠ å…¨å±€å±æ€§
    app.config.globalProperties.$size = sizeManager

    // 4. ç”Ÿå‘½å‘¨æœŸç®¡ç†
    const originalUnmount = app.unmount
    app.unmount = function (...args) {
      sizeManager.destroy()
      return originalUnmount.apply(this, args)
    }
  },
}
```

### 2. Composables (ç»„åˆå¼ API)

**è®¾è®¡ç›®æ ‡**ï¼š

- æä¾›å“åº”å¼çš„å°ºå¯¸çŠ¶æ€
- å°è£…å¸¸ç”¨çš„å°ºå¯¸æ“ä½œ
- æ”¯æŒç»„ä»¶çº§çš„å°ºå¯¸ç®¡ç†

**æ ¸å¿ƒ Hook è®¾è®¡**ï¼š

```typescript
function useSize(options: UseSizeOptions = {}): UseSizeReturn {
  // 1. è·å–ç®¡ç†å™¨å®ä¾‹
  const sizeManager = getSizeManager(options)

  // 2. åˆ›å»ºå“åº”å¼çŠ¶æ€
  const currentMode = ref<SizeMode>(sizeManager.getCurrentMode())
  const currentConfig = ref<SizeConfig>(sizeManager.getConfig())

  // 3. ç›‘å¬å˜åŒ–
  const unsubscribe = sizeManager.onSizeChange(event => {
    currentMode.value = event.currentMode
    currentConfig.value = sizeManager.getConfig(event.currentMode)
  })

  // 4. ç”Ÿå‘½å‘¨æœŸç®¡ç†
  onUnmounted(() => {
    unsubscribe()
  })

  return {
    currentMode,
    currentConfig,
    setMode: sizeManager.setMode.bind(sizeManager),
    // ... å…¶ä»–æ–¹æ³•
  }
}
```

### 3. Components (ç»„ä»¶)

**è®¾è®¡ç›®æ ‡**ï¼š

- æä¾›å¼€ç®±å³ç”¨çš„ UI ç»„ä»¶
- æ”¯æŒå¤šç§æ ·å¼å’Œäº¤äº’æ¨¡å¼
- ä¸å°ºå¯¸ç³»ç»Ÿæ·±åº¦é›†æˆ

**ç»„ä»¶æ¶æ„**ï¼š

```typescript
export const SizeSwitcher = defineComponent({
  name: 'SizeSwitcher',
  props: {
    mode: String as PropType<SizeMode>,
    switcherStyle: String as PropType<'button' | 'select' | 'radio'>,
    // ... å…¶ä»–å±æ€§
  },
  setup(props, { emit }) {
    const { currentMode, setMode, availableModes } = useSizeSwitcher()

    // æ¸²æŸ“é€»è¾‘
    return () => {
      switch (props.switcherStyle) {
        case 'select':
          return renderSelectSwitcher()
        case 'radio':
          return renderRadioSwitcher()
        default:
          return renderButtonSwitcher()
      }
    }
  },
})
```

## ğŸ“Š æ•°æ®æµè®¾è®¡

### 1. å•å‘æ•°æ®æµ

```
ç”¨æˆ·äº¤äº’ â†’ äº‹ä»¶è§¦å‘ â†’ çŠ¶æ€æ›´æ–° â†’ è§†å›¾é‡æ¸²æŸ“
    â†“           â†“           â†“           â†“
  ç‚¹å‡»æŒ‰é’®    setMode()   currentMode   UIæ›´æ–°
```

### 2. çŠ¶æ€åŒæ­¥æœºåˆ¶

```typescript
// çŠ¶æ€å˜æ›´æµç¨‹
class SizeManagerImpl {
  setMode(mode: SizeMode): void {
    // 1. éªŒè¯è¾“å…¥
    if (!isValidSizeMode(mode)) return

    // 2. æ£€æŸ¥å˜åŒ–
    if (mode === this.currentMode) return

    // 3. æ›´æ–°çŠ¶æ€
    const previousMode = this.currentMode
    this.currentMode = mode

    // 4. åŒæ­¥CSS
    if (this.options.autoInject) {
      this.injectCSS(mode)
    }

    // 5. é€šçŸ¥ç›‘å¬å™¨
    this.emitSizeChange({
      previousMode,
      currentMode: mode,
      timestamp: Date.now(),
    })
  }
}
```

### 3. äº‹ä»¶ç³»ç»Ÿè®¾è®¡

**äº‹ä»¶ç±»å‹**ï¼š

```typescript
interface SizeChangeEvent {
  previousMode: SizeMode
  currentMode: SizeMode
  timestamp: number
}

type SizeChangeCallback = (event: SizeChangeEvent) => void
```

**äº‹ä»¶ç®¡ç†**ï¼š

```typescript
class EventManager {
  private listeners: SizeChangeCallback[] = []

  subscribe(callback: SizeChangeCallback): UnsubscribeFunction {
    this.listeners.push(callback)

    return () => {
      const index = this.listeners.indexOf(callback)
      if (index > -1) {
        this.listeners.splice(index, 1)
      }
    }
  }

  emit(event: SizeChangeEvent): void {
    this.listeners.forEach(callback => {
      try {
        callback(event)
      } catch (error) {
        console.error('Error in size change callback:', error)
      }
    })
  }
}
```

## ğŸ”§ æ‰©å±•æ€§è®¾è®¡

### 1. æ’ä»¶ç³»ç»Ÿ

```typescript
interface SizePlugin {
  name: string
  version?: string
  install(manager: SizeManager, options?: any): void
  uninstall?(manager: SizeManager): void
}

class PluginManager {
  private plugins: Map<string, SizePlugin> = new Map()

  use(plugin: SizePlugin, options?: any): void {
    if (this.plugins.has(plugin.name)) {
      console.warn(`Plugin ${plugin.name} is already installed`)
      return
    }

    plugin.install(this.sizeManager, options)
    this.plugins.set(plugin.name, plugin)
  }
}
```

### 2. é…ç½®æ‰©å±•

```typescript
interface ExtendedSizeConfig extends SizeConfig {
  // å…è®¸ç”¨æˆ·æ‰©å±•é…ç½®
  [key: string]: any
}

// é…ç½®åˆå¹¶ç­–ç•¥
function mergeConfig(base: SizeConfig, extension: Partial<ExtendedSizeConfig>): ExtendedSizeConfig {
  return deepMerge(base, extension)
}
```

### 3. ä¸»é¢˜ç³»ç»Ÿ

```typescript
interface SizeTheme {
  name: string
  configs: Record<SizeMode, SizeConfig>
  cssVariables?: Record<string, string>
}

class ThemeManager {
  private themes: Map<string, SizeTheme> = new Map()
  private currentTheme: string = 'default'

  registerTheme(theme: SizeTheme): void {
    this.themes.set(theme.name, theme)
  }

  switchTheme(themeName: string): void {
    const theme = this.themes.get(themeName)
    if (!theme) return

    this.currentTheme = themeName
    // æ›´æ–°é…ç½®å’ŒCSSå˜é‡
  }
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 1. æ‡’åŠ è½½ç­–ç•¥

```typescript
// æ¡†æ¶ç‰¹å®šåŠŸèƒ½æŒ‰éœ€åŠ è½½
const loadVueSupport = () => import('./vue')
const loadReactSupport = () => import('./react')

// é…ç½®æŒ‰éœ€ç”Ÿæˆ
const configCache = new Map<SizeMode, SizeConfig>()

function getConfig(mode: SizeMode): SizeConfig {
  if (!configCache.has(mode)) {
    configCache.set(mode, generateConfig(mode))
  }
  return configCache.get(mode)!
}
```

### 2. ç¼“å­˜æœºåˆ¶

```typescript
class CacheManager {
  private cssCache = new Map<string, string>()
  private configCache = new Map<SizeMode, SizeConfig>()

  getCachedCSS(key: string): string | undefined {
    return this.cssCache.get(key)
  }

  setCachedCSS(key: string, css: string): void {
    this.cssCache.set(key, css)
  }
}
```

### 3. æ‰¹é‡æ›´æ–°

```typescript
class BatchUpdater {
  private pendingUpdates: (() => void)[] = []
  private isScheduled = false

  schedule(update: () => void): void {
    this.pendingUpdates.push(update)

    if (!this.isScheduled) {
      this.isScheduled = true
      requestAnimationFrame(() => {
        this.flush()
      })
    }
  }

  private flush(): void {
    this.pendingUpdates.forEach(update => update())
    this.pendingUpdates.length = 0
    this.isScheduled = false
  }
}
```

## ğŸ” é”™è¯¯å¤„ç†è®¾è®¡

### 1. é”™è¯¯åˆ†ç±»

```typescript
enum ErrorType {
  INVALID_MODE = 'INVALID_MODE',
  INJECTION_FAILED = 'INJECTION_FAILED',
  CONFIG_ERROR = 'CONFIG_ERROR',
  PLUGIN_ERROR = 'PLUGIN_ERROR',
}

class SizeError extends Error {
  constructor(public type: ErrorType, message: string, public context?: any) {
    super(message)
    this.name = 'SizeError'
  }
}
```

### 2. é”™è¯¯æ¢å¤ç­–ç•¥

```typescript
class ErrorHandler {
  handle(error: SizeError): void {
    switch (error.type) {
      case ErrorType.INVALID_MODE:
        // ä½¿ç”¨é»˜è®¤æ¨¡å¼
        this.fallbackToDefault()
        break

      case ErrorType.INJECTION_FAILED:
        // é‡è¯•æ³¨å…¥
        this.retryInjection()
        break

      default:
        console.error('Unhandled size error:', error)
    }
  }
}
```

---

_è¿™ä¸ªæ¶æ„è®¾è®¡ç¡®ä¿äº†@ldesign/size çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œé«˜æ€§èƒ½ï¼Œä¸ºé¡¹ç›®çš„é•¿æœŸå‘å±•å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚_
