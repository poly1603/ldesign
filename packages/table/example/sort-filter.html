<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>表格排序和筛选功能示例</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    h1 {
      color: #333;
      margin-bottom: 8px;
    }
    
    .description {
      color: #666;
      margin-bottom: 24px;
      line-height: 1.6;
    }
    
    .section {
      margin-bottom: 32px;
    }
    
    .section h2 {
      color: #333;
      margin-bottom: 16px;
      border-bottom: 2px solid #722ED1;
      padding-bottom: 8px;
    }
    
    .controls {
      margin-bottom: 16px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .control-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    button {
      padding: 8px 16px;
      border: 1px solid #d9d9d9;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    button:hover {
      border-color: #722ED1;
      color: #722ED1;
    }
    
    button:active {
      background: #f0f0f0;
    }
    
    select {
      padding: 8px 12px;
      border: 1px solid #d9d9d9;
      border-radius: 6px;
      background: white;
    }
    
    .info {
      margin-top: 16px;
      padding: 12px;
      background: #f6f8fa;
      border-radius: 6px;
      border-left: 4px solid #722ED1;
    }
    
    .info h3 {
      margin: 0 0 8px 0;
      color: #333;
    }
    
    .info p {
      margin: 0;
      color: #666;
      font-family: 'Courier New', monospace;
    }
    
    #table-container {
      margin-top: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>表格排序和筛选功能示例</h1>
    <p class="description">
      演示表格的排序指示器和筛选下拉框功能，包括列头排序、多条件筛选、状态管理等特性
    </p>

    <div class="section">
      <h2>排序和筛选示例</h2>
      <div class="controls">
        <div class="control-group">
          <button id="enable-sort">启用排序</button>
          <button id="disable-sort">禁用排序</button>
        </div>
        <div class="control-group">
          <button id="enable-filter">启用筛选</button>
          <button id="disable-filter">禁用筛选</button>
        </div>
        <div class="control-group">
          <button id="clear-sort">清除排序</button>
          <button id="clear-filter">清除筛选</button>
        </div>
        <div class="control-group">
          <label>排序列:</label>
          <select id="sort-column">
            <option value="">请选择</option>
            <option value="name">姓名</option>
            <option value="age">年龄</option>
            <option value="department">部门</option>
            <option value="status">状态</option>
          </select>
          <select id="sort-direction">
            <option value="asc">升序</option>
            <option value="desc">降序</option>
          </select>
          <button id="apply-sort">应用排序</button>
        </div>
      </div>

      <div id="table-container"></div>

      <div class="info">
        <h3>排序和筛选信息</h3>
        <p id="sort-filter-info">当前无排序和筛选</p>
      </div>
    </div>

    <div class="section">
      <h2>组件独立使用</h2>
      <div class="controls">
        <div class="control-group">
          <label>排序指示器:</label>
          <div id="sort-indicator-demo"></div>
        </div>
        <div class="control-group">
          <label>筛选下拉框:</label>
          <div id="filter-dropdown-demo"></div>
        </div>
      </div>

      <div class="info">
        <h3>独立组件信息</h3>
        <p id="component-info">排序方向: 无, 筛选值: 无</p>
      </div>
    </div>
  </div>

  <script type="module">
    import { Table, SortIndicator, FilterDropdown } from '../es/index.js'

    // 模拟数据
    const generateData = (count = 50) => {
      const departments = ['技术部', '产品部', '设计部', '运营部', '市场部']
      const statuses = ['在职', '离职', '试用期']
      
      return Array.from({ length: count }, (_, i) => ({
        id: i + 1,
        name: `用户 ${i + 1}`,
        age: Math.floor(Math.random() * 40) + 20,
        email: `user${i + 1}@example.com`,
        department: departments[Math.floor(Math.random() * departments.length)],
        status: statuses[Math.floor(Math.random() * statuses.length)]
      }))
    }

    const data = generateData()

    // 表格配置
    const columns = [
      { key: 'id', title: 'ID', width: 80, sortable: true },
      { key: 'name', title: '姓名', width: 120, sortable: true },
      { key: 'age', title: '年龄', width: 80, sortable: true },
      { key: 'email', title: '邮箱', width: 200 },
      { key: 'department', title: '部门', width: 120, sortable: true, filterable: true },
      { key: 'status', title: '状态', width: 100, sortable: true, filterable: true }
    ]

    // 创建表格
    const table = new Table('#table-container', {
      columns,
      data,
      height: 400,
      pagination: {
        enabled: true,
        pageSize: 10
      }
    })

    // 监听排序变化
    table.on('sort-change', (event) => {
      console.log('排序变化:', event)
      updateSortFilterInfo()
    })

    // 监听筛选变化
    table.on('filter-change', (event) => {
      console.log('筛选变化:', event)
      updateSortFilterInfo()
    })

    // 更新排序和筛选信息显示
    function updateSortFilterInfo() {
      const sortState = table.getSortState()
      const filterState = table.getFilterState()
      
      let info = []
      
      if (sortState) {
        info.push(`排序: ${sortState.column} (${sortState.direction === 'asc' ? '升序' : '降序'})`)
      }
      
      const filterKeys = Object.keys(filterState)
      if (filterKeys.length > 0) {
        const filterInfo = filterKeys.map(key => 
          `${key}: [${filterState[key].join(', ')}]`
        ).join(', ')
        info.push(`筛选: ${filterInfo}`)
      }
      
      document.getElementById('sort-filter-info').textContent = 
        info.length > 0 ? info.join(', ') : '当前无排序和筛选'
    }

    // 控制按钮事件
    document.getElementById('enable-sort').addEventListener('click', () => {
      // 启用所有列的排序
      table.updateConfig({
        columns: columns.map(col => ({ ...col, sortable: true }))
      })
    })

    document.getElementById('disable-sort').addEventListener('click', () => {
      // 禁用所有列的排序
      table.updateConfig({
        columns: columns.map(col => ({ ...col, sortable: false }))
      })
    })

    document.getElementById('enable-filter').addEventListener('click', () => {
      // 启用部分列的筛选
      table.updateConfig({
        columns: columns.map(col => ({
          ...col,
          filterable: ['department', 'status'].includes(col.key)
        }))
      })
    })

    document.getElementById('disable-filter').addEventListener('click', () => {
      // 禁用所有列的筛选
      table.updateConfig({
        columns: columns.map(col => ({ ...col, filterable: false }))
      })
    })

    document.getElementById('clear-sort').addEventListener('click', () => {
      table.clearSort()
    })

    document.getElementById('clear-filter').addEventListener('click', () => {
      table.clearFilter()
    })

    document.getElementById('apply-sort').addEventListener('click', () => {
      const column = document.getElementById('sort-column').value
      const direction = document.getElementById('sort-direction').value
      
      if (column) {
        table.sort(column, direction)
      }
    })

    // 独立组件示例
    const sortIndicator = new SortIndicator('#sort-indicator-demo', {
      onClick: (direction) => {
        updateComponentInfo()
        console.log('排序指示器点击:', direction)
      }
    })

    const filterDropdown = new FilterDropdown('#filter-dropdown-demo', {
      options: [
        { value: 'option1', label: '选项1' },
        { value: 'option2', label: '选项2' },
        { value: 'option3', label: '选项3' },
        { value: 'option4', label: '选项4' }
      ],
      onChange: (values) => {
        updateComponentInfo()
        console.log('筛选下拉框变化:', values)
      }
    })

    function updateComponentInfo() {
      const sortDirection = sortIndicator.getDirection() || '无'
      const filterValues = filterDropdown.getSelectedValues()
      const filterText = filterValues.length > 0 ? filterValues.join(', ') : '无'
      
      document.getElementById('component-info').textContent = 
        `排序方向: ${sortDirection}, 筛选值: ${filterText}`
    }

    // 初始化信息显示
    updateSortFilterInfo()
    updateComponentInfo()
  </script>
</body>
</html>
