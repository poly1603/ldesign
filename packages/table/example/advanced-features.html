<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>表格高级功能演示</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      padding: 20px;
      background: linear-gradient(135deg, #722ED1, #9254DE);
      color: white;
    }

    .header h1 {
      margin: 0 0 10px 0;
      font-size: 24px;
    }

    .header p {
      margin: 0;
      opacity: 0.9;
    }

    .content {
      padding: 20px;
    }

    .demo-section {
      margin-bottom: 30px;
    }

    .demo-section h3 {
      margin: 0 0 15px 0;
      color: #722ED1;
      font-size: 18px;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 8px 16px;
      border: 1px solid #722ED1;
      background: white;
      color: #722ED1;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .btn:hover {
      background: #722ED1;
      color: white;
    }

    .btn.primary {
      background: #722ED1;
      color: white;
    }

    .btn.primary:hover {
      background: #5A1FA8;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .table-container {
      border: 1px solid #e8e8e8;
      border-radius: 6px;
      overflow: hidden;
    }

    .info-panel {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .info-panel h4 {
      margin: 0 0 10px 0;
      color: #495057;
    }

    .info-panel ul {
      margin: 0;
      padding-left: 20px;
    }

    .info-panel li {
      margin-bottom: 5px;
    }

    .status {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .status.editing {
      background: #e6f7ff;
      color: #1890ff;
    }

    .status.dragging {
      background: #fff2e8;
      color: #fa8c16;
    }

    .status.exporting {
      background: #f6ffed;
      color: #52c41a;
    }

    .log {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 4px;
      padding: 10px;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 15px;
    }

    .log-entry {
      margin-bottom: 5px;
      padding: 2px 0;
    }

    .log-entry.info {
      color: #1890ff;
    }

    .log-entry.success {
      color: #52c41a;
    }

    .log-entry.warning {
      color: #fa8c16;
    }

    .log-entry.error {
      color: #ff4d4f;
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .feature-card {
      border: 1px solid #e8e8e8;
      border-radius: 6px;
      padding: 15px;
      background: white;
    }

    .feature-card h4 {
      margin: 0 0 10px 0;
      color: #722ED1;
    }

    .feature-card p {
      margin: 0 0 10px 0;
      color: #666;
      font-size: 14px;
    }

    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>表格高级功能演示</h1>
      <p>展示可编辑单元格、拖拽排序、数据导出等高级功能</p>
    </div>

    <div class="content">
      <!-- 功能介绍 -->
      <div class="feature-grid">
        <div class="feature-card">
          <h4>🖊️ 可编辑单元格</h4>
          <p>支持多种编辑器类型：文本、数字、选择器、日期等</p>
          <p>双击单元格开始编辑，支持验证规则</p>
        </div>
        <div class="feature-card">
          <h4>🔄 拖拽排序</h4>
          <p>通过拖拽手柄重新排列表格行</p>
          <p>支持拖拽约束和可视化反馈</p>
        </div>
        <div class="feature-card">
          <h4>📤 数据导出</h4>
          <p>支持多种格式：CSV、Excel、JSON、XML、HTML</p>
          <p>可自定义导出列和数据过滤</p>
        </div>
      </div>

      <!-- 控制面板 -->
      <div class="demo-section">
        <h3>控制面板</h3>
        <div class="controls">
          <button class="btn" onclick="toggleEditing()">
            <span id="editToggleText">启用编辑</span>
          </button>
          <button class="btn" onclick="toggleDragSort()">
            <span id="dragToggleText">启用拖拽</span>
          </button>
          <button class="btn" onclick="addRandomRow()">添加随机行</button>
          <button class="btn" onclick="clearTable()">清空表格</button>
        </div>
        
        <div class="controls">
          <button class="btn primary" onclick="exportCSV()">导出 CSV</button>
          <button class="btn primary" onclick="exportExcel()">导出 Excel</button>
          <button class="btn primary" onclick="exportJSON()">导出 JSON</button>
          <button class="btn" onclick="exportSelected()">导出选中列</button>
        </div>
      </div>

      <!-- 状态信息 -->
      <div class="info-panel">
        <h4>当前状态</h4>
        <div>
          编辑模式: <span class="status" id="editStatus">禁用</span>
          拖拽排序: <span class="status" id="dragStatus">禁用</span>
          数据行数: <span id="rowCount">0</span>
        </div>
      </div>

      <!-- 表格容器 -->
      <div class="demo-section">
        <h3>表格演示</h3>
        <div class="table-container" id="advancedTableContainer"></div>
      </div>

      <!-- 操作日志 -->
      <div class="demo-section">
        <h3>操作日志</h3>
        <div class="log" id="operationLog"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { Table } from '../es/index.js'

    let advancedTable = null
    let editingEnabled = false
    let dragSortEnabled = false

    // 示例数据
    const sampleData = [
      { id: 1, name: '张三', age: 25, email: 'zhangsan@example.com', department: '技术部', salary: 8000, active: true, joinDate: '2023-01-15' },
      { id: 2, name: '李四', age: 30, email: 'lisi@example.com', department: '产品部', salary: 9000, active: true, joinDate: '2022-08-20' },
      { id: 3, name: '王五', age: 28, email: 'wangwu@example.com', department: '设计部', salary: 7500, active: false, joinDate: '2023-03-10' },
      { id: 4, name: '赵六', age: 32, email: 'zhaoliu@example.com', department: '市场部', salary: 8500, active: true, joinDate: '2022-12-05' },
      { id: 5, name: '钱七', age: 27, email: 'qianqi@example.com', department: '技术部', salary: 7800, active: true, joinDate: '2023-05-18' }
    ]

    // 列配置
    const columns = [
      {
        key: 'drag',
        title: '',
        width: 40,
        render: () => '<span class="drag-handle" style="cursor: grab;">⋮⋮</span>'
      },
      {
        key: 'id',
        title: 'ID',
        width: 60,
        sortable: true
      },
      {
        key: 'name',
        title: '姓名',
        width: 100,
        sortable: true,
        editable: true,
        editor: {
          type: 'text',
          rules: [
            {
              validator: (value) => value && value.length > 0,
              message: '姓名不能为空'
            }
          ]
        }
      },
      {
        key: 'age',
        title: '年龄',
        width: 80,
        sortable: true,
        editable: true,
        editor: {
          type: 'number',
          props: { min: 18, max: 65 },
          rules: [
            {
              validator: (value) => value >= 18 && value <= 65,
              message: '年龄必须在18-65之间'
            }
          ]
        }
      },
      {
        key: 'email',
        title: '邮箱',
        width: 200,
        editable: true,
        editor: {
          type: 'text',
          rules: [
            {
              validator: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
              message: '请输入有效的邮箱地址'
            }
          ]
        }
      },
      {
        key: 'department',
        title: '部门',
        width: 100,
        filterable: true,
        editable: true,
        editor: {
          type: 'select',
          options: [
            { label: '技术部', value: '技术部' },
            { label: '产品部', value: '产品部' },
            { label: '设计部', value: '设计部' },
            { label: '市场部', value: '市场部' },
            { label: '运营部', value: '运营部' }
          ]
        }
      },
      {
        key: 'salary',
        title: '薪资',
        width: 100,
        sortable: true,
        editable: true,
        editor: {
          type: 'number',
          props: { min: 3000, step: 100 }
        },
        formatter: (value) => `¥${value.toLocaleString()}`
      },
      {
        key: 'active',
        title: '状态',
        width: 80,
        editable: true,
        editor: {
          type: 'checkbox'
        },
        render: (value) => value ? '<span style="color: green;">✓ 在职</span>' : '<span style="color: red;">✗ 离职</span>'
      },
      {
        key: 'joinDate',
        title: '入职日期',
        width: 120,
        editable: true,
        editor: {
          type: 'date'
        }
      }
    ]

    // 初始化表格
    function initAdvancedTable() {
      const container = document.getElementById('advancedTableContainer')
      container.innerHTML = ''

      advancedTable = new Table({
        container,
        columns,
        data: [...sampleData],
        rowKey: 'id',
        selection: {
          enabled: true,
          multiple: true,
          checkboxColumn: true
        },
        editable: {
          enabled: editingEnabled,
          trigger: 'dblclick'
        },
        dragSort: {
          enabled: dragSortEnabled,
          handleSelector: '.drag-handle'
        },
        export: {
          enabled: true
        },
        pagination: {
          enabled: true,
          pageSize: 10
        }
      })

      // 绑定事件
      bindTableEvents()
      updateStatus()
      log('表格初始化完成', 'success')
    }

    // 绑定表格事件
    function bindTableEvents() {
      // 编辑事件
      advancedTable.on('cell-edit-start', (data) => {
        log(`开始编辑: ${data.column.title} - 行${data.rowIndex + 1}`, 'info')
      })

      advancedTable.on('cell-edit-finish', (data) => {
        log(`编辑完成: ${data.column.title} = ${data.newValue}`, 'success')
        updateStatus()
      })

      advancedTable.on('cell-edit-cancel', (data) => {
        log(`取消编辑: ${data.column.title}`, 'warning')
      })

      // 拖拽排序事件
      advancedTable.on('row-sort-change', (data) => {
        log(`行排序: 从位置${data.fromIndex}移动到位置${data.toIndex}`, 'info')
        updateStatus()
      })

      // 导出事件
      advancedTable.on('export-start', (data) => {
        log(`开始导出: ${data.config.format.toUpperCase()}格式`, 'info')
      })

      advancedTable.on('export-complete', (data) => {
        log(`导出完成: ${data.rowCount}行数据`, 'success')
      })

      advancedTable.on('export-error', (data) => {
        log(`导出失败: ${data.error}`, 'error')
      })

      // 选择事件
      advancedTable.on('selection-change', (data) => {
        log(`选择变更: ${data.selectedKeys.length}行被选中`, 'info')
      })
    }

    // 切换编辑模式
    window.toggleEditing = function() {
      editingEnabled = !editingEnabled
      document.getElementById('editToggleText').textContent = editingEnabled ? '禁用编辑' : '启用编辑'
      initAdvancedTable()
      log(`编辑模式: ${editingEnabled ? '启用' : '禁用'}`, 'info')
    }

    // 切换拖拽排序
    window.toggleDragSort = function() {
      dragSortEnabled = !dragSortEnabled
      document.getElementById('dragToggleText').textContent = dragSortEnabled ? '禁用拖拽' : '启用拖拽'
      initAdvancedTable()
      log(`拖拽排序: ${dragSortEnabled ? '启用' : '禁用'}`, 'info')
    }

    // 添加随机行
    window.addRandomRow = function() {
      const departments = ['技术部', '产品部', '设计部', '市场部', '运营部']
      const names = ['新员工A', '新员工B', '新员工C', '新员工D', '新员工E']
      
      const newRow = {
        id: Date.now(),
        name: names[Math.floor(Math.random() * names.length)],
        age: Math.floor(Math.random() * 30) + 22,
        email: `user${Date.now()}@example.com`,
        department: departments[Math.floor(Math.random() * departments.length)],
        salary: Math.floor(Math.random() * 5000) + 5000,
        active: Math.random() > 0.3,
        joinDate: new Date().toISOString().split('T')[0]
      }

      advancedTable.addData(newRow)
      updateStatus()
      log(`添加新行: ${newRow.name}`, 'success')
    }

    // 清空表格
    window.clearTable = function() {
      advancedTable.setData([])
      updateStatus()
      log('表格已清空', 'warning')
    }

    // 导出CSV
    window.exportCSV = function() {
      advancedTable.exportData({
        format: 'csv',
        filename: 'employees.csv',
        includeHeader: true
      })
    }

    // 导出Excel
    window.exportExcel = function() {
      advancedTable.exportData({
        format: 'excel',
        filename: 'employees.xlsx',
        includeHeader: true
      })
    }

    // 导出JSON
    window.exportJSON = function() {
      advancedTable.exportData({
        format: 'json',
        filename: 'employees.json'
      })
    }

    // 导出选中列
    window.exportSelected = function() {
      advancedTable.exportData({
        format: 'csv',
        filename: 'selected-columns.csv',
        columns: ['name', 'department', 'salary'],
        includeHeader: true
      })
    }

    // 更新状态
    function updateStatus() {
      const editStatus = document.getElementById('editStatus')
      const dragStatus = document.getElementById('dragStatus')
      const rowCount = document.getElementById('rowCount')

      editStatus.textContent = editingEnabled ? '启用' : '禁用'
      editStatus.className = `status ${editingEnabled ? 'editing' : ''}`

      dragStatus.textContent = dragSortEnabled ? '启用' : '禁用'
      dragStatus.className = `status ${dragSortEnabled ? 'dragging' : ''}`

      if (advancedTable) {
        rowCount.textContent = advancedTable.getData().length
      }
    }

    // 日志记录
    function log(message, type = 'info') {
      const logContainer = document.getElementById('operationLog')
      const timestamp = new Date().toLocaleTimeString()
      const logEntry = document.createElement('div')
      logEntry.className = `log-entry ${type}`
      logEntry.textContent = `[${timestamp}] ${message}`
      
      logContainer.appendChild(logEntry)
      logContainer.scrollTop = logContainer.scrollHeight
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', () => {
      initAdvancedTable()
      log('页面加载完成', 'success')
    })
  </script>
</body>
</html>
