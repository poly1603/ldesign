<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¡¨æ ¼é«˜çº§åŠŸèƒ½æ¼”ç¤º</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      padding: 20px;
      background: linear-gradient(135deg, #722ED1, #9254DE);
      color: white;
    }

    .header h1 {
      margin: 0 0 10px 0;
      font-size: 24px;
    }

    .header p {
      margin: 0;
      opacity: 0.9;
    }

    .content {
      padding: 20px;
    }

    .demo-section {
      margin-bottom: 30px;
    }

    .demo-section h3 {
      margin: 0 0 15px 0;
      color: #722ED1;
      font-size: 18px;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 8px 16px;
      border: 1px solid #722ED1;
      background: white;
      color: #722ED1;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .btn:hover {
      background: #722ED1;
      color: white;
    }

    .btn.primary {
      background: #722ED1;
      color: white;
    }

    .btn.primary:hover {
      background: #5A1FA8;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .table-container {
      border: 1px solid #e8e8e8;
      border-radius: 6px;
      overflow: hidden;
    }

    .info-panel {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .info-panel h4 {
      margin: 0 0 10px 0;
      color: #495057;
    }

    .info-panel ul {
      margin: 0;
      padding-left: 20px;
    }

    .info-panel li {
      margin-bottom: 5px;
    }

    .status {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .status.editing {
      background: #e6f7ff;
      color: #1890ff;
    }

    .status.dragging {
      background: #fff2e8;
      color: #fa8c16;
    }

    .status.exporting {
      background: #f6ffed;
      color: #52c41a;
    }

    .log {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 4px;
      padding: 10px;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 15px;
    }

    .log-entry {
      margin-bottom: 5px;
      padding: 2px 0;
    }

    .log-entry.info {
      color: #1890ff;
    }

    .log-entry.success {
      color: #52c41a;
    }

    .log-entry.warning {
      color: #fa8c16;
    }

    .log-entry.error {
      color: #ff4d4f;
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .feature-card {
      border: 1px solid #e8e8e8;
      border-radius: 6px;
      padding: 15px;
      background: white;
    }

    .feature-card h4 {
      margin: 0 0 10px 0;
      color: #722ED1;
    }

    .feature-card p {
      margin: 0 0 10px 0;
      color: #666;
      font-size: 14px;
    }

    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>è¡¨æ ¼é«˜çº§åŠŸèƒ½æ¼”ç¤º</h1>
      <p>å±•ç¤ºå¯ç¼–è¾‘å•å…ƒæ ¼ã€æ‹–æ‹½æ’åºã€æ•°æ®å¯¼å‡ºç­‰é«˜çº§åŠŸèƒ½</p>
    </div>

    <div class="content">
      <!-- åŠŸèƒ½ä»‹ç» -->
      <div class="feature-grid">
        <div class="feature-card">
          <h4>ğŸ–Šï¸ å¯ç¼–è¾‘å•å…ƒæ ¼</h4>
          <p>æ”¯æŒå¤šç§ç¼–è¾‘å™¨ç±»å‹ï¼šæ–‡æœ¬ã€æ•°å­—ã€é€‰æ‹©å™¨ã€æ—¥æœŸç­‰</p>
          <p>åŒå‡»å•å…ƒæ ¼å¼€å§‹ç¼–è¾‘ï¼Œæ”¯æŒéªŒè¯è§„åˆ™</p>
        </div>
        <div class="feature-card">
          <h4>ğŸ”„ æ‹–æ‹½æ’åº</h4>
          <p>é€šè¿‡æ‹–æ‹½æ‰‹æŸ„é‡æ–°æ’åˆ—è¡¨æ ¼è¡Œ</p>
          <p>æ”¯æŒæ‹–æ‹½çº¦æŸå’Œå¯è§†åŒ–åé¦ˆ</p>
        </div>
        <div class="feature-card">
          <h4>ğŸ“¤ æ•°æ®å¯¼å‡º</h4>
          <p>æ”¯æŒå¤šç§æ ¼å¼ï¼šCSVã€Excelã€JSONã€XMLã€HTML</p>
          <p>å¯è‡ªå®šä¹‰å¯¼å‡ºåˆ—å’Œæ•°æ®è¿‡æ»¤</p>
        </div>
      </div>

      <!-- æ§åˆ¶é¢æ¿ -->
      <div class="demo-section">
        <h3>æ§åˆ¶é¢æ¿</h3>
        <div class="controls">
          <button class="btn" onclick="toggleEditing()">
            <span id="editToggleText">å¯ç”¨ç¼–è¾‘</span>
          </button>
          <button class="btn" onclick="toggleDragSort()">
            <span id="dragToggleText">å¯ç”¨æ‹–æ‹½</span>
          </button>
          <button class="btn" onclick="addRandomRow()">æ·»åŠ éšæœºè¡Œ</button>
          <button class="btn" onclick="clearTable()">æ¸…ç©ºè¡¨æ ¼</button>
        </div>
        
        <div class="controls">
          <button class="btn primary" onclick="exportCSV()">å¯¼å‡º CSV</button>
          <button class="btn primary" onclick="exportExcel()">å¯¼å‡º Excel</button>
          <button class="btn primary" onclick="exportJSON()">å¯¼å‡º JSON</button>
          <button class="btn" onclick="exportSelected()">å¯¼å‡ºé€‰ä¸­åˆ—</button>
        </div>
      </div>

      <!-- çŠ¶æ€ä¿¡æ¯ -->
      <div class="info-panel">
        <h4>å½“å‰çŠ¶æ€</h4>
        <div>
          ç¼–è¾‘æ¨¡å¼: <span class="status" id="editStatus">ç¦ç”¨</span>
          æ‹–æ‹½æ’åº: <span class="status" id="dragStatus">ç¦ç”¨</span>
          æ•°æ®è¡Œæ•°: <span id="rowCount">0</span>
        </div>
      </div>

      <!-- è¡¨æ ¼å®¹å™¨ -->
      <div class="demo-section">
        <h3>è¡¨æ ¼æ¼”ç¤º</h3>
        <div class="table-container" id="advancedTableContainer"></div>
      </div>

      <!-- æ“ä½œæ—¥å¿— -->
      <div class="demo-section">
        <h3>æ“ä½œæ—¥å¿—</h3>
        <div class="log" id="operationLog"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { Table } from '../es/index.js'

    let advancedTable = null
    let editingEnabled = false
    let dragSortEnabled = false

    // ç¤ºä¾‹æ•°æ®
    const sampleData = [
      { id: 1, name: 'å¼ ä¸‰', age: 25, email: 'zhangsan@example.com', department: 'æŠ€æœ¯éƒ¨', salary: 8000, active: true, joinDate: '2023-01-15' },
      { id: 2, name: 'æå››', age: 30, email: 'lisi@example.com', department: 'äº§å“éƒ¨', salary: 9000, active: true, joinDate: '2022-08-20' },
      { id: 3, name: 'ç‹äº”', age: 28, email: 'wangwu@example.com', department: 'è®¾è®¡éƒ¨', salary: 7500, active: false, joinDate: '2023-03-10' },
      { id: 4, name: 'èµµå…­', age: 32, email: 'zhaoliu@example.com', department: 'å¸‚åœºéƒ¨', salary: 8500, active: true, joinDate: '2022-12-05' },
      { id: 5, name: 'é’±ä¸ƒ', age: 27, email: 'qianqi@example.com', department: 'æŠ€æœ¯éƒ¨', salary: 7800, active: true, joinDate: '2023-05-18' }
    ]

    // åˆ—é…ç½®
    const columns = [
      {
        key: 'drag',
        title: '',
        width: 40,
        render: () => '<span class="drag-handle" style="cursor: grab;">â‹®â‹®</span>'
      },
      {
        key: 'id',
        title: 'ID',
        width: 60,
        sortable: true
      },
      {
        key: 'name',
        title: 'å§“å',
        width: 100,
        sortable: true,
        editable: true,
        editor: {
          type: 'text',
          rules: [
            {
              validator: (value) => value && value.length > 0,
              message: 'å§“åä¸èƒ½ä¸ºç©º'
            }
          ]
        }
      },
      {
        key: 'age',
        title: 'å¹´é¾„',
        width: 80,
        sortable: true,
        editable: true,
        editor: {
          type: 'number',
          props: { min: 18, max: 65 },
          rules: [
            {
              validator: (value) => value >= 18 && value <= 65,
              message: 'å¹´é¾„å¿…é¡»åœ¨18-65ä¹‹é—´'
            }
          ]
        }
      },
      {
        key: 'email',
        title: 'é‚®ç®±',
        width: 200,
        editable: true,
        editor: {
          type: 'text',
          rules: [
            {
              validator: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
              message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€'
            }
          ]
        }
      },
      {
        key: 'department',
        title: 'éƒ¨é—¨',
        width: 100,
        filterable: true,
        editable: true,
        editor: {
          type: 'select',
          options: [
            { label: 'æŠ€æœ¯éƒ¨', value: 'æŠ€æœ¯éƒ¨' },
            { label: 'äº§å“éƒ¨', value: 'äº§å“éƒ¨' },
            { label: 'è®¾è®¡éƒ¨', value: 'è®¾è®¡éƒ¨' },
            { label: 'å¸‚åœºéƒ¨', value: 'å¸‚åœºéƒ¨' },
            { label: 'è¿è¥éƒ¨', value: 'è¿è¥éƒ¨' }
          ]
        }
      },
      {
        key: 'salary',
        title: 'è–ªèµ„',
        width: 100,
        sortable: true,
        editable: true,
        editor: {
          type: 'number',
          props: { min: 3000, step: 100 }
        },
        formatter: (value) => `Â¥${value.toLocaleString()}`
      },
      {
        key: 'active',
        title: 'çŠ¶æ€',
        width: 80,
        editable: true,
        editor: {
          type: 'checkbox'
        },
        render: (value) => value ? '<span style="color: green;">âœ“ åœ¨èŒ</span>' : '<span style="color: red;">âœ— ç¦»èŒ</span>'
      },
      {
        key: 'joinDate',
        title: 'å…¥èŒæ—¥æœŸ',
        width: 120,
        editable: true,
        editor: {
          type: 'date'
        }
      }
    ]

    // åˆå§‹åŒ–è¡¨æ ¼
    function initAdvancedTable() {
      const container = document.getElementById('advancedTableContainer')
      container.innerHTML = ''

      advancedTable = new Table({
        container,
        columns,
        data: [...sampleData],
        rowKey: 'id',
        selection: {
          enabled: true,
          multiple: true,
          checkboxColumn: true
        },
        editable: {
          enabled: editingEnabled,
          trigger: 'dblclick'
        },
        dragSort: {
          enabled: dragSortEnabled,
          handleSelector: '.drag-handle'
        },
        export: {
          enabled: true
        },
        pagination: {
          enabled: true,
          pageSize: 10
        }
      })

      // ç»‘å®šäº‹ä»¶
      bindTableEvents()
      updateStatus()
      log('è¡¨æ ¼åˆå§‹åŒ–å®Œæˆ', 'success')
    }

    // ç»‘å®šè¡¨æ ¼äº‹ä»¶
    function bindTableEvents() {
      // ç¼–è¾‘äº‹ä»¶
      advancedTable.on('cell-edit-start', (data) => {
        log(`å¼€å§‹ç¼–è¾‘: ${data.column.title} - è¡Œ${data.rowIndex + 1}`, 'info')
      })

      advancedTable.on('cell-edit-finish', (data) => {
        log(`ç¼–è¾‘å®Œæˆ: ${data.column.title} = ${data.newValue}`, 'success')
        updateStatus()
      })

      advancedTable.on('cell-edit-cancel', (data) => {
        log(`å–æ¶ˆç¼–è¾‘: ${data.column.title}`, 'warning')
      })

      // æ‹–æ‹½æ’åºäº‹ä»¶
      advancedTable.on('row-sort-change', (data) => {
        log(`è¡Œæ’åº: ä»ä½ç½®${data.fromIndex}ç§»åŠ¨åˆ°ä½ç½®${data.toIndex}`, 'info')
        updateStatus()
      })

      // å¯¼å‡ºäº‹ä»¶
      advancedTable.on('export-start', (data) => {
        log(`å¼€å§‹å¯¼å‡º: ${data.config.format.toUpperCase()}æ ¼å¼`, 'info')
      })

      advancedTable.on('export-complete', (data) => {
        log(`å¯¼å‡ºå®Œæˆ: ${data.rowCount}è¡Œæ•°æ®`, 'success')
      })

      advancedTable.on('export-error', (data) => {
        log(`å¯¼å‡ºå¤±è´¥: ${data.error}`, 'error')
      })

      // é€‰æ‹©äº‹ä»¶
      advancedTable.on('selection-change', (data) => {
        log(`é€‰æ‹©å˜æ›´: ${data.selectedKeys.length}è¡Œè¢«é€‰ä¸­`, 'info')
      })
    }

    // åˆ‡æ¢ç¼–è¾‘æ¨¡å¼
    window.toggleEditing = function() {
      editingEnabled = !editingEnabled
      document.getElementById('editToggleText').textContent = editingEnabled ? 'ç¦ç”¨ç¼–è¾‘' : 'å¯ç”¨ç¼–è¾‘'
      initAdvancedTable()
      log(`ç¼–è¾‘æ¨¡å¼: ${editingEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'info')
    }

    // åˆ‡æ¢æ‹–æ‹½æ’åº
    window.toggleDragSort = function() {
      dragSortEnabled = !dragSortEnabled
      document.getElementById('dragToggleText').textContent = dragSortEnabled ? 'ç¦ç”¨æ‹–æ‹½' : 'å¯ç”¨æ‹–æ‹½'
      initAdvancedTable()
      log(`æ‹–æ‹½æ’åº: ${dragSortEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'info')
    }

    // æ·»åŠ éšæœºè¡Œ
    window.addRandomRow = function() {
      const departments = ['æŠ€æœ¯éƒ¨', 'äº§å“éƒ¨', 'è®¾è®¡éƒ¨', 'å¸‚åœºéƒ¨', 'è¿è¥éƒ¨']
      const names = ['æ–°å‘˜å·¥A', 'æ–°å‘˜å·¥B', 'æ–°å‘˜å·¥C', 'æ–°å‘˜å·¥D', 'æ–°å‘˜å·¥E']
      
      const newRow = {
        id: Date.now(),
        name: names[Math.floor(Math.random() * names.length)],
        age: Math.floor(Math.random() * 30) + 22,
        email: `user${Date.now()}@example.com`,
        department: departments[Math.floor(Math.random() * departments.length)],
        salary: Math.floor(Math.random() * 5000) + 5000,
        active: Math.random() > 0.3,
        joinDate: new Date().toISOString().split('T')[0]
      }

      advancedTable.addData(newRow)
      updateStatus()
      log(`æ·»åŠ æ–°è¡Œ: ${newRow.name}`, 'success')
    }

    // æ¸…ç©ºè¡¨æ ¼
    window.clearTable = function() {
      advancedTable.setData([])
      updateStatus()
      log('è¡¨æ ¼å·²æ¸…ç©º', 'warning')
    }

    // å¯¼å‡ºCSV
    window.exportCSV = function() {
      advancedTable.exportData({
        format: 'csv',
        filename: 'employees.csv',
        includeHeader: true
      })
    }

    // å¯¼å‡ºExcel
    window.exportExcel = function() {
      advancedTable.exportData({
        format: 'excel',
        filename: 'employees.xlsx',
        includeHeader: true
      })
    }

    // å¯¼å‡ºJSON
    window.exportJSON = function() {
      advancedTable.exportData({
        format: 'json',
        filename: 'employees.json'
      })
    }

    // å¯¼å‡ºé€‰ä¸­åˆ—
    window.exportSelected = function() {
      advancedTable.exportData({
        format: 'csv',
        filename: 'selected-columns.csv',
        columns: ['name', 'department', 'salary'],
        includeHeader: true
      })
    }

    // æ›´æ–°çŠ¶æ€
    function updateStatus() {
      const editStatus = document.getElementById('editStatus')
      const dragStatus = document.getElementById('dragStatus')
      const rowCount = document.getElementById('rowCount')

      editStatus.textContent = editingEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'
      editStatus.className = `status ${editingEnabled ? 'editing' : ''}`

      dragStatus.textContent = dragSortEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'
      dragStatus.className = `status ${dragSortEnabled ? 'dragging' : ''}`

      if (advancedTable) {
        rowCount.textContent = advancedTable.getData().length
      }
    }

    // æ—¥å¿—è®°å½•
    function log(message, type = 'info') {
      const logContainer = document.getElementById('operationLog')
      const timestamp = new Date().toLocaleTimeString()
      const logEntry = document.createElement('div')
      logEntry.className = `log-entry ${type}`
      logEntry.textContent = `[${timestamp}] ${message}`
      
      logContainer.appendChild(logEntry)
      logContainer.scrollTop = logContainer.scrollHeight
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      initAdvancedTable()
      log('é¡µé¢åŠ è½½å®Œæˆ', 'success')
    })
  </script>
</body>
</html>
