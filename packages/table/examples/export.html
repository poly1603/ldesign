<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•°æ®å¯¼å‡ºç¤ºä¾‹ - LDESIGN Table</title>
  <link rel="stylesheet" href="./src/styles/main.css">
</head>
<body>
  <div class="page-header">
    <h1>ğŸ“¤ æ•°æ®å¯¼å‡ºç¤ºä¾‹</h1>
    <p>æ¼”ç¤ºè¡¨æ ¼çš„å¤šæ ¼å¼æ•°æ®å¯¼å‡ºåŠŸèƒ½</p>
  </div>

  <nav class="nav">
    <div class="container">
      <ul class="nav-links">
        <li><a href="./index.html">é¦–é¡µ</a></li>
        <li><a href="./basic.html">åŸºç¡€è¡¨æ ¼</a></li>
        <li><a href="./filter.html">ç­›é€‰æœç´¢</a></li>
        <li><a href="./editable.html">å¯ç¼–è¾‘è¡¨æ ¼</a></li>
        <li><a href="./drag-sort.html">æ‹–æ‹½æ’åº</a></li>
        <li><a href="./export.html" class="active">æ•°æ®å¯¼å‡º</a></li>
        <li><a href="./theme.html">ä¸»é¢˜ç³»ç»Ÿ</a></li>
        <li><a href="./complete.html">å®Œæ•´åŠŸèƒ½</a></li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <div class="example-section">
      <h2>æ•°æ®å¯¼å‡ºæ¼”ç¤º</h2>
      <p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†è¡¨æ ¼çš„æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼Œæ”¯æŒå¤šç§æ ¼å¼å’Œè‡ªå®šä¹‰é€‰é¡¹ã€‚</p>
      
      <div class="info-panel">
        <h4>å¯¼å‡ºç‰¹æ€§</h4>
        <ul>
          <li>ğŸ“Š CSVæ ¼å¼å¯¼å‡º</li>
          <li>ğŸ“‹ Excelæ ¼å¼å¯¼å‡º</li>
          <li>ğŸ”— JSONæ ¼å¼å¯¼å‡º</li>
          <li>ğŸ“„ XMLæ ¼å¼å¯¼å‡º</li>
          <li>ğŸŒ HTMLæ ¼å¼å¯¼å‡º</li>
          <li>ğŸ¯ é€‰æ‹©æ€§åˆ—å¯¼å‡º</li>
          <li>ğŸ” ç­›é€‰æ•°æ®å¯¼å‡º</li>
          <li>ğŸ“ˆ å¯¼å‡ºè¿›åº¦è·Ÿè¸ª</li>
        </ul>
      </div>

      <div class="controls">
        <h3>å¿«é€Ÿå¯¼å‡º</h3>
        <button class="btn" onclick="exportCSV()">å¯¼å‡º CSV</button>
        <button class="btn" onclick="exportExcel()">å¯¼å‡º Excel</button>
        <button class="btn" onclick="exportJSON()">å¯¼å‡º JSON</button>
        <button class="btn" onclick="exportXML()">å¯¼å‡º XML</button>
        <button class="btn" onclick="exportHTML()">å¯¼å‡º HTML</button>
      </div>

      <div class="controls">
        <h3>å¯¼å‡ºé€‰é¡¹</h3>
        <div class="export-options">
          <div class="option-group">
            <h4>å¯¼å‡ºèŒƒå›´</h4>
            <label>
              <input type="radio" name="exportRange" value="all" checked>
              å…¨éƒ¨æ•°æ®
            </label>
            <label>
              <input type="radio" name="exportRange" value="filtered">
              ç­›é€‰åæ•°æ®
            </label>
            <label>
              <input type="radio" name="exportRange" value="selected">
              é€‰ä¸­æ•°æ®
            </label>
            <label>
              <input type="radio" name="exportRange" value="current">
              å½“å‰é¡µæ•°æ®
            </label>
          </div>
          
          <div class="option-group">
            <h4>å¯¼å‡ºåˆ—</h4>
            <label>
              <input type="checkbox" id="exportName" checked>
              å§“å
            </label>
            <label>
              <input type="checkbox" id="exportAge" checked>
              å¹´é¾„
            </label>
            <label>
              <input type="checkbox" id="exportDepartment" checked>
              éƒ¨é—¨
            </label>
            <label>
              <input type="checkbox" id="exportSalary" checked>
              è–ªèµ„
            </label>
            <label>
              <input type="checkbox" id="exportJoinDate" checked>
              å…¥èŒæ—¥æœŸ
            </label>
            <label>
              <input type="checkbox" id="exportStatus" checked>
              çŠ¶æ€
            </label>
          </div>
        </div>
      </div>

      <div class="controls">
        <h3>é«˜çº§å¯¼å‡º</h3>
        <div class="advanced-export">
          <label>
            æ–‡ä»¶åå‰ç¼€:
            <input type="text" id="filePrefix" value="å‘˜å·¥æ•°æ®" placeholder="æ–‡ä»¶åå‰ç¼€">
          </label>
          <label>
            <input type="checkbox" id="includeTimestamp" checked>
            åŒ…å«æ—¶é—´æˆ³
          </label>
          <label>
            <input type="checkbox" id="includeHeaders" checked>
            åŒ…å«è¡¨å¤´
          </label>
          <button class="btn btn-primary" onclick="customExport()">è‡ªå®šä¹‰å¯¼å‡º</button>
        </div>
      </div>

      <div class="table-container" id="exportTableContainer"></div>

      <div class="info-panel">
        <h4>å¯¼å‡ºçŠ¶æ€</h4>
        <div>
          æ€»è®°å½•æ•°: <span class="status" id="totalRecords">0</span>
          ç­›é€‰åè®°å½•æ•°: <span class="status" id="filteredRecords">0</span>
          é€‰ä¸­è®°å½•æ•°: <span class="status" id="selectedRecords">0</span>
        </div>
        <div>
          å¯¼å‡ºè¿›åº¦: <span class="status" id="exportProgress">å°±ç»ª</span>
        </div>
      </div>

      <div class="info-panel">
        <h4>å¯¼å‡ºå†å²</h4>
        <div id="exportHistory" class="export-history">
          <p>æš‚æ— å¯¼å‡ºè®°å½•</p>
        </div>
        <button class="btn btn-small" onclick="clearExportHistory()">æ¸…é™¤å†å²</button>
      </div>

      <div class="log" id="operationLog"></div>
    </div>
  </div>

  <script type="module">
    import { Table } from '@ldesign/table'
    import '@ldesign/table/styles'
    import { sampleEmployees, basicColumns, createLogger } from './src/utils/data.js'

    let exportTable = null
    let exportHistory = []
    const log = createLogger('operationLog')

    // æ‰©å±•å‘˜å·¥æ•°æ®
    const extendedEmployees = [
      ...sampleEmployees,
      { id: 6, name: 'èµµå…­', age: 28, department: 'è´¢åŠ¡éƒ¨', salary: 7500, joinDate: '2023-08-15', status: 'åœ¨èŒ' },
      { id: 7, name: 'å­™ä¸ƒ', age: 35, department: 'æŠ€æœ¯éƒ¨', salary: 12000, joinDate: '2022-03-10', status: 'åœ¨èŒ' },
      { id: 8, name: 'å‘¨å…«', age: 26, department: 'å¸‚åœºéƒ¨', salary: 6800, joinDate: '2024-01-20', status: 'åœ¨èŒ' },
      { id: 9, name: 'å´ä¹', age: 31, department: 'äººäº‹éƒ¨', salary: 8200, joinDate: '2023-05-12', status: 'åœ¨èŒ' },
      { id: 10, name: 'éƒ‘å', age: 29, department: 'æŠ€æœ¯éƒ¨', salary: 9500, joinDate: '2023-11-08', status: 'åœ¨èŒ' }
    ]

    // åˆå§‹åŒ–è¡¨æ ¼
    function initExportTable() {
      const container = document.getElementById('exportTableContainer')
      container.innerHTML = ''

      exportTable = new Table({
        container,
        columns: basicColumns,
        data: [...extendedEmployees],
        rowKey: 'id',
        selection: {
          enabled: true,
          multiple: true,
          checkboxColumn: true
        },
        pagination: {
          enabled: true,
          pageSize: 8
        },
        sorting: {
          enabled: true
        },
        filtering: {
          enabled: true
        }
      })

      // ç»‘å®šå¯¼å‡ºäº‹ä»¶
      bindExportEvents()
      updateExportStatus()
      log('æ•°æ®å¯¼å‡ºæ¼”ç¤ºè¡¨æ ¼åˆå§‹åŒ–å®Œæˆ', 'success')
    }

    // ç»‘å®šå¯¼å‡ºäº‹ä»¶
    function bindExportEvents() {
      // é€‰æ‹©å˜æ›´äº‹ä»¶
      exportTable.on('selection-change', () => {
        updateExportStatus()
      })

      // ç­›é€‰å˜æ›´äº‹ä»¶
      exportTable.on('filter-change', () => {
        updateExportStatus()
      })

      // å¯¼å‡ºè¿›åº¦äº‹ä»¶
      exportTable.on('export-progress', (data) => {
        document.getElementById('exportProgress').textContent = `å¯¼å‡ºä¸­... ${data.progress}%`
        document.getElementById('exportProgress').className = 'status warning'
      })

      // å¯¼å‡ºå®Œæˆäº‹ä»¶
      exportTable.on('export-complete', (data) => {
        document.getElementById('exportProgress').textContent = 'å¯¼å‡ºå®Œæˆ'
        document.getElementById('exportProgress').className = 'status success'
        
        // è®°å½•å¯¼å‡ºå†å²
        const historyItem = {
          timestamp: new Date().toLocaleString(),
          format: data.format.toUpperCase(),
          filename: data.filename,
          recordCount: data.recordCount,
          size: data.size || 'æœªçŸ¥'
        }
        
        exportHistory.unshift(historyItem)
        if (exportHistory.length > 10) {
          exportHistory = exportHistory.slice(0, 10)
        }
        
        updateExportHistory()
        log(`å¯¼å‡ºå®Œæˆ: ${data.filename} (${data.recordCount} æ¡è®°å½•)`, 'success')
        
        // é‡ç½®è¿›åº¦çŠ¶æ€
        setTimeout(() => {
          document.getElementById('exportProgress').textContent = 'å°±ç»ª'
          document.getElementById('exportProgress').className = 'status success'
        }, 2000)
      })
    }

    // è·å–å¯¼å‡ºæ•°æ®
    function getExportData() {
      const range = document.querySelector('input[name="exportRange"]:checked').value
      const dataManager = exportTable.getDataManager()
      
      let data = []
      switch (range) {
        case 'all':
          data = dataManager.getOriginalData()
          break
        case 'filtered':
          data = dataManager.getFilteredData()
          break
        case 'selected':
          data = exportTable.getSelectedRows()
          break
        case 'current':
          data = dataManager.getDisplayData()
          break
      }
      
      return data
    }

    // è·å–å¯¼å‡ºåˆ—
    function getExportColumns() {
      const columns = []
      if (document.getElementById('exportName').checked) columns.push('name')
      if (document.getElementById('exportAge').checked) columns.push('age')
      if (document.getElementById('exportDepartment').checked) columns.push('department')
      if (document.getElementById('exportSalary').checked) columns.push('salary')
      if (document.getElementById('exportJoinDate').checked) columns.push('joinDate')
      if (document.getElementById('exportStatus').checked) columns.push('status')
      return columns
    }

    // ç”Ÿæˆæ–‡ä»¶å
    function generateFilename(format) {
      const prefix = document.getElementById('filePrefix').value || 'æ•°æ®å¯¼å‡º'
      const timestamp = document.getElementById('includeTimestamp').checked 
        ? '_' + new Date().toISOString().slice(0, 19).replace(/[:-]/g, '')
        : ''
      return `${prefix}${timestamp}.${format}`
    }

    // CSVå¯¼å‡º
    window.exportCSV = function() {
      const data = getExportData()
      const columns = getExportColumns()
      const filename = generateFilename('csv')
      const includeHeaders = document.getElementById('includeHeaders').checked
      
      exportTable.exportData({
        format: 'csv',
        data,
        columns,
        filename,
        includeHeaders
      })
      
      log(`å¼€å§‹å¯¼å‡º CSV: ${filename}`, 'info')
    }

    // Excelå¯¼å‡º
    window.exportExcel = function() {
      const data = getExportData()
      const columns = getExportColumns()
      const filename = generateFilename('xlsx')
      const includeHeaders = document.getElementById('includeHeaders').checked
      
      exportTable.exportData({
        format: 'excel',
        data,
        columns,
        filename,
        includeHeaders
      })
      
      log(`å¼€å§‹å¯¼å‡º Excel: ${filename}`, 'info')
    }

    // JSONå¯¼å‡º
    window.exportJSON = function() {
      const data = getExportData()
      const columns = getExportColumns()
      const filename = generateFilename('json')
      
      exportTable.exportData({
        format: 'json',
        data,
        columns,
        filename
      })
      
      log(`å¼€å§‹å¯¼å‡º JSON: ${filename}`, 'info')
    }

    // XMLå¯¼å‡º
    window.exportXML = function() {
      const data = getExportData()
      const columns = getExportColumns()
      const filename = generateFilename('xml')
      
      exportTable.exportData({
        format: 'xml',
        data,
        columns,
        filename
      })
      
      log(`å¼€å§‹å¯¼å‡º XML: ${filename}`, 'info')
    }

    // HTMLå¯¼å‡º
    window.exportHTML = function() {
      const data = getExportData()
      const columns = getExportColumns()
      const filename = generateFilename('html')
      const includeHeaders = document.getElementById('includeHeaders').checked
      
      exportTable.exportData({
        format: 'html',
        data,
        columns,
        filename,
        includeHeaders
      })
      
      log(`å¼€å§‹å¯¼å‡º HTML: ${filename}`, 'info')
    }

    // è‡ªå®šä¹‰å¯¼å‡º
    window.customExport = function() {
      const format = prompt('è¯·é€‰æ‹©å¯¼å‡ºæ ¼å¼ (csv/excel/json/xml/html):', 'csv')
      if (!format) return
      
      const data = getExportData()
      const columns = getExportColumns()
      const filename = generateFilename(format.toLowerCase())
      const includeHeaders = document.getElementById('includeHeaders').checked
      
      exportTable.exportData({
        format: format.toLowerCase(),
        data,
        columns,
        filename,
        includeHeaders
      })
      
      log(`å¼€å§‹è‡ªå®šä¹‰å¯¼å‡º ${format.toUpperCase()}: ${filename}`, 'info')
    }

    // æ›´æ–°å¯¼å‡ºçŠ¶æ€
    function updateExportStatus() {
      const dataManager = exportTable.getDataManager()
      const totalRecords = dataManager.getOriginalData().length
      const filteredRecords = dataManager.getFilteredData().length
      const selectedRecords = exportTable.getSelectedRows().length

      document.getElementById('totalRecords').textContent = totalRecords
      document.getElementById('filteredRecords').textContent = filteredRecords
      document.getElementById('selectedRecords').textContent = selectedRecords

      // æ›´æ–°çŠ¶æ€æ ·å¼
      document.getElementById('filteredRecords').className = `status ${filteredRecords < totalRecords ? 'warning' : 'success'}`
      document.getElementById('selectedRecords').className = `status ${selectedRecords > 0 ? 'success' : 'info'}`
    }

    // æ›´æ–°å¯¼å‡ºå†å²
    function updateExportHistory() {
      const historyContainer = document.getElementById('exportHistory')
      
      if (exportHistory.length === 0) {
        historyContainer.innerHTML = '<p>æš‚æ— å¯¼å‡ºè®°å½•</p>'
        return
      }
      
      const historyHTML = exportHistory.map(item => `
        <div class="history-item">
          <div class="history-main">
            <span class="format">${item.format}</span>
            <span class="filename">${item.filename}</span>
            <span class="count">${item.recordCount} æ¡è®°å½•</span>
          </div>
          <div class="history-meta">
            <span class="time">${item.timestamp}</span>
            <span class="size">${item.size}</span>
          </div>
        </div>
      `).join('')
      
      historyContainer.innerHTML = historyHTML
    }

    // æ¸…é™¤å¯¼å‡ºå†å²
    window.clearExportHistory = function() {
      exportHistory = []
      updateExportHistory()
      log('æ¸…é™¤å¯¼å‡ºå†å²', 'info')
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      initExportTable()
      log('é¡µé¢åŠ è½½å®Œæˆ', 'success')
    })
  </script>

  <style>
    .export-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 15px 0;
    }

    .option-group h4 {
      margin: 0 0 10px 0;
      color: var(--ldesign-text-color-primary);
    }

    .option-group label {
      display: block;
      margin: 5px 0;
      cursor: pointer;
    }

    .advanced-export {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .advanced-export label {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .export-history {
      max-height: 250px;
      overflow-y: auto;
      border: 1px solid var(--ldesign-border-color);
      border-radius: var(--ls-border-radius-base);
      padding: 10px;
      background: var(--ldesign-bg-color-component);
    }

    .history-item {
      padding: 10px 0;
      border-bottom: 1px solid var(--ldesign-border-level-1-color);
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-main {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 5px;
    }

    .format {
      background: var(--ldesign-brand-color);
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: var(--ls-font-size-xs);
      font-weight: bold;
    }

    .filename {
      font-weight: 500;
      color: var(--ldesign-text-color-primary);
    }

    .count {
      color: var(--ldesign-text-color-secondary);
      font-size: var(--ls-font-size-xs);
    }

    .history-meta {
      display: flex;
      justify-content: space-between;
      font-size: var(--ls-font-size-xs);
      color: var(--ldesign-text-color-secondary);
    }

    .btn-primary {
      background: var(--ldesign-brand-color);
      color: white;
      border: none;
    }

    .btn-primary:hover {
      background: var(--ldesign-brand-color-hover);
    }

    .btn-small {
      padding: 5px 10px;
      font-size: var(--ls-font-size-xs);
    }
  </style>
</body>
</html>
