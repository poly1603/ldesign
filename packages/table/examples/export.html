<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>数据导出示例 - LDESIGN Table</title>
  <link rel="stylesheet" href="./src/styles/main.css">
</head>
<body>
  <div class="page-header">
    <h1>📤 数据导出示例</h1>
    <p>演示表格的多格式数据导出功能</p>
  </div>

  <nav class="nav">
    <div class="container">
      <ul class="nav-links">
        <li><a href="./index.html">首页</a></li>
        <li><a href="./basic.html">基础表格</a></li>
        <li><a href="./filter.html">筛选搜索</a></li>
        <li><a href="./editable.html">可编辑表格</a></li>
        <li><a href="./drag-sort.html">拖拽排序</a></li>
        <li><a href="./export.html" class="active">数据导出</a></li>
        <li><a href="./theme.html">主题系统</a></li>
        <li><a href="./complete.html">完整功能</a></li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <div class="example-section">
      <h2>数据导出演示</h2>
      <p>这个示例展示了表格的数据导出功能，支持多种格式和自定义选项。</p>
      
      <div class="info-panel">
        <h4>导出特性</h4>
        <ul>
          <li>📊 CSV格式导出</li>
          <li>📋 Excel格式导出</li>
          <li>🔗 JSON格式导出</li>
          <li>📄 XML格式导出</li>
          <li>🌐 HTML格式导出</li>
          <li>🎯 选择性列导出</li>
          <li>🔍 筛选数据导出</li>
          <li>📈 导出进度跟踪</li>
        </ul>
      </div>

      <div class="controls">
        <h3>快速导出</h3>
        <button class="btn" onclick="exportCSV()">导出 CSV</button>
        <button class="btn" onclick="exportExcel()">导出 Excel</button>
        <button class="btn" onclick="exportJSON()">导出 JSON</button>
        <button class="btn" onclick="exportXML()">导出 XML</button>
        <button class="btn" onclick="exportHTML()">导出 HTML</button>
      </div>

      <div class="controls">
        <h3>导出选项</h3>
        <div class="export-options">
          <div class="option-group">
            <h4>导出范围</h4>
            <label>
              <input type="radio" name="exportRange" value="all" checked>
              全部数据
            </label>
            <label>
              <input type="radio" name="exportRange" value="filtered">
              筛选后数据
            </label>
            <label>
              <input type="radio" name="exportRange" value="selected">
              选中数据
            </label>
            <label>
              <input type="radio" name="exportRange" value="current">
              当前页数据
            </label>
          </div>
          
          <div class="option-group">
            <h4>导出列</h4>
            <label>
              <input type="checkbox" id="exportName" checked>
              姓名
            </label>
            <label>
              <input type="checkbox" id="exportAge" checked>
              年龄
            </label>
            <label>
              <input type="checkbox" id="exportDepartment" checked>
              部门
            </label>
            <label>
              <input type="checkbox" id="exportSalary" checked>
              薪资
            </label>
            <label>
              <input type="checkbox" id="exportJoinDate" checked>
              入职日期
            </label>
            <label>
              <input type="checkbox" id="exportStatus" checked>
              状态
            </label>
          </div>
        </div>
      </div>

      <div class="controls">
        <h3>高级导出</h3>
        <div class="advanced-export">
          <label>
            文件名前缀:
            <input type="text" id="filePrefix" value="员工数据" placeholder="文件名前缀">
          </label>
          <label>
            <input type="checkbox" id="includeTimestamp" checked>
            包含时间戳
          </label>
          <label>
            <input type="checkbox" id="includeHeaders" checked>
            包含表头
          </label>
          <button class="btn btn-primary" onclick="customExport()">自定义导出</button>
        </div>
      </div>

      <div class="table-container" id="exportTableContainer"></div>

      <div class="info-panel">
        <h4>导出状态</h4>
        <div>
          总记录数: <span class="status" id="totalRecords">0</span>
          筛选后记录数: <span class="status" id="filteredRecords">0</span>
          选中记录数: <span class="status" id="selectedRecords">0</span>
        </div>
        <div>
          导出进度: <span class="status" id="exportProgress">就绪</span>
        </div>
      </div>

      <div class="info-panel">
        <h4>导出历史</h4>
        <div id="exportHistory" class="export-history">
          <p>暂无导出记录</p>
        </div>
        <button class="btn btn-small" onclick="clearExportHistory()">清除历史</button>
      </div>

      <div class="log" id="operationLog"></div>
    </div>
  </div>

  <script type="module">
    import { Table } from '@ldesign/table'
    import '@ldesign/table/styles'
    import { sampleEmployees, basicColumns, createLogger } from './src/utils/data.js'

    let exportTable = null
    let exportHistory = []
    const log = createLogger('operationLog')

    // 扩展员工数据
    const extendedEmployees = [
      ...sampleEmployees,
      { id: 6, name: '赵六', age: 28, department: '财务部', salary: 7500, joinDate: '2023-08-15', status: '在职' },
      { id: 7, name: '孙七', age: 35, department: '技术部', salary: 12000, joinDate: '2022-03-10', status: '在职' },
      { id: 8, name: '周八', age: 26, department: '市场部', salary: 6800, joinDate: '2024-01-20', status: '在职' },
      { id: 9, name: '吴九', age: 31, department: '人事部', salary: 8200, joinDate: '2023-05-12', status: '在职' },
      { id: 10, name: '郑十', age: 29, department: '技术部', salary: 9500, joinDate: '2023-11-08', status: '在职' }
    ]

    // 初始化表格
    function initExportTable() {
      const container = document.getElementById('exportTableContainer')
      container.innerHTML = ''

      exportTable = new Table({
        container,
        columns: basicColumns,
        data: [...extendedEmployees],
        rowKey: 'id',
        selection: {
          enabled: true,
          multiple: true,
          checkboxColumn: true
        },
        pagination: {
          enabled: true,
          pageSize: 8
        },
        sorting: {
          enabled: true
        },
        filtering: {
          enabled: true
        }
      })

      // 绑定导出事件
      bindExportEvents()
      updateExportStatus()
      log('数据导出演示表格初始化完成', 'success')
    }

    // 绑定导出事件
    function bindExportEvents() {
      // 选择变更事件
      exportTable.on('selection-change', () => {
        updateExportStatus()
      })

      // 筛选变更事件
      exportTable.on('filter-change', () => {
        updateExportStatus()
      })

      // 导出进度事件
      exportTable.on('export-progress', (data) => {
        document.getElementById('exportProgress').textContent = `导出中... ${data.progress}%`
        document.getElementById('exportProgress').className = 'status warning'
      })

      // 导出完成事件
      exportTable.on('export-complete', (data) => {
        document.getElementById('exportProgress').textContent = '导出完成'
        document.getElementById('exportProgress').className = 'status success'
        
        // 记录导出历史
        const historyItem = {
          timestamp: new Date().toLocaleString(),
          format: data.format.toUpperCase(),
          filename: data.filename,
          recordCount: data.recordCount,
          size: data.size || '未知'
        }
        
        exportHistory.unshift(historyItem)
        if (exportHistory.length > 10) {
          exportHistory = exportHistory.slice(0, 10)
        }
        
        updateExportHistory()
        log(`导出完成: ${data.filename} (${data.recordCount} 条记录)`, 'success')
        
        // 重置进度状态
        setTimeout(() => {
          document.getElementById('exportProgress').textContent = '就绪'
          document.getElementById('exportProgress').className = 'status success'
        }, 2000)
      })
    }

    // 获取导出数据
    function getExportData() {
      const range = document.querySelector('input[name="exportRange"]:checked').value
      const dataManager = exportTable.getDataManager()
      
      let data = []
      switch (range) {
        case 'all':
          data = dataManager.getOriginalData()
          break
        case 'filtered':
          data = dataManager.getFilteredData()
          break
        case 'selected':
          data = exportTable.getSelectedRows()
          break
        case 'current':
          data = dataManager.getDisplayData()
          break
      }
      
      return data
    }

    // 获取导出列
    function getExportColumns() {
      const columns = []
      if (document.getElementById('exportName').checked) columns.push('name')
      if (document.getElementById('exportAge').checked) columns.push('age')
      if (document.getElementById('exportDepartment').checked) columns.push('department')
      if (document.getElementById('exportSalary').checked) columns.push('salary')
      if (document.getElementById('exportJoinDate').checked) columns.push('joinDate')
      if (document.getElementById('exportStatus').checked) columns.push('status')
      return columns
    }

    // 生成文件名
    function generateFilename(format) {
      const prefix = document.getElementById('filePrefix').value || '数据导出'
      const timestamp = document.getElementById('includeTimestamp').checked 
        ? '_' + new Date().toISOString().slice(0, 19).replace(/[:-]/g, '')
        : ''
      return `${prefix}${timestamp}.${format}`
    }

    // CSV导出
    window.exportCSV = function() {
      const data = getExportData()
      const columns = getExportColumns()
      const filename = generateFilename('csv')
      const includeHeaders = document.getElementById('includeHeaders').checked
      
      exportTable.exportData({
        format: 'csv',
        data,
        columns,
        filename,
        includeHeaders
      })
      
      log(`开始导出 CSV: ${filename}`, 'info')
    }

    // Excel导出
    window.exportExcel = function() {
      const data = getExportData()
      const columns = getExportColumns()
      const filename = generateFilename('xlsx')
      const includeHeaders = document.getElementById('includeHeaders').checked
      
      exportTable.exportData({
        format: 'excel',
        data,
        columns,
        filename,
        includeHeaders
      })
      
      log(`开始导出 Excel: ${filename}`, 'info')
    }

    // JSON导出
    window.exportJSON = function() {
      const data = getExportData()
      const columns = getExportColumns()
      const filename = generateFilename('json')
      
      exportTable.exportData({
        format: 'json',
        data,
        columns,
        filename
      })
      
      log(`开始导出 JSON: ${filename}`, 'info')
    }

    // XML导出
    window.exportXML = function() {
      const data = getExportData()
      const columns = getExportColumns()
      const filename = generateFilename('xml')
      
      exportTable.exportData({
        format: 'xml',
        data,
        columns,
        filename
      })
      
      log(`开始导出 XML: ${filename}`, 'info')
    }

    // HTML导出
    window.exportHTML = function() {
      const data = getExportData()
      const columns = getExportColumns()
      const filename = generateFilename('html')
      const includeHeaders = document.getElementById('includeHeaders').checked
      
      exportTable.exportData({
        format: 'html',
        data,
        columns,
        filename,
        includeHeaders
      })
      
      log(`开始导出 HTML: ${filename}`, 'info')
    }

    // 自定义导出
    window.customExport = function() {
      const format = prompt('请选择导出格式 (csv/excel/json/xml/html):', 'csv')
      if (!format) return
      
      const data = getExportData()
      const columns = getExportColumns()
      const filename = generateFilename(format.toLowerCase())
      const includeHeaders = document.getElementById('includeHeaders').checked
      
      exportTable.exportData({
        format: format.toLowerCase(),
        data,
        columns,
        filename,
        includeHeaders
      })
      
      log(`开始自定义导出 ${format.toUpperCase()}: ${filename}`, 'info')
    }

    // 更新导出状态
    function updateExportStatus() {
      const dataManager = exportTable.getDataManager()
      const totalRecords = dataManager.getOriginalData().length
      const filteredRecords = dataManager.getFilteredData().length
      const selectedRecords = exportTable.getSelectedRows().length

      document.getElementById('totalRecords').textContent = totalRecords
      document.getElementById('filteredRecords').textContent = filteredRecords
      document.getElementById('selectedRecords').textContent = selectedRecords

      // 更新状态样式
      document.getElementById('filteredRecords').className = `status ${filteredRecords < totalRecords ? 'warning' : 'success'}`
      document.getElementById('selectedRecords').className = `status ${selectedRecords > 0 ? 'success' : 'info'}`
    }

    // 更新导出历史
    function updateExportHistory() {
      const historyContainer = document.getElementById('exportHistory')
      
      if (exportHistory.length === 0) {
        historyContainer.innerHTML = '<p>暂无导出记录</p>'
        return
      }
      
      const historyHTML = exportHistory.map(item => `
        <div class="history-item">
          <div class="history-main">
            <span class="format">${item.format}</span>
            <span class="filename">${item.filename}</span>
            <span class="count">${item.recordCount} 条记录</span>
          </div>
          <div class="history-meta">
            <span class="time">${item.timestamp}</span>
            <span class="size">${item.size}</span>
          </div>
        </div>
      `).join('')
      
      historyContainer.innerHTML = historyHTML
    }

    // 清除导出历史
    window.clearExportHistory = function() {
      exportHistory = []
      updateExportHistory()
      log('清除导出历史', 'info')
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', () => {
      initExportTable()
      log('页面加载完成', 'success')
    })
  </script>

  <style>
    .export-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 15px 0;
    }

    .option-group h4 {
      margin: 0 0 10px 0;
      color: var(--ldesign-text-color-primary);
    }

    .option-group label {
      display: block;
      margin: 5px 0;
      cursor: pointer;
    }

    .advanced-export {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .advanced-export label {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .export-history {
      max-height: 250px;
      overflow-y: auto;
      border: 1px solid var(--ldesign-border-color);
      border-radius: var(--ls-border-radius-base);
      padding: 10px;
      background: var(--ldesign-bg-color-component);
    }

    .history-item {
      padding: 10px 0;
      border-bottom: 1px solid var(--ldesign-border-level-1-color);
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-main {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 5px;
    }

    .format {
      background: var(--ldesign-brand-color);
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: var(--ls-font-size-xs);
      font-weight: bold;
    }

    .filename {
      font-weight: 500;
      color: var(--ldesign-text-color-primary);
    }

    .count {
      color: var(--ldesign-text-color-secondary);
      font-size: var(--ls-font-size-xs);
    }

    .history-meta {
      display: flex;
      justify-content: space-between;
      font-size: var(--ls-font-size-xs);
      color: var(--ldesign-text-color-secondary);
    }

    .btn-primary {
      background: var(--ldesign-brand-color);
      color: white;
      border: none;
    }

    .btn-primary:hover {
      background: var(--ldesign-brand-color-hover);
    }

    .btn-small {
      padding: 5px 10px;
      font-size: var(--ls-font-size-xs);
    }
  </style>
</body>
</html>
