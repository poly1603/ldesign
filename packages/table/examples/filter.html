<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>筛选搜索示例 - LDESIGN Table</title>
  <link rel="stylesheet" href="./src/styles/main.css">
</head>
<body>
  <div class="page-header">
    <h1>🔍 筛选搜索示例</h1>
    <p>演示表格的高级筛选和搜索功能</p>
  </div>

  <nav class="nav">
    <div class="container">
      <ul class="nav-links">
        <li><a href="./index.html">首页</a></li>
        <li><a href="./basic.html">基础表格</a></li>
        <li><a href="./filter.html" class="active">筛选搜索</a></li>
        <li><a href="./editable.html">可编辑表格</a></li>
        <li><a href="./drag-sort.html">拖拽排序</a></li>
        <li><a href="./export.html">数据导出</a></li>
        <li><a href="./theme.html">主题系统</a></li>
        <li><a href="./complete.html">完整功能</a></li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <div class="example-section">
      <h2>筛选搜索演示</h2>
      <p>这个示例展示了表格的高级筛选和搜索功能，包括多列筛选、条件组合、实时搜索等。</p>
      
      <div class="info-panel">
        <h4>筛选特性</h4>
        <ul>
          <li>🔍 全局搜索功能</li>
          <li>📋 多列独立筛选</li>
          <li>🎯 精确匹配和模糊匹配</li>
          <li>📅 日期范围筛选</li>
          <li>🔢 数值范围筛选</li>
          <li>📝 文本包含筛选</li>
          <li>✅ 多选筛选</li>
          <li>🔄 筛选条件组合</li>
        </ul>
      </div>

      <div class="controls">
        <h3>全局搜索</h3>
        <input type="text" id="globalSearch" placeholder="搜索所有列..." class="search-input">
        <button class="btn" onclick="clearGlobalSearch()">清除搜索</button>
      </div>

      <div class="controls">
        <h3>快速筛选</h3>
        <button class="btn" onclick="filterByDepartment('技术部')">技术部员工</button>
        <button class="btn" onclick="filterByDepartment('市场部')">市场部员工</button>
        <button class="btn" onclick="filterByDepartment('人事部')">人事部员工</button>
        <button class="btn" onclick="filterHighSalary()">高薪员工 (>8000)</button>
        <button class="btn" onclick="filterRecentJoined()">新入职员工</button>
        <button class="btn" onclick="clearAllFilters()">清除所有筛选</button>
      </div>

      <div class="controls">
        <h3>高级筛选</h3>
        <div class="filter-row">
          <label>部门:</label>
          <select id="departmentFilter" onchange="applyAdvancedFilters()">
            <option value="">全部</option>
            <option value="技术部">技术部</option>
            <option value="市场部">市场部</option>
            <option value="人事部">人事部</option>
            <option value="财务部">财务部</option>
          </select>
        </div>
        <div class="filter-row">
          <label>薪资范围:</label>
          <input type="number" id="salaryMin" placeholder="最低薪资" onchange="applyAdvancedFilters()">
          <span>-</span>
          <input type="number" id="salaryMax" placeholder="最高薪资" onchange="applyAdvancedFilters()">
        </div>
        <div class="filter-row">
          <label>入职日期:</label>
          <input type="date" id="joinDateStart" onchange="applyAdvancedFilters()">
          <span>-</span>
          <input type="date" id="joinDateEnd" onchange="applyAdvancedFilters()">
        </div>
      </div>

      <div class="table-container" id="filterTableContainer"></div>

      <div class="info-panel">
        <h4>筛选状态</h4>
        <div>
          总记录数: <span class="status" id="totalRecords">0</span>
          筛选后记录数: <span class="status" id="filteredRecords">0</span>
          当前页记录数: <span class="status" id="currentPageRecords">0</span>
        </div>
        <div>
          活跃筛选器: <span class="status" id="activeFilters">无</span>
        </div>
      </div>

      <div class="log" id="operationLog"></div>
    </div>
  </div>

  <script type="module">
    import { Table } from '@ldesign/table'
    import '@ldesign/table/styles'
    import { sampleEmployees, basicColumns, createLogger } from './src/utils/data.js'

    let filterTable = null
    const log = createLogger('operationLog')

    // 扩展员工数据
    const extendedEmployees = [
      ...sampleEmployees,
      { id: 6, name: '赵六', age: 28, department: '财务部', salary: 7500, joinDate: '2023-08-15', status: '在职' },
      { id: 7, name: '孙七', age: 35, department: '技术部', salary: 12000, joinDate: '2022-03-10', status: '在职' },
      { id: 8, name: '周八', age: 26, department: '市场部', salary: 6800, joinDate: '2024-01-20', status: '在职' },
      { id: 9, name: '吴九', age: 31, department: '人事部', salary: 8200, joinDate: '2023-05-12', status: '在职' },
      { id: 10, name: '郑十', age: 29, department: '技术部', salary: 9500, joinDate: '2023-11-08', status: '在职' },
      { id: 11, name: '钱十一', age: 33, department: '财务部', salary: 8800, joinDate: '2022-09-25', status: '在职' },
      { id: 12, name: '陈十二', age: 27, department: '市场部', salary: 7200, joinDate: '2024-02-14', status: '在职' }
    ]

    // 初始化表格
    function initFilterTable() {
      const container = document.getElementById('filterTableContainer')
      container.innerHTML = ''

      filterTable = new Table({
        container,
        columns: basicColumns,
        data: [...extendedEmployees],
        rowKey: 'id',
        selection: {
          enabled: true,
          multiple: true,
          checkboxColumn: true
        },
        pagination: {
          enabled: true,
          pageSize: 8
        },
        sorting: {
          enabled: true
        },
        filtering: {
          enabled: true
        }
      })

      // 绑定筛选事件
      bindFilterEvents()
      updateFilterStatus()
      log('筛选演示表格初始化完成', 'success')
    }

    // 绑定筛选事件
    function bindFilterEvents() {
      // 全局搜索
      document.getElementById('globalSearch').addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase()
        if (searchTerm) {
          filterTable.setFilter('global', (row) => {
            return Object.values(row).some(value => 
              String(value).toLowerCase().includes(searchTerm)
            )
          })
          log(`全局搜索: "${searchTerm}"`, 'info')
        } else {
          filterTable.clearFilter('global')
          log('清除全局搜索', 'info')
        }
        updateFilterStatus()
      })

      // 筛选变更事件
      filterTable.on('filter-change', (data) => {
        log(`筛选变更: ${data.column || '全局'} - ${data.filters ? '设置' : '清除'}`, 'info')
        updateFilterStatus()
      })

      // 数据变更事件
      filterTable.on('data-change', () => {
        updateFilterStatus()
      })
    }

    // 按部门筛选
    window.filterByDepartment = function(department) {
      filterTable.setFilter('department', (row) => row.department === department)
      log(`筛选部门: ${department}`, 'info')
    }

    // 筛选高薪员工
    window.filterHighSalary = function() {
      filterTable.setFilter('salary', (row) => row.salary > 8000)
      log('筛选高薪员工 (>8000)', 'info')
    }

    // 筛选新入职员工
    window.filterRecentJoined = function() {
      const sixMonthsAgo = new Date()
      sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6)
      
      filterTable.setFilter('joinDate', (row) => {
        const joinDate = new Date(row.joinDate)
        return joinDate > sixMonthsAgo
      })
      log('筛选新入职员工 (6个月内)', 'info')
    }

    // 清除全局搜索
    window.clearGlobalSearch = function() {
      document.getElementById('globalSearch').value = ''
      filterTable.clearFilter('global')
      log('清除全局搜索', 'info')
    }

    // 清除所有筛选
    window.clearAllFilters = function() {
      filterTable.clearAllFilters()
      document.getElementById('globalSearch').value = ''
      document.getElementById('departmentFilter').value = ''
      document.getElementById('salaryMin').value = ''
      document.getElementById('salaryMax').value = ''
      document.getElementById('joinDateStart').value = ''
      document.getElementById('joinDateEnd').value = ''
      log('清除所有筛选条件', 'info')
    }

    // 应用高级筛选
    window.applyAdvancedFilters = function() {
      const department = document.getElementById('departmentFilter').value
      const salaryMin = document.getElementById('salaryMin').value
      const salaryMax = document.getElementById('salaryMax').value
      const joinDateStart = document.getElementById('joinDateStart').value
      const joinDateEnd = document.getElementById('joinDateEnd').value

      // 组合筛选条件
      filterTable.setFilter('advanced', (row) => {
        // 部门筛选
        if (department && row.department !== department) return false
        
        // 薪资范围筛选
        if (salaryMin && row.salary < parseInt(salaryMin)) return false
        if (salaryMax && row.salary > parseInt(salaryMax)) return false
        
        // 入职日期范围筛选
        if (joinDateStart || joinDateEnd) {
          const joinDate = new Date(row.joinDate)
          if (joinDateStart && joinDate < new Date(joinDateStart)) return false
          if (joinDateEnd && joinDate > new Date(joinDateEnd)) return false
        }
        
        return true
      })

      log('应用高级筛选条件', 'info')
    }

    // 更新筛选状态
    function updateFilterStatus() {
      const dataManager = filterTable.getDataManager()
      const totalRecords = dataManager.getOriginalData().length
      const filteredRecords = dataManager.getFilteredData().length
      const displayData = dataManager.getDisplayData()
      const currentPageRecords = displayData.length

      document.getElementById('totalRecords').textContent = totalRecords
      document.getElementById('filteredRecords').textContent = filteredRecords
      document.getElementById('currentPageRecords').textContent = currentPageRecords

      // 更新活跃筛选器
      const activeFilters = []
      if (document.getElementById('globalSearch').value) activeFilters.push('全局搜索')
      if (document.getElementById('departmentFilter').value) activeFilters.push('部门')
      if (document.getElementById('salaryMin').value || document.getElementById('salaryMax').value) activeFilters.push('薪资')
      if (document.getElementById('joinDateStart').value || document.getElementById('joinDateEnd').value) activeFilters.push('入职日期')

      document.getElementById('activeFilters').textContent = activeFilters.length > 0 ? activeFilters.join(', ') : '无'

      // 更新状态样式
      document.getElementById('filteredRecords').className = `status ${filteredRecords < totalRecords ? 'warning' : 'success'}`
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', () => {
      initFilterTable()
      log('页面加载完成', 'success')
    })
  </script>
</body>
</html>
