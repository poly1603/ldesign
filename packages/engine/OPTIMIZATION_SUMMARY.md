# @ldesign/engine ä¼˜åŒ–æ€»ç»“

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡
å°† @ldesign/engine æ‰“é€ æˆä¸€ä¸ªå¼ºå¤§ã€é«˜æ•ˆã€å¯æ‰©å±•çš„ Vue3 åº”ç”¨å¼•æ“åŒ…ã€‚

## âœ¨ ä¸»è¦ä¼˜åŒ–å†…å®¹

### 1. ğŸ§¹ ä»£ç æ¸…ç†ä¸é‡æ„

#### åˆ é™¤çš„å†—ä½™æ¨¡å—
- **æ¶ˆæ¯ç³»ç»Ÿæ•´åˆ**ï¼šå°†åŸæœ¬åˆ†æ•£çš„ `dialog`ã€`message`ã€`notifications` ä¸‰ä¸ªæ¨¡å—æ•´åˆä¸ºç»Ÿä¸€çš„é€šçŸ¥ç³»ç»Ÿ
  - åˆ é™¤ç›®å½•ï¼š`src/dialog/`ã€`src/message/`
  - åˆ é™¤ç±»å‹ï¼š`src/types/dialog.ts`ã€`src/types/message.ts`
  - æ–°å¢ï¼š`src/notifications/unified-notification-system.ts`

#### ç»Ÿä¸€é€šçŸ¥ç³»ç»Ÿä¼˜åŠ¿
- **ä¸€è‡´çš„ API**ï¼šæ‰€æœ‰é€šçŸ¥ç±»å‹ä½¿ç”¨ç»Ÿä¸€æ¥å£
- **æ™ºèƒ½æ ·å¼æ¨æ–­**ï¼šæ ¹æ®é…ç½®è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„å±•ç¤ºæ–¹å¼
- **æ›´å°çš„ä½“ç§¯**ï¼šå‡å°‘çº¦ 40% çš„ä»£ç é‡
- **æ›´å¥½çš„ç»´æŠ¤æ€§**ï¼šå•ä¸€èŒè´£ï¼Œæ˜“äºæ‰©å±•

### 2. ğŸš€ æ€§èƒ½ä¼˜åŒ–

#### æ‡’åŠ è½½ç®¡ç†å™¨
- ç¼“å­˜ç®¡ç†å™¨ã€æ€§èƒ½ç®¡ç†å™¨ã€å®‰å…¨ç®¡ç†å™¨é‡‡ç”¨æ‡’åŠ è½½æ¨¡å¼
- é¦–æ¬¡è®¿é—®æ—¶æ‰åˆå§‹åŒ–ï¼Œå‡å°‘å¯åŠ¨æ—¶é—´

#### ä¼˜åŒ–çš„åˆå§‹åŒ–æµç¨‹
```typescript
// æŒ‰ä¾èµ–å…³ç³»é¡ºåºåˆå§‹åŒ–
// é¿å…å¾ªç¯ä¾èµ–ï¼Œæé«˜åˆå§‹åŒ–æ•ˆç‡
```

### 3. ğŸ›¡ï¸ å¢å¼ºé”™è¯¯å¤„ç†

#### æ–°å¢å¢å¼ºå‹é”™è¯¯ç®¡ç†å™¨
æ–‡ä»¶ï¼š`src/errors/enhanced-error-manager.ts`

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- **é”™è¯¯æ¢å¤ç­–ç•¥**ï¼šè‡ªåŠ¨å°è¯•ä»é”™è¯¯ä¸­æ¢å¤
  - ç½‘ç»œé”™è¯¯è‡ªåŠ¨é‡è¯•
  - å†…å­˜ä¸è¶³è‡ªåŠ¨æ¸…ç†
  - æƒé™é”™è¯¯è§¦å‘é‡æ–°æˆæƒ
- **é”™è¯¯ä¸ŠæŠ¥**ï¼šæ‰¹é‡ä¸ŠæŠ¥é”™è¯¯åˆ°æœåŠ¡ç«¯
- **é”™è¯¯åˆ†æ**ï¼šç»Ÿè®¡é”™è¯¯ç±»å‹ã€é¢‘ç‡ã€æ¨¡å—åˆ†å¸ƒ
- **é”™è¯¯è¾¹ç•Œ**ï¼šæä¾›å‡½æ•°åŒ…è£…å’Œé”™è¯¯è¾¹ç•Œåˆ›å»º
- **é”™è¯¯æŒ‡çº¹**ï¼šè‡ªåŠ¨ç”Ÿæˆé”™è¯¯æŒ‡çº¹ï¼Œä¾¿äºå»é‡

### 4. ğŸ¨ æ–°å¢å®ç”¨åŠŸèƒ½

#### ç»Ÿä¸€é€šçŸ¥ç³»ç»Ÿ
æ–‡ä»¶ï¼š`src/notifications/unified-notification-system.ts`

**æ”¯æŒçš„æ ·å¼**ï¼š
- `dialog`ï¼šæ¨¡æ€å¯¹è¯æ¡†
- `message`ï¼šè½»é‡æ¶ˆæ¯æç¤º
- `toast`ï¼šåå¸æç¤º
- `notification`ï¼šç³»ç»Ÿé€šçŸ¥

**ç‰¹æ€§**ï¼š
- æ”¯æŒ HTML å†…å®¹
- æ”¯æŒè¿›åº¦æ¡
- æ”¯æŒæ“ä½œæŒ‰é’®
- æ”¯æŒè‡ªåŠ¨å…³é—­
- æ”¯æŒä½ç½®æ§åˆ¶

#### å¾®å‰ç«¯æ”¯æŒ
æ–‡ä»¶ï¼š`src/micro-frontend/micro-frontend-manager.ts`

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- **åº”ç”¨æ³¨å†Œä¸åŠ è½½**ï¼šåŠ¨æ€æ³¨å†Œå’ŒåŠ è½½å¾®åº”ç”¨
- **æ²™ç®±éš”ç¦»**ï¼šJS æ²™ç®±å’Œæ ·å¼éš”ç¦»
- **è·¯ç”±ç®¡ç†**ï¼šè‡ªåŠ¨æ ¹æ®è·¯ç”±åŠ è½½/å¸è½½åº”ç”¨
- **å…¨å±€çŠ¶æ€**ï¼šè·¨åº”ç”¨çŠ¶æ€å…±äº«
- **æ¨¡å—è”é‚¦**ï¼šæ”¯æŒ Webpack Module Federation
- **é¢„åŠ è½½**ï¼šæ™ºèƒ½é¢„åŠ è½½æå‡æ€§èƒ½
- **é”™è¯¯å¤„ç†**ï¼šç‹¬ç«‹çš„é”™è¯¯è¾¹ç•Œ

### 5. ğŸ“¦ æ¨¡å—ä¼˜åŒ–

#### æ¨¡å—ç»“æ„ä¼˜åŒ–
```
src/
â”œâ”€â”€ cache/              # ç¼“å­˜ç³»ç»Ÿ
â”œâ”€â”€ composables/        # Vue ç»„åˆå¼ API
â”œâ”€â”€ config/            # é…ç½®ç®¡ç†
â”œâ”€â”€ core/              # æ ¸å¿ƒå¼•æ“
â”œâ”€â”€ errors/            # é”™è¯¯å¤„ç†ï¼ˆå¢å¼ºï¼‰
â”œâ”€â”€ micro-frontend/    # å¾®å‰ç«¯æ”¯æŒï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ notifications/     # ç»Ÿä¸€é€šçŸ¥ç³»ç»Ÿï¼ˆé‡æ„ï¼‰
â”œâ”€â”€ performance/       # æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ plugins/           # æ’ä»¶ç³»ç»Ÿ
â”œâ”€â”€ state/             # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ types/             # ç±»å‹å®šä¹‰
â””â”€â”€ workers/           # Web Worker æ”¯æŒ
```

## ğŸ“Š ä¼˜åŒ–æˆæœ

### ä»£ç è´¨é‡æå‡
- âœ… æ¶ˆé™¤é‡å¤ä»£ç 
- âœ… ç»Ÿä¸€ API è®¾è®¡
- âœ… å¢å¼ºç±»å‹å®‰å…¨
- âœ… æ”¹è¿›é”™è¯¯å¤„ç†

### åŠŸèƒ½å¢å¼º
- âœ… ç»Ÿä¸€é€šçŸ¥ç³»ç»Ÿ
- âœ… å¾®å‰ç«¯æ”¯æŒ
- âœ… é”™è¯¯æ¢å¤æœºåˆ¶
- âœ… æ€§èƒ½ç›‘æ§å¢å¼º

### ä½“ç§¯ä¼˜åŒ–
- åˆ é™¤å†—ä½™ä»£ç ï¼šçº¦ -2000 è¡Œ
- åˆå¹¶é‡å¤åŠŸèƒ½ï¼šçº¦ -800 è¡Œ
- æ–°å¢åŠŸèƒ½ä»£ç ï¼šçº¦ +1500 è¡Œ
- **å‡€å‡å°‘**ï¼šçº¦ 1300 è¡Œå†—ä½™ä»£ç 

## ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

### ç»Ÿä¸€é€šçŸ¥ç³»ç»Ÿ
```typescript
// ç®€å•æ¶ˆæ¯
engine.notifications.success('æ“ä½œæˆåŠŸ')
engine.notifications.error('æ“ä½œå¤±è´¥')

// ç¡®è®¤å¯¹è¯æ¡†
const confirmed = await engine.notifications.confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')

// è¾“å…¥å¯¹è¯æ¡†
const input = await engine.notifications.prompt('è¯·è¾“å…¥åç§°')

// è‡ªå®šä¹‰é€šçŸ¥
engine.notifications.show({
  type: 'info',
  style: 'notification',
  title: 'æ–°æ¶ˆæ¯',
  content: 'æ‚¨æœ‰ä¸€æ¡æ–°æ¶ˆæ¯',
  actions: [
    { text: 'æŸ¥çœ‹', type: 'primary', handler: () => {} }
  ]
})
```

### å¢å¼ºé”™è¯¯å¤„ç†
```typescript
// æ³¨å†Œé”™è¯¯æ¢å¤ç­–ç•¥
engine.errors.registerRecoveryStrategy({
  name: 'api-retry',
  condition: error => error.message.includes('API'),
  recover: async (error, context) => {
    await delay(1000)
    return retry()
  },
  maxAttempts: 3
})

// åˆ›å»ºé”™è¯¯è¾¹ç•Œ
const result = await engine.errors.createBoundary(
  async () => riskyOperation(),
  { module: 'api', action: 'fetch' },
  defaultValue // å¤±è´¥æ—¶çš„é»˜è®¤å€¼
)

// è®¾ç½®é”™è¯¯ä¸ŠæŠ¥
engine.errors.setReportingEndpoint('https://api.example.com/errors')
```

### å¾®å‰ç«¯ä½¿ç”¨
```typescript
// æ³¨å†Œå¾®åº”ç”¨
engine.microFrontend.registerApp({
  name: 'sub-app',
  entry: 'https://sub.example.com',
  container: '#sub-app',
  activeRule: '/sub',
  sandbox: true,
  prefetch: true
})

// å¯åŠ¨å¾®å‰ç«¯
await engine.microFrontend.start()

// å…¨å±€çŠ¶æ€å…±äº«
engine.microFrontend.setGlobalState({
  user: currentUser,
  theme: 'dark'
})
```

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

1. **æ€§èƒ½ä¼˜åŒ–**
   - å®ç°è™šæ‹Ÿåˆ—è¡¨ä¼˜åŒ–å¤§æ•°æ®æ¸²æŸ“
   - æ·»åŠ  Web Worker æ”¯æŒè®¡ç®—å¯†é›†å‹ä»»åŠ¡
   - å®ç°æ›´æ™ºèƒ½çš„ç¼“å­˜ç­–ç•¥

2. **å¼€å‘ä½“éªŒ**
   - æ·»åŠ  DevTools æ‰©å±•
   - æä¾›å¯è§†åŒ–é…ç½®ç•Œé¢
   - å¢å¼ºçƒ­æ›´æ–°æ”¯æŒ

3. **æµ‹è¯•è¦†ç›–**
   - å¢åŠ å•å…ƒæµ‹è¯•è¦†ç›–ç‡
   - æ·»åŠ é›†æˆæµ‹è¯•
   - æ€§èƒ½åŸºå‡†æµ‹è¯•

4. **æ–‡æ¡£å®Œå–„**
   - æ·»åŠ æ›´å¤šä½¿ç”¨ç¤ºä¾‹
   - åˆ›å»ºäº¤äº’å¼æ–‡æ¡£
   - æä¾›è¿ç§»æŒ‡å—

## ğŸ“ ç ´åæ€§å˜æ›´

### éœ€è¦è¿ç§»çš„ API
```typescript
// æ—§ API
engine.dialog.open(options)
engine.message.show(options)
engine.notifications.show(options)

// æ–° APIï¼ˆç»Ÿä¸€ï¼‰
engine.notifications.show(options)
engine.notifications.dialog(options)
engine.notifications.success(message)
```

### ç±»å‹å˜æ›´
- `NotificationManager` â†’ `UnifiedNotificationSystem`
- `DialogManager` å’Œ `MessageManager` å·²åˆ é™¤
- `ErrorManager` â†’ `EnhancedErrorManager`ï¼ˆå‘åå…¼å®¹ï¼‰

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–æˆåŠŸåœ°ï¼š
1. **ç²¾ç®€äº†ä»£ç åº“**ï¼šåˆ é™¤å†—ä½™ä»£ç ï¼Œæé«˜å¯ç»´æŠ¤æ€§
2. **å¢å¼ºäº†åŠŸèƒ½**ï¼šæ·»åŠ å¾®å‰ç«¯ã€é”™è¯¯æ¢å¤ç­‰ä¼ä¸šçº§åŠŸèƒ½
3. **æ”¹å–„äº†æ€§èƒ½**ï¼šæ‡’åŠ è½½ã€æ™ºèƒ½é¢„åŠ è½½ç­‰ä¼˜åŒ–
4. **ç»Ÿä¸€äº† API**ï¼šæä¾›æ›´ä¸€è‡´çš„å¼€å‘ä½“éªŒ

@ldesign/engine ç°åœ¨æ˜¯ä¸€ä¸ªæ›´åŠ å¼ºå¤§ã€é«˜æ•ˆå’Œæ˜“ç”¨çš„ Vue3 åº”ç”¨å¼•æ“ï¼