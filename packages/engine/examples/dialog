<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Delete Confirm Dialog Plugin - Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 40px;
      font-size: 36px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .demo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }

    .demo-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1), 0 1px 3px rgba(0,0,0,0.08);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .demo-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.15), 0 4px 8px rgba(0,0,0,0.1);
    }

    .demo-card h3 {
      color: #333;
      margin-bottom: 12px;
      font-size: 20px;
    }

    .demo-card p {
      color: #666;
      margin-bottom: 20px;
      line-height: 1.6;
      font-size: 14px;
    }

    .demo-card button {
      width: 100%;
      padding: 12px 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 6px rgba(102, 126, 234, 0.3);
    }

    .demo-card button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
    }

    .demo-card button:active {
      transform: translateY(0);
    }

    .result {
      margin-top: 40px;
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .result h2 {
      color: #333;
      margin-bottom: 16px;
    }

    .result-content {
      background: #f5f5f5;
      border-radius: 8px;
      padding: 16px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      color: #333;
      max-height: 300px;
      overflow-y: auto;
    }

    .result-item {
      padding: 8px 0;
      border-bottom: 1px solid #e0e0e0;
    }

    .result-item:last-child {
      border-bottom: none;
    }

    .result-time {
      color: #999;
      font-size: 12px;
    }

    .result-message {
      margin-top: 4px;
    }

    .result-success {
      color: #4caf50;
    }

    .result-cancel {
      color: #ff9800;
    }

    .result-error {
      color: #f44336;
    }

    /* Dialog åŸºç¡€æ ·å¼ */
    .engine-dialog-mask {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .engine-dialog {
      position: relative;
      background: white;
      border-radius: 12px;
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.2);
      max-width: 90vw;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .engine-dialog-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e8e8e8;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .engine-dialog-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      margin: 0;
    }

    .engine-dialog-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
      padding: 0;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .engine-dialog-close:hover {
      background: #f5f5f5;
      color: #666;
    }

    .engine-dialog-body {
      padding: 24px;
      flex: 1;
      overflow-y: auto;
    }

    .engine-dialog-footer {
      padding: 16px 24px;
      border-top: 1px solid #e8e8e8;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ—‘ï¸ Delete Confirm Dialog Plugin</h1>

    <div class="demo-grid">
      <div class="demo-card">
        <h3>1ï¸âƒ£ ç®€å•åˆ é™¤</h3>
        <p>æœ€åŸºç¡€çš„åˆ é™¤ç¡®è®¤å¼¹çª—ï¼Œç”¨äºä¸€èˆ¬çš„åˆ é™¤æ“ä½œã€‚</p>
        <button onclick="demo1_simpleDelete()">åˆ é™¤ç”¨æˆ·æ•°æ®</button>
      </div>

      <div class="demo-card">
        <h3>2ï¸âƒ£ è‡ªå®šä¹‰æ¶ˆæ¯</h3>
        <p>è‡ªå®šä¹‰ç¡®è®¤æ¶ˆæ¯å†…å®¹ï¼Œæ›´å…·ä½“åœ°æè¿°åˆ é™¤æ“ä½œã€‚</p>
        <button onclick="demo2_customMessage()">åˆ é™¤æ–‡ä»¶</button>
      </div>

      <div class="demo-card">
        <h3>3ï¸âƒ£ è‡ªå®šä¹‰æŒ‰é’®</h3>
        <p>è‡ªå®šä¹‰æŒ‰é’®æ–‡æœ¬å’Œæ ·å¼ç±»å‹ã€‚</p>
        <button onclick="demo3_customButtons()">åˆ é™¤é¡¹ç›®</button>
      </div>

      <div class="demo-card">
        <h3>4ï¸âƒ£ å±é™©åˆ é™¤ï¼ˆè¾“å…¥ç¡®è®¤ï¼‰</h3>
        <p>å¯¹äºé‡è¦æ•°æ®çš„åˆ é™¤ï¼Œéœ€è¦ç”¨æˆ·è¾“å…¥ç¡®è®¤æ–‡æœ¬ã€‚</p>
        <button onclick="demo4_dangerousDelete()">åˆ é™¤æ•°æ®åº“</button>
      </div>

      <div class="demo-card">
        <h3>5ï¸âƒ£ å¿«é€Ÿåˆ é™¤</h3>
        <p>ä½¿ç”¨ç®€åŒ–çš„ API å¿«é€Ÿåˆ›å»ºåˆ é™¤ç¡®è®¤ã€‚</p>
        <button onclick="demo5_quickDelete()">å¿«é€Ÿåˆ é™¤</button>
      </div>

      <div class="demo-card">
        <h3>6ï¸âƒ£ æ‰¹é‡åˆ é™¤</h3>
        <p>æ‰¹é‡åˆ é™¤å¤šä¸ªé¡¹ç›®ï¼Œæ˜¾ç¤ºæ•°é‡ç»Ÿè®¡ã€‚</p>
        <button onclick="demo6_batchDelete()">åˆ é™¤ 5 ä¸ªæ–‡ä»¶</button>
      </div>

      <div class="demo-card">
        <h3>7ï¸âƒ£ å¸¦å›è°ƒçš„åˆ é™¤</h3>
        <p>åœ¨ç¡®è®¤åè‡ªåŠ¨æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p>
        <button onclick="demo7_withCallback()">åˆ é™¤å¹¶æ‰§è¡Œå›è°ƒ</button>
      </div>

      <div class="demo-card">
        <h3>8ï¸âƒ£ æ— è­¦å‘Šå›¾æ ‡</h3>
        <p>éšè—è­¦å‘Šå›¾æ ‡çš„ç®€æ´ç‰ˆæœ¬ã€‚</p>
        <button onclick="demo8_noIcon()">åˆ é™¤ï¼ˆæ— å›¾æ ‡ï¼‰</button>
      </div>
    </div>

    <div class="result">
      <h2>ğŸ“‹ æ“ä½œç»“æœ</h2>
      <div class="result-content" id="result-content">
        <div style="color: #999; text-align: center; padding: 20px;">
          ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============ æ¨¡æ‹Ÿ Dialog Manager ============
    class SimpleDialogManager {
      constructor() {
        this.dialogs = []
        this.zIndexCounter = 2000
      }

      async open(options) {
        const id = 'dialog-' + Date.now()
        const zIndex = this.zIndexCounter++

        return new Promise((resolve) => {
          // åˆ›å»ºé®ç½©å±‚
          const mask = document.createElement('div')
          mask.className = 'engine-dialog-mask'
          mask.style.zIndex = zIndex

          // åˆ›å»ºå¯¹è¯æ¡†
          const dialog = document.createElement('div')
          dialog.className = 'engine-dialog'
          if (options.customClass) {
            dialog.className += ' ' + options.customClass
          }
          if (options.width) {
            dialog.style.width = typeof options.width === 'number' ? options.width + 'px' : options.width
          }

          // å¤´éƒ¨
          const header = document.createElement('div')
          header.className = 'engine-dialog-header'
          header.innerHTML = `
            <h3 class="engine-dialog-title">${options.title || ''}</h3>
            ${options.closable !== false ? '<button class="engine-dialog-close">Ã—</button>' : ''}
          `

          // å†…å®¹
          const body = document.createElement('div')
          body.className = 'engine-dialog-body'
          if (options.html) {
            body.innerHTML = options.content || ''
          } else {
            body.textContent = options.content || ''
          }

          // åº•éƒ¨æŒ‰é’®
          const footer = document.createElement('div')
          footer.className = 'engine-dialog-footer'
          if (options.buttons && options.buttons.length > 0) {
            options.buttons.forEach((btn) => {
              const button = document.createElement('button')
              button.textContent = btn.text
              button.disabled = btn.disabled || false
              button.onclick = () => {
                if (btn.onClick) {
                  btn.onClick(instance)
                }
              }
              footer.appendChild(button)
            })
          }

          dialog.appendChild(header)
          dialog.appendChild(body)
          if (options.buttons && options.buttons.length > 0) {
            dialog.appendChild(footer)
          }
          mask.appendChild(dialog)

          // å…³é—­æŒ‰é’®äº‹ä»¶
          const closeBtn = header.querySelector('.engine-dialog-close')
          if (closeBtn) {
            closeBtn.onclick = () => instance.close(false)
          }

          // æ·»åŠ åˆ°é¡µé¢
          document.body.appendChild(mask)

          // åŠ¨ç”»æ•ˆæœ
          setTimeout(() => {
            mask.style.animation = 'fadeIn 0.2s'
            dialog.style.animation = 'zoomIn 0.2s'
          }, 10)

          const instance = {
            id,
            element: dialog,
            maskElement: mask,
            close: async (result) => {
              mask.style.animation = 'fadeOut 0.2s'
              dialog.style.animation = 'zoomOut 0.2s'
              setTimeout(() => {
                document.body.removeChild(mask)
              }, 200)
              if (options.onClose) {
                options.onClose(result)
              }
              return result
            }
          }

          if (options.onOpen) {
            options.onOpen()
          }

          resolve(instance)
        })
      }
    }

    // ============ Delete Confirm Plugin ============
    class DeleteConfirmPlugin {
      constructor() {
        this.dialogManager = new SimpleDialogManager()
        this.injectStyles()
      }

      injectStyles() {
        if (document.querySelector('#delete-confirm-styles')) return

        const style = document.createElement('style')
        style.id = 'delete-confirm-styles'
        style.textContent = `
          @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
          }
          @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
          }
          @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
          }
          @keyframes zoomOut {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0.9); opacity: 0; }
          }
          @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
          }

          .delete-confirm-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 10px 0;
          }

          .delete-confirm-icon {
            animation: scaleIn 0.3s ease-out;
          }

          .delete-confirm-message {
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            text-align: center;
          }

          .delete-confirm-input-group {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 10px;
          }

          .delete-confirm-label {
            font-size: 14px;
            color: #666;
          }

          .delete-confirm-label strong {
            color: #f44336;
            font-weight: 600;
          }

          .delete-confirm-input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.2s;
          }

          .delete-confirm-input:focus {
            outline: none;
            border-color: #2196F3;
          }
        `
        document.head.appendChild(style)
      }

      async showDeleteConfirm(options = {}) {
        const {
          itemName = 'æ­¤é¡¹',
          message,
          showWarningIcon = true,
          confirmText = 'ç¡®è®¤åˆ é™¤',
          cancelText = 'å–æ¶ˆ',
          requireConfirmInput = false,
          confirmInputText = 'DELETE',
          onConfirm,
          onCancel
        } = options

        const content = message || `ç¡®å®šè¦åˆ é™¤${itemName}å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`

        if (requireConfirmInput) {
          return this.showWithInput(content, confirmInputText, confirmText, cancelText, showWarningIcon, onConfirm, onCancel)
        }

        return this.showSimple(content, confirmText, cancelText, showWarningIcon, onConfirm, onCancel)
      }

      async showSimple(content, confirmText, cancelText, showWarningIcon, onConfirm, onCancel) {
        return new Promise((resolve) => {
          const contentHTML = `
            <div class="delete-confirm-content">
              ${showWarningIcon ? `
                <div class="delete-confirm-icon">
                  <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                    <circle cx="24" cy="24" r="20" fill="#FFF3E0"/>
                    <path d="M24 14V26M24 30V32" stroke="#FF9800" stroke-width="3" stroke-linecap="round"/>
                  </svg>
                </div>
              ` : ''}
              <div class="delete-confirm-message">${content}</div>
            </div>
          `

          this.dialogManager.open({
            title: 'åˆ é™¤ç¡®è®¤',
            content: contentHTML,
            html: true,
            width: 460,
            customClass: 'delete-confirm-dialog',
            buttons: [
              {
                text: cancelText,
                onClick: async (dialog) => {
                  if (onCancel) onCancel()
                  await dialog.close(false)
                  resolve(false)
                }
              },
              {
                text: confirmText,
                onClick: async (dialog) => {
                  if (onConfirm) {
                    try {
                      await onConfirm()
                    } catch (e) {
                      console.error(e)
                      return
                    }
                  }
                  await dialog.close(true)
                  resolve(true)
                }
              }
            ]
          })
        })
      }

      async showWithInput(content, confirmInputText, confirmText, cancelText, showWarningIcon, onConfirm, onCancel) {
        return new Promise((resolve) => {
          const contentHTML = `
            <div class="delete-confirm-content">
              ${showWarningIcon ? `
                <div class="delete-confirm-icon">
                  <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                    <circle cx="24" cy="24" r="20" fill="#FFEBEE"/>
                    <path d="M24 14V26M24 30V32" stroke="#F44336" stroke-width="3" stroke-linecap="round"/>
                  </svg>
                </div>
              ` : ''}
              <div class="delete-confirm-message">${content}</div>
              <div class="delete-confirm-input-group">
                <label class="delete-confirm-label">
                  è¯·è¾“å…¥ <strong>${confirmInputText}</strong> ä»¥ç¡®è®¤åˆ é™¤ï¼š
                </label>
                <input type="text" class="delete-confirm-input" placeholder="è¾“å…¥ ${confirmInputText}" autocomplete="off" />
              </div>
            </div>
          `

          this.dialogManager.open({
            title: 'åˆ é™¤ç¡®è®¤',
            content: contentHTML,
            html: true,
            width: 500,
            customClass: 'delete-confirm-dialog',
            buttons: [
              {
                text: cancelText,
                onClick: async (dialog) => {
                  if (onCancel) onCancel()
                  await dialog.close(false)
                  resolve(false)
                }
              },
              {
                text: confirmText,
                disabled: true,
                onClick: async (dialog) => {
                  if (onConfirm) {
                    try {
                      await onConfirm()
                    } catch (e) {
                      console.error(e)
                      return
                    }
                  }
                  await dialog.close(true)
                  resolve(true)
                }
              }
            ],
            onOpen: () => {
              setTimeout(() => {
                const input = document.querySelector('.delete-confirm-input')
                const buttons = document.querySelectorAll('.engine-dialog-footer button')
                const confirmBtn = buttons[1]

                if (input && confirmBtn) {
                  input.focus()
                  input.addEventListener('input', (e) => {
                    confirmBtn.disabled = e.target.value.trim() !== confirmInputText
                  })
                  input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && e.target.value.trim() === confirmInputText) {
                      confirmBtn.click()
                    }
                  })
                }
              }, 100)
            }
          })
        })
      }
    }

    // åˆ›å»ºå®ä¾‹
    const deletePlugin = new DeleteConfirmPlugin()

    // æ—¥å¿—å‡½æ•°
    function logResult(message, type = 'info') {
      const resultContent = document.getElementById('result-content')
      const item = document.createElement('div')
      item.className = 'result-item'
      
      const time = new Date().toLocaleTimeString()
      const typeClass = type === 'success' ? 'result-success' : type === 'cancel' ? 'result-cancel' : type === 'error' ? 'result-error' : ''
      
      item.innerHTML = `
        <div class="result-time">${time}</div>
        <div class="result-message ${typeClass}">${message}</div>
      `
      
      if (resultContent.firstChild.textContent.includes('ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®')) {
        resultContent.innerHTML = ''
      }
      
      resultContent.insertBefore(item, resultContent.firstChild)
    }

    // ============ Demo å‡½æ•° ============
    async function demo1_simpleDelete() {
      const confirmed = await deletePlugin.showDeleteConfirm({
        itemName: 'ç”¨æˆ·æ•°æ®'
      })
      logResult(confirmed ? 'âœ… ç”¨æˆ·ç¡®è®¤åˆ é™¤ç”¨æˆ·æ•°æ®' : 'âŒ ç”¨æˆ·å–æ¶ˆåˆ é™¤', confirmed ? 'success' : 'cancel')
    }

    async function demo2_customMessage() {
      const confirmed = await deletePlugin.showDeleteConfirm({
        itemName: 'æ–‡ä»¶ "document.pdf"',
        message: 'åˆ é™¤åå°†æ— æ³•æ¢å¤ï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ'
      })
      logResult(confirmed ? 'âœ… æ–‡ä»¶å·²åˆ é™¤' : 'âŒ å–æ¶ˆåˆ é™¤æ–‡ä»¶', confirmed ? 'success' : 'cancel')
    }

    async function demo3_customButtons() {
      const confirmed = await deletePlugin.showDeleteConfirm({
        itemName: 'é¡¹ç›®æ–‡ä»¶å¤¹',
        confirmText: 'æ°¸ä¹…åˆ é™¤',
        cancelText: 'æš‚ä¸åˆ é™¤'
      })
      logResult(confirmed ? 'âœ… é¡¹ç›®å·²æ°¸ä¹…åˆ é™¤' : 'âŒ æš‚ä¸åˆ é™¤é¡¹ç›®', confirmed ? 'success' : 'cancel')
    }

    async function demo4_dangerousDelete() {
      const confirmed = await deletePlugin.showDeleteConfirm({
        itemName: 'æ•´ä¸ªæ•°æ®åº“',
        message: 'æ‚¨å³å°†åˆ é™¤æ•´ä¸ªæ•°æ®åº“ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„æ“ä½œï¼',
        requireConfirmInput: true,
        confirmInputText: 'DELETE'
      })
      logResult(confirmed ? 'âœ… æ•°æ®åº“å·²åˆ é™¤ï¼ˆå±é™©æ“ä½œï¼‰' : 'âŒ å–æ¶ˆåˆ é™¤æ•°æ®åº“', confirmed ? 'success' : 'cancel')
    }

    async function demo5_quickDelete() {
      const confirmed = await deletePlugin.showDeleteConfirm({ itemName: 'è¿™æ¡è®°å½•' })
      logResult(confirmed ? 'âœ… è®°å½•å·²åˆ é™¤' : 'âŒ å–æ¶ˆåˆ é™¤è®°å½•', confirmed ? 'success' : 'cancel')
    }

    async function demo6_batchDelete() {
      const confirmed = await deletePlugin.showDeleteConfirm({
        itemName: '5 ä¸ªæ–‡ä»¶',
        message: 'ç¡®å®šè¦åˆ é™¤è¿™ 5 ä¸ªæ–‡ä»¶å—ï¼Ÿ'
      })
      logResult(confirmed ? 'âœ… æ‰¹é‡åˆ é™¤äº† 5 ä¸ªæ–‡ä»¶' : 'âŒ å–æ¶ˆæ‰¹é‡åˆ é™¤', confirmed ? 'success' : 'cancel')
    }

    async function demo7_withCallback() {
      const confirmed = await deletePlugin.showDeleteConfirm({
        itemName: 'é‡è¦æ–‡æ¡£',
        onConfirm: () => {
          logResult('ğŸ”„ æ‰§è¡Œåˆ é™¤å›è°ƒ...', 'info')
        },
        onCancel: () => {
          logResult('ğŸ”„ æ‰§è¡Œå–æ¶ˆå›è°ƒ...', 'info')
        }
      })
      logResult(confirmed ? 'âœ… åˆ é™¤å®Œæˆï¼ˆå¸¦å›è°ƒï¼‰' : 'âŒ å·²å–æ¶ˆï¼ˆå¸¦å›è°ƒï¼‰', confirmed ? 'success' : 'cancel')
    }

    async function demo8_noIcon() {
      const confirmed = await deletePlugin.showDeleteConfirm({
        itemName: 'ä¸´æ—¶æ–‡ä»¶',
        showWarningIcon: false
      })
      logResult(confirmed ? 'âœ… ä¸´æ—¶æ–‡ä»¶å·²åˆ é™¤' : 'âŒ å–æ¶ˆåˆ é™¤', confirmed ? 'success' : 'cancel')
    }

    // åˆå§‹åŒ–æ—¥å¿—
    logResult('ğŸš€ Delete Confirm Plugin å·²å°±ç»ª', 'info')
  </script>
</body>
</html>
