<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Range Debug</title>
  <script type="module" src="./dist/ldesign/ldesign.esm.js"></script>
  <link rel="stylesheet" href="./dist/ldesign/ldesign.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .panel {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
    }
    .state-panel {
      background: #f8f9fa;
    }
    h2 {
      margin-top: 0;
      font-size: 18px;
      color: #333;
    }
    .state-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #e0e0e0;
    }
    .state-label {
      color: #666;
      font-weight: 500;
    }
    .state-value {
      font-family: monospace;
      color: #0066cc;
      font-weight: bold;
    }
    .action-buttons {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }
    button {
      padding: 8px 16px;
      border: 1px solid #0066cc;
      background: white;
      color: #0066cc;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #0066cc;
      color: white;
    }
    .log-area {
      margin-top: 20px;
      padding: 10px;
      background: #1e1e1e;
      color: #d4d4d4;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
    }
    .log-entry {
      margin-bottom: 4px;
    }
    .log-time {
      color: #888;
    }
    .log-event {
      color: #4ec9b0;
    }
    .log-data {
      color: #ce9178;
    }
  </style>
</head>
<body>
  <h1>时间范围选择调试工具</h1>
  
  <div class="container">
    <div class="panel">
      <h2>时间选择器</h2>
      
      <ldesign-time-picker 
        id="picker" 
        range="true"
        placeholder="选择时间范围"
        confirm="true"
        show-seconds="false"
      ></ldesign-time-picker>
      
      <div class="action-buttons">
        <button onclick="setStartTime()">设置开始时间 09:00</button>
        <button onclick="setEndTime()">设置结束时间 18:00</button>
        <button onclick="clearAll()">清空</button>
      </div>
      
      <div class="log-area" id="log"></div>
    </div>
    
    <div class="panel state-panel">
      <h2>组件状态监控</h2>
      
      <div class="state-item">
        <span class="state-label">activePanel:</span>
        <span class="state-value" id="activePanel">-</span>
      </div>
      
      <div class="state-item">
        <span class="state-label">startValue:</span>
        <span class="state-value" id="startValue">-</span>
      </div>
      
      <div class="state-item">
        <span class="state-label">endValue:</span>
        <span class="state-value" id="endValue">-</span>
      </div>
      
      <div class="state-item">
        <span class="state-label">h (开始小时):</span>
        <span class="state-value" id="h">-</span>
      </div>
      
      <div class="state-item">
        <span class="state-label">m (开始分钟):</span>
        <span class="state-value" id="m">-</span>
      </div>
      
      <div class="state-item">
        <span class="state-label">s (开始秒):</span>
        <span class="state-value" id="s">-</span>
      </div>
      
      <div class="state-item">
        <span class="state-label">endH (结束小时):</span>
        <span class="state-value" id="endH">-</span>
      </div>
      
      <div class="state-item">
        <span class="state-label">endM (结束分钟):</span>
        <span class="state-value" id="endM">-</span>
      </div>
      
      <div class="state-item">
        <span class="state-label">endS (结束秒):</span>
        <span class="state-value" id="endS">-</span>
      </div>
      
      <div class="state-item">
        <span class="state-label">meridiem (开始):</span>
        <span class="state-value" id="meridiem">-</span>
      </div>
      
      <div class="state-item">
        <span class="state-label">endMeridiem (结束):</span>
        <span class="state-value" id="endMeridiem">-</span>
      </div>
      
      <div class="state-item">
        <span class="state-label">最后事件:</span>
        <span class="state-value" id="lastEvent">-</span>
      </div>
    </div>
  </div>
  
  <script>
    const picker = document.getElementById('picker');
    let updateTimer;
    
    function log(event, data) {
      const logEl = document.getElementById('log');
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `<span class="log-time">[${time}]</span> <span class="log-event">${event}:</span> <span class="log-data">${JSON.stringify(data)}</span>`;
      logEl.insertBefore(entry, logEl.firstChild);
      
      // 限制日志数量
      while (logEl.children.length > 50) {
        logEl.removeChild(logEl.lastChild);
      }
    }
    
    function updateState() {
      // 延迟获取状态，确保DOM更新
      clearTimeout(updateTimer);
      updateTimer = setTimeout(() => {
        try {
          // 尝试读取组件内部状态
          document.getElementById('activePanel').textContent = picker.activePanel || '-';
          document.getElementById('startValue').textContent = picker.startValue || '-';
          document.getElementById('endValue').textContent = picker.endValue || '-';
          document.getElementById('h').textContent = picker.h !== undefined ? picker.h : '-';
          document.getElementById('m').textContent = picker.m !== undefined ? picker.m : '-';
          document.getElementById('s').textContent = picker.s !== undefined ? picker.s : '-';
          document.getElementById('endH').textContent = picker.endH !== undefined ? picker.endH : '-';
          document.getElementById('endM').textContent = picker.endM !== undefined ? picker.endM : '-';
          document.getElementById('endS').textContent = picker.endS !== undefined ? picker.endS : '-';
          document.getElementById('meridiem').textContent = picker.meridiem || '-';
          document.getElementById('endMeridiem').textContent = picker.endMeridiem || '-';
        } catch (e) {
          console.error('Error reading state:', e);
        }
      }, 100);
    }
    
    // 监听所有事件
    picker.addEventListener('ldesignChange', (e) => {
      log('Change', e.detail);
      document.getElementById('lastEvent').textContent = 'Change';
      updateState();
    });
    
    picker.addEventListener('ldesignPick', (e) => {
      log('Pick', e.detail);
      document.getElementById('lastEvent').textContent = 'Pick';
      updateState();
    });
    
    picker.addEventListener('ldesignOpen', () => {
      log('Open', '弹层打开');
      document.getElementById('lastEvent').textContent = 'Open';
      updateState();
    });
    
    picker.addEventListener('ldesignClose', () => {
      log('Close', '弹层关闭');
      document.getElementById('lastEvent').textContent = 'Close';
      updateState();
    });
    
    picker.addEventListener('ldesignVisibleChange', (e) => {
      log('VisibleChange', e.detail);
      updateState();
    });
    
    // 测试函数
    function setStartTime() {
      picker.startValue = '09:00';
      log('Action', '设置开始时间为 09:00');
      updateState();
    }
    
    function setEndTime() {
      picker.endValue = '18:00';
      log('Action', '设置结束时间为 18:00');
      updateState();
    }
    
    function clearAll() {
      picker.startValue = undefined;
      picker.endValue = undefined;
      picker.value = undefined;
      log('Action', '清空所有值');
      updateState();
    }
    
    // 定时更新状态
    setInterval(updateState, 2000);
    
    // 初始化
    updateState();
    log('Init', '调试工具已初始化');
    
    console.log('时间范围调试工具已加载');
    console.log('可以实时查看组件内部状态');
    console.log('所有操作都会记录在日志中');
  </script>
</body>
</html>