<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Drawer 移动端完整测试</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding-bottom: env(safe-area-inset-bottom);
    }
    
    .mobile-simulator {
      width: 100%;
      max-width: 430px;
      margin: 0 auto;
      background: #f5f7fa;
      min-height: 100vh;
      position: relative;
      box-shadow: 0 0 40px rgba(0,0,0,0.2);
    }
    
    .status-bar {
      background: white;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #666;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .test-section {
      background: white;
      margin: 10px;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .test-section h3 {
      font-size: 16px;
      color: #333;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .test-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .test-btn {
      padding: 12px 8px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }
    
    .test-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.4s, height 0.4s;
    }
    
    .test-btn:active::before {
      width: 200px;
      height: 200px;
    }
    
    .test-btn:active {
      transform: scale(0.95);
    }
    
    .test-btn.secondary {
      background: #6b7280;
    }
    
    .test-btn.success {
      background: #10b981;
    }
    
    .test-btn.warning {
      background: #f59e0b;
    }
    
    .test-btn.danger {
      background: #ef4444;
    }
    
    .test-btn.full {
      grid-column: 1 / -1;
    }
    
    .config-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
    }
    
    .config-item label {
      font-size: 14px;
      color: #555;
    }
    
    .config-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
    }
    
    .config-item input[type="text"],
    .config-item select {
      padding: 6px 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      width: 120px;
    }
    
    .device-info {
      background: #f0f9ff;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      font-size: 12px;
      color: #0369a1;
    }
    
    .drawer-content {
      padding: 20px;
    }
    
    .drawer-content h2 {
      font-size: 20px;
      color: #333;
      margin-bottom: 15px;
    }
    
    .drawer-content .info {
      background: #f9fafb;
      padding: 12px;
      border-radius: 8px;
      margin: 10px 0;
      font-size: 14px;
      line-height: 1.6;
    }
    
    .drawer-content .long-content {
      height: 800px;
      background: linear-gradient(to bottom, #fef3c7, #fde68a);
      padding: 20px;
      border-radius: 8px;
      margin-top: 15px;
    }
    
    .drawer-content .long-content h3 {
      font-size: 16px;
      margin-bottom: 10px;
    }
    
    .drawer-content .long-content p {
      margin: 10px 0;
      line-height: 1.8;
    }
    
    /* 适配 iPhone 刘海屏 */
    @supports (padding: env(safe-area-inset-top)) {
      .status-bar {
        padding-top: calc(10px + env(safe-area-inset-top));
      }
    }
    
    /* 横屏适配 */
    @media (orientation: landscape) {
      .mobile-simulator {
        max-width: 100%;
      }
      
      .test-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    /* 小屏幕适配 */
    @media (max-width: 360px) {
      .test-grid {
        grid-template-columns: 1fr;
      }
      
      .test-btn {
        padding: 14px 12px;
      }
    }
  </style>
  <script type="module" src="/build/ldesign-webcomponent.esm.js"></script>
</head>
<body>
  <div class="mobile-simulator">
    <div class="status-bar">
      <span id="deviceType">检测中...</span>
      <span id="screenSize">--x--</span>
    </div>
    
    <div class="test-section">
      <h3>📱 设备信息</h3>
      <div class="device-info" id="deviceInfo">
        正在获取设备信息...
      </div>
    </div>
    
    <div class="test-section">
      <h3>🎯 基础测试</h3>
      <div class="test-grid">
        <button class="test-btn" onclick="testDrawer('right')">右侧抽屉</button>
        <button class="test-btn" onclick="testDrawer('left')">左侧抽屉</button>
        <button class="test-btn" onclick="testDrawer('top')">顶部抽屉</button>
        <button class="test-btn" onclick="testDrawer('bottom')">底部抽屉</button>
      </div>
    </div>
    
    <div class="test-section">
      <h3>📏 尺寸测试</h3>
      <div class="test-grid">
        <button class="test-btn secondary" onclick="testSize('100%')">全屏 (100%)</button>
        <button class="test-btn secondary" onclick="testSize('90%')">90% 宽度</button>
        <button class="test-btn secondary" onclick="testSize('80%')">80% 宽度</button>
        <button class="test-btn secondary" onclick="testSize('60%')">60% 宽度</button>
        <button class="test-btn secondary" onclick="testSize('300px')">300px 固定</button>
        <button class="test-btn secondary" onclick="testSize('50vh')">50vh 高度</button>
      </div>
    </div>
    
    <div class="test-section">
      <h3>🎨 功能测试</h3>
      <div class="test-grid">
        <button class="test-btn success" onclick="testSwipeClose()">滑动关闭</button>
        <button class="test-btn success" onclick="testResizable()">调整大小</button>
        <button class="test-btn success" onclick="testFullscreen()">全屏切换</button>
        <button class="test-btn success" onclick="testScrollContent()">长内容滚动</button>
        <button class="test-btn warning full" onclick="testAllDirections()">自动测试所有方向</button>
        <button class="test-btn danger full" onclick="testStress()">压力测试</button>
      </div>
    </div>
    
    <div class="test-section">
      <h3>⚙️ 配置</h3>
      <div class="config-item">
        <label>启用遮罩</label>
        <input type="checkbox" id="maskEnabled" checked>
      </div>
      <div class="config-item">
        <label>圆角样式</label>
        <input type="checkbox" id="roundedEnabled" checked>
      </div>
      <div class="config-item">
        <label>滑动关闭</label>
        <input type="checkbox" id="swipeEnabled" checked>
      </div>
      <div class="config-item">
        <label>可调整大小</label>
        <input type="checkbox" id="resizableEnabled" checked>
      </div>
      <div class="config-item">
        <label>动画时长</label>
        <select id="animDuration">
          <option value="200">200ms</option>
          <option value="300" selected>300ms</option>
          <option value="500">500ms</option>
        </select>
      </div>
    </div>
  </div>
  
  <!-- Drawer 组件实例 -->
  <ldesign-drawer id="testDrawer">
    <div class="drawer-content">
      <h2 id="drawerTitle">测试抽屉</h2>
      <div class="info" id="drawerInfo">
        正在加载信息...
      </div>
      <div id="scrollContent" style="display: none;">
        <div class="long-content">
          <h3>📜 滚动测试内容</h3>
          <p>这是一个很长的内容区域，用于测试抽屉内的滚动功能。</p>
          <p>在移动设备上，需要确保滚动流畅，并且不会与滑动关闭手势冲突。</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
          <p>继续滚动查看更多内容...</p>
          <p>1. 测试项目一</p>
          <p>2. 测试项目二</p>
          <p>3. 测试项目三</p>
          <p>4. 测试项目四</p>
          <p>5. 测试项目五</p>
          <p>6. 测试项目六</p>
          <p>7. 测试项目七</p>
          <p>8. 测试项目八</p>
          <p>9. 测试项目九</p>
          <p>10. 测试项目十</p>
          <p>继续添加更多内容以确保可以滚动...</p>
          <p>这里是底部内容</p>
        </div>
      </div>
    </div>
  </ldesign-drawer>
  
  <script>
    const drawer = document.getElementById('testDrawer');
    let currentConfig = {};
    
    // 获取设备信息
    function updateDeviceInfo() {
      const ua = navigator.userAgent;
      const width = window.innerWidth;
      const height = window.innerHeight;
      const dpr = window.devicePixelRatio || 1;
      
      let deviceType = '桌面端';
      let os = 'Unknown';
      
      if (/iPhone|iPad|iPod/.test(ua)) {
        deviceType = width <= 430 ? 'iPhone' : 'iPad';
        os = 'iOS';
      } else if (/Android/.test(ua)) {
        deviceType = width <= 430 ? 'Android手机' : 'Android平板';
        os = 'Android';
      } else if (width <= 768) {
        deviceType = '小屏设备';
      }
      
      document.getElementById('deviceType').textContent = deviceType;
      document.getElementById('screenSize').textContent = `${width}×${height}`;
      
      const orientation = width > height ? '横屏' : '竖屏';
      const touchSupport = 'ontouchstart' in window ? '支持' : '不支持';
      
      document.getElementById('deviceInfo').innerHTML = `
        <strong>设备：</strong>${deviceType} (${os})<br>
        <strong>视口：</strong>${width} × ${height}px<br>
        <strong>DPR：</strong>${dpr}<br>
        <strong>方向：</strong>${orientation}<br>
        <strong>触摸：</strong>${touchSupport}<br>
        <strong>用户代理：</strong>${ua.substring(0, 50)}...
      `;
    }
    
    // 获取当前配置
    function getCurrentConfig() {
      return {
        mask: document.getElementById('maskEnabled').checked,
        rounded: document.getElementById('roundedEnabled').checked,
        swipeToClose: document.getElementById('swipeEnabled').checked,
        resizable: document.getElementById('resizableEnabled').checked,
        animationDuration: parseInt(document.getElementById('animDuration').value),
        closable: true,
        showResizeHint: true,
        damping: true,
        swipeTriggerArea: 'handle'
      };
    }
    
    // 更新抽屉信息
    function updateDrawerInfo(placement, size) {
      const config = getCurrentConfig();
      const width = window.innerWidth;
      const height = window.innerHeight;
      
      document.getElementById('drawerInfo').innerHTML = `
        <strong>📍 方向：</strong>${placement}<br>
        <strong>📏 尺寸：</strong>${size}<br>
        <strong>📱 视口：</strong>${width} × ${height}px<br>
        <strong>✅ 遮罩：</strong>${config.mask ? '启用' : '禁用'}<br>
        <strong>🎨 圆角：</strong>${config.rounded ? '启用' : '禁用'}<br>
        <strong>👆 滑动关闭：</strong>${config.swipeToClose ? '启用' : '禁用'}<br>
        <strong>↔️ 可调整：</strong>${config.resizable ? '启用' : '禁用'}<br>
        <strong>⏱️ 动画时长：</strong>${config.animationDuration}ms
      `;
    }
    
    // 基础测试
    function testDrawer(placement) {
      const config = getCurrentConfig();
      drawer.placement = placement;
      
      // 移动端智能尺寸
      let size = '80%';
      if (placement === 'top' || placement === 'bottom') {
        size = '60%';
      }
      
      drawer.size = size;
      drawer.drawerTitle = `${placement.toUpperCase()} 方向抽屉`;
      Object.assign(drawer, config);
      
      // 隐藏滚动内容
      document.getElementById('scrollContent').style.display = 'none';
      
      drawer.visible = true;
      updateDrawerInfo(placement, size);
    }
    
    // 尺寸测试
    function testSize(size) {
      const config = getCurrentConfig();
      drawer.placement = 'right';
      drawer.size = size;
      drawer.drawerTitle = `尺寸测试：${size}`;
      Object.assign(drawer, config);
      
      document.getElementById('scrollContent').style.display = 'none';
      drawer.visible = true;
      updateDrawerInfo('right', size);
    }
    
    // 滑动关闭测试
    function testSwipeClose() {
      const config = getCurrentConfig();
      drawer.placement = 'bottom';
      drawer.size = '50%';
      drawer.drawerTitle = '👆 滑动关闭测试';
      drawer.swipeToClose = true;
      drawer.swipeTriggerArea = 'handle';
      drawer.showResizeHint = true;
      Object.assign(drawer, config);
      
      document.getElementById('scrollContent').style.display = 'none';
      drawer.visible = true;
      updateDrawerInfo('bottom', '50%');
    }
    
    // 调整大小测试
    function testResizable() {
      drawer.placement = 'right';
      drawer.size = '70%';
      drawer.drawerTitle = '↔️ 调整大小测试';
      drawer.resizable = true;
      drawer.resizeMode = 'edge';
      drawer.minSize = '30%';
      drawer.maxSize = '95%';
      drawer.showResizeHint = true;
      drawer.damping = true;
      
      const config = getCurrentConfig();
      Object.assign(drawer, config);
      
      document.getElementById('scrollContent').style.display = 'none';
      drawer.visible = true;
      updateDrawerInfo('right', '70%');
    }
    
    // 全屏测试
    function testFullscreen() {
      drawer.placement = 'right';
      drawer.size = '80%';
      drawer.drawerTitle = '📺 全屏测试';
      drawer.fullscreenable = true;
      drawer.fullscreen = false;
      
      const config = getCurrentConfig();
      Object.assign(drawer, config);
      
      document.getElementById('scrollContent').style.display = 'none';
      drawer.visible = true;
      updateDrawerInfo('right', '80%');
    }
    
    // 滚动内容测试
    function testScrollContent() {
      drawer.placement = 'bottom';
      drawer.size = '70%';
      drawer.drawerTitle = '📜 滚动内容测试';
      drawer.swipeToClose = true;
      drawer.swipeTriggerArea = 'handle';
      
      const config = getCurrentConfig();
      Object.assign(drawer, config);
      
      // 显示滚动内容
      document.getElementById('scrollContent').style.display = 'block';
      drawer.visible = true;
      updateDrawerInfo('bottom', '70%');
    }
    
    // 测试所有方向
    async function testAllDirections() {
      const placements = ['right', 'left', 'top', 'bottom'];
      const sizes = ['80%', '80%', '60%', '60%'];
      
      for (let i = 0; i < placements.length; i++) {
        const placement = placements[i];
        const size = sizes[i];
        
        drawer.placement = placement;
        drawer.size = size;
        drawer.drawerTitle = `自动测试：${placement.toUpperCase()}`;
        
        const config = getCurrentConfig();
        Object.assign(drawer, config);
        
        document.getElementById('scrollContent').style.display = 'none';
        drawer.visible = true;
        updateDrawerInfo(placement, size);
        
        await new Promise(resolve => setTimeout(resolve, 1500));
        drawer.visible = false;
        await new Promise(resolve => setTimeout(resolve, 500));
      }
    }
    
    // 压力测试
    async function testStress() {
      const configs = [
        { placement: 'right', size: '100%' },
        { placement: 'left', size: '10%' },
        { placement: 'top', size: '90%' },
        { placement: 'bottom', size: '30%' },
        { placement: 'right', size: '200px' },
        { placement: 'left', size: '50vw' },
        { placement: 'top', size: '80vh' },
        { placement: 'bottom', size: '400px' }
      ];
      
      for (const conf of configs) {
        drawer.placement = conf.placement;
        drawer.size = conf.size;
        drawer.drawerTitle = `压力测试：${conf.placement} - ${conf.size}`;
        
        const config = getCurrentConfig();
        Object.assign(drawer, config);
        
        drawer.visible = true;
        await new Promise(resolve => setTimeout(resolve, 800));
        drawer.visible = false;
        await new Promise(resolve => setTimeout(resolve, 200));
      }
    }
    
    // 监听窗口变化
    window.addEventListener('resize', updateDeviceInfo);
    window.addEventListener('orientationchange', updateDeviceInfo);
    
    // 监听抽屉事件
    drawer.addEventListener('ldesignClose', () => {
      console.log('Drawer closed');
      document.getElementById('scrollContent').style.display = 'none';
    });
    
    drawer.addEventListener('ldesignSizeChange', (e) => {
      console.log('Size changed:', e.detail);
    });
    
    // 初始化
    updateDeviceInfo();
  </script>
</body>
</html>