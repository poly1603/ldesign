<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Debug Input Issues</title>
  <script type="module" src="./dist/ldesign-webcomponent/ldesign-webcomponent.esm.js"></script>
  <link rel="stylesheet" href="./dist/ldesign-webcomponent/ldesign-webcomponent.css">
  <style>
    body { padding: 20px; font-family: Arial; }
    .test { margin: 20px 0; padding: 20px; border: 1px solid #ddd; }
    h3 { margin-top: 0; }
    .info { 
      margin-top: 10px; 
      padding: 10px; 
      background: #f0f0f0; 
      font-size: 12px; 
      font-family: monospace;
    }
    .controls { margin: 10px 0; }
    button { margin-right: 10px; }
  </style>
</head>
<body>
  <h1>调试 Input 组件问题</h1>

  <div class="test">
    <h3>1. Textarea 自动高度调试</h3>
    <p>配置：minRows: 2, maxRows: 5</p>
    <ldesign-input type="textarea" placeholder="输入多行文本测试" id="textarea1"></ldesign-input>
    <div class="controls">
      <button onclick="addMultipleLines()">添加多行文本</button>
      <button onclick="clearTextarea()">清空</button>
      <button onclick="checkTextareaStyles()">检查样式</button>
    </div>
    <div class="info" id="textarea-info">等待检查...</div>
  </div>

  <div class="test">
    <h3>2. 输入限制调试</h3>
    <p>配置：只允许数字 (allowInput = /^\d*$/)</p>
    <ldesign-input placeholder="只能输入数字" id="input1"></ldesign-input>
    <div class="controls">
      <button onclick="testInputRestriction()">测试输入限制</button>
    </div>
    <div class="info" id="input-info">
      <div>当前值: <span id="current-value"></span></div>
      <div>allowInput属性: <span id="allow-input-prop"></span></div>
      <div>输入日志: <div id="input-log"></div></div>
    </div>
  </div>

  <script>
    let textarea1, input1;
    let inputLog = [];

    window.addEventListener('DOMContentLoaded', () => {
      // 获取元素
      textarea1 = document.getElementById('textarea1');
      input1 = document.getElementById('input1');
      
      // 1. 设置textarea自动高度
      textarea1.autosize = { minRows: 2, maxRows: 5 };
      console.log('设置 textarea autosize:', textarea1.autosize);
      
      // 2. 设置输入限制
      input1.allowInput = /^\d*$/;
      console.log('设置 input allowInput:', input1.allowInput);
      
      // 监听输入事件
      input1.addEventListener('input', (e) => {
        const log = `input事件: "${e.target.value}" (${new Date().toISOString()})`;
        inputLog.push(log);
        updateInputInfo();
      });
      
      input1.addEventListener('ldesignInput', (e) => {
        const log = `ldesignInput事件: "${e.detail}" (${new Date().toISOString()})`;
        inputLog.push(log);
        updateInputInfo();
      });
      
      // 监听textarea变化
      textarea1.addEventListener('input', () => {
        setTimeout(checkTextareaStatus, 100);
      });
      
      // 初始检查
      setTimeout(() => {
        checkTextareaStatus();
        updateInputInfo();
      }, 500);
    });

    function addMultipleLines() {
      const lines = [
        '第一行文本',
        '第二行文本',
        '第三行文本',
        '第四行文本',
        '第五行文本',
        '第六行文本',
        '第七行文本'
      ];
      textarea1.value = lines.join('\\n');
      textarea1.dispatchEvent(new Event('input', { bubbles: true }));
    }

    function clearTextarea() {
      textarea1.value = '';
      textarea1.dispatchEvent(new Event('input', { bubbles: true }));
    }

    function checkTextareaStatus() {
      const textarea = textarea1.querySelector('textarea');
      if (!textarea) return;
      
      const style = window.getComputedStyle(textarea);
      const info = {
        value: textarea.value,
        rows: textarea.value.split('\\n').length,
        scrollHeight: textarea.scrollHeight,
        clientHeight: textarea.clientHeight,
        offsetHeight: textarea.offsetHeight,
        height: style.height,
        overflow: style.overflow,
        overflowY: style.overflowY,
        lineHeight: style.lineHeight,
        paddingTop: style.paddingTop,
        paddingBottom: style.paddingBottom,
        borderTop: style.borderTopWidth,
        borderBottom: style.borderBottomWidth,
        hasScroll: textarea.scrollHeight > textarea.clientHeight
      };
      
      document.getElementById('textarea-info').innerHTML = `
        <pre>${JSON.stringify(info, null, 2)}</pre>
      `;
    }

    function checkTextareaStyles() {
      const textarea = textarea1.querySelector('textarea');
      if (!textarea) {
        alert('找不到textarea元素');
        return;
      }
      
      // 临时修改样式测试
      console.log('当前overflow样式:', textarea.style.overflow, textarea.style.overflowY);
      
      // 强制设置overflow为auto
      textarea.style.overflow = 'auto';
      textarea.style.overflowY = 'auto';
      
      alert('已强制设置overflow为auto，请查看是否出现滚动条');
      
      setTimeout(checkTextareaStatus, 100);
    }

    function updateInputInfo() {
      const input = input1.querySelector('input');
      if (!input) return;
      
      document.getElementById('current-value').textContent = input.value;
      document.getElementById('allow-input-prop').textContent = input1.allowInput ? input1.allowInput.toString() : 'undefined';
      
      // 只显示最后5条日志
      const recentLogs = inputLog.slice(-5);
      document.getElementById('input-log').innerHTML = recentLogs.join('<br>');
    }

    function testInputRestriction() {
      const input = input1.querySelector('input');
      if (!input) return;
      
      // 尝试通过代码设置非法值
      const testValue = 'abc123';
      console.log('尝试设置值:', testValue);
      
      input.value = testValue;
      input.dispatchEvent(new Event('input', { bubbles: true }));
      
      setTimeout(() => {
        console.log('设置后的值:', input.value);
        alert(`尝试设置 "${testValue}"，实际值: "${input.value}"`);
      }, 100);
    }
  </script>
</body>
</html>