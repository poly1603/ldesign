<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>测试修复结果</title>
  <script type="module" src="./dist/ldesign-webcomponent/ldesign-webcomponent.esm.js"></script>
  <link rel="stylesheet" href="./dist/ldesign-webcomponent/ldesign-webcomponent.css">
  <style>
    body { 
      padding: 20px; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    .test-group { 
      margin: 30px 0; 
      padding: 20px; 
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      background: #f9f9f9;
    }
    h2 { 
      margin-top: 0; 
      color: #333;
    }
    .description {
      margin: 10px 0;
      color: #666;
    }
    .result {
      margin-top: 15px;
      padding: 15px;
      background: white;
      border-radius: 4px;
      border: 1px solid #e0e0e0;
    }
    .success { color: #52c41a; }
    .fail { color: #ff4d4f; }
    pre {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow: auto;
    }
  </style>
</head>
<body>
  <h1>LDesign Input 组件修复验证</h1>

  <div class="test-group">
    <h2>测试1: Textarea 自动高度和滚动条</h2>
    <div class="description">
      设置: minRows=2, maxRows=5<br>
      预期: 输入超过5行后应显示滚动条
    </div>
    <ldesign-input 
      type="textarea" 
      placeholder="请输入文本，测试是否在第5行后出现滚动条" 
      id="textarea-test"
      value="第一行
第二行
第三行
第四行
第五行
第六行（这行应该触发滚动条）
第七行"
    ></ldesign-input>
    <div class="result" id="textarea-result"></div>
  </div>

  <div class="test-group">
    <h2>测试2: 输入限制 - 只允许数字</h2>
    <div class="description">
      设置: allowInput = /^\d*$/<br>
      预期: 只能输入数字，字母应被拦截
    </div>
    <ldesign-input 
      placeholder="尝试输入字母，应该被阻止" 
      id="number-input"
    ></ldesign-input>
    <div class="result" id="input-result">
      <div>当前值: <span id="current-value"></span></div>
      <div>测试日志: <pre id="test-log"></pre></div>
    </div>
  </div>

  <div class="test-group">
    <h2>测试3: 中文输入限制</h2>
    <div class="description">
      设置: allowInput = /^[a-zA-Z0-9]*$/<br>
      预期: 只能输入英文和数字，中文应被拦截
    </div>
    <ldesign-input 
      placeholder="只能输入英文和数字" 
      id="english-input"
    ></ldesign-input>
    <div class="result">
      <div>当前值: <span id="english-value"></span></div>
    </div>
  </div>

  <script>
    const testLog = [];
    
    function log(message) {
      const timestamp = new Date().toLocaleTimeString();
      testLog.push(`[${timestamp}] ${message}`);
      document.getElementById('test-log').textContent = testLog.slice(-10).join('\n');
    }

    window.addEventListener('DOMContentLoaded', () => {
      // 测试1: Textarea自动高度
      const textarea = document.getElementById('textarea-test');
      textarea.autosize = { minRows: 2, maxRows: 5 };
      
      setTimeout(() => {
        const textareaElement = textarea.querySelector('textarea');
        if (textareaElement) {
          const hasScroll = textareaElement.scrollHeight > textareaElement.clientHeight;
          const overflowY = window.getComputedStyle(textareaElement).overflowY;
          
          document.getElementById('textarea-result').innerHTML = `
            <div class="${hasScroll ? 'success' : 'fail'}">
              滚动条状态: ${hasScroll ? '✓ 显示' : '✗ 未显示'}
            </div>
            <div>scrollHeight: ${textareaElement.scrollHeight}px</div>
            <div>clientHeight: ${textareaElement.clientHeight}px</div>
            <div>overflow-y: ${overflowY}</div>
          `;
        }
      }, 500);
      
      // 测试2: 数字输入限制
      const numberInput = document.getElementById('number-input');
      numberInput.allowInput = /^\d*$/;
      
      numberInput.addEventListener('ldesignInput', (e) => {
        document.getElementById('current-value').textContent = e.detail;
        log(`输入事件: "${e.detail}"`);
      });
      
      // 自动测试输入
      setTimeout(() => {
        log('开始自动测试...');
        const input = numberInput.querySelector('input');
        if (input) {
          // 测试输入数字
          log('测试输入 "123"');
          input.value = '123';
          input.dispatchEvent(new Event('input', { bubbles: true }));
          
          setTimeout(() => {
            // 测试输入字母
            log('测试输入 "123abc"');
            input.value = '123abc';
            input.dispatchEvent(new Event('input', { bubbles: true }));
            
            setTimeout(() => {
              const finalValue = input.value;
              log(`最终值: "${finalValue}" (应该是 "123")`);
              
              if (finalValue === '123') {
                log('✓ 输入限制测试通过');
              } else {
                log('✗ 输入限制测试失败');
              }
            }, 100);
          }, 200);
        }
      }, 1000);
      
      // 测试3: 英文数字限制
      const englishInput = document.getElementById('english-input');
      englishInput.allowInput = /^[a-zA-Z0-9]*$/;
      
      englishInput.addEventListener('ldesignInput', (e) => {
        document.getElementById('english-value').textContent = e.detail;
      });
    });
  </script>
</body>
</html>