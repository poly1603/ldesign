<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drawer 滑动关闭调试</title>
  <script type="module" src="/dist/ldesign-webcomponent/ldesign-webcomponent.esm.js"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover {
      background: #2563eb;
    }
    .note {
      background: #dbeafe;
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
      font-size: 14px;
      color: #1e40af;
      border-left: 4px solid #3b82f6;
    }
    .warning {
      background: #fef3c7;
      padding: 15px;
      border-radius: 4px;
      margin-top: 10px;
      font-size: 14px;
      color: #92400e;
      border-left: 4px solid #f59e0b;
    }
    .success {
      background: #d1fae5;
      padding: 15px;
      border-radius: 4px;
      margin-top: 10px;
      font-size: 14px;
      color: #065f46;
      border-left: 4px solid #10b981;
    }
    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
    .drawer-content {
      padding: 20px;
    }
    .drawer-content h3 {
      margin-top: 0;
      color: #1e293b;
    }
    .drawer-content p {
      line-height: 1.6;
      color: #475569;
    }
    .scrollable-content {
      height: 300px;
      overflow-y: auto;
      background: #f1f5f9;
      padding: 15px;
      border-radius: 4px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🐛 Drawer 滑动关闭调试页面</h1>
    
    <div class="warning">
      <strong>⚠️ 重要：</strong>请打开浏览器控制台（F12）查看调试日志！
    </div>
    
    <div class="note">
      <strong>📱 测试步骤：</strong>
      <ol style="margin: 10px 0 0 0; padding-left: 20px;">
        <li>打开 Chrome 浏览器的开发者工具（F12）</li>
        <li>点击"切换设备工具栏"图标（或按 Ctrl+Shift+M）进入移动设备模式</li>
        <li>选择一个移动设备（如 iPhone 12 Pro 或 Pixel 5）</li>
        <li>点击下面的按钮打开抽屉</li>
        <li>在抽屉上尝试触摸滑动，观察控制台输出</li>
      </ol>
    </div>

    <div style="margin-top: 30px;">
      <h2>测试案例</h2>
      
      <div style="margin: 20px 0;">
        <h3>1. 底部抽屉 - 任意区域滑动</h3>
        <button onclick="openDrawer1()">打开底部抽屉（anywhere）</button>
        <p style="font-size: 14px; color: #64748b; margin-top: 5px;">
          swipe-trigger-area="anywhere" - 在抽屉任意位置都可以触发滑动
        </p>
      </div>

      <div style="margin: 20px 0;">
        <h3>2. 底部抽屉 - 仅头部滑动</h3>
        <button onclick="openDrawer2()">打开底部抽屉（header）</button>
        <p style="font-size: 14px; color: #64748b; margin-top: 5px;">
          swipe-trigger-area="header" - 只能在头部区域滑动
        </p>
      </div>

      <div style="margin: 20px 0;">
        <h3>3. 底部抽屉 - 仅边缘滑动 ⭐</h3>
        <button onclick="openDrawer3()">打开底部抽屉（edge）</button>
        <p style="font-size: 14px; color: #64748b; margin-top: 5px;">
          swipe-trigger-area="edge" - <strong>只能在抽屉顶部边缘 20px 区域滑动</strong>
        </p>
        <p style="font-size: 13px; color: #f59e0b; margin-top: 5px;">
          ⚠️ 提示：请在抽屉的<strong>最顶部</strong>（靠近标题栏的上方）滑动，在内容区域滑动无效
        </p>
      </div>

      <div style="margin: 20px 0;">
        <h3>4. 右侧抽屉 - 任意区域滑动</h3>
        <button onclick="openDrawer4()">打开右侧抽屉（anywhere）</button>
        <p style="font-size: 14px; color: #64748b; margin-top: 5px;">
          右侧抽屉，向右滑动关闭
        </p>
      </div>
    </div>

    <div class="success" style="margin-top: 30px;">
      <strong>✅ 预期看到的日志：</strong>
      <pre style="margin-top: 10px;">[Drawer Render] onTouchStart triggered!
[Drawer Swipe] === TOUCH START ===
[Drawer Swipe] Event type: touchstart
[Drawer Swipe] swipeToClose prop: true
[Drawer Swipe] swipeTriggerArea: anywhere
[Drawer Swipe] placement: bottom
[Drawer Swipe] currentState: open
[Drawer Swipe] isMobileDevice: true
[Drawer Swipe] Target element: DIV drawer-content
[Drawer Swipe] isTriggerArea: true
[Drawer Swipe] ✅ Starting swipe...</pre>
    </div>

    <div class="warning" style="margin-top: 15px;">
      <strong>❌ 如果没有任何日志输出：</strong>
      <ul style="margin: 5px 0 0 0; padding-left: 20px;">
        <li>检查是否正确开启了移动设备模式</li>
        <li>尝试刷新页面重新加载组件</li>
        <li>检查控制台是否有 JavaScript 错误</li>
      </ul>
    </div>
  </div>

  <!-- 测试抽屉 1: anywhere -->
  <ldesign-drawer 
    id="drawer1" 
    drawer-title="底部抽屉 - anywhere"
    placement="bottom"
    size="60%"
    animation="true"
    swipe-to-close="true"
    swipe-trigger-area="anywhere">
    <div class="drawer-content">
      <h3>任意区域滑动测试</h3>
      <p>在抽屉的任意位置向下滑动都应该能关闭抽屉。</p>
      <p>请尝试在这段文字上滑动。</p>
      <div class="scrollable-content">
        <p>可滚动内容 1</p>
        <p>可滚动内容 2</p>
        <p>可滚动内容 3</p>
        <p>可滚动内容 4</p>
        <p>可滚动内容 5</p>
        <p>可滚动内容 6</p>
        <p>可滚动内容 7</p>
        <p>可滚动内容 8</p>
      </div>
    </div>
  </ldesign-drawer>

  <!-- 测试抽屉 2: header -->
  <ldesign-drawer 
    id="drawer2" 
    drawer-title="底部抽屉 - header"
    placement="bottom"
    size="60%"
    animation="true"
    swipe-to-close="true"
    swipe-trigger-area="header">
    <div class="drawer-content">
      <h3>仅头部滑动测试</h3>
      <p>只有在头部区域滑动才能关闭抽屉。</p>
      <p>在这里滑动应该不会关闭抽屉。</p>
      <p>请尝试在标题栏滑动。</p>
    </div>
  </ldesign-drawer>

  <!-- 测试抽屉 3: edge -->
  <ldesign-drawer 
    id="drawer3" 
    drawer-title="底部抽屉 - edge"
    placement="bottom"
    size="60%"
    animation="true"
    swipe-to-close="true"
    swipe-trigger-area="edge">
    <div class="drawer-content">
      <h3>仅边缘滑动测试</h3>
      <p>只有在抽屉顶部边缘 20px 区域滑动才能关闭抽屉。</p>
      <p>在这里滑动应该不会关闭抽屉。</p>
      <p>请尝试在抽屉的最顶部边缘滑动。</p>
    </div>
  </ldesign-drawer>

  <!-- 测试抽屉 4: 右侧 -->
  <ldesign-drawer 
    id="drawer4" 
    drawer-title="右侧抽屉 - anywhere"
    placement="right"
    size="80%"
    animation="true"
    swipe-to-close="true"
    swipe-trigger-area="anywhere">
    <div class="drawer-content">
      <h3>右侧抽屉滑动测试</h3>
      <p>向右滑动应该能关闭抽屉。</p>
      <p>请尝试在抽屉上向右滑动。</p>
    </div>
  </ldesign-drawer>

  <script>
    function openDrawer1() {
      const drawer = document.getElementById('drawer1');
      console.log('=== Opening drawer1 ===');
      console.log('Drawer element:', drawer);
      console.log('swipeToClose attribute:', drawer.getAttribute('swipe-to-close'));
      console.log('swipeToClose property:', drawer.swipeToClose);
      drawer.visible = true;
    }
    
    function openDrawer2() {
      const drawer = document.getElementById('drawer2');
      console.log('=== Opening drawer2 ===');
      console.log('swipeToClose property:', drawer.swipeToClose);
      drawer.visible = true;
    }
    
    function openDrawer3() {
      const drawer = document.getElementById('drawer3');
      console.log('=== Opening drawer3 ===');
      console.log('swipeToClose property:', drawer.swipeToClose);
      drawer.visible = true;
    }
    
    function openDrawer4() {
      const drawer = document.getElementById('drawer4');
      console.log('=== Opening drawer4 ===');
      console.log('swipeToClose property:', drawer.swipeToClose);
      drawer.visible = true;
    }
    
    // 监听所有抽屉事件
    document.querySelectorAll('ldesign-drawer').forEach(drawer => {
      drawer.addEventListener('ldesignOpen', (e) => {
        console.log('✅ Drawer opened:', drawer.id);
      });
      
      drawer.addEventListener('ldesignClose', (e) => {
        console.log('✅ Drawer closed:', drawer.id, 'reason:', e.detail.reason);
      });
      
      drawer.addEventListener('ldesignSwipe', (e) => {
        console.log('📱 Drawer swiping:', drawer.id, 'progress:', e.detail.progress);
      });
    });

    // 全局触摸事件监听（用于调试）
    document.addEventListener('touchstart', (e) => {
      console.log('[Global] touchstart on:', e.target.tagName, e.target.className);
    }, { passive: true });
  </script>
</body>
</html>
