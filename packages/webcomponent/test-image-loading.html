<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Loading State Test</title>
  <script type="module" src="./dist/webcomponent/webcomponent.esm.js"></script>
  <link rel="stylesheet" href="./dist/webcomponent/webcomponent.css">
  <style>
    body {
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #fff;
    }
    h1 { color: #1890ff; margin-bottom: 20px; }
    h2 { margin: 30px 0 20px; color: #333; }
    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .test-item {
      border: 2px solid #e8e8e8;
      border-radius: 8px;
      padding: 15px;
      background: #fafafa;
    }
    .test-label {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
      font-weight: 600;
    }
    .desc {
      font-size: 12px;
      color: #999;
      margin-top: 8px;
    }
    .highlight {
      background: #e6f7ff;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      border: 1px solid #91d5ff;
    }
    .status-good { color: #52c41a; }
    .status-bad { color: #ff4d4f; }
  </style>
</head>
<body>
  <h1>🔄 图片加载状态测试</h1>
  
  <div class="highlight">
    <strong>改进说明：</strong>
    <ul style="margin: 10px 0 0; padding-left: 20px;">
      <li>✅ 设置了宽高的图片组件在初始化时立即显示占位框</li>
      <li>✅ 占位框默认有背景色（由 placeholder-color 控制）</li>
      <li>✅ 加载动画旋转器由 show-loading 控制（默认显示）</li>
      <li>✅ 即使图片还未开始加载，容器也会占据正确的空间</li>
    </ul>
  </div>

  <h2>1. 固定宽高 - 立即显示占位框</h2>
  <div class="test-grid">
    <div class="test-item">
      <div class="test-label">✅ 有明确宽高（300x200）</div>
      <ldesign-image
        src="https://picsum.photos/600/400?random=${Math.random()}&delay=2000"
        width="300"
        height="200"
        fit="cover"
        alt="固定尺寸"
      />
      <p class="desc status-good">立即显示 300x200 的占位框</p>
    </div>
    
    <div class="test-item">
      <div class="test-label">✅ 自定义占位色</div>
      <ldesign-image
        src="https://picsum.photos/600/400?random=${Math.random()}&delay=2000"
        width="300"
        height="200"
        placeholder-color="#e6f7ff"
        fit="cover"
        alt="自定义占位色"
      />
      <p class="desc status-good">浅蓝色占位背景</p>
    </div>
    
    <div class="test-item">
      <div class="test-label">✅ 不显示加载动画</div>
      <ldesign-image
        src="https://picsum.photos/600/400?random=${Math.random()}&delay=2000"
        width="300"
        height="200"
        :show-loading="false"
        placeholder-color="#f6ffed"
        fit="cover"
        alt="无动画"
      />
      <p class="desc status-good">只有背景色，无旋转动画</p>
    </div>
  </div>

  <h2>2. 响应式宽度 + ratio - 自动计算高度</h2>
  <div class="test-grid">
    <div class="test-item">
      <div class="test-label">✅ 100% + 16:9</div>
      <ldesign-image
        src="https://picsum.photos/800/450?random=${Math.random()}&delay=2000"
        width="100%"
        ratio="16/9"
        placeholder-color="#fff1f0"
        fit="cover"
        alt="16:9比例"
      />
      <p class="desc status-good">宽度100%，高度按16:9计算</p>
    </div>
    
    <div class="test-item">
      <div class="test-label">✅ 固定宽度 + ratio</div>
      <ldesign-image
        src="https://picsum.photos/400/400?random=${Math.random()}&delay=2000"
        width="200"
        ratio="1/1"
        placeholder-color="#f9f0ff"
        fit="cover"
        alt="1:1比例"
      />
      <p class="desc status-good">200x200 正方形占位</p>
    </div>
  </div>

  <h2>3. 不同加载阶段</h2>
  <div class="test-grid">
    <div class="test-item">
      <div class="test-label">⏳ 加载中（带进度条）</div>
      <ldesign-image
        src="https://picsum.photos/600/400?random=${Math.random()}&t=${Date.now()}"
        width="100%"
        height="180"
        show-progress
        placeholder-color="#e6f7ff"
        fit="cover"
        alt="加载中"
      />
      <p class="desc">显示进度条（如果支持）</p>
    </div>
    
    <div class="test-item">
      <div class="test-label">❌ 加载失败（带重试）</div>
      <ldesign-image
        src="https://invalid-url-test.example.com/not-exist.jpg"
        width="100%"
        height="180"
        retryable
        show-error
        fit="cover"
        alt="加载失败"
      />
      <p class="desc status-bad">显示错误状态和重试按钮</p>
    </div>
    
    <div class="test-item">
      <div class="test-label">✅ 自定义占位图</div>
      <ldesign-image
        src="https://picsum.photos/600/400?random=${Math.random()}&delay=3000"
        width="100%"
        height="180"
        placeholder="https://picsum.photos/60/40?random=${Math.random()}&blur=5"
        fit="cover"
        alt="自定义占位图"
      />
      <p class="desc status-good">使用模糊的小图作为占位</p>
    </div>
  </div>

  <h2>4. 懒加载场景</h2>
  <div style="height: 300px; overflow-y: auto; border: 2px solid #e8e8e8; padding: 20px; border-radius: 8px;">
    <p style="margin: 0 0 20px; color: #1890ff; font-weight: 600;">⬇ 滚动查看懒加载效果</p>
    
    <div style="height: 200px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; border-radius: 8px;">
      <span style="color: #999;">占位区域</span>
    </div>
    
    <div class="test-item" style="margin-bottom: 20px;">
      <div class="test-label">懒加载图片 1 - 设置了明确尺寸</div>
      <ldesign-image
        src="https://picsum.photos/600/400?random=${Math.random()}"
        width="100%"
        height="200"
        lazy
        placeholder-color="#e6f7ff"
        fit="cover"
        alt="懒加载1"
      />
      <p class="desc status-good">滚动到这里才开始加载，但容器已占位</p>
    </div>
    
    <div style="height: 100px;"></div>
    
    <div class="test-item" style="margin-bottom: 20px;">
      <div class="test-label">懒加载图片 2 - 使用 ratio</div>
      <ldesign-image
        src="https://picsum.photos/600/400?random=${Math.random()}"
        width="100%"
        ratio="3/2"
        lazy
        placeholder-color="#f6ffed"
        fit="cover"
        alt="懒加载2"
      />
      <p class="desc status-good">宽度100%，高度按比例计算</p>
    </div>
    
    <div style="height: 100px;"></div>
    
    <div class="test-item">
      <div class="test-label">懒加载图片 3 - 固定尺寸</div>
      <ldesign-image
        src="https://picsum.photos/600/400?random=${Math.random()}"
        width="280"
        height="180"
        lazy
        placeholder-color="#fff1f0"
        fit="cover"
        alt="懒加载3"
      />
      <p class="desc status-good">280x180 固定尺寸</p>
    </div>
  </div>

  <h2>5. 对比：有无尺寸设置</h2>
  <div class="test-grid">
    <div class="test-item">
      <div class="test-label">✅ 有尺寸（推荐）</div>
      <ldesign-image
        src="https://picsum.photos/400/300?random=${Math.random()}&delay=1500"
        width="250"
        height="150"
        fit="cover"
        alt="有尺寸"
      />
      <p class="desc status-good">
        立即显示占位框，无布局跳动<br>
        用户体验更好
      </p>
    </div>
    
    <div class="test-item">
      <div class="test-label">⚠️ 无尺寸</div>
      <ldesign-image
        src="https://picsum.photos/400/300?random=${Math.random()}&delay=1500"
        fit="cover"
        alt="无尺寸"
      />
      <p class="desc status-bad">
        初始无高度，加载后才撑开<br>
        可能造成布局跳动
      </p>
    </div>
  </div>

  <script>
    // 监听加载事件
    let loadCount = 0;
    let errorCount = 0;
    
    document.addEventListener('ldesignLoad', (e) => {
      loadCount++;
      console.log(`✅ [${loadCount}] 图片加载成功:`, e.detail);
    });
    
    document.addEventListener('ldesignError', (e) => {
      errorCount++;
      console.log(`❌ [${errorCount}] 图片加载失败:`, e.detail);
    });
    
    // 页面加载完成提示
    window.addEventListener('load', () => {
      console.log('🎉 测试页面加载完成！');
      console.log('💡 提示：');
      console.log('  1. 有明确尺寸的图片立即显示占位框');
      console.log('  2. 占位框背景色由 placeholder-color 控制');
      console.log('  3. 加载动画由 show-loading 控制');
      console.log('  4. 滚动查看懒加载效果');
    });
  </script>
</body>
</html>