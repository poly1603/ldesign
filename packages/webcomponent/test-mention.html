<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mention组件测试</title>
    <link rel="stylesheet" href="./dist/ldesign-webcomponent/ldesign-webcomponent.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .demo-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #1677ff;
            padding-bottom: 8px;
        }
        .demo-row {
            margin-bottom: 20px;
        }
        .demo-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #666;
        }
        .output {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Mention 组件测试</h1>

    <div class="demo-section">
        <h2>1. 基础用法（空初始值）</h2>
        <div class="demo-row">
            <span class="demo-label">输入 @ 或 # 触发提及：</span>
            <ldesign-mention
                id="mention-basic"
                placeholder="输入 @ 提及用户，# 提及话题"
                triggers='["@", "#"]'
                trigger-configs='[
                    {
                        "char": "@",
                        "tokenType": "primary",
                        "options": [
                            {"value": "1", "label": "Alice"},
                            {"value": "2", "label": "Bob"},
                            {"value": "3", "label": "Charlie"}
                        ]
                    },
                    {
                        "char": "#",
                        "tokenType": "info",
                        "options": [
                            {"value": "t1", "label": "前端开发"},
                            {"value": "t2", "label": "性能优化"},
                            {"value": "t3", "label": "最佳实践"}
                        ]
                    }
                ]'
            ></ldesign-mention>
        </div>
        <div class="output" id="output-basic">等待输入...</div>
    </div>

    <div class="demo-section">
        <h2>2. 分段模型初始化（model）</h2>
        <div class="demo-row">
            <span class="demo-label">使用分段数组初始化内容：</span>
            <ldesign-mention
                id="mention-model"
                triggers='["@", "#"]'
                model='[
                    {"type": "text", "text": "欢迎 "},
                    {"type": "mention", "trigger": "@", "label": "Alice", "value": "1"},
                    {"type": "text", "text": " 参与讨论，今天的主题是 "},
                    {"type": "mention", "trigger": "#", "label": "性能优化", "value": "t2"},
                    {"type": "text", "text": " ！"}
                ]'
                trigger-configs='[
                    {
                        "char": "@",
                        "tokenType": "primary",
                        "options": [
                            {"value": "1", "label": "Alice"},
                            {"value": "2", "label": "Bob"}
                        ]
                    },
                    {
                        "char": "#",
                        "tokenType": "warning",
                        "options": [
                            {"value": "t1", "label": "前端开发"},
                            {"value": "t2", "label": "性能优化"}
                        ]
                    }
                ]'
            ></ldesign-mention>
        </div>
        <div class="output" id="output-model">等待变更...</div>
    </div>

    <div class="demo-section">
        <h2>3. 语义模型初始化（value-model）</h2>
        <div class="demo-row">
            <span class="demo-label">使用语义模型（文本+提及位置）初始化：</span>
            <ldesign-mention
                id="mention-value-model"
                triggers='["@", "#"]'
                value-model='{
                    "text": "请 @Bob 和 @Charlie 关注 #前端开发 相关内容",
                    "mentions": [
                        {"value": "2", "label": "Bob", "trigger": "@", "start": 2, "length": 4},
                        {"value": "3", "label": "Charlie", "trigger": "@", "start": 9, "length": 8},
                        {"value": "t1", "label": "前端开发", "trigger": "#", "start": 20, "length": 5}
                    ]
                }'
                trigger-configs='[
                    {
                        "char": "@",
                        "tokenType": "success",
                        "options": [
                            {"value": "1", "label": "Alice"},
                            {"value": "2", "label": "Bob"},
                            {"value": "3", "label": "Charlie"}
                        ]
                    },
                    {
                        "char": "#",
                        "tokenType": "danger",
                        "options": [
                            {"value": "t1", "label": "前端开发"},
                            {"value": "t2", "label": "性能优化"}
                        ]
                    }
                ]'
            ></ldesign-mention>
        </div>
        <div class="output" id="output-value-model">等待变更...</div>
    </div>

    <div class="demo-section">
        <h2>4. 纯文本初始化（自动解析）</h2>
        <div class="demo-row">
            <span class="demo-label">传入纯文本，自动解析为标签：</span>
            <ldesign-mention
                id="mention-parse"
                value="大家好，我是 @Alice，今天分享 #性能优化 的经验"
                parse-on-init="true"
                triggers='["@", "#"]'
                trigger-configs='[
                    {
                        "char": "@",
                        "tokenType": "primary",
                        "options": [
                            {"value": "1", "label": "Alice"},
                            {"value": "2", "label": "Bob"}
                        ]
                    },
                    {
                        "char": "#",
                        "tokenType": "info",
                        "options": [
                            {"value": "t2", "label": "性能优化"}
                        ]
                    }
                ]'
            ></ldesign-mention>
        </div>
        <div class="output" id="output-parse">等待变更...</div>
    </div>

    <script type="module">
        import { defineCustomElements } from './dist/ldesign-webcomponent/ldesign-webcomponent.esm.js';
        defineCustomElements();

        // 等待组件加载
        setTimeout(() => {
            // 绑定事件监听器
            const demos = [
                { id: 'mention-basic', outputId: 'output-basic' },
                { id: 'mention-model', outputId: 'output-model' },
                { id: 'mention-value-model', outputId: 'output-value-model' },
                { id: 'mention-parse', outputId: 'output-parse' }
            ];

            demos.forEach(({ id, outputId }) => {
                const el = document.getElementById(id);
                const output = document.getElementById(outputId);
                
                if (el && output) {
                    // 监听结构化变更事件
                    el.addEventListener('ldesignValueChange', (e) => {
                        const { text, mentions, model } = e.detail || {};
                        output.innerHTML = `
                            <strong>文本:</strong> ${text || '(空)'}<br>
                            <strong>提及:</strong> ${JSON.stringify(mentions || [], null, 2)}<br>
                            <strong>分段:</strong> ${JSON.stringify(model || [], null, 2)}
                        `;
                    });

                    // 监听选择事件
                    el.addEventListener('ldesignSelect', (e) => {
                        console.log(`[${id}] 选中:`, e.detail);
                    });

                    // 监听移除事件
                    el.addEventListener('ldesignRemove', (e) => {
                        console.log(`[${id}] 移除:`, e.detail);
                    });

                    // 触发初始事件（如果组件已经有初始值）
                    const editable = el.querySelector('.ldesign-mention__editable');
                    if (editable && editable.innerText) {
                        console.log(`[${id}] 初始内容:`, editable.innerText);
                    }
                }
            });

            console.log('Mention组件测试页面已初始化');
        }, 100);
    </script>
</body>
</html>