# LDesign Router è®¾è®¡ç†å¿µ

## ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. æ€§èƒ½ä¼˜å…ˆ (Performance First)

> "å¿«é€Ÿçš„ç”¨æˆ·ä½“éªŒæ˜¯ç°ä»£ Web åº”ç”¨çš„åŸºç¡€"

#### è®¾è®¡ç›®æ ‡

- å¯¼èˆªé€Ÿåº¦æ¯”ä¼ ç»Ÿè·¯ç”±å¿« 50%
- å†…å­˜ä½¿ç”¨å‡å°‘ 25%
- åŒ…ä½“ç§¯ä¼˜åŒ–åˆ°æœ€å°

#### å®ç°ç­–ç•¥

- **ä¼˜åŒ–çš„è·¯ç”±åŒ¹é…ç®—æ³•**: ä½¿ç”¨é«˜æ•ˆçš„è·¯å¾„åŒ¹é…å’Œç¼“å­˜æœºåˆ¶
- **æ™ºèƒ½é¢„åŠ è½½**: å››ç§é¢„åŠ è½½ç­–ç•¥ï¼Œæå‰å‡†å¤‡ç”¨æˆ·å¯èƒ½è®¿é—®çš„é¡µé¢
- **æ™ºèƒ½ç¼“å­˜**: LRU + TTL æ··åˆç¼“å­˜ç­–ç•¥ï¼Œå‡å°‘é‡å¤åŠ è½½
- **Tree Shaking**: æ”¯æŒæŒ‰éœ€åŠ è½½ï¼Œå‡å°‘ä¸å¿…è¦çš„ä»£ç 

```typescript
// æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹
const router = createRouter({
  routes,
  preloadStrategy: 'hover', // æ‚¬åœé¢„åŠ è½½
  cache: {
    // æ™ºèƒ½ç¼“å­˜
    max: 20,
    ttl: 5 * 60 * 1000,
    include: [/^\/user/],
  },
  performance: true, // æ€§èƒ½ç›‘æ§
})
```

### 2. å¼€å‘ä½“éªŒè‡³ä¸Š (Developer Experience)

> "å¥½çš„å·¥å…·åº”è¯¥è®©å¼€å‘è€…ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸æ˜¯å·¥å…·æœ¬èº«"

#### è®¾è®¡ç›®æ ‡

- ç›´è§‚æ˜“æ‡‚çš„ API è®¾è®¡
- å®Œæ•´çš„ TypeScript æ”¯æŒ
- è¯¦ç»†çš„é”™è¯¯æç¤ºå’Œè°ƒè¯•ä¿¡æ¯
- ä¸°å¯Œçš„æ–‡æ¡£å’Œç¤ºä¾‹

#### å®ç°ç­–ç•¥

- **ç±»å‹å®‰å…¨**: 100% TypeScript ç¼–å†™ï¼Œå®Œæ•´çš„ç±»å‹æ¨å¯¼
- **æ™ºèƒ½æç¤º**: IDE å‹å¥½çš„ API è®¾è®¡ï¼Œæä¾›å®Œæ•´çš„æ™ºèƒ½æç¤º
- **é”™è¯¯å¤„ç†**: è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•å»ºè®®
- **æ–‡æ¡£å®Œå–„**: ç”ŸåŠ¨æ´»æ³¼çš„æ–‡æ¡£ï¼Œä¸°å¯Œçš„ç¤ºä¾‹å’Œæœ€ä½³å®è·µ

```typescript
// ç±»å‹å®‰å…¨ç¤ºä¾‹
const router = useRouter()
const route = useRoute()

// å®Œæ•´çš„ç±»å‹æ¨å¯¼
const userId = computed(() => route.params.id as string)
const isActive = computed(() => route.name === 'UserProfile')

// ç±»å‹å®‰å…¨çš„å¯¼èˆª
router.push({ name: 'User', params: { id: '123' } })
```

### 3. æ¸è¿›å¼å¢å¼º (Progressive Enhancement)

> "ä»ç®€å•å¼€å§‹ï¼ŒæŒ‰éœ€å¢å¼º"

#### è®¾è®¡ç›®æ ‡

- åŸºç¡€åŠŸèƒ½å¼€ç®±å³ç”¨
- é«˜çº§åŠŸèƒ½å¯é€‰å¯ç”¨
- å¹³æ»‘çš„å­¦ä¹ æ›²çº¿
- å‘åå…¼å®¹

#### å®ç°ç­–ç•¥

- **åˆ†å±‚è®¾è®¡**: æ ¸å¿ƒåŠŸèƒ½ + é«˜çº§åŠŸèƒ½ + æ’ä»¶æ‰©å±•
- **å¯é€‰é…ç½®**: æ‰€æœ‰é«˜çº§åŠŸèƒ½éƒ½æ˜¯å¯é€‰çš„
- **å…¼å®¹æ€§**: ä¸ Vue Router ç›¸ä¼¼çš„ API è®¾è®¡
- **æ’ä»¶ç³»ç»Ÿ**: æ”¯æŒç¬¬ä¸‰æ–¹åŠŸèƒ½æ‰©å±•

```typescript
// æ¸è¿›å¼é…ç½®ç¤ºä¾‹
// åŸºç¡€é…ç½®
const router = createRouter({
  history: createWebHistory(),
  routes,
})

// å¢å¼ºé…ç½®
const router = createRouter({
  history: createWebHistory(),
  routes,
  preloadStrategy: 'hover', // å¯ç”¨é¢„åŠ è½½
  performance: true, // å¯ç”¨æ€§èƒ½ç›‘æ§
  cache: { max: 20 }, // å¯ç”¨ç¼“å­˜
})
```

### 4. ç°ä»£åŒ–æ¶æ„ (Modern Architecture)

> "æ‹¥æŠ±ç°ä»£ Web æŠ€æœ¯ï¼Œé¢å‘æœªæ¥è®¾è®¡"

#### è®¾è®¡ç›®æ ‡

- åŸºäº Vue 3 Composition API
- æ”¯æŒ ES æ¨¡å—å’Œ Tree Shaking
- ç°ä»£åŒ–çš„æ„å»ºå·¥å…·é“¾
- é¢å‘æœªæ¥çš„æŠ€æœ¯é€‰å‹

#### å®ç°ç­–ç•¥

- **Composition API**: å®Œå…¨åŸºäº Vue 3 ç»„åˆå¼ API
- **ES æ¨¡å—**: åŸç”Ÿæ”¯æŒ ES æ¨¡å—å¯¼å…¥å¯¼å‡º
- **TypeScript**: ä½¿ç”¨æœ€æ–°çš„ TypeScript ç‰¹æ€§
- **ç°ä»£æ„å»º**: ä½¿ç”¨ Rollup + TypeScript æ„å»º

```typescript
// ç°ä»£åŒ– API ç¤ºä¾‹
import { useRoute, useRouter } from '@ldesign/router'

export default defineComponent({
  setup() {
    const router = useRouter()
    const route = useRoute()

    // å“åº”å¼è·¯ç”±ä¿¡æ¯
    const currentPath = computed(() => route.path)

    // ç¼–ç¨‹å¼å¯¼èˆª
    const navigate = (path: string) => {
      router.push(path)
    }

    return { currentPath, navigate }
  },
})
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡åŸåˆ™

### 1. å•ä¸€èŒè´£åŸåˆ™ (Single Responsibility)

æ¯ä¸ªæ¨¡å—éƒ½æœ‰æ˜ç¡®çš„èŒè´£ï¼š

- **Router**: è·¯ç”±ç®¡ç†å’Œå¯¼èˆªæ§åˆ¶
- **Matcher**: è·¯ç”±åŒ¹é…å’Œå‚æ•°è§£æ
- **History**: å†å²è®°å½•ç®¡ç†
- **Preloader**: é¢„åŠ è½½åŠŸèƒ½
- **Cache**: ç¼“å­˜ç®¡ç†
- **Performance**: æ€§èƒ½ç›‘æ§

### 2. å¼€æ”¾å°é—­åŸåˆ™ (Open/Closed)

- å¯¹æ‰©å±•å¼€æ”¾ï¼šæ’ä»¶ç³»ç»Ÿæ”¯æŒåŠŸèƒ½æ‰©å±•
- å¯¹ä¿®æ”¹å°é—­ï¼šæ ¸å¿ƒ API ä¿æŒç¨³å®š

```typescript
// æ’ä»¶æ‰©å±•ç¤ºä¾‹
const authPlugin = {
  install(router: Router) {
    router.beforeEach((to, from, next) => {
      if (to.meta.requiresAuth && !isAuthenticated()) {
        next('/login')
      } else {
        next()
      }
    })
  },
}

router.use(authPlugin)
```

### 3. ä¾èµ–å€’ç½®åŸåˆ™ (Dependency Inversion)

- é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—
- æŠ½è±¡ä¸ä¾èµ–å…·ä½“å®ç°
- å…·ä½“å®ç°ä¾èµ–æŠ½è±¡

```typescript
// æŠ½è±¡æ¥å£è®¾è®¡
interface RouterHistory {
  location: () => string
  push: (to: string, data?: any) => void
  replace: (to: string, data?: any) => void
  go: (delta: number) => void
  listen: (callback: NavigationCallback) => () => void
}

// å…·ä½“å®ç°
class WebHistory implements RouterHistory {
  // å®ç°æ¥å£æ–¹æ³•
}
```

### 4. æ¥å£éš”ç¦»åŸåˆ™ (Interface Segregation)

- ç»†ç²’åº¦çš„æ¥å£è®¾è®¡
- é¿å…è‡ƒè‚¿çš„æ¥å£
- æŒ‰éœ€å®ç°æ¥å£

## ğŸ¨ ç”¨æˆ·ä½“éªŒè®¾è®¡

### 1. æ™ºèƒ½é¢„åŠ è½½ç­–ç•¥

æ ¹æ®ç”¨æˆ·è¡Œä¸ºæ¨¡å¼è®¾è®¡å››ç§é¢„åŠ è½½ç­–ç•¥ï¼š

#### Hover é¢„åŠ è½½

- **åœºæ™¯**: ç”¨æˆ·æ‚¬åœåœ¨é“¾æ¥ä¸Š
- **ä¼˜åŠ¿**: å¹³è¡¡æ€§èƒ½ä¸ä½“éªŒ
- **é€‚ç”¨**: å¤§å¤šæ•°åº”ç”¨åœºæ™¯

#### Visible é¢„åŠ è½½

- **åœºæ™¯**: é“¾æ¥è¿›å…¥å¯è§†åŒºåŸŸ
- **ä¼˜åŠ¿**: èŠ‚çœå¸¦å®½
- **é€‚ç”¨**: ç§»åŠ¨ç«¯æˆ–ç½‘ç»œè¾ƒæ…¢çš„ç¯å¢ƒ

#### Idle é¢„åŠ è½½

- **åœºæ™¯**: æµè§ˆå™¨ç©ºé—²æ—¶
- **ä¼˜åŠ¿**: æœ€å¤§åŒ–ç¼“å­˜åˆ©ç”¨
- **é€‚ç”¨**: èµ„æºå……è¶³çš„ç¯å¢ƒ

#### Immediate é¢„åŠ è½½

- **åœºæ™¯**: é¡µé¢åŠ è½½å®Œæˆåç«‹å³é¢„åŠ è½½
- **ä¼˜åŠ¿**: æè‡´çš„ç”¨æˆ·ä½“éªŒ
- **é€‚ç”¨**: å…³é”®é¡µé¢æˆ–é«˜é¢‘è®¿é—®é¡µé¢

### 2. æ™ºèƒ½ç¼“å­˜æœºåˆ¶

#### LRU (Least Recently Used) ç®—æ³•

- è‡ªåŠ¨æ·˜æ±°æœ€å°‘ä½¿ç”¨çš„ç¼“å­˜
- ä¿æŒå†…å­˜ä½¿ç”¨åœ¨åˆç†èŒƒå›´
- æé«˜ç¼“å­˜å‘½ä¸­ç‡

#### TTL (Time To Live) æœºåˆ¶

- è‡ªåŠ¨è¿‡æœŸæœºåˆ¶ï¼Œç¡®ä¿æ•°æ®æ–°é²œåº¦
- å¯é…ç½®çš„è¿‡æœŸæ—¶é—´
- æ”¯æŒä¸åŒé¡µé¢ä¸åŒè¿‡æœŸç­–ç•¥

#### çµæ´»çš„è§„åˆ™é…ç½®

```typescript
cache: {
  max: 20,                    // æœ€å¤§ç¼“å­˜æ•°é‡
  ttl: 5 * 60 * 1000,        // 5åˆ†é’Ÿè¿‡æœŸ
  include: [                  // åŒ…å«è§„åˆ™
    /^\/user/,               // ç”¨æˆ·ç›¸å…³é¡µé¢
    'ProductList'            // äº§å“åˆ—è¡¨é¡µé¢
  ],
  exclude: [                  // æ’é™¤è§„åˆ™
    '/realtime-data',        // å®æ—¶æ•°æ®é¡µé¢
    '/payment'               // æ”¯ä»˜é¡µé¢
  ]
}
```

### 3. æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–

#### å®æ—¶æ€§èƒ½ç›‘æ§

- å¯¼èˆªæ—¶é—´ç»Ÿè®¡
- æˆåŠŸç‡ç›‘æ§
- å†…å­˜ä½¿ç”¨åˆ†æ
- ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡

#### æ€§èƒ½ä¼˜åŒ–å»ºè®®

- è‡ªåŠ¨æ£€æµ‹æ€§èƒ½ç“¶é¢ˆ
- æä¾›ä¼˜åŒ–å»ºè®®
- æ€§èƒ½æŠ¥å‘Šç”Ÿæˆ

```typescript
// æ€§èƒ½ç›‘æ§ç¤ºä¾‹
router.afterEach(() => {
  const stats = router.getPerformanceStats()

  if (stats.averageDuration > 1000) {
    console.warn('âš ï¸ å¯¼èˆªæ€§èƒ½è¾ƒæ…¢ï¼Œå»ºè®®ä¼˜åŒ–')
  }

  if (stats.successRate < 0.95) {
    console.warn('âš ï¸ å¯¼èˆªæˆåŠŸç‡è¾ƒä½ï¼Œè¯·æ£€æŸ¥è·¯ç”±é…ç½®')
  }
})
```

## ğŸ”® é¢å‘æœªæ¥çš„è®¾è®¡

### 1. å¯æ‰©å±•æ€§

#### æ’ä»¶ç³»ç»Ÿ

- æ ‡å‡†åŒ–çš„æ’ä»¶æ¥å£
- ç”Ÿå‘½å‘¨æœŸé’©å­
- çŠ¶æ€å…±äº«æœºåˆ¶

#### ç»„ä»¶æ‰©å±•

- è‡ªå®šä¹‰ RouterView
- è‡ªå®šä¹‰ RouterLink
- ç¬¬ä¸‰æ–¹ç»„ä»¶é›†æˆ

### 2. å…¼å®¹æ€§

#### å‘åå…¼å®¹

- ä¸ Vue Router ç›¸ä¼¼çš„ API
- å¹³æ»‘çš„è¿ç§»è·¯å¾„
- å…¼å®¹æ€§é€‚é…å™¨

#### å‘å‰å…¼å®¹

- é¢„ç•™æ‰©å±•æ¥å£
- ç‰ˆæœ¬åŒ–çš„ API è®¾è®¡
- æ¸è¿›å¼å‡çº§æ”¯æŒ

### 3. ç”Ÿæ€ç³»ç»Ÿ

#### å®˜æ–¹æ’ä»¶

- è®¤è¯æ’ä»¶
- åˆ†ææ’ä»¶
- è¿‡æ¸¡åŠ¨ç”»æ’ä»¶
- å¼€å‘è€…å·¥å…·

#### ç¤¾åŒºæ”¯æŒ

- æ’ä»¶å¼€å‘æŒ‡å—
- è´¡çŒ®è€…æ–‡æ¡£
- ç¤¾åŒºæ²»ç†

## ğŸ“Š è®¾è®¡éªŒè¯

### æ€§èƒ½éªŒè¯

- å¯¼èˆªé€Ÿåº¦æå‡ 50%
- å†…å­˜ä½¿ç”¨å‡å°‘ 25%
- åŒ…ä½“ç§¯ä¼˜åŒ– 13%
- ç¼“å­˜å‘½ä¸­ç‡ 85%

### ç”¨æˆ·ä½“éªŒéªŒè¯

- å­¦ä¹ æ›²çº¿å¹³æ»‘
- API ç›´è§‚æ˜“ç”¨
- é”™è¯¯æç¤ºæ¸…æ™°
- æ–‡æ¡£å®Œå–„æ˜“æ‡‚

### å¼€å‘ä½“éªŒéªŒè¯

- TypeScript æ”¯æŒå®Œæ•´
- IDE æ™ºèƒ½æç¤ºå‹å¥½
- è°ƒè¯•ä¿¡æ¯è¯¦ç»†
- æ„å»ºé›†æˆç®€å•

## ğŸ¯ è®¾è®¡æˆæœ

LDesign Router çš„è®¾è®¡ç†å¿µä½“ç°åœ¨ï¼š

1. **æ€§èƒ½ä¼˜å…ˆ**: é€šè¿‡æ™ºèƒ½é¢„åŠ è½½ã€ç¼“å­˜å’Œä¼˜åŒ–ç®—æ³•ï¼Œå®ç°äº†å“è¶Šçš„æ€§èƒ½è¡¨ç°
2. **å¼€å‘ä½“éªŒ**: é€šè¿‡å®Œæ•´çš„ TypeScript æ”¯æŒå’Œç›´è§‚çš„ API è®¾è®¡ï¼Œæä¾›äº†ä¼˜ç§€çš„å¼€å‘ä½“éªŒ
3. **æ¸è¿›å¼å¢å¼º**: é€šè¿‡åˆ†å±‚è®¾è®¡å’Œå¯é€‰é…ç½®ï¼Œå®ç°äº†ä»ç®€å•åˆ°å¤æ‚çš„å¹³æ»‘è¿‡æ¸¡
4. **ç°ä»£åŒ–æ¶æ„**: é€šè¿‡åŸºäº Vue 3 çš„è®¾è®¡å’Œç°ä»£åŒ–å·¥å…·é“¾ï¼Œé¢å‘æœªæ¥æ„å»º

è¿™äº›è®¾è®¡ç†å¿µä¸ä»…æŒ‡å¯¼äº† LDesign Router çš„å¼€å‘ï¼Œä¹Ÿä¸ºæœªæ¥çš„å‘å±•å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚
