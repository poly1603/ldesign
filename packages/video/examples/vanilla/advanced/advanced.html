<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>高级功能演示 - LDesign Video Player</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      color: #333;
      line-height: 1.6;
    }

    .header {
      background: linear-gradient(135deg, #722ED1, #9254DE);
      color: white;
      padding: 1.5rem 0;
      text-align: center;
    }

    .header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .nav {
      background: white;
      padding: 1rem 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      align-items: center;
      gap: 2rem;
    }

    .nav a {
      color: #666;
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      transition: all 0.3s ease;
    }

    .nav a:hover,
    .nav a.active {
      background: #722ED1;
      color: white;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .demo-section {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .demo-section h2 {
      color: #722ED1;
      margin-bottom: 1rem;
      font-size: 1.5rem;
    }

    .demo-section p {
      color: #666;
      margin-bottom: 1.5rem;
    }

    .player-container {
      width: 100%;
      max-width: 800px;
      margin: 0 auto 2rem;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }

    .feature-card {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1.5rem;
      border-left: 4px solid #722ED1;
    }

    .feature-card h3 {
      color: #333;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .feature-card .icon {
      font-size: 1.5rem;
    }

    .hotkey-list {
      background: #e9ecef;
      border-radius: 4px;
      padding: 1rem;
      margin-top: 1rem;
    }

    .hotkey-list h4 {
      color: #333;
      margin-bottom: 0.8rem;
      font-size: 1rem;
    }

    .hotkey-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #dee2e6;
    }

    .hotkey-item:last-child {
      border-bottom: none;
    }

    .hotkey-key {
      background: #6c757d;
      color: white;
      padding: 0.2rem 0.5rem;
      border-radius: 3px;
      font-family: monospace;
      font-size: 0.8rem;
    }

    .gesture-demo {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 4px;
      padding: 1rem;
      margin-top: 1rem;
    }

    .gesture-demo h4 {
      color: #856404;
      margin-bottom: 0.8rem;
    }

    .gesture-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.5rem 0;
    }

    .gesture-icon {
      font-size: 1.5rem;
      width: 2rem;
      text-align: center;
    }

    .performance-monitor {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      border-radius: 4px;
      padding: 1rem;
      margin-top: 1rem;
    }

    .performance-monitor h4 {
      color: #0c5460;
      margin-bottom: 0.8rem;
    }

    .performance-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #0c5460;
    }

    .stat-label {
      font-size: 0.8rem;
      color: #6c757d;
    }

    .controls-panel {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 8px;
      margin-top: 1rem;
    }

    .controls-panel h3 {
      color: #333;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }

    .control-group {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .control-group label {
      font-weight: 500;
      color: #555;
      min-width: 100px;
    }

    .btn {
      padding: 0.5rem 1rem;
      background: #722ED1;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s ease;
      font-size: 0.9rem;
    }

    .btn:hover {
      background: #5e2aa7;
    }

    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #6c757d;
    }

    .btn-secondary:hover {
      background: #545b62;
    }

    .btn-success {
      background: #28a745;
    }

    .btn-success:hover {
      background: #218838;
    }

    .btn-warning {
      background: #ffc107;
      color: #212529;
    }

    .btn-warning:hover {
      background: #e0a800;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #722ED1;
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .code-block {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 4px;
      padding: 1rem;
      margin: 1rem 0;
      overflow-x: auto;
    }

    .code-block pre {
      margin: 0;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      color: #333;
    }

    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      
      .feature-grid {
        grid-template-columns: 1fr;
      }
      
      .control-group {
        flex-direction: column;
        align-items: stretch;
      }
      
      .control-group label {
        min-width: auto;
      }
      
      .performance-stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>高级功能演示</h1>
    <p>展示 LDesign Video Player 的高级功能特性</p>
  </div>

  <div class="nav">
    <div class="nav-container">
      <a href="index.html">← 返回首页</a>
      <a href="basic.html">基础功能</a>
      <a href="plugins.html">插件系统</a>
      <a href="themes.html">主题系统</a>
      <a href="advanced.html" class="active">高级功能</a>
    </div>
  </div>

  <div class="container">
    <div class="demo-section">
      <h2>⚡ 高级功能演示</h2>
      <p>这个播放器实例启用了所有高级功能，包括快捷键、手势控制、性能监控等。</p>
      
      <div id="player-advanced" class="player-container"></div>

      <div class="controls-panel">
        <h3>功能控制</h3>
        
        <div class="control-group">
          <label>快捷键:</label>
          <label class="switch">
            <input type="checkbox" id="hotkey-toggle" checked>
            <span class="slider"></span>
          </label>
          <button id="hotkey-test" class="btn btn-secondary">测试快捷键</button>
        </div>

        <div class="control-group">
          <label>手势控制:</label>
          <label class="switch">
            <input type="checkbox" id="gesture-toggle" checked>
            <span class="slider"></span>
          </label>
          <button id="gesture-test" class="btn btn-secondary">测试手势</button>
        </div>

        <div class="control-group">
          <label>性能监控:</label>
          <label class="switch">
            <input type="checkbox" id="performance-toggle" checked>
            <span class="slider"></span>
          </label>
          <button id="performance-reset" class="btn btn-warning">重置统计</button>
        </div>

        <div class="control-group">
          <label>内存管理:</label>
          <button id="memory-optimize" class="btn btn-success">优化内存</button>
          <button id="memory-gc" class="btn btn-secondary">垃圾回收</button>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <div class="feature-grid">
        <!-- 快捷键功能 -->
        <div class="feature-card">
          <h3>
            <span class="icon">⌨️</span>
            键盘快捷键
          </h3>
          <p>支持丰富的键盘快捷键操作，提升用户体验。</p>
          
          <div class="hotkey-list">
            <h4>快捷键列表</h4>
            <div class="hotkey-item">
              <span>播放/暂停</span>
              <span class="hotkey-key">Space</span>
            </div>
            <div class="hotkey-item">
              <span>快退10秒</span>
              <span class="hotkey-key">←</span>
            </div>
            <div class="hotkey-item">
              <span>快进10秒</span>
              <span class="hotkey-key">→</span>
            </div>
            <div class="hotkey-item">
              <span>音量增加</span>
              <span class="hotkey-key">↑</span>
            </div>
            <div class="hotkey-item">
              <span>音量减少</span>
              <span class="hotkey-key">↓</span>
            </div>
            <div class="hotkey-item">
              <span>静音切换</span>
              <span class="hotkey-key">M</span>
            </div>
            <div class="hotkey-item">
              <span>全屏切换</span>
              <span class="hotkey-key">F</span>
            </div>
            <div class="hotkey-item">
              <span>截图</span>
              <span class="hotkey-key">Ctrl+S</span>
            </div>
          </div>
        </div>

        <!-- 手势控制 -->
        <div class="feature-card">
          <h3>
            <span class="icon">👆</span>
            触摸手势
          </h3>
          <p>在移动设备上支持直观的触摸手势操作。</p>
          
          <div class="gesture-demo">
            <h4>手势操作</h4>
            <div class="gesture-item">
              <span class="gesture-icon">👆</span>
              <span>单击 - 播放/暂停</span>
            </div>
            <div class="gesture-item">
              <span class="gesture-icon">👆👆</span>
              <span>双击 - 全屏切换</span>
            </div>
            <div class="gesture-item">
              <span class="gesture-icon">👈</span>
              <span>左滑 - 快退</span>
            </div>
            <div class="gesture-item">
              <span class="gesture-icon">👉</span>
              <span>右滑 - 快进</span>
            </div>
            <div class="gesture-item">
              <span class="gesture-icon">👆</span>
              <span>右侧上下滑 - 音量</span>
            </div>
            <div class="gesture-item">
              <span class="gesture-icon">👆</span>
              <span>左侧上下滑 - 亮度</span>
            </div>
          </div>
        </div>

        <!-- 性能监控 -->
        <div class="feature-card">
          <h3>
            <span class="icon">📊</span>
            性能监控
          </h3>
          <p>实时监控播放器性能，优化用户体验。</p>
          
          <div class="performance-monitor">
            <h4>性能统计</h4>
            <div class="performance-stats">
              <div class="stat-item">
                <div class="stat-value" id="fps-value">60</div>
                <div class="stat-label">FPS</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="memory-value">45</div>
                <div class="stat-label">内存(MB)</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="cpu-value">12</div>
                <div class="stat-label">CPU(%)</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="network-value">2.5</div>
                <div class="stat-label">网络(Mbps)</div>
              </div>
            </div>
          </div>
        </div>

        <!-- 错误处理 -->
        <div class="feature-card">
          <h3>
            <span class="icon">🛡️</span>
            错误处理
          </h3>
          <p>智能错误处理和恢复机制，确保播放稳定性。</p>
          
          <div style="margin-top: 1rem;">
            <button class="btn btn-warning" onclick="simulateError('network')">模拟网络错误</button>
            <button class="btn btn-warning" onclick="simulateError('decode')">模拟解码错误</button>
            <button class="btn btn-success" onclick="recoverError()">错误恢复</button>
          </div>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h2>📝 代码示例</h2>
      <p>以下是启用高级功能的代码示例：</p>
      
      <div class="code-block">
        <pre><code>import { VideoPlayer, HotkeyManager, GestureManager } from '@ldesign/video'

// 创建播放器并启用高级功能
const player = new VideoPlayer({
  container: document.getElementById('player'),
  src: 'video.mp4',
  // 启用快捷键
  hotkeys: {
    enabled: true,
    global: false,
    bindings: {
      'Space': {
        description: '播放/暂停',
        handler: () => player.toggle()
      },
      'Ctrl+KeyS': {
        description: '截图',
        handler: () => player.screenshot()
      }
    }
  },
  // 启用手势控制
  gestures: {
    enabled: true,
    bindings: {
      tap: () => player.toggle(),
      doubleTap: () => player.toggleFullscreen(),
      swipeLeft: () => player.seek(-10, true),
      swipeRight: () => player.seek(10, true)
    }
  },
  // 启用性能监控
  performance: {
    enabled: true,
    monitor: ['fps', 'memory', 'cpu', 'network'],
    onStats: (stats) => console.log('性能统计:', stats)
  },
  // 错误处理
  errorHandling: {
    autoRecover: true,
    maxRetries: 3,
    onError: (error) => console.error('播放器错误:', error)
  }
})

await player.initialize()

// 获取性能统计
const stats = player.getPerformanceStats()
console.log('当前性能:', stats)

// 内存优化
player.optimizeMemory()

// 自定义快捷键
player.getHotkeyManager().register('KeyR', {
  description: '重新加载',
  handler: () => player.reload()
})</code></pre>
      </div>
    </div>
  </div>

  <script type="module">
    import { VideoPlayer, HotkeyManager, GestureManager } from '../../src/index.ts'

    let player = null
    let hotkeyManager = null
    let gestureManager = null
    let performanceInterval = null

    // 初始化播放器
    async function initPlayer() {
      try {
        player = new VideoPlayer({
          container: document.getElementById('player-advanced'),
          src: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
          autoplay: false,
          controls: true,
          volume: 1,
          theme: 'default'
        })

        await player.initialize()
        
        // 初始化高级功能
        initAdvancedFeatures()
        
        // 绑定控制面板
        bindAdvancedControls()
        
        // 启动性能监控
        startPerformanceMonitoring()
        
        console.log('播放器和高级功能初始化成功')
      } catch (error) {
        console.error('播放器初始化失败:', error)
      }
    }

    // 初始化高级功能
    function initAdvancedFeatures() {
      // 初始化快捷键管理器
      hotkeyManager = new HotkeyManager(player, {
        enabled: true,
        global: false
      })

      // 初始化手势管理器
      gestureManager = new GestureManager(player, {
        enabled: true
      })

      // 绑定事件监听
      hotkeyManager.on('triggered', (data) => {
        console.log('快捷键触发:', data.key)
      })

      gestureManager.on('triggered', (data) => {
        console.log('手势触发:', data.type)
      })
    }

    // 绑定高级控制面板
    function bindAdvancedControls() {
      // 快捷键开关
      document.getElementById('hotkey-toggle').addEventListener('change', (e) => {
        if (e.target.checked) {
          hotkeyManager.enable()
        } else {
          hotkeyManager.disable()
        }
      })

      // 手势控制开关
      document.getElementById('gesture-toggle').addEventListener('change', (e) => {
        if (e.target.checked) {
          gestureManager.enable()
        } else {
          gestureManager.disable()
        }
      })

      // 性能监控开关
      document.getElementById('performance-toggle').addEventListener('change', (e) => {
        if (e.target.checked) {
          startPerformanceMonitoring()
        } else {
          stopPerformanceMonitoring()
        }
      })

      // 测试按钮
      document.getElementById('hotkey-test').addEventListener('click', () => {
        alert('请尝试按下空格键来播放/暂停视频')
      })

      document.getElementById('gesture-test').addEventListener('click', () => {
        alert('请在移动设备上尝试单击或双击播放器')
      })

      document.getElementById('performance-reset').addEventListener('click', () => {
        resetPerformanceStats()
      })

      document.getElementById('memory-optimize').addEventListener('click', () => {
        optimizeMemory()
      })

      document.getElementById('memory-gc').addEventListener('click', () => {
        if (window.gc) {
          window.gc()
          console.log('手动垃圾回收完成')
        } else {
          console.log('浏览器不支持手动垃圾回收')
        }
      })
    }

    // 启动性能监控
    function startPerformanceMonitoring() {
      if (performanceInterval) return

      performanceInterval = setInterval(() => {
        updatePerformanceStats()
      }, 1000)
    }

    // 停止性能监控
    function stopPerformanceMonitoring() {
      if (performanceInterval) {
        clearInterval(performanceInterval)
        performanceInterval = null
      }
    }

    // 更新性能统计
    function updatePerformanceStats() {
      // 模拟性能数据
      const fps = Math.floor(Math.random() * 10) + 55
      const memory = Math.floor(Math.random() * 20) + 40
      const cpu = Math.floor(Math.random() * 15) + 5
      const network = (Math.random() * 2 + 1).toFixed(1)

      document.getElementById('fps-value').textContent = fps
      document.getElementById('memory-value').textContent = memory
      document.getElementById('cpu-value').textContent = cpu
      document.getElementById('network-value').textContent = network
    }

    // 重置性能统计
    function resetPerformanceStats() {
      document.getElementById('fps-value').textContent = '60'
      document.getElementById('memory-value').textContent = '45'
      document.getElementById('cpu-value').textContent = '12'
      document.getElementById('network-value').textContent = '2.5'
      
      console.log('性能统计已重置')
    }

    // 内存优化
    function optimizeMemory() {
      // 模拟内存优化
      setTimeout(() => {
        const currentMemory = parseInt(document.getElementById('memory-value').textContent)
        const optimizedMemory = Math.max(20, currentMemory - 10)
        document.getElementById('memory-value').textContent = optimizedMemory
        
        console.log('内存优化完成，释放了', currentMemory - optimizedMemory, 'MB内存')
      }, 500)
    }

    // 模拟错误
    window.simulateError = function(type) {
      switch (type) {
        case 'network':
          console.error('模拟网络错误: 连接超时')
          alert('模拟网络错误: 连接超时\n播放器将尝试自动恢复...')
          break
        case 'decode':
          console.error('模拟解码错误: 视频格式不支持')
          alert('模拟解码错误: 视频格式不支持\n播放器将尝试降级处理...')
          break
      }
    }

    // 错误恢复
    window.recoverError = function() {
      console.log('执行错误恢复...')
      alert('错误恢复成功！播放器已恢复正常状态。')
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', initPlayer)

    // 页面卸载时清理
    window.addEventListener('beforeunload', () => {
      stopPerformanceMonitoring()
      if (player) {
        player.destroy()
      }
    })
  </script>
</body>
</html>
