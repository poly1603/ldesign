<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>@ldesign/tree - 功能演示</title>
  <!-- CSS样式将内联在下面 -->
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #722ED1, #9254DE);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    
    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }
    
    .demo-section {
      padding: 30px;
    }
    
    .demo-title {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: #333;
      border-bottom: 2px solid #722ED1;
      padding-bottom: 10px;
    }
    
    .demo-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 40px;
    }
    
    @media (max-width: 768px) {
      .demo-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .demo-item {
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .demo-item h3 {
      background: #f8f9fa;
      padding: 15px;
      margin: 0;
      font-size: 1.1rem;
      color: #333;
      border-bottom: 1px solid #e5e5e5;
    }
    
    .demo-content {
      padding: 20px;
    }
    
    .tree-container {
      height: 300px;
      border: 1px solid #e5e5e5;
      border-radius: 4px;
      overflow: auto;
    }
    
    .controls {
      margin-bottom: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 8px 16px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      background: white;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .btn:hover {
      background: #f5f5f5;
      border-color: #722ED1;
    }
    
    .btn.primary {
      background: #722ED1;
      color: white;
      border-color: #722ED1;
    }
    
    .btn.primary:hover {
      background: #5e2aa7;
    }
    
    .info-panel {
      background: #f8f9fa;
      border: 1px solid #e5e5e5;
      border-radius: 4px;
      padding: 15px;
      margin-top: 15px;
      font-size: 14px;
    }
    
    .status {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .status.success {
      background: #f6ffed;
      color: #52c41a;
      border: 1px solid #b7eb8f;
    }
    
    .status.warning {
      background: #fffbe6;
      color: #faad14;
      border: 1px solid #ffe58f;
    }
    
    .footer {
      background: #f8f9fa;
      padding: 20px;
      text-align: center;
      color: #666;
      border-top: 1px solid #e5e5e5;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>@ldesign/tree</h1>
      <p>功能完整的树形组件库演示</p>
    </div>
    
    <div class="demo-section">
      <h2 class="demo-title">基础功能演示</h2>
      
      <div class="demo-grid">
        <!-- 基础树形展示 -->
        <div class="demo-item">
          <h3>基础树形展示</h3>
          <div class="demo-content">
            <div class="controls">
              <button class="btn" onclick="expandAll('basic')">展开全部</button>
              <button class="btn" onclick="collapseAll('basic')">收起全部</button>
            </div>
            <div id="tree-basic" class="tree-container"></div>
            <div class="info-panel">
              <div>状态: <span class="status success">正常</span></div>
              <div>节点数: <span id="basic-count">0</span></div>
            </div>
          </div>
        </div>
        
        <!-- 多选模式 -->
        <div class="demo-item">
          <h3>多选模式</h3>
          <div class="demo-content">
            <div class="controls">
              <button class="btn" onclick="selectAll('multiple')">全选</button>
              <button class="btn" onclick="unselectAll('multiple')">取消全选</button>
            </div>
            <div id="tree-multiple" class="tree-container"></div>
            <div class="info-panel">
              <div>选中节点: <span id="multiple-selected">0</span></div>
            </div>
          </div>
        </div>
        
        <!-- 搜索功能 -->
        <div class="demo-item">
          <h3>搜索功能</h3>
          <div class="demo-content">
            <div class="controls">
              <input type="text" id="search-input" placeholder="搜索节点..." style="flex: 1; padding: 8px; border: 1px solid #d9d9d9; border-radius: 4px;">
              <button class="btn primary" onclick="performSearch()">搜索</button>
              <button class="btn" onclick="clearSearch()">清除</button>
            </div>
            <div id="tree-search" class="tree-container"></div>
            <div class="info-panel">
              <div>搜索结果: <span id="search-results">0</span> 个匹配项</div>
            </div>
          </div>
        </div>
        
        <!-- 拖拽功能 -->
        <div class="demo-item">
          <h3>拖拽排序</h3>
          <div class="demo-content">
            <div class="controls">
              <span class="status warning">拖拽节点进行排序</span>
            </div>
            <div id="tree-drag" class="tree-container"></div>
            <div class="info-panel">
              <div>拖拽操作: <span id="drag-operations">0</span> 次</div>
            </div>
          </div>
        </div>
      </div>
      
      <h2 class="demo-title">高级功能演示</h2>
      
      <div class="demo-grid">
        <!-- 虚拟滚动 -->
        <div class="demo-item">
          <h3>虚拟滚动 (大数据量)</h3>
          <div class="demo-content">
            <div class="controls">
              <button class="btn primary" onclick="generateLargeData()">生成1000个节点</button>
              <button class="btn" onclick="scrollToNode()">滚动到节点500</button>
            </div>
            <div id="tree-virtual" class="tree-container"></div>
            <div class="info-panel">
              <div>总节点数: <span id="virtual-count">0</span></div>
              <div>渲染性能: <span id="virtual-performance">-</span></div>
            </div>
          </div>
        </div>
        
        <!-- 异步加载 -->
        <div class="demo-item">
          <h3>异步加载</h3>
          <div class="demo-content">
            <div class="controls">
              <span class="status success">点击节点展开异步加载子节点</span>
            </div>
            <div id="tree-async" class="tree-container"></div>
            <div class="info-panel">
              <div>加载状态: <span id="async-status">就绪</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="footer">
      <p>&copy; 2024 ldesign. MIT License. 构建时间: <span id="build-time"></span></p>
    </div>
  </div>
  
  <script src="../dist/index.js"></script>
  <script>
    // 设置构建时间
    document.getElementById('build-time').textContent = new Date().toLocaleString()
    
    // 全局变量
    const trees = {}
    let dragOperations = 0
    
    // 生成测试数据
    function generateTestData(count = 20, depth = 3) {
      const data = []
      let nodeId = 1
      
      function createNode(level, parentId) {
        const id = `node-${nodeId++}`
        const node = {
          id,
          label: `节点 ${id}`,
          icon: level === 0 ? '📁' : (Math.random() > 0.5 ? '📄' : '🖼️'),
          parentId,
        }
        
        if (level < depth && Math.random() > 0.3 && nodeId <= count) {
          const childCount = Math.floor(Math.random() * 4) + 1
          node.children = []
          for (let i = 0; i < childCount && nodeId <= count; i++) {
            node.children.push(createNode(level + 1, id))
          }
        }
        
        return node
      }
      
      while (nodeId <= count) {
        data.push(createNode(0))
      }
      
      return data
    }
    
    // 初始化基础树
    function initBasicTree() {
      const data = generateTestData(15, 2)
      trees.basic = new LDesignTree.Tree(document.getElementById('tree-basic'), {
        data,
        style: { showIcons: true, showLines: true }
      })
      
      document.getElementById('basic-count').textContent = trees.basic.getAllNodes().length
    }
    
    // 初始化多选树
    function initMultipleTree() {
      const data = generateTestData(12, 2)
      trees.multiple = new LDesignTree.Tree(document.getElementById('tree-multiple'), {
        data,
        selection: {
          mode: 'multiple',
          showCheckbox: true,
        },
        style: { showIcons: true }
      })
      
      trees.multiple.on('select', (selectedIds) => {
        document.getElementById('multiple-selected').textContent = selectedIds.length
      })
    }
    
    // 初始化搜索树
    function initSearchTree() {
      const data = generateTestData(20, 3)
      trees.search = new LDesignTree.Tree(document.getElementById('tree-search'), {
        data,
        search: {
          enabled: true,
          highlightMatches: true,
        },
        style: { showIcons: true }
      })
      
      trees.search.on('search', (query, results) => {
        document.getElementById('search-results').textContent = results.length
      })
    }
    
    // 初始化拖拽树
    function initDragTree() {
      const data = generateTestData(10, 2)
      trees.drag = new LDesignTree.Tree(document.getElementById('tree-drag'), {
        data,
        dragDrop: {
          enabled: true,
          allowCrossLevel: true,
          allowReorder: true,
        },
        style: { showIcons: true }
      })
      
      trees.drag.on('drop', () => {
        dragOperations++
        document.getElementById('drag-operations').textContent = dragOperations
      })
    }
    
    // 初始化虚拟滚动树
    function initVirtualTree() {
      trees.virtual = new LDesignTree.Tree(document.getElementById('tree-virtual'), {
        data: [],
        virtualScroll: {
          enabled: true,
          itemHeight: 32,
        },
        style: { showIcons: true }
      })
    }
    
    // 初始化异步加载树
    function initAsyncTree() {
      const rootData = [
        { id: 'async-1', label: '异步节点1', children: [] },
        { id: 'async-2', label: '异步节点2', children: [] },
        { id: 'async-3', label: '异步节点3', children: [] },
      ]
      
      trees.async = new LDesignTree.Tree(document.getElementById('tree-async'), {
        data: rootData,
        async: {
          loadChildren: async (node) => {
            document.getElementById('async-status').textContent = '加载中...'
            
            // 模拟异步加载
            await new Promise(resolve => setTimeout(resolve, 1000))
            
            const children = Array.from({ length: 3 }, (_, i) => ({
              id: `${node.id}-child-${i + 1}`,
              label: `${node.label} 的子节点 ${i + 1}`,
              icon: '📄',
            }))
            
            document.getElementById('async-status').textContent = '加载完成'
            setTimeout(() => {
              document.getElementById('async-status').textContent = '就绪'
            }, 2000)
            
            return children
          },
        },
        style: { showIcons: true }
      })
    }
    
    // 控制函数
    function expandAll(treeKey) {
      if (trees[treeKey]) {
        trees[treeKey].expandAll()
      }
    }
    
    function collapseAll(treeKey) {
      if (trees[treeKey]) {
        trees[treeKey].collapseAll()
      }
    }
    
    function selectAll(treeKey) {
      if (trees[treeKey]) {
        trees[treeKey].selectAll()
      }
    }
    
    function unselectAll(treeKey) {
      if (trees[treeKey]) {
        trees[treeKey].unselectAll()
      }
    }
    
    function performSearch() {
      const query = document.getElementById('search-input').value
      if (trees.search && query) {
        trees.search.search(query)
      }
    }
    
    function clearSearch() {
      document.getElementById('search-input').value = ''
      if (trees.search) {
        trees.search.clearSearch()
        document.getElementById('search-results').textContent = '0'
      }
    }
    
    function generateLargeData() {
      const startTime = performance.now()
      const data = generateTestData(1000, 1)
      const endTime = performance.now()
      
      trees.virtual.setData(data)
      document.getElementById('virtual-count').textContent = data.length
      document.getElementById('virtual-performance').textContent = `${(endTime - startTime).toFixed(2)}ms`
    }
    
    function scrollToNode() {
      if (trees.virtual) {
        trees.virtual.scrollToNode('node-500')
      }
    }
    
    // 初始化所有树
    try {
      initBasicTree()
      initMultipleTree()
      initSearchTree()
      initDragTree()
      initVirtualTree()
      initAsyncTree()
      
      console.log('✅ 所有树形组件初始化成功')
    } catch (error) {
      console.error('❌ 树形组件初始化失败:', error)
    }
  </script>
</body>
</html>
