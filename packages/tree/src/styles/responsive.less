/**
 * 响应式样式
 */

@import './variables.less';

// 超小屏幕 (手机竖屏)
@media (max-width: @tree-breakpoint-xs) {
  .@{tree-prefix} {
    font-size: @tree-font-size-small;

    &__node {
      min-height: 48px; // 增加触摸目标
      padding: var(--ls-padding-sm);

      &-content {
        gap: var(--ls-spacing-sm);
      }

      &-indent {
        width: var(--ls-spacing-sm); // 减少缩进
      }

      &-label {
        font-size: @tree-font-size;
        line-height: 1.4;
      }

      &-expand-icon {
        width: 32px;
        height: 32px;
        font-size: 16px;
      }

      &-checkbox {
        width: 20px;
        height: 20px;
      }

      &-actions {
        gap: var(--ls-spacing-xs);

        button {
          min-width: 32px;
          min-height: 32px;
          padding: var(--ls-padding-xs);
        }
      }
    }

    &__search {
      margin-bottom: var(--ls-margin-base);

      &-input {
        height: 48px;
        font-size: 16px; // 防止iOS缩放
        padding: 0 var(--ls-padding-base);
      }

      &-results {
        max-height: 40vh;
      }
    }

    // 隐藏不必要的元素
    &__drag-handle {
      display: none;
    }

    &__virtual-scroll {
      &-stats {
        display: none;
      }
    }
  }
}

// 小屏幕 (手机横屏/小平板)
@media (min-width: @tree-breakpoint-xs) and (max-width: @tree-breakpoint-sm) {
  .@{tree-prefix} {
    &__node {
      min-height: 44px;
      padding: var(--ls-padding-sm);

      &-indent {
        width: var(--ls-spacing-base);
      }

      &-expand-icon {
        width: 28px;
        height: 28px;
      }

      &-actions {
        button {
          min-width: 28px;
          min-height: 28px;
        }
      }
    }

    &__search {
      &-input {
        height: 44px;
        font-size: 16px;
      }

      &-mode {
        flex-direction: column;
        align-items: stretch;

        &-toggle {
          width: 100%;

          button {
            flex: 1;
            padding: var(--ls-padding-xs) var(--ls-padding-sm);
          }
        }
      }
    }

    // 简化拖拽
    &__drag-handle {
      opacity: 1;
      width: 24px;
      height: 24px;
    }
  }
}

// 中等屏幕 (平板)
@media (min-width: @tree-breakpoint-sm) and (max-width: @tree-breakpoint-md) {
  .@{tree-prefix} {
    &__node {
      &-actions {
        opacity: 1; // 始终显示操作按钮
      }
    }

    &__search {
      &-stats {
        flex-direction: row;
        align-items: center;
      }
    }

    // 优化虚拟滚动
    &__virtual-scroll {
      &::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }
    }
  }
}

// 大屏幕 (桌面)
@media (min-width: @tree-breakpoint-md) {
  .@{tree-prefix} {
    // 默认样式适用于桌面
  }
}

// 超大屏幕
@media (min-width: @tree-breakpoint-xl) {
  .@{tree-prefix} {
    &__node {
      &-content {
        gap: var(--ls-spacing-lg);
      }

      &-indent {
        width: calc(@tree-indent-size * 1.2);
      }
    }

    &__search {
      &-input {
        font-size: @tree-font-size-large;
      }
    }
  }
}

// 横屏模式
@media (orientation: landscape) {
  .@{tree-prefix} {
    &__search {
      &-results {
        max-height: 30vh;
      }
    }

    &__virtual-scroll {
      &-load-more {
        padding: var(--ls-padding-sm) var(--ls-padding-base);
      }
    }
  }
}

// 竖屏模式
@media (orientation: portrait) {
  .@{tree-prefix} {
    &__search {
      &-results {
        max-height: 50vh;
      }
    }

    &__node {
      &-actions {
        flex-direction: column;
        gap: var(--ls-spacing-xs);

        @media (max-width: @tree-breakpoint-sm) {
          flex-direction: row;
        }
      }
    }
  }
}

// 触摸设备
@media (hover: none) and (pointer: coarse) {
  .@{tree-prefix} {
    &__node {
      min-height: 44px; // WCAG 最小触摸目标
      
      &:hover {
        background: transparent; // 禁用悬停效果
      }

      &-expand-icon {
        width: 44px;
        height: 44px;
        font-size: 18px;
      }

      &-checkbox {
        width: 24px;
        height: 24px;
      }

      &-actions {
        opacity: 1; // 始终显示

        button {
          min-width: 44px;
          min-height: 44px;
        }
      }
    }

    &__drag-handle {
      opacity: 1;
      width: 44px;
      height: 44px;
    }

    &__search {
      &-input {
        height: 44px;
        font-size: 16px;
      }

      &-clear {
        width: 24px;
        height: 24px;
        opacity: 1;
      }
    }

    // 禁用某些交互
    &__drop-zone {
      display: none;
    }

    &__virtual-scroll {
      &::-webkit-scrollbar {
        display: none; // 隐藏滚动条
      }

      &-indicator {
        display: none;
      }
    }
  }
}

// 鼠标设备
@media (hover: hover) and (pointer: fine) {
  .@{tree-prefix} {
    &__node {
      &-actions {
        opacity: 0;
        transition: opacity @tree-transition-duration @tree-transition-timing;
      }

      &:hover {
        .@{tree-prefix}__node-actions {
          opacity: 1;
        }
      }
    }

    &__drag-handle {
      opacity: 0;
      transition: opacity @tree-transition-duration @tree-transition-timing;

      .@{tree-prefix}__node:hover & {
        opacity: 1;
      }
    }
  }
}

// 高分辨率屏幕
@media (min-resolution: 2dppx) {
  .@{tree-prefix} {
    &__node {
      &-icon {
        font-size: calc(@tree-icon-size + 1px);
      }

      &-expand-icon {
        font-size: calc(@tree-icon-size + 1px);
      }
    }

    // 优化边框
    border-width: 0.5px;

    .@{tree-prefix}__node {
      border-width: 0.5px;
    }

    .@{tree-prefix}__drop-indicator {
      height: 1px;
    }
  }
}

// 打印样式
@media print {
  .@{tree-prefix} {
    background: white !important;
    color: black !important;
    border: 1px solid black !important;
    box-shadow: none !important;

    * {
      background: transparent !important;
      color: black !important;
      box-shadow: none !important;
    }

    &__node {
      border: none !important;
      page-break-inside: avoid;

      &--selected {
        font-weight: bold !important;
        text-decoration: underline !important;
      }

      &-actions,
      &-expand-icon {
        display: none !important;
      }
    }

    &__search,
    &__drag-handle,
    &__drop-indicator,
    &__virtual-scroll-stats {
      display: none !important;
    }

    // 展开所有节点
    &__node-children {
      display: block !important;
      height: auto !important;
      overflow: visible !important;
    }
  }
}

// 容器查询 (实验性)
@supports (container-type: inline-size) {
  .@{tree-prefix} {
    container-type: inline-size;
  }

  @container (max-width: 300px) {
    .@{tree-prefix} {
      &__node {
        &-label {
          font-size: @tree-font-size-small;
        }

        &-actions {
          flex-direction: column;
        }
      }

      &__search {
        &-mode {
          flex-direction: column;
        }
      }
    }
  }

  @container (max-width: 200px) {
    .@{tree-prefix} {
      &__node {
        &-indent {
          width: var(--ls-spacing-xs);
        }

        &-actions {
          display: none;
        }
      }

      &__drag-handle {
        display: none;
      }
    }
  }
}
