/**
 * 树形节点样式
 */

.tree-node {
  position: relative;
  display: flex;
  align-items: center;
  min-height: var(--tree-node-height);
  padding: var(--tree-node-padding);
  background: var(--tree-node-bg);
  border: 1px solid transparent;
  border-radius: var(--ls-border-radius-sm);
  cursor: pointer;
  user-select: none;
  transition: all var(--tree-animation-duration) var(--tree-animation-easing);

  // 悬停状态
  &:hover {
    background: var(--tree-node-bg-hover);
    border-color: var(--tree-node-border);
  }

  // 选中状态
  &.tree-node-selected {
    background: var(--tree-node-bg-selected);
    border-color: var(--ldesign-brand-color);
    
    .tree-node-label {
      color: var(--ldesign-brand-color);
      font-weight: 500;
    }
  }

  // 激活状态
  &:active {
    background: var(--tree-node-bg-active);
  }

  // 禁用状态
  &.tree-node-disabled {
    opacity: 0.6;
    cursor: not-allowed;
    pointer-events: none;
    
    .tree-node-label {
      color: var(--tree-node-text-disabled);
    }
  }

  // 加载状态
  &.tree-node-loading {
    .tree-node-expand-button {
      opacity: 0.5;
      pointer-events: none;
    }
  }

  // 错误状态
  &.tree-node-error {
    border-color: var(--ldesign-error-color);
    
    .tree-node-label {
      color: var(--ldesign-error-color);
    }
  }

  // 拖拽状态
  &.tree-node-dragging {
    opacity: 0.5;
    transform: scale(0.95);
    z-index: 1000;
  }

  // 拖拽目标状态
  &.tree-node-drop-target {
    border-color: var(--ldesign-brand-color);
    background: var(--ldesign-brand-color-focus);
    
    &::before {
      content: '';
      position: absolute;
      top: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--ldesign-brand-color);
      border-radius: 1px;
    }
    
    &.drop-position-after::before {
      top: auto;
      bottom: -2px;
    }
    
    &.drop-position-inside {
      border-style: dashed;
      
      &::before {
        display: none;
      }
    }
  }

  // 焦点状态
  &:focus {
    outline: 2px solid var(--ldesign-brand-color-focus);
    outline-offset: -2px;
  }
}

// 节点内容容器
.tree-node-content {
  display: flex;
  align-items: center;
  flex: 1;
  gap: var(--tree-node-gap);
  min-width: 0;
}

// 展开/收起按钮
.tree-node-expand-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: var(--tree-expand-icon-size);
  height: var(--tree-expand-icon-size);
  padding: 0;
  margin: 0;
  background: transparent;
  border: none;
  border-radius: var(--ls-border-radius-sm);
  color: var(--ldesign-text-color-secondary);
  font-size: 12px;
  cursor: pointer;
  transition: all var(--tree-animation-duration) var(--tree-animation-easing);

  &:hover {
    background: var(--ldesign-bg-color-container-hover);
    color: var(--ldesign-text-color-primary);
  }

  &:active {
    background: var(--ldesign-bg-color-container-active);
  }

  &:focus {
    outline: 1px solid var(--ldesign-brand-color);
    outline-offset: 1px;
  }
}

// 展开按钮占位符
.tree-node-expand-spacer {
  width: var(--tree-expand-icon-size);
  height: var(--tree-expand-icon-size);
  flex-shrink: 0;
}

// 复选框
.tree-node-checkbox {
  width: 16px;
  height: 16px;
  margin: 0;
  cursor: pointer;
  accent-color: var(--ldesign-brand-color);

  &:disabled {
    cursor: not-allowed;
    opacity: 0.6;
  }

  &:focus {
    outline: 2px solid var(--ldesign-brand-color-focus);
    outline-offset: 2px;
  }
}

// 节点图标
.tree-node-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: var(--tree-icon-size);
  height: var(--tree-icon-size);
  font-size: var(--tree-icon-size);
  color: var(--ldesign-text-color-secondary);
  flex-shrink: 0;
}

// 节点标签
.tree-node-label {
  flex: 1;
  min-width: 0;
  color: var(--tree-node-text);
  font-size: var(--ls-font-size-sm);
  line-height: 1.4;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  transition: color var(--tree-animation-duration) var(--tree-animation-easing);
}

// 加载指示器
.tree-node-loading-indicator {
  display: inline-flex;
  align-items: center;
  color: var(--ldesign-text-color-placeholder);
  font-size: 12px;
  animation: tree-loading-dots 1.5s infinite;
}

// 错误指示器
.tree-node-error-indicator {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  background: var(--ldesign-error-color);
  color: white;
  font-size: 12px;
  font-weight: bold;
  border-radius: 50%;
  cursor: help;
}

// 加载点动画
@keyframes tree-loading-dots {
  0%, 20% {
    opacity: 0;
  }
  50% {
    opacity: 1;
  }
  80%, 100% {
    opacity: 0;
  }
}

// 连接线样式
.ldesign-tree.tree-show-line {
  .tree-node {
    position: relative;
    
    &::before {
      content: '';
      position: absolute;
      left: calc(var(--tree-node-indent) / 2 - 1px);
      top: 0;
      bottom: 50%;
      width: 1px;
      background: var(--ldesign-border-color);
    }
    
    &::after {
      content: '';
      position: absolute;
      left: calc(var(--tree-node-indent) / 2 - 1px);
      top: 50%;
      width: calc(var(--tree-node-indent) / 2);
      height: 1px;
      background: var(--ldesign-border-color);
    }
    
    // 最后一个子节点
    &:last-child::before {
      bottom: 50%;
    }
    
    // 根节点不显示连接线
    &[data-level="0"] {
      &::before,
      &::after {
        display: none;
      }
    }
  }
}
