# æ¨¡æ¿ç³»ç»Ÿé‡æ„æ€»ç»“

## ğŸ“‹ é‡æ„æ¦‚è¿°

å®Œå…¨é‡å†™äº† `@ldesign/template` åŒ…ï¼Œä½¿ç”¨ `import.meta.glob` å®ç°è‡ªåŠ¨åŒ–çš„æ¨¡æ¿æ‰«æå’ŒåŠ è½½ç³»ç»Ÿã€‚

## ğŸ¯ é‡æ„ç›®æ ‡

1. âœ… ä½¿ç”¨ `import.meta.glob` è‡ªåŠ¨æ‰«ææ‰€æœ‰æ¨¡æ¿
2. âœ… æ”¯æŒå¼€å‘ç¯å¢ƒï¼ˆ.tsï¼‰å’Œç”Ÿäº§ç¯å¢ƒï¼ˆ.jsï¼‰
3. âœ… æ¨¡æ¿ç»„ä»¶æ‡’åŠ è½½ï¼Œä¼˜åŒ–æ€§èƒ½
4. âœ… ç®€åŒ–æ¨¡æ¿åˆ›å»ºæµç¨‹
5. âœ… æä¾›å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ
6. âœ… æä¾›å¤šç§ä½¿ç”¨æ–¹å¼ï¼ˆAPIã€Composablesã€Componentsï¼‰

## ğŸ“ æ–°çš„ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ types/                      # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts               # æ ¸å¿ƒç±»å‹
â”œâ”€â”€ core/                       # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ scanner.ts             # æ¨¡æ¿æ‰«æå™¨
â”‚   â”œâ”€â”€ loader.ts              # æ¨¡æ¿åŠ è½½å™¨
â”‚   â”œâ”€â”€ manager.ts             # æ¨¡æ¿ç®¡ç†å™¨
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ composables/                # Vue ç»„åˆå¼å‡½æ•°
â”‚   â”œâ”€â”€ useTemplate.ts         # æ¨¡æ¿ç›¸å…³ hooks
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ components/                 # Vue ç»„ä»¶
â”‚   â”œâ”€â”€ TemplateRenderer.vue   # æ¨¡æ¿æ¸²æŸ“ç»„ä»¶
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ templates/                  # æ¨¡æ¿åº“
â”‚   â”œâ”€â”€ login/                 # ç™»å½•æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ desktop/
â”‚   â”‚   â”‚   â””â”€â”€ default/
â”‚   â”‚   â”‚       â”œâ”€â”€ config.ts
â”‚   â”‚   â”‚       â””â”€â”€ index.vue
â”‚   â”‚   â””â”€â”€ mobile/
â”‚   â”‚       â””â”€â”€ default/
â”‚   â”‚           â”œâ”€â”€ config.ts
â”‚   â”‚           â””â”€â”€ index.vue
â”‚   â””â”€â”€ dashboard/             # ä»ªè¡¨æ¿æ¨¡æ¿
â”‚       â””â”€â”€ desktop/
â”‚           â””â”€â”€ default/
â”‚               â”œâ”€â”€ config.ts
â”‚               â””â”€â”€ index.vue
â”œâ”€â”€ index.ts                    # ä¸»å…¥å£
â””â”€â”€ README.md                   # è¯´æ˜æ–‡æ¡£
```

## ğŸ”‘ æ ¸å¿ƒç»„ä»¶

### 1. TemplateScanner (æ‰«æå™¨)

**æ–‡ä»¶**: `src/core/scanner.ts`

**åŠŸèƒ½**:
- ä½¿ç”¨ `import.meta.glob` è‡ªåŠ¨æ‰«ææ‰€æœ‰æ¨¡æ¿
- æ”¯æŒ `.ts` å’Œ `.js` é…ç½®æ–‡ä»¶
- ç”Ÿæˆæ¨¡æ¿æ³¨å†Œè¡¨
- æä¾›æ‰«æç»Ÿè®¡ä¿¡æ¯

**å…³é”®ä»£ç **:
```typescript
const configModules = import.meta.glob(
  '/src/templates/**/config.{ts,js}',
  { eager: true }
)

const componentModules = import.meta.glob(
  '/src/templates/**/index.vue'
)
```

### 2. TemplateLoader (åŠ è½½å™¨)

**æ–‡ä»¶**: `src/core/loader.ts`

**åŠŸèƒ½**:
- æŒ‰éœ€åŠ è½½æ¨¡æ¿ç»„ä»¶
- ç»„ä»¶ç¼“å­˜ç®¡ç†
- åŠ è½½å»é‡å¤„ç†
- é¢„åŠ è½½æ”¯æŒ
- è¶…æ—¶å’Œé”™è¯¯å¤„ç†

### 3. TemplateManager (ç®¡ç†å™¨)

**æ–‡ä»¶**: `src/core/manager.ts`

**åŠŸèƒ½**:
- ç»Ÿä¸€çš„æ¨¡æ¿ç®¡ç†æ¥å£
- åˆå§‹åŒ–å’Œæ‰«æç®¡ç†
- æ¨¡æ¿æŸ¥è¯¢åŠŸèƒ½
- ç¼“å­˜ç®¡ç†

### 4. Vue ç»„åˆå¼å‡½æ•°

**æ–‡ä»¶**: `src/composables/useTemplate.ts`

**æä¾›çš„ Hooks**:
- `useTemplate()` - åŠ è½½å•ä¸ªæ¨¡æ¿
- `useTemplateList()` - æŸ¥è¯¢æ¨¡æ¿åˆ—è¡¨
- `useDefaultTemplate()` - è·å–é»˜è®¤æ¨¡æ¿
- `useTemplateManager()` - ä½¿ç”¨ç®¡ç†å™¨

### 5. TemplateRenderer ç»„ä»¶

**æ–‡ä»¶**: `src/components/TemplateRenderer.vue`

**åŠŸèƒ½**:
- å£°æ˜å¼æ¨¡æ¿æ¸²æŸ“
- å†…ç½®åŠ è½½çŠ¶æ€
- å†…ç½®é”™è¯¯å¤„ç†
- è‡ªå®šä¹‰æ’æ§½æ”¯æŒ

## ğŸ¨ æ¨¡æ¿åˆ›å»ºæµç¨‹

### æ—§æ–¹å¼ï¼ˆå·²åºŸå¼ƒï¼‰
```
1. åˆ›å»ºæ¨¡æ¿ç»„ä»¶
2. æ‰‹åŠ¨æ³¨å†Œåˆ°é…ç½®æ–‡ä»¶
3. æ›´æ–°ç±»å‹å®šä¹‰
4. ç»´æŠ¤ç´¢å¼•æ–‡ä»¶
```

### æ–°æ–¹å¼ï¼ˆè‡ªåŠ¨åŒ–ï¼‰
```
1. åˆ›å»ºç›®å½•: templates/{category}/{device}/{name}/
2. åˆ›å»º config.tsï¼ˆæ¨¡æ¿å…ƒæ•°æ®ï¼‰
3. åˆ›å»º index.vueï¼ˆæ¨¡æ¿ç»„ä»¶ï¼‰
4. å®Œæˆï¼ç³»ç»Ÿè‡ªåŠ¨æ‰«æå’Œæ³¨å†Œ
```

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ API ä½¿ç”¨

```typescript
import { getManager } from '@ldesign/template'

const manager = getManager()
await manager.initialize()

const component = await manager.loadTemplate('login', 'desktop', 'default')
```

### Vue ç»„åˆå¼å‡½æ•°

```vue
<script setup>
import { useTemplate } from '@ldesign/template'

const { component, loading, error } = useTemplate('login', 'desktop', 'default')
</script>

<template>
  <component :is="component" v-if="component" />
</template>
```

### TemplateRenderer ç»„ä»¶

```vue
<template>
  <TemplateRenderer
    category="login"
    device="desktop"
    name="default"
    @submit="handleSubmit"
  />
</template>
```

## ğŸ”„ å…³é”®æ”¹è¿›

### 1. è‡ªåŠ¨åŒ–
- âœ… æ— éœ€æ‰‹åŠ¨æ³¨å†Œæ¨¡æ¿
- âœ… è‡ªåŠ¨æ‰«æå’Œå‘ç°
- âœ… è·¯å¾„å³é…ç½®

### 2. ç±»å‹å®‰å…¨
- âœ… å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- âœ… ç±»å‹æ¨å¯¼å’Œæ£€æŸ¥
- âœ… IDE æ™ºèƒ½æç¤º

### 3. æ€§èƒ½ä¼˜åŒ–
- âœ… é…ç½® eager åŠ è½½ï¼ˆä½“ç§¯å°ï¼‰
- âœ… ç»„ä»¶æ‡’åŠ è½½
- âœ… æ™ºèƒ½ç¼“å­˜
- âœ… åŠ è½½å»é‡

### 4. å¼€å‘ä½“éªŒ
- âœ… ç®€åŒ–çš„æ¨¡æ¿åˆ›å»ºæµç¨‹
- âœ… æ¸…æ™°çš„ç›®å½•ç»“æ„
- âœ… ä¸°å¯Œçš„ä½¿ç”¨æ–¹å¼
- âœ… å®Œå–„çš„æ–‡æ¡£

### 5. ç”Ÿäº§å°±ç»ª
- âœ… æ”¯æŒæ‰“åŒ…å‘å¸ƒåˆ° npm
- âœ… å…¼å®¹å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒ
- âœ… æ­£ç¡®å¤„ç†æ–‡ä»¶æ‰©å±•å
- âœ… è·¯å¾„è‡ªåŠ¨è½¬æ¢

## ğŸ“¦ æ‰“åŒ…è¯´æ˜

### import.meta.glob å¤„ç†

**å¼€å‘ç¯å¢ƒ**:
```typescript
import.meta.glob('/src/templates/**/config.ts', { eager: true })
```

**æ‰“åŒ…å**:
- Vite/Rollup è‡ªåŠ¨è½¬æ¢ä¸ºå®é™…çš„ import è¯­å¥
- è‡ªåŠ¨å¤„ç† `.ts` â†’ `.js` è½¬æ¢
- ç”Ÿæˆæ­£ç¡®çš„ç›¸å¯¹è·¯å¾„

### æ–‡ä»¶æ‰©å±•åå…¼å®¹

ä½¿ç”¨ `config.{ts,js}` æ¨¡å¼åŒæ—¶åŒ¹é…ï¼š
- å¼€å‘ç¯å¢ƒï¼š`.ts` æ–‡ä»¶
- ç”Ÿäº§ç¯å¢ƒï¼š`.js` æ–‡ä»¶ï¼ˆç¼–è¯‘åï¼‰

## ğŸ”§ è¿ç§»æŒ‡å—

### å¦‚æœä½ æ˜¯åŒ…çš„ä½¿ç”¨è€…

**æ— éœ€æ”¹åŠ¨**ï¼æ–°ç³»ç»Ÿå‘åå…¼å®¹ï¼Œä½¿ç”¨æ–¹å¼æ›´ç®€å•ã€‚

### å¦‚æœä½ è¦åˆ›å»ºæ–°æ¨¡æ¿

**æŒ‰ç…§æ–°æµç¨‹**ï¼š
1. åˆ›å»ºç›®å½•ç»“æ„
2. æ·»åŠ  `config.ts` å’Œ `index.vue`
3. ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«

### å¦‚æœä½ æœ‰ç°æœ‰æ¨¡æ¿

**ç¡®ä¿ç›®å½•ç»“æ„æ­£ç¡®**ï¼š
```
templates/{category}/{device}/{name}/
  â”œâ”€â”€ config.ts
  â””â”€â”€ index.vue
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **æ¶æ„è¯´æ˜**: `ARCHITECTURE_NEW.md`
- **ä½¿ç”¨ç¤ºä¾‹**: `USAGE_EXAMPLE.md`
- **README**: `src/README.md`

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… æ ¸å¿ƒç³»ç»Ÿå®Œæˆ
2. âœ… ç¤ºä¾‹æ¨¡æ¿åˆ›å»º
3. â³ æ·»åŠ æ›´å¤šæ¨¡æ¿
4. â³ ç¼–å†™æµ‹è¯•ç”¨ä¾‹
5. â³ æ›´æ–°æ–‡æ¡£ç½‘ç«™

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤æ–°æ¨¡æ¿ï¼éµå¾ªç›®å½•ç»“æ„å³å¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«ã€‚

## ğŸ“ æ€»ç»“

è¿™æ¬¡é‡æ„å®ç°äº†çœŸæ­£çš„è‡ªåŠ¨åŒ–æ¨¡æ¿ç®¡ç†ç³»ç»Ÿï¼Œå¤§å¹…ç®€åŒ–äº†æ¨¡æ¿çš„åˆ›å»ºå’Œä½¿ç”¨æµç¨‹ã€‚é€šè¿‡ `import.meta.glob` çš„å¼ºå¤§åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨ä¿æŒçµæ´»æ€§çš„åŒæ—¶ï¼Œæä¾›äº†å‡ºè‰²çš„å¼€å‘ä½“éªŒã€‚

**æ ¸å¿ƒä»·å€¼**ï¼š
- é›¶é…ç½®
- è‡ªåŠ¨åŒ–
- ç±»å‹å®‰å…¨
- æ€§èƒ½ä¼˜åŒ–
- æ˜“äºä½¿ç”¨
- ç”Ÿäº§å°±ç»ª

---

**é‡æ„å®Œæˆæ—¶é—´**: 2025-10-15
**ç‰ˆæœ¬**: 0.2.0
**çŠ¶æ€**: âœ… å®Œæˆ
