<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>功能测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
        }
        button:hover {
            background-color: #0056b3;
        }
        #device-info {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>@ldesign/template Vue3 示例功能测试</h1>
    
    <div class="test-section">
        <h2>设备检测测试</h2>
        <div id="device-info"></div>
        <button onclick="testDeviceDetection()">测试设备检测</button>
        <button onclick="simulateResize()">模拟窗口调整</button>
        <div id="device-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>响应式测试</h2>
        <button onclick="testResponsive('mobile')">切换到移动端</button>
        <button onclick="testResponsive('tablet')">切换到平板端</button>
        <button onclick="testResponsive('desktop')">切换到桌面端</button>
        <div id="responsive-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>模板加载测试</h2>
        <button onclick="testTemplateLoading()">测试模板加载</button>
        <div id="template-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>性能测试</h2>
        <button onclick="testPerformance()">测试性能监控</button>
        <div id="performance-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>错误处理测试</h2>
        <button onclick="testErrorHandling()">测试错误处理</button>
        <div id="error-test-result"></div>
    </div>

    <script>
        // 设备检测测试
        function testDeviceDetection() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            const deviceType = getDeviceType(width);
            
            document.getElementById('device-info').innerHTML = `
                <strong>当前设备信息:</strong><br>
                屏幕宽度: ${width}px<br>
                屏幕高度: ${height}px<br>
                设备类型: ${deviceType}<br>
                方向: ${width > height ? 'landscape' : 'portrait'}
            `;
            
            showResult('device-test-result', '设备检测功能正常', 'success');
        }
        
        function getDeviceType(width) {
            if (width <= 768) return 'mobile';
            if (width <= 1024) return 'tablet';
            return 'desktop';
        }
        
        // 模拟窗口调整
        function simulateResize() {
            const originalWidth = window.innerWidth;
            
            // 模拟不同的窗口大小
            const sizes = [
                { width: 375, name: 'iPhone' },
                { width: 768, name: 'iPad' },
                { width: 1200, name: 'Desktop' }
            ];
            
            let currentIndex = 0;
            const interval = setInterval(() => {
                if (currentIndex >= sizes.length) {
                    clearInterval(interval);
                    showResult('device-test-result', '窗口调整测试完成', 'success');
                    return;
                }
                
                const size = sizes[currentIndex];
                showResult('device-test-result', `模拟 ${size.name} 设备 (${size.width}px)`, 'info');
                currentIndex++;
            }, 1000);
        }
        
        // 响应式测试
        function testResponsive(deviceType) {
            const message = `切换到 ${deviceType} 设备类型`;
            showResult('responsive-test-result', message, 'success');
            
            // 模拟设备切换的视觉效果
            document.body.style.transition = 'all 0.3s ease';
            
            switch(deviceType) {
                case 'mobile':
                    document.body.style.maxWidth = '375px';
                    break;
                case 'tablet':
                    document.body.style.maxWidth = '768px';
                    break;
                case 'desktop':
                    document.body.style.maxWidth = '100%';
                    break;
            }
            
            setTimeout(() => {
                document.body.style.maxWidth = '100%';
            }, 2000);
        }
        
        // 模板加载测试
        function testTemplateLoading() {
            showResult('template-test-result', '开始加载模板...', 'info');
            
            // 模拟异步加载
            setTimeout(() => {
                const templates = ['login', 'dashboard'];
                const devices = ['desktop', 'mobile', 'tablet'];
                
                let loadedCount = 0;
                const totalTemplates = templates.length * devices.length;
                
                templates.forEach(template => {
                    devices.forEach(device => {
                        setTimeout(() => {
                            loadedCount++;
                            const progress = Math.round((loadedCount / totalTemplates) * 100);
                            showResult('template-test-result', 
                                `加载模板: ${template}/${device} (${progress}%)`, 
                                loadedCount === totalTemplates ? 'success' : 'info'
                            );
                        }, Math.random() * 1000);
                    });
                });
            }, 500);
        }
        
        // 性能测试
        function testPerformance() {
            const startTime = performance.now();
            
            // 模拟一些计算密集型操作
            let result = 0;
            for (let i = 0; i < 1000000; i++) {
                result += Math.random();
            }
            
            const endTime = performance.now();
            const duration = Math.round(endTime - startTime);
            
            const memoryInfo = performance.memory ? {
                used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),
                total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024),
                limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024)
            } : null;
            
            let message = `性能测试完成: 耗时 ${duration}ms`;
            if (memoryInfo) {
                message += `<br>内存使用: ${memoryInfo.used}MB / ${memoryInfo.total}MB (限制: ${memoryInfo.limit}MB)`;
            }
            
            showResult('performance-test-result', message, 'success');
        }
        
        // 错误处理测试
        function testErrorHandling() {
            showResult('error-test-result', '测试错误处理机制...', 'info');
            
            try {
                // 模拟一个错误
                throw new Error('这是一个测试错误');
            } catch (error) {
                showResult('error-test-result', 
                    `错误处理正常: ${error.message}`, 
                    'success'
                );
            }
            
            // 测试异步错误处理
            setTimeout(() => {
                try {
                    // 模拟异步错误
                    throw new Error('异步错误测试');
                } catch (error) {
                    showResult('error-test-result', 
                        `异步错误处理正常: ${error.message}`, 
                        'success'
                    );
                }
            }, 1000);
        }
        
        // 显示测试结果
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="test-result ${type}">${message}</div>`;
        }
        
        // 页面加载时自动运行设备检测
        window.addEventListener('load', testDeviceDetection);
        window.addEventListener('resize', testDeviceDetection);
    </script>
</body>
</html>
