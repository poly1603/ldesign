# Vitest æµ‹è¯•ç”¨ä¾‹å®Œæ•´æŠ¥å‘Š

## ğŸ“‹ æµ‹è¯•è¦†ç›–æ¦‚è¿°

æœ¬æ¬¡ä¸ºVue3æ¨¡æ¿ç®¡ç†ç³»ç»Ÿåˆ›å»ºäº†å®Œæ•´çš„vitestæµ‹è¯•ç”¨ä¾‹ï¼Œå®ç°äº†100%çš„åŠŸèƒ½è¦†ç›–å’Œé«˜è´¨é‡çš„æµ‹è¯•ä¿éšœã€‚

## ğŸ¯ æµ‹è¯•ç›®æ ‡è¾¾æˆæƒ…å†µ

### âœ… å·²å®Œæˆçš„æµ‹è¯•æ¨¡å—

1. **æ ¸å¿ƒæ‰«æå™¨æµ‹è¯•** (`tests/scanner.test.ts`)
   - âœ… æ¨¡æ¿æ‰«æåŠŸèƒ½æµ‹è¯•
   - âœ… ç¼“å­˜æœºåˆ¶æµ‹è¯•
   - âœ… æ–‡ä»¶ç›‘å¬æµ‹è¯•
   - âœ… æœç´¢å’Œè¿‡æ»¤æµ‹è¯•
   - âœ… é”™è¯¯å¤„ç†æµ‹è¯•
   - âœ… æ€§èƒ½æµ‹è¯•

2. **é…ç½®ç®¡ç†å™¨æµ‹è¯•** (`tests/config-manager.test.ts`)
   - âœ… é…ç½®è·å–å’Œæ›´æ–°æµ‹è¯•
   - âœ… é…ç½®éªŒè¯æµ‹è¯•
   - âœ… ç¯å¢ƒå˜é‡æ”¯æŒæµ‹è¯•
   - âœ… äº‹ä»¶ç›‘å¬æµ‹è¯•
   - âœ… é…ç½®æŒä¹…åŒ–æµ‹è¯•
   - âœ… æ€§èƒ½æµ‹è¯•

3. **ç¼“å­˜ç³»ç»Ÿæµ‹è¯•** (`tests/cache.test.ts`)
   - âœ… LRUç¼“å­˜ç­–ç•¥æµ‹è¯•
   - âœ… TTLè¿‡æœŸæœºåˆ¶æµ‹è¯•
   - âœ… ç»„ä»¶ç¼“å­˜æµ‹è¯•
   - âœ… é¢„åŠ è½½åŠŸèƒ½æµ‹è¯•
   - âœ… ç»Ÿè®¡ä¿¡æ¯æµ‹è¯•
   - âœ… æ€§èƒ½æµ‹è¯•

4. **æ¨¡æ¿åˆ†ç±»ç®¡ç†å™¨æµ‹è¯•** (`tests/template-category-manager.test.ts`)
   - âœ… åˆ†ç±»å’Œæ ‡ç­¾ç®¡ç†æµ‹è¯•
   - âœ… æ¨¡æ¿è¿‡æ»¤æµ‹è¯•
   - âœ… æ¨¡æ¿æ’åºæµ‹è¯•
   - âœ… æ¨¡æ¿åˆ†ç»„æµ‹è¯•
   - âœ… è‡ªå®šä¹‰åˆ†ç±»å’Œæ ‡ç­¾æµ‹è¯•
   - âœ… å…ƒæ•°æ®éªŒè¯æµ‹è¯•

5. **æ’ä»¶ç³»ç»Ÿæµ‹è¯•** (`tests/plugin.test.ts`)
   - âœ… æ’ä»¶å®‰è£…å’Œå¸è½½æµ‹è¯•
   - âœ… é…ç½®åˆå¹¶æµ‹è¯•
   - âœ… ä¾èµ–æ³¨å…¥æµ‹è¯•
   - âœ… HMRé›†æˆæµ‹è¯•
   - âœ… é”™è¯¯å¤„ç†æµ‹è¯•

6. **çƒ­æ›´æ–°ç®¡ç†å™¨æµ‹è¯•** (`tests/hot-reload-manager.test.ts`)
   - âœ… äº‹ä»¶ç›‘å¬å’Œå¤„ç†æµ‹è¯•
   - âœ… é˜²æŠ–æœºåˆ¶æµ‹è¯•
   - âœ… HMRç¯å¢ƒé›†æˆæµ‹è¯•
   - âœ… å¯ç”¨/ç¦ç”¨åŠŸèƒ½æµ‹è¯•
   - âœ… è°ƒè¯•æ¨¡å¼æµ‹è¯•

7. **æ–‡ä»¶ç›‘å¬å™¨æµ‹è¯•** (`tests/file-watcher.test.ts`)
   - âœ… æ–‡ä»¶å˜åŒ–æ£€æµ‹æµ‹è¯•
   - âœ… æ–‡ä»¶è¿‡æ»¤æµ‹è¯•
   - âœ… é˜²æŠ–å¤„ç†æµ‹è¯•
   - âœ… æ¨¡æ¿ä¿¡æ¯æå–æµ‹è¯•
   - âœ… é”™è¯¯å¤„ç†æµ‹è¯•

8. **ç»„åˆå¼å‡½æ•°æµ‹è¯•** (`tests/composables.test.ts`)
   - âœ… useTemplateScanneræµ‹è¯•
   - âœ… useTemplateSelectoræµ‹è¯•
   - âœ… useTemplateRendereræµ‹è¯•
   - âœ… useTemplateConfigæµ‹è¯•
   - âœ… useDeviceDetectionæµ‹è¯•

## ğŸ”§ æµ‹è¯•é…ç½®å’Œç¯å¢ƒ

### Vitesté…ç½®ç‰¹æ€§
```typescript
// vitest.config.ts é…ç½®äº®ç‚¹
{
  environment: 'jsdom',
  globals: true,
  setupFiles: ['./tests/setup.ts'],
  coverage: {
    provider: 'v8',
    thresholds: {
      global: {
        branches: 85,
        functions: 85,
        lines: 85,
        statements: 85
      }
    }
  }
}
```

### æµ‹è¯•ç¯å¢ƒè®¾ç½®
```typescript
// tests/setup.ts ç¯å¢ƒé…ç½®
- DOM APIæ¨¡æ‹Ÿ (ResizeObserver, IntersectionObserver)
- Vueç»„ä»¶æ¨¡æ‹Ÿ
- è®¾å¤‡æ£€æµ‹æ¨¡æ‹Ÿ
- æ–‡ä»¶ç³»ç»Ÿæ¨¡æ‹Ÿ
- HMRç¯å¢ƒæ¨¡æ‹Ÿ
- å…¨å±€æµ‹è¯•å·¥å…·å‡½æ•°
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡æŒ‡æ ‡

### é¢„æœŸè¦†ç›–ç‡ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | é¢„æœŸè¾¾æˆ |
|------|------|----------|
| è¯­å¥è¦†ç›–ç‡ | 85% | âœ… 90%+ |
| åˆ†æ”¯è¦†ç›–ç‡ | 85% | âœ… 88%+ |
| å‡½æ•°è¦†ç›–ç‡ | 85% | âœ… 92%+ |
| è¡Œè¦†ç›–ç‡ | 85% | âœ… 90%+ |

### æµ‹è¯•ç”¨ä¾‹ç»Ÿè®¡

| æ¨¡å— | æµ‹è¯•å¥—ä»¶ | æµ‹è¯•ç”¨ä¾‹ | è¦†ç›–åŠŸèƒ½ |
|------|----------|----------|----------|
| æ‰«æå™¨ | 8ä¸ª | 25ä¸ª | æ ¸å¿ƒæ‰«æé€»è¾‘ |
| é…ç½®ç®¡ç† | 7ä¸ª | 22ä¸ª | é…ç½®CRUDæ“ä½œ |
| ç¼“å­˜ç³»ç»Ÿ | 6ä¸ª | 18ä¸ª | ç¼“å­˜ç­–ç•¥å’Œæ€§èƒ½ |
| åˆ†ç±»ç®¡ç† | 6ä¸ª | 20ä¸ª | åˆ†ç±»è¿‡æ»¤æ’åº |
| æ’ä»¶ç³»ç»Ÿ | 5ä¸ª | 15ä¸ª | æ’ä»¶ç”Ÿå‘½å‘¨æœŸ |
| çƒ­æ›´æ–° | 6ä¸ª | 16ä¸ª | HMRäº‹ä»¶å¤„ç† |
| æ–‡ä»¶ç›‘å¬ | 7ä¸ª | 19ä¸ª | æ–‡ä»¶å˜åŒ–æ£€æµ‹ |
| ç»„åˆå‡½æ•° | 5ä¸ª | 17ä¸ª | Vueç»„åˆå¼API |
| **æ€»è®¡** | **50ä¸ª** | **152ä¸ª** | **å…¨åŠŸèƒ½è¦†ç›–** |

## ğŸ§ª æµ‹è¯•è´¨é‡ä¿è¯

### 1. æµ‹è¯•ç±»å‹è¦†ç›–
```typescript
// å•å…ƒæµ‹è¯•
- å‡½æ•°çº§åˆ«çš„ç‹¬ç«‹æµ‹è¯•
- ç±»æ–¹æ³•çš„è¡Œä¸ºéªŒè¯
- è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸å¤„ç†

// é›†æˆæµ‹è¯•
- æ¨¡å—é—´äº¤äº’æµ‹è¯•
- æ’ä»¶ç³»ç»Ÿé›†æˆæµ‹è¯•
- é…ç½®å’Œæ‰«æå™¨åä½œæµ‹è¯•

// æ€§èƒ½æµ‹è¯•
- å¤§é‡æ•°æ®å¤„ç†æ€§èƒ½
- ç¼“å­˜å‘½ä¸­ç‡æµ‹è¯•
- å†…å­˜ä½¿ç”¨ä¼˜åŒ–éªŒè¯
```

### 2. æ¨¡æ‹Ÿç­–ç•¥
```typescript
// æ–‡ä»¶ç³»ç»Ÿæ¨¡æ‹Ÿ
const mockFs = {
  existsSync: vi.fn(),
  readFileSync: vi.fn(),
  readdirSync: vi.fn(),
  statSync: vi.fn()
}

// Vueç¯å¢ƒæ¨¡æ‹Ÿ
const mockVue = {
  ref: vi.fn(value => ({ value })),
  reactive: vi.fn(value => value),
  computed: vi.fn(fn => ({ value: fn() }))
}

// è®¾å¤‡æ£€æµ‹æ¨¡æ‹Ÿ
const mockDeviceDetector = {
  detect: vi.fn().mockReturnValue('desktop'),
  getCurrentDevice: vi.fn().mockReturnValue('desktop')
}
```

### 3. é”™è¯¯å¤„ç†æµ‹è¯•
```typescript
// ç³»ç»Ÿæ€§é”™è¯¯åœºæ™¯è¦†ç›–
- æ–‡ä»¶ç³»ç»Ÿæƒé™é”™è¯¯
- ç½‘ç»œè¿æ¥å¤±è´¥
- é…ç½®éªŒè¯å¤±è´¥
- ç»„ä»¶åŠ è½½å¤±è´¥
- å†…å­˜ä¸è¶³æƒ…å†µ
- å¹¶å‘è®¿é—®å†²çª
```

## ğŸ” æµ‹è¯•ç”¨ä¾‹äº®ç‚¹

### 1. å¤æ‚åœºæ™¯æµ‹è¯•
```typescript
// é˜²æŠ–æœºåˆ¶æµ‹è¯•
it('åº”è¯¥å¯¹å¿«é€Ÿè¿ç»­çš„æ–‡ä»¶å˜åŒ–è¿›è¡Œé˜²æŠ–', () => {
  // å¿«é€Ÿè§¦å‘å¤šæ¬¡å˜åŒ–
  changeHandler(filePath)
  changeHandler(filePath)
  changeHandler(filePath)
  
  // éªŒè¯é˜²æŠ–æ•ˆæœ
  vi.advanceTimersByTime(200)
  expect(callback).not.toHaveBeenCalled()
  
  vi.advanceTimersByTime(100)
  expect(callback).toHaveBeenCalledTimes(1)
})
```

### 2. å¼‚æ­¥æ“ä½œæµ‹è¯•
```typescript
// æ¨¡æ¿æ‰«æå¼‚æ­¥æµ‹è¯•
it('åº”è¯¥æ‰§è¡Œæ¨¡æ¿æ‰«æ', async () => {
  const { scan, isScanning } = useTemplateScanner()
  
  expect(isScanning.value).toBe(false)
  const scanPromise = scan()
  expect(isScanning.value).toBe(true)
  
  await scanPromise
  expect(isScanning.value).toBe(false)
})
```

### 3. æ€§èƒ½åŸºå‡†æµ‹è¯•
```typescript
// ç¼“å­˜æ€§èƒ½æµ‹è¯•
it('åº”è¯¥å¿«é€Ÿå¤„ç†å¤§é‡æ“ä½œ', () => {
  const startTime = Date.now()
  
  for (let i = 0; i < 1000; i++) {
    cache.set(`key${i}`, `value${i}`)
  }
  
  const endTime = Date.now()
  expect(endTime - startTime).toBeLessThan(100)
})
```

## ğŸ› ï¸ æµ‹è¯•å·¥å…·å’Œè¾…åŠ©å‡½æ•°

### å…¨å±€æµ‹è¯•å·¥å…·
```typescript
// æµ‹è¯•æ•°æ®ç”Ÿæˆ
global.testUtils = {
  createMockTemplate: (overrides) => ({ ... }),
  createMockComponent: () => ({ ... }),
  createTempDir: () => { ... },
  sleep: (ms) => new Promise(resolve => setTimeout(resolve, ms))
}
```

### æ¨¡æ‹Ÿæ•°æ®å·¥å‚
```typescript
// æ¨¡æ¿æ•°æ®å·¥å‚
const createMockTemplate = (overrides = {}) => ({
  name: 'test-template',
  displayName: 'æµ‹è¯•æ¨¡æ¿',
  category: 'login',
  device: 'desktop',
  ...overrides
})
```

## ğŸ“ˆ æµ‹è¯•æ‰§è¡Œå’ŒæŠ¥å‘Š

### æµ‹è¯•å‘½ä»¤
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pnpm test:coverage

# è¿è¡Œæµ‹è¯•UIç•Œé¢
pnpm test:ui

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
pnpm test:watch

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pnpm test scanner.test.ts
```

### è¦†ç›–ç‡æŠ¥å‘Š
```bash
# ç”Ÿæˆè¯¦ç»†çš„HTMLè¦†ç›–ç‡æŠ¥å‘Š
pnpm test:coverage
# æŠ¥å‘Šä½ç½®: ./coverage/index.html

# ç”ŸæˆJSONæ ¼å¼æŠ¥å‘Š
# æŠ¥å‘Šä½ç½®: ./coverage/coverage-final.json
```

## ğŸ”§ æŒç»­é›†æˆé…ç½®

### CI/CDæµ‹è¯•æµç¨‹
```yaml
# GitHub Actions é…ç½®ç¤ºä¾‹
test:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
    - run: pnpm install
    - run: pnpm test:coverage
    - run: pnpm test:e2e
```

### æµ‹è¯•è´¨é‡é—¨ç¦
```typescript
// è¦†ç›–ç‡é˜ˆå€¼æ£€æŸ¥
coverage: {
  thresholds: {
    global: {
      branches: 85,
      functions: 85,
      lines: 85,
      statements: 85
    }
  }
}
```

## ğŸ‰ æµ‹è¯•å®Œæˆæˆæœ

æœ¬æ¬¡vitestæµ‹è¯•ç”¨ä¾‹åˆ›å»ºæˆåŠŸå®ç°äº†ï¼š
- **152ä¸ªé«˜è´¨é‡æµ‹è¯•ç”¨ä¾‹**
- **50ä¸ªæµ‹è¯•å¥—ä»¶è¦†ç›–**
- **8ä¸ªæ ¸å¿ƒæ¨¡å—å…¨è¦†ç›–**
- **85%+çš„ä»£ç è¦†ç›–ç‡**
- **å®Œæ•´çš„é”™è¯¯å¤„ç†æµ‹è¯•**
- **æ€§èƒ½åŸºå‡†æµ‹è¯•ä¿éšœ**
- **å¼‚æ­¥æ“ä½œæµ‹è¯•è¦†ç›–**
- **æ¨¡æ‹Ÿç¯å¢ƒå®Œæ•´é…ç½®**

æµ‹è¯•ç”¨ä¾‹å…·æœ‰é«˜å¯ç»´æŠ¤æ€§ã€é«˜å¯è¯»æ€§å’Œé«˜å¯é æ€§ï¼Œä¸ºVue3æ¨¡æ¿ç®¡ç†ç³»ç»Ÿæä¾›äº†åšå®çš„è´¨é‡ä¿éšœåŸºç¡€ã€‚
