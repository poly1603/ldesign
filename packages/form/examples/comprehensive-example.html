<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è‡ªé€‚åº”è¡¨å•å¸ƒå±€ç³»ç»Ÿ - ç»¼åˆç¤ºä¾‹</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background-color: #f5f5f5;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      .header {
        background: white;
        padding: 24px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 24px;
      }

      .header h1 {
        font-size: 28px;
        color: #333;
        margin-bottom: 8px;
      }

      .header p {
        color: #666;
        font-size: 16px;
        line-height: 1.5;
      }

      .demo-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        margin-bottom: 24px;
      }

      @media (max-width: 1200px) {
        .demo-grid {
          grid-template-columns: 1fr;
        }
      }

      .demo-section {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .demo-header {
        padding: 20px 24px;
        border-bottom: 1px solid #f0f0f0;
        background: #fafafa;
      }

      .demo-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
      }

      .demo-description {
        color: #666;
        font-size: 14px;
        line-height: 1.5;
      }

      .demo-content {
        padding: 24px;
      }

      .controls {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 8px 16px;
        border: 1px solid #d9d9d9;
        border-radius: 4px;
        background: white;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-block;
      }

      .btn:hover {
        border-color: #1890ff;
        color: #1890ff;
      }

      .btn.primary {
        background: #1890ff;
        border-color: #1890ff;
        color: white;
      }

      .btn.primary:hover {
        background: #40a9ff;
        border-color: #40a9ff;
      }

      .btn.success {
        background: #52c41a;
        border-color: #52c41a;
        color: white;
      }

      .btn.success:hover {
        background: #73d13d;
        border-color: #73d13d;
      }

      .form-container {
        border: 1px solid #e8e8e8;
        border-radius: 6px;
        padding: 20px;
        background: #fafafa;
        min-height: 300px;
        position: relative;
      }

      .status {
        margin-top: 16px;
        padding: 12px;
        border-radius: 4px;
        font-size: 14px;
      }

      .status.info {
        background: #e6f7ff;
        border: 1px solid #91d5ff;
        color: #1890ff;
      }

      .status.success {
        background: #f6ffed;
        border: 1px solid #b7eb8f;
        color: #52c41a;
      }

      .status.warning {
        background: #fffbe6;
        border: 1px solid #ffe58f;
        color: #faad14;
      }

      .status.error {
        background: #fff2f0;
        border: 1px solid #ffccc7;
        color: #ff4d4f;
      }

      .metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin-top: 16px;
      }

      .metric {
        text-align: center;
        padding: 16px;
        background: #f8f9fa;
        border-radius: 6px;
      }

      .metric-value {
        font-size: 24px;
        font-weight: 600;
        color: #1890ff;
        margin-bottom: 4px;
      }

      .metric-label {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
      }

      .full-width {
        grid-column: 1 / -1;
      }

      .feature-list {
        list-style: none;
        margin-top: 16px;
      }

      .feature-list li {
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        align-items: center;
      }

      .feature-list li:last-child {
        border-bottom: none;
      }

      .feature-list li::before {
        content: 'âœ…';
        margin-right: 12px;
        font-size: 16px;
      }

      .code-block {
        background: #f6f8fa;
        border: 1px solid #e1e4e8;
        border-radius: 6px;
        padding: 16px;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        overflow-x: auto;
        margin-top: 16px;
      }

      .loading {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #1890ff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 8px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* è¡¨å•æ ·å¼ */
      .form-item {
        margin-bottom: 16px;
        display: flex;
        flex-direction: column;
      }

      .form-item label {
        font-size: 14px;
        color: #333;
        font-weight: 500;
        margin-bottom: 4px;
      }

      .form-item input,
      .form-item textarea,
      .form-item select {
        padding: 8px 12px;
        border: 1px solid #d9d9d9;
        border-radius: 4px;
        font-size: 14px;
        transition: border-color 0.2s;
      }

      .form-item input:focus,
      .form-item textarea:focus,
      .form-item select:focus {
        outline: none;
        border-color: #1890ff;
        box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
      }

      .form-group-header {
        display: flex;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #f0f0f0;
        margin-bottom: 16px;
        cursor: pointer;
        user-select: none;
      }

      .form-group-header:hover {
        background-color: #f8f9fa;
      }

      .expand-button {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 8px 16px;
        margin: 16px 0;
        border: 1px solid #d9d9d9;
        border-radius: 4px;
        background: #fafafa;
        cursor: pointer;
        transition: all 0.3s ease;
        user-select: none;
      }

      .expand-button:hover {
        border-color: #1890ff;
        background: #f0f8ff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- å¤´éƒ¨ä»‹ç» -->
      <div class="header">
        <h1>ğŸš€ è‡ªé€‚åº”è¡¨å•å¸ƒå±€ç³»ç»Ÿ</h1>
        <p>
          ä¸€ä¸ªæ™ºèƒ½çš„è¡¨å•å¸ƒå±€è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒè‡ªé€‚åº”å¸ƒå±€ã€å±•å¼€æ”¶èµ·ã€å¼¹çª—æ¨¡å¼ã€è¡¨å•åˆ†ç»„ã€å®æ—¶éªŒè¯ç­‰åŠŸèƒ½ã€‚
          æœ¬ç¤ºä¾‹å±•ç¤ºäº†ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚
        </p>
      </div>

      <!-- åŠŸèƒ½æ¼”ç¤ºç½‘æ ¼ -->
      <div class="demo-grid">
        <!-- åŸºç¡€å¸ƒå±€æ¼”ç¤º -->
        <div class="demo-section">
          <div class="demo-header">
            <div class="demo-title">ğŸ“ è‡ªé€‚åº”å¸ƒå±€</div>
            <div class="demo-description">æ ¹æ®å®¹å™¨å®½åº¦è‡ªåŠ¨è®¡ç®—æœ€ä½³åˆ—æ•°å’Œå¸ƒå±€</div>
          </div>
          <div class="demo-content">
            <div class="controls">
              <button class="btn primary" onclick="initBasicForm()">åˆå§‹åŒ–è¡¨å•</button>
              <button class="btn" onclick="resizeContainer('basic', 400)">çª„å®¹å™¨</button>
              <button class="btn" onclick="resizeContainer('basic', 800)">å®½å®¹å™¨</button>
              <button class="btn" onclick="addFormItems('basic')">æ·»åŠ å­—æ®µ</button>
            </div>
            <div class="form-container" id="basic-form">
              <p>ç‚¹å‡»"åˆå§‹åŒ–è¡¨å•"å¼€å§‹æ¼”ç¤º</p>
            </div>
            <div class="status info" id="basic-status">ç­‰å¾…åˆå§‹åŒ–...</div>
          </div>
        </div>

        <!-- å±•å¼€æ”¶èµ·æ¼”ç¤º -->
        <div class="demo-section">
          <div class="demo-header">
            <div class="demo-title">ğŸ“‚ å±•å¼€æ”¶èµ·åŠŸèƒ½</div>
            <div class="demo-description">æ”¯æŒå†…è”å±•å¼€å’Œå¼¹çª—æ¨¡å¼ä¸¤ç§æ–¹å¼</div>
          </div>
          <div class="demo-content">
            <div class="controls">
              <button class="btn primary" onclick="initExpandForm()">åˆå§‹åŒ–è¡¨å•</button>
              <button class="btn" onclick="toggleExpand('expand')">åˆ‡æ¢å±•å¼€</button>
              <button class="btn" onclick="switchToModal('expand')">åˆ‡æ¢å¼¹çª—æ¨¡å¼</button>
              <button class="btn" onclick="openModal('expand')">æ‰“å¼€å¼¹çª—</button>
            </div>
            <div class="form-container" id="expand-form">
              <p>ç‚¹å‡»"åˆå§‹åŒ–è¡¨å•"å¼€å§‹æ¼”ç¤º</p>
            </div>
            <div class="status info" id="expand-status">ç­‰å¾…åˆå§‹åŒ–...</div>
          </div>
        </div>

        <!-- è¡¨å•éªŒè¯æ¼”ç¤º -->
        <div class="demo-section">
          <div class="demo-header">
            <div class="demo-title">âœ… å®æ—¶éªŒè¯</div>
            <div class="demo-description">æ”¯æŒå¤šç§éªŒè¯è§„åˆ™å’Œå®æ—¶é”™è¯¯æç¤º</div>
          </div>
          <div class="demo-content">
            <div class="controls">
              <button class="btn primary" onclick="initValidationForm()">åˆå§‹åŒ–è¡¨å•</button>
              <button class="btn" onclick="validateForm('validation')">éªŒè¯è¡¨å•</button>
              <button class="btn" onclick="fillValidData('validation')">å¡«å…¥æœ‰æ•ˆæ•°æ®</button>
              <button class="btn" onclick="clearForm('validation')">æ¸…ç©ºè¡¨å•</button>
            </div>
            <div class="form-container" id="validation-form">
              <p>ç‚¹å‡»"åˆå§‹åŒ–è¡¨å•"å¼€å§‹æ¼”ç¤º</p>
            </div>
            <div class="status info" id="validation-status">ç­‰å¾…åˆå§‹åŒ–...</div>
          </div>
        </div>

        <!-- è¡¨å•åˆ†ç»„æ¼”ç¤º -->
        <div class="demo-section">
          <div class="demo-header">
            <div class="demo-title">ğŸ“‹ è¡¨å•åˆ†ç»„</div>
            <div class="demo-description">æ”¯æŒè¡¨å•é¡¹åˆ†ç»„æ˜¾ç¤ºå’Œç‹¬ç«‹å±•å¼€æ”¶èµ·</div>
          </div>
          <div class="demo-content">
            <div class="controls">
              <button class="btn primary" onclick="initGroupForm()">åˆå§‹åŒ–è¡¨å•</button>
              <button class="btn" onclick="toggleGroup('group', 'basic')">åˆ‡æ¢åŸºæœ¬ä¿¡æ¯</button>
              <button class="btn" onclick="toggleGroup('group', 'contact')">åˆ‡æ¢è”ç³»æ–¹å¼</button>
              <button class="btn" onclick="toggleGroup('group', 'advanced')">åˆ‡æ¢é«˜çº§è®¾ç½®</button>
            </div>
            <div class="form-container" id="group-form">
              <p>ç‚¹å‡»"åˆå§‹åŒ–è¡¨å•"å¼€å§‹æ¼”ç¤º</p>
            </div>
            <div class="status info" id="group-status">ç­‰å¾…åˆå§‹åŒ–...</div>
          </div>
        </div>
      </div>

      <!-- æ€§èƒ½æŒ‡æ ‡ -->
      <div class="demo-section full-width">
        <div class="demo-header">
          <div class="demo-title">ğŸ“Š æ€§èƒ½æŒ‡æ ‡</div>
          <div class="demo-description">å®æ—¶ç›‘æ§è¡¨å•ç³»ç»Ÿçš„æ€§èƒ½è¡¨ç°</div>
        </div>
        <div class="demo-content">
          <div class="metrics" id="performance-metrics">
            <div class="metric">
              <div class="metric-value" id="render-count">0</div>
              <div class="metric-label">æ¸²æŸ“æ¬¡æ•°</div>
            </div>
            <div class="metric">
              <div class="metric-value" id="avg-render-time">0ms</div>
              <div class="metric-label">å¹³å‡æ¸²æŸ“æ—¶é—´</div>
            </div>
            <div class="metric">
              <div class="metric-value" id="form-count">0</div>
              <div class="metric-label">è¡¨å•å®ä¾‹æ•°</div>
            </div>
            <div class="metric">
              <div class="metric-value" id="memory-usage">0MB</div>
              <div class="metric-label">å†…å­˜ä½¿ç”¨</div>
            </div>
          </div>
          <div class="controls">
            <button class="btn" onclick="updateMetrics()">æ›´æ–°æŒ‡æ ‡</button>
            <button class="btn" onclick="clearMetrics()">æ¸…ç©ºæŒ‡æ ‡</button>
            <button class="btn success" onclick="runPerformanceTest()">æ€§èƒ½æµ‹è¯•</button>
          </div>
        </div>
      </div>

      <!-- åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨ -->
      <div class="demo-section full-width">
        <div class="demo-header">
          <div class="demo-title">ğŸ¯ åŠŸèƒ½ç‰¹æ€§</div>
          <div class="demo-description">è‡ªé€‚åº”è¡¨å•å¸ƒå±€ç³»ç»Ÿçš„å®Œæ•´åŠŸèƒ½åˆ—è¡¨</div>
        </div>
        <div class="demo-content">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px">
            <div>
              <h4>ğŸ—ï¸ æ ¸å¿ƒåŠŸèƒ½</h4>
              <ul class="feature-list">
                <li>è‡ªé€‚åº”å¸ƒå±€è®¡ç®—</li>
                <li>å“åº”å¼æ–­ç‚¹æ”¯æŒ</li>
                <li>è¡¨å•é¡¹è‡ªåŠ¨æ’åˆ—</li>
                <li>å®¹å™¨å°ºå¯¸ç›‘å¬</li>
                <li>æ€§èƒ½ä¼˜åŒ–æœºåˆ¶</li>
              </ul>
            </div>
            <div>
              <h4>ğŸ¨ äº¤äº’åŠŸèƒ½</h4>
              <ul class="feature-list">
                <li>å±•å¼€æ”¶èµ·æ§åˆ¶</li>
                <li>å¼¹çª—æ¨¡å¼æ”¯æŒ</li>
                <li>è¡¨å•åˆ†ç»„ç®¡ç†</li>
                <li>æ‹–æ‹½æ’åºæ”¯æŒ</li>
                <li>é”®ç›˜å¯¼èˆªæ”¯æŒ</li>
              </ul>
            </div>
            <div>
              <h4>âœ… éªŒè¯åŠŸèƒ½</h4>
              <ul class="feature-list">
                <li>å®æ—¶è¡¨å•éªŒè¯</li>
                <li>è‡ªå®šä¹‰éªŒè¯è§„åˆ™</li>
                <li>å¼‚æ­¥éªŒè¯æ”¯æŒ</li>
                <li>é”™è¯¯ä¿¡æ¯æ˜¾ç¤º</li>
                <li>éªŒè¯çŠ¶æ€ç®¡ç†</li>
              </ul>
            </div>
            <div>
              <h4>ğŸ”§ å¼€å‘æ”¯æŒ</h4>
              <ul class="feature-list">
                <li>TypeScriptæ”¯æŒ</li>
                <li>Vue3é›†æˆ</li>
                <li>åŸç”ŸJSé€‚é…å™¨</li>
                <li>æ’ä»¶ç³»ç»Ÿ</li>
                <li>å¼€å‘å·¥å…·æ”¯æŒ</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- ä½¿ç”¨ç¤ºä¾‹ -->
      <div class="demo-section full-width">
        <div class="demo-header">
          <div class="demo-title">ğŸ’» ä½¿ç”¨ç¤ºä¾‹</div>
          <div class="demo-description">å¿«é€Ÿå¼€å§‹ä½¿ç”¨è‡ªé€‚åº”è¡¨å•å¸ƒå±€ç³»ç»Ÿ</div>
        </div>
        <div class="demo-content">
          <h4>åŸç”ŸJavaScriptä½¿ç”¨</h4>
          <div class="code-block">
            // å¼•å…¥é€‚é…å™¨ import { AdaptiveForm } from '@ldesign/form' // åˆ›å»ºè¡¨å•å®ä¾‹ const form = new AdaptiveForm({
            selector: '#form-container', items: [ { key: 'name', label: 'å§“å', type: 'input', required: true }, { key:
            'email', label: 'é‚®ç®±', type: 'email', required: true }, { key: 'phone', label: 'ç”µè¯', type: 'tel' }, ],
            layout: { defaultRows: 2, maxColumns: 3, gap: { horizontal: 16, vertical: 16 } }, display: { labelPosition:
            'left', expandMode: 'modal' } }) // ç›‘å¬äº‹ä»¶ form.on('change', (data) => { console.log('è¡¨å•å€¼å˜åŒ–:', data)
            })
          </div>

          <h4>Vue3ç»„ä»¶ä½¿ç”¨</h4>
          <div class="code-block">
            &lt;template&gt; &lt;AdaptiveForm v-model="formData" :config="formConfig" @change="handleChange"
            @submit="handleSubmit" /&gt; &lt;/template&gt; &lt;script setup&gt; import { ref } from 'vue' import {
            AdaptiveForm } from '@ldesign/form/vue' const formData = ref({}) const formConfig = ref({ items: [ { key:
            'name', label: 'å§“å', type: 'input', required: true }, { key: 'email', label: 'é‚®ç®±', type: 'email',
            required: true } ], layout: { maxColumns: 2 }, display: { expandMode: 'inline' } }) const handleChange =
            (data) => { console.log('è¡¨å•å˜åŒ–:', data) } &lt;/script&gt;
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      // æ¨¡æ‹Ÿè¡¨å•ç®¡ç†å™¨
      class MockFormManager {
        constructor(config, container) {
          this.config = config
          this.container = container
          this.values = {}
          this.errors = {}
          this.expanded = false
          this.modalOpen = false
          this.eventListeners = new Map()

          this.render()
        }

        render() {
          if (!this.container) return

          this.container.innerHTML = ''

          // æ¸²æŸ“è¡¨å•é¡¹
          const visibleItems = this.getVisibleItems()
          visibleItems.forEach((item) => {
            const formItem = this.createFormItem(item)
            this.container.appendChild(formItem)
          })

          // æ¸²æŸ“å±•å¼€æŒ‰é’®
          if (this.needsExpandButton()) {
            const expandButton = this.createExpandButton()
            this.container.appendChild(expandButton)
          }

          this.emit('render', { itemCount: visibleItems.length })
        }

        createFormItem(item) {
          const div = document.createElement('div')
          div.className = 'form-item'
          div.innerHTML = `
                    <label>${item.label}${item.required ? ' *' : ''}</label>
                    <input
                        type="${item.type || 'text'}"
                        name="${item.key}"
                        value="${this.values[item.key] || ''}"
                        placeholder="${item.placeholder || ''}"
                        ${item.required ? 'required' : ''}
                    />
                    ${this.errors[item.key] ? `<div style="color: #ff4d4f; font-size: 12px; margin-top: 4px;">${this.errors[item.key]}</div>` : ''}
                `

          const input = div.querySelector('input')
          input.addEventListener('input', (e) => {
            this.setValue(item.key, e.target.value)
          })

          return div
        }

        createExpandButton() {
          const button = document.createElement('div')
          button.className = 'expand-button'
          button.innerHTML = `
                    <span>${this.expanded ? 'æ”¶èµ·' : 'å±•å¼€æ›´å¤š'}</span>
                    <span style="margin-left: 8px;">${this.expanded ? 'â–²' : 'â–¼'}</span>
                `

          button.addEventListener('click', () => {
            this.toggle()
          })

          return button
        }

        getVisibleItems() {
          const threshold = this.config.behavior?.expandThreshold || 3
          if (this.expanded) {
            return this.config.items
          }
          return this.config.items.slice(0, threshold)
        }

        needsExpandButton() {
          const threshold = this.config.behavior?.expandThreshold || 3
          return this.config.items.length > threshold
        }

        setValue(key, value) {
          this.values[key] = value
          this.emit('change', { key, value })
        }

        getValue(key) {
          return key ? this.values[key] : { ...this.values }
        }

        validate(key) {
          const errors = []
          const items = key ? [this.config.items.find((item) => item.key === key)] : this.config.items

          items.forEach((item) => {
            if (!item) return

            const value = this.values[item.key]
            if (item.required && (!value || value.trim() === '')) {
              errors.push(`${item.label}æ˜¯å¿…å¡«é¡¹`)
              this.errors[item.key] = `${item.label}æ˜¯å¿…å¡«é¡¹`
            } else {
              delete this.errors[item.key]
            }
          })

          this.render()
          this.emit('validation', { errors })
          return { valid: errors.length === 0, errors }
        }

        reset() {
          this.values = {}
          this.errors = {}
          this.render()
          this.emit('reset')
        }

        expand() {
          this.expanded = true
          this.render()
          this.emit('expand', { expanded: true })
        }

        collapse() {
          this.expanded = false
          this.render()
          this.emit('expand', { expanded: false })
        }

        toggle() {
          if (this.expanded) {
            this.collapse()
          } else {
            this.expand()
          }
        }

        async openModal() {
          this.modalOpen = true
          this.emit('modal', { open: true })
          // æ¨¡æ‹Ÿå¼¹çª—
          alert('å¼¹çª—æ¨¡å¼æ¼”ç¤º - è¿™é‡Œä¼šæ˜¾ç¤ºéšè—çš„è¡¨å•é¡¹')
        }

        async closeModal() {
          this.modalOpen = false
          this.emit('modal', { open: false })
        }

        on(event, handler) {
          if (!this.eventListeners.has(event)) {
            this.eventListeners.set(event, new Set())
          }
          this.eventListeners.get(event).add(handler)

          return () => {
            const handlers = this.eventListeners.get(event)
            if (handlers) {
              handlers.delete(handler)
            }
          }
        }

        emit(event, data) {
          const handlers = this.eventListeners.get(event)
          if (handlers) {
            handlers.forEach((handler) => handler(data))
          }
        }

        destroy() {
          this.eventListeners.clear()
          if (this.container) {
            this.container.innerHTML = ''
          }
        }
      }

      // å…¨å±€çŠ¶æ€
      const formInstances = new Map()
      const performanceMetrics = {
        renderCount: 0,
        totalRenderTime: 0,
        formCount: 0,
        startTime: Date.now(),
      }

      // å·¥å…·å‡½æ•°
      function updateStatus(id, message, type = 'info') {
        const statusEl = document.getElementById(`${id}-status`)
        if (statusEl) {
          statusEl.textContent = message
          statusEl.className = `status ${type}`
        }
      }

      function createFormConfig(type) {
        const configs = {
          basic: {
            items: [
              { key: 'name', label: 'å§“å', type: 'text', required: true },
              { key: 'email', label: 'é‚®ç®±', type: 'email', required: true },
              { key: 'phone', label: 'ç”µè¯', type: 'tel' },
              { key: 'company', label: 'å…¬å¸', type: 'text' },
            ],
            behavior: { expandThreshold: 2 },
          },
          expand: {
            items: [
              { key: 'name', label: 'å§“å', type: 'text', required: true },
              { key: 'email', label: 'é‚®ç®±', type: 'email', required: true },
              { key: 'phone', label: 'ç”µè¯', type: 'tel' },
              { key: 'company', label: 'å…¬å¸', type: 'text' },
              { key: 'position', label: 'èŒä½', type: 'text' },
              { key: 'address', label: 'åœ°å€', type: 'text' },
              { key: 'website', label: 'ç½‘ç«™', type: 'url' },
              { key: 'notes', label: 'å¤‡æ³¨', type: 'textarea' },
            ],
            behavior: { expandThreshold: 3 },
            display: { expandMode: 'inline' },
          },
          validation: {
            items: [
              { key: 'username', label: 'ç”¨æˆ·å', type: 'text', required: true, placeholder: 'è¯·è¾“å…¥ç”¨æˆ·å' },
              { key: 'password', label: 'å¯†ç ', type: 'password', required: true, placeholder: 'è¯·è¾“å…¥å¯†ç ' },
              { key: 'email', label: 'é‚®ç®±', type: 'email', required: true, placeholder: 'è¯·è¾“å…¥é‚®ç®±' },
              { key: 'age', label: 'å¹´é¾„', type: 'number', placeholder: 'è¯·è¾“å…¥å¹´é¾„' },
            ],
            behavior: { expandThreshold: 4 },
          },
          group: {
            items: [
              { key: 'name', label: 'å§“å', type: 'text', required: true, group: 'basic' },
              { key: 'age', label: 'å¹´é¾„', type: 'number', group: 'basic' },
              { key: 'gender', label: 'æ€§åˆ«', type: 'text', group: 'basic' },
              { key: 'email', label: 'é‚®ç®±', type: 'email', required: true, group: 'contact' },
              { key: 'phone', label: 'ç”µè¯', type: 'tel', group: 'contact' },
              { key: 'address', label: 'åœ°å€', type: 'text', group: 'contact' },
              { key: 'theme', label: 'ä¸»é¢˜', type: 'text', group: 'advanced' },
              { key: 'language', label: 'è¯­è¨€', type: 'text', group: 'advanced' },
              { key: 'timezone', label: 'æ—¶åŒº', type: 'text', group: 'advanced' },
            ],
            behavior: { expandThreshold: 6 },
          },
        }
        return configs[type] || configs.basic
      }

      // å…¨å±€å‡½æ•°
      window.initBasicForm = () => {
        const container = document.getElementById('basic-form')
        const config = createFormConfig('basic')

        if (formInstances.has('basic')) {
          formInstances.get('basic').destroy()
        }

        const form = new MockFormManager(config, container)
        formInstances.set('basic', form)

        form.on('render', (data) => {
          updateStatus('basic', `è¡¨å•å·²æ¸²æŸ“ï¼Œæ˜¾ç¤º ${data.itemCount} ä¸ªå­—æ®µ`, 'success')
          performanceMetrics.renderCount++
          performanceMetrics.formCount = formInstances.size
        })

        form.on('change', (data) => {
          updateStatus('basic', `å­—æ®µ ${data.key} å€¼å·²æ›´æ–°: ${data.value}`, 'info')
        })
      }

      window.resizeContainer = (formId, width) => {
        const container = document.getElementById(`${formId}-form`)
        if (container) {
          container.style.width = `${width}px`
          updateStatus(formId, `å®¹å™¨å®½åº¦å·²è°ƒæ•´ä¸º ${width}px`, 'info')
        }
      }

      window.addFormItems = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          const newItems = [
            { key: 'department', label: 'éƒ¨é—¨', type: 'text' },
            { key: 'salary', label: 'è–ªèµ„', type: 'number' },
          ]
          form.config.items.push(...newItems)
          form.render()
          updateStatus(formId, `å·²æ·»åŠ  ${newItems.length} ä¸ªæ–°å­—æ®µ`, 'success')
        }
      }

      window.initExpandForm = () => {
        const container = document.getElementById('expand-form')
        const config = createFormConfig('expand')

        if (formInstances.has('expand')) {
          formInstances.get('expand').destroy()
        }

        const form = new MockFormManager(config, container)
        formInstances.set('expand', form)

        form.on('expand', (data) => {
          updateStatus('expand', `è¡¨å•å·²${data.expanded ? 'å±•å¼€' : 'æ”¶èµ·'}`, 'success')
        })

        form.on('modal', (data) => {
          updateStatus('expand', `å¼¹çª—å·²${data.open ? 'æ‰“å¼€' : 'å…³é—­'}`, 'info')
        })

        updateStatus('expand', 'å±•å¼€æ”¶èµ·è¡¨å•å·²åˆå§‹åŒ–', 'success')
      }

      window.toggleExpand = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          form.toggle()
        }
      }

      window.switchToModal = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          form.config.display = { expandMode: 'modal' }
          updateStatus(formId, 'å·²åˆ‡æ¢åˆ°å¼¹çª—æ¨¡å¼', 'info')
        }
      }

      window.openModal = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          form.openModal()
        }
      }

      window.initValidationForm = () => {
        const container = document.getElementById('validation-form')
        const config = createFormConfig('validation')

        if (formInstances.has('validation')) {
          formInstances.get('validation').destroy()
        }

        const form = new MockFormManager(config, container)
        formInstances.set('validation', form)

        form.on('validation', (data) => {
          const status = data.errors.length === 0 ? 'success' : 'error'
          const message = data.errors.length === 0 ? 'è¡¨å•éªŒè¯é€šè¿‡' : `å‘ç° ${data.errors.length} ä¸ªé”™è¯¯`
          updateStatus('validation', message, status)
        })

        updateStatus('validation', 'éªŒè¯è¡¨å•å·²åˆå§‹åŒ–', 'success')
      }

      window.validateForm = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          form.validate()
        }
      }

      window.fillValidData = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          form.setValue('username', 'testuser')
          form.setValue('password', '123456')
          form.setValue('email', 'test@example.com')
          form.setValue('age', '25')
          form.render()
          updateStatus(formId, 'å·²å¡«å…¥æœ‰æ•ˆæ•°æ®', 'success')
        }
      }

      window.clearForm = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          form.reset()
          updateStatus(formId, 'è¡¨å•å·²æ¸…ç©º', 'info')
        }
      }

      window.initGroupForm = () => {
        const container = document.getElementById('group-form')
        const config = createFormConfig('group')

        if (formInstances.has('group')) {
          formInstances.get('group').destroy()
        }

        // æ¨¡æ‹Ÿåˆ†ç»„æ¸²æŸ“
        container.innerHTML = `
                <div class="form-group-header" onclick="toggleGroup('group', 'basic')">
                    <span style="margin-right: 8px;">â–¼</span>
                    <span style="flex: 1; font-weight: 600;">åŸºæœ¬ä¿¡æ¯</span>
                    <span style="background: #f5f5f5; padding: 2px 8px; border-radius: 10px; font-size: 12px;">3</span>
                </div>
                <div id="group-basic">
                    <div class="form-item">
                        <label>å§“å *</label>
                        <input type="text" placeholder="è¯·è¾“å…¥å§“å">
                    </div>
                    <div class="form-item">
                        <label>å¹´é¾„</label>
                        <input type="number" placeholder="è¯·è¾“å…¥å¹´é¾„">
                    </div>
                    <div class="form-item">
                        <label>æ€§åˆ«</label>
                        <input type="text" placeholder="è¯·è¾“å…¥æ€§åˆ«">
                    </div>
                </div>

                <div class="form-group-header" onclick="toggleGroup('group', 'contact')">
                    <span style="margin-right: 8px;">â–¼</span>
                    <span style="flex: 1; font-weight: 600;">è”ç³»æ–¹å¼</span>
                    <span style="background: #f5f5f5; padding: 2px 8px; border-radius: 10px; font-size: 12px;">3</span>
                </div>
                <div id="group-contact">
                    <div class="form-item">
                        <label>é‚®ç®± *</label>
                        <input type="email" placeholder="è¯·è¾“å…¥é‚®ç®±">
                    </div>
                    <div class="form-item">
                        <label>ç”µè¯</label>
                        <input type="tel" placeholder="è¯·è¾“å…¥ç”µè¯">
                    </div>
                    <div class="form-item">
                        <label>åœ°å€</label>
                        <input type="text" placeholder="è¯·è¾“å…¥åœ°å€">
                    </div>
                </div>

                <div class="form-group-header" onclick="toggleGroup('group', 'advanced')">
                    <span style="margin-right: 8px;">â–¼</span>
                    <span style="flex: 1; font-weight: 600;">é«˜çº§è®¾ç½®</span>
                    <span style="background: #f5f5f5; padding: 2px 8px; border-radius: 10px; font-size: 12px;">3</span>
                </div>
                <div id="group-advanced">
                    <div class="form-item">
                        <label>ä¸»é¢˜</label>
                        <input type="text" placeholder="è¯·é€‰æ‹©ä¸»é¢˜">
                    </div>
                    <div class="form-item">
                        <label>è¯­è¨€</label>
                        <input type="text" placeholder="è¯·é€‰æ‹©è¯­è¨€">
                    </div>
                    <div class="form-item">
                        <label>æ—¶åŒº</label>
                        <input type="text" placeholder="è¯·é€‰æ‹©æ—¶åŒº">
                    </div>
                </div>
            `

        updateStatus('group', 'åˆ†ç»„è¡¨å•å·²åˆå§‹åŒ–', 'success')
      }

      window.toggleGroup = (formId, groupKey) => {
        const groupEl = document.getElementById(`group-${groupKey}`)
        const headerEl = groupEl?.previousElementSibling

        if (groupEl && headerEl) {
          const isVisible = groupEl.style.display !== 'none'
          groupEl.style.display = isVisible ? 'none' : 'block'

          const icon = headerEl.querySelector('span')
          if (icon) {
            icon.textContent = isVisible ? 'â–¶' : 'â–¼'
          }

          updateStatus(formId, `åˆ†ç»„ ${groupKey} å·²${isVisible ? 'æ”¶èµ·' : 'å±•å¼€'}`, 'info')
        }
      }

      window.updateMetrics = () => {
        const now = Date.now()
        const uptime = Math.floor((now - performanceMetrics.startTime) / 1000)
        const avgRenderTime =
          performanceMetrics.renderCount > 0
            ? (performanceMetrics.totalRenderTime / performanceMetrics.renderCount).toFixed(2)
            : 0

        document.getElementById('render-count').textContent = performanceMetrics.renderCount
        document.getElementById('avg-render-time').textContent = `${avgRenderTime}ms`
        document.getElementById('form-count').textContent = formInstances.size
        document.getElementById('memory-usage').textContent =
          `${(performance.memory?.usedJSHeapSize / 1024 / 1024 || 0).toFixed(1)}MB`
      }

      window.clearMetrics = () => {
        performanceMetrics.renderCount = 0
        performanceMetrics.totalRenderTime = 0
        performanceMetrics.startTime = Date.now()
        updateMetrics()
      }

      window.runPerformanceTest = async () => {
        const testButton = event.target
        testButton.innerHTML = '<span class="loading"></span>è¿è¡Œä¸­...'
        testButton.disabled = true

        try {
          // æ¨¡æ‹Ÿæ€§èƒ½æµ‹è¯•
          for (let i = 0; i < 10; i++) {
            const startTime = performance.now()

            // åˆ›å»ºä¸´æ—¶è¡¨å•
            const tempContainer = document.createElement('div')
            const tempForm = new MockFormManager(createFormConfig('basic'), tempContainer)

            // æ¨¡æ‹Ÿæ“ä½œ
            tempForm.setValue('name', `æµ‹è¯•ç”¨æˆ·${i}`)
            tempForm.validate()
            tempForm.toggle()

            const endTime = performance.now()
            performanceMetrics.totalRenderTime += endTime - startTime
            performanceMetrics.renderCount++

            tempForm.destroy()

            // çŸ­æš‚å»¶è¿Ÿä»¥æ˜¾ç¤ºè¿›åº¦
            await new Promise((resolve) => setTimeout(resolve, 100))
          }

          updateMetrics()
          alert('æ€§èƒ½æµ‹è¯•å®Œæˆï¼è¯·æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡ã€‚')
        } finally {
          testButton.innerHTML = 'æ€§èƒ½æµ‹è¯•'
          testButton.disabled = false
        }
      }

      // å®šæœŸæ›´æ–°æŒ‡æ ‡
      setInterval(updateMetrics, 2000)

      // åˆå§‹åŒ–
      updateMetrics()

      console.log('ğŸš€ è‡ªé€‚åº”è¡¨å•å¸ƒå±€ç³»ç»Ÿæ¼”ç¤ºå·²åŠ è½½')
      console.log(
        'ğŸ“‹ å¯ç”¨çš„å…¨å±€å‡½æ•°:',
        Object.keys(window).filter(
          (key) =>
            typeof window[key] === 'function' &&
            ['init', 'toggle', 'resize', 'add', 'validate', 'fill', 'clear', 'switch', 'open', 'update', 'run'].some(
              (prefix) => key.startsWith(prefix),
            ),
        ),
      )
    </script>
  </body>
</html>
