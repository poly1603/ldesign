<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>自适应表单布局系统 - 综合示例</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background-color: #f5f5f5;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      .header {
        background: white;
        padding: 24px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 24px;
      }

      .header h1 {
        font-size: 28px;
        color: #333;
        margin-bottom: 8px;
      }

      .header p {
        color: #666;
        font-size: 16px;
        line-height: 1.5;
      }

      .demo-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        margin-bottom: 24px;
      }

      @media (max-width: 1200px) {
        .demo-grid {
          grid-template-columns: 1fr;
        }
      }

      .demo-section {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .demo-header {
        padding: 20px 24px;
        border-bottom: 1px solid #f0f0f0;
        background: #fafafa;
      }

      .demo-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
      }

      .demo-description {
        color: #666;
        font-size: 14px;
        line-height: 1.5;
      }

      .demo-content {
        padding: 24px;
      }

      .controls {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 8px 16px;
        border: 1px solid #d9d9d9;
        border-radius: 4px;
        background: white;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-block;
      }

      .btn:hover {
        border-color: #1890ff;
        color: #1890ff;
      }

      .btn.primary {
        background: #1890ff;
        border-color: #1890ff;
        color: white;
      }

      .btn.primary:hover {
        background: #40a9ff;
        border-color: #40a9ff;
      }

      .btn.success {
        background: #52c41a;
        border-color: #52c41a;
        color: white;
      }

      .btn.success:hover {
        background: #73d13d;
        border-color: #73d13d;
      }

      .form-container {
        border: 1px solid #e8e8e8;
        border-radius: 6px;
        padding: 20px;
        background: #fafafa;
        min-height: 300px;
        position: relative;
      }

      .status {
        margin-top: 16px;
        padding: 12px;
        border-radius: 4px;
        font-size: 14px;
      }

      .status.info {
        background: #e6f7ff;
        border: 1px solid #91d5ff;
        color: #1890ff;
      }

      .status.success {
        background: #f6ffed;
        border: 1px solid #b7eb8f;
        color: #52c41a;
      }

      .status.warning {
        background: #fffbe6;
        border: 1px solid #ffe58f;
        color: #faad14;
      }

      .status.error {
        background: #fff2f0;
        border: 1px solid #ffccc7;
        color: #ff4d4f;
      }

      .metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin-top: 16px;
      }

      .metric {
        text-align: center;
        padding: 16px;
        background: #f8f9fa;
        border-radius: 6px;
      }

      .metric-value {
        font-size: 24px;
        font-weight: 600;
        color: #1890ff;
        margin-bottom: 4px;
      }

      .metric-label {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
      }

      .full-width {
        grid-column: 1 / -1;
      }

      .feature-list {
        list-style: none;
        margin-top: 16px;
      }

      .feature-list li {
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        align-items: center;
      }

      .feature-list li:last-child {
        border-bottom: none;
      }

      .feature-list li::before {
        content: '✅';
        margin-right: 12px;
        font-size: 16px;
      }

      .code-block {
        background: #f6f8fa;
        border: 1px solid #e1e4e8;
        border-radius: 6px;
        padding: 16px;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        overflow-x: auto;
        margin-top: 16px;
      }

      .loading {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #1890ff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 8px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* 表单样式 */
      .form-item {
        margin-bottom: 16px;
        display: flex;
        flex-direction: column;
      }

      .form-item label {
        font-size: 14px;
        color: #333;
        font-weight: 500;
        margin-bottom: 4px;
      }

      .form-item input,
      .form-item textarea,
      .form-item select {
        padding: 8px 12px;
        border: 1px solid #d9d9d9;
        border-radius: 4px;
        font-size: 14px;
        transition: border-color 0.2s;
      }

      .form-item input:focus,
      .form-item textarea:focus,
      .form-item select:focus {
        outline: none;
        border-color: #1890ff;
        box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
      }

      .form-group-header {
        display: flex;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #f0f0f0;
        margin-bottom: 16px;
        cursor: pointer;
        user-select: none;
      }

      .form-group-header:hover {
        background-color: #f8f9fa;
      }

      .expand-button {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 8px 16px;
        margin: 16px 0;
        border: 1px solid #d9d9d9;
        border-radius: 4px;
        background: #fafafa;
        cursor: pointer;
        transition: all 0.3s ease;
        user-select: none;
      }

      .expand-button:hover {
        border-color: #1890ff;
        background: #f0f8ff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- 头部介绍 -->
      <div class="header">
        <h1>🚀 自适应表单布局系统</h1>
        <p>
          一个智能的表单布局解决方案，支持自适应布局、展开收起、弹窗模式、表单分组、实时验证等功能。
          本示例展示了系统的核心功能和使用方法。
        </p>
      </div>

      <!-- 功能演示网格 -->
      <div class="demo-grid">
        <!-- 基础布局演示 -->
        <div class="demo-section">
          <div class="demo-header">
            <div class="demo-title">📐 自适应布局</div>
            <div class="demo-description">根据容器宽度自动计算最佳列数和布局</div>
          </div>
          <div class="demo-content">
            <div class="controls">
              <button class="btn primary" onclick="initBasicForm()">初始化表单</button>
              <button class="btn" onclick="resizeContainer('basic', 400)">窄容器</button>
              <button class="btn" onclick="resizeContainer('basic', 800)">宽容器</button>
              <button class="btn" onclick="addFormItems('basic')">添加字段</button>
            </div>
            <div class="form-container" id="basic-form">
              <p>点击"初始化表单"开始演示</p>
            </div>
            <div class="status info" id="basic-status">等待初始化...</div>
          </div>
        </div>

        <!-- 展开收起演示 -->
        <div class="demo-section">
          <div class="demo-header">
            <div class="demo-title">📂 展开收起功能</div>
            <div class="demo-description">支持内联展开和弹窗模式两种方式</div>
          </div>
          <div class="demo-content">
            <div class="controls">
              <button class="btn primary" onclick="initExpandForm()">初始化表单</button>
              <button class="btn" onclick="toggleExpand('expand')">切换展开</button>
              <button class="btn" onclick="switchToModal('expand')">切换弹窗模式</button>
              <button class="btn" onclick="openModal('expand')">打开弹窗</button>
            </div>
            <div class="form-container" id="expand-form">
              <p>点击"初始化表单"开始演示</p>
            </div>
            <div class="status info" id="expand-status">等待初始化...</div>
          </div>
        </div>

        <!-- 表单验证演示 -->
        <div class="demo-section">
          <div class="demo-header">
            <div class="demo-title">✅ 实时验证</div>
            <div class="demo-description">支持多种验证规则和实时错误提示</div>
          </div>
          <div class="demo-content">
            <div class="controls">
              <button class="btn primary" onclick="initValidationForm()">初始化表单</button>
              <button class="btn" onclick="validateForm('validation')">验证表单</button>
              <button class="btn" onclick="fillValidData('validation')">填入有效数据</button>
              <button class="btn" onclick="clearForm('validation')">清空表单</button>
            </div>
            <div class="form-container" id="validation-form">
              <p>点击"初始化表单"开始演示</p>
            </div>
            <div class="status info" id="validation-status">等待初始化...</div>
          </div>
        </div>

        <!-- 表单分组演示 -->
        <div class="demo-section">
          <div class="demo-header">
            <div class="demo-title">📋 表单分组</div>
            <div class="demo-description">支持表单项分组显示和独立展开收起</div>
          </div>
          <div class="demo-content">
            <div class="controls">
              <button class="btn primary" onclick="initGroupForm()">初始化表单</button>
              <button class="btn" onclick="toggleGroup('group', 'basic')">切换基本信息</button>
              <button class="btn" onclick="toggleGroup('group', 'contact')">切换联系方式</button>
              <button class="btn" onclick="toggleGroup('group', 'advanced')">切换高级设置</button>
            </div>
            <div class="form-container" id="group-form">
              <p>点击"初始化表单"开始演示</p>
            </div>
            <div class="status info" id="group-status">等待初始化...</div>
          </div>
        </div>
      </div>

      <!-- 性能指标 -->
      <div class="demo-section full-width">
        <div class="demo-header">
          <div class="demo-title">📊 性能指标</div>
          <div class="demo-description">实时监控表单系统的性能表现</div>
        </div>
        <div class="demo-content">
          <div class="metrics" id="performance-metrics">
            <div class="metric">
              <div class="metric-value" id="render-count">0</div>
              <div class="metric-label">渲染次数</div>
            </div>
            <div class="metric">
              <div class="metric-value" id="avg-render-time">0ms</div>
              <div class="metric-label">平均渲染时间</div>
            </div>
            <div class="metric">
              <div class="metric-value" id="form-count">0</div>
              <div class="metric-label">表单实例数</div>
            </div>
            <div class="metric">
              <div class="metric-value" id="memory-usage">0MB</div>
              <div class="metric-label">内存使用</div>
            </div>
          </div>
          <div class="controls">
            <button class="btn" onclick="updateMetrics()">更新指标</button>
            <button class="btn" onclick="clearMetrics()">清空指标</button>
            <button class="btn success" onclick="runPerformanceTest()">性能测试</button>
          </div>
        </div>
      </div>

      <!-- 功能特性列表 -->
      <div class="demo-section full-width">
        <div class="demo-header">
          <div class="demo-title">🎯 功能特性</div>
          <div class="demo-description">自适应表单布局系统的完整功能列表</div>
        </div>
        <div class="demo-content">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px">
            <div>
              <h4>🏗️ 核心功能</h4>
              <ul class="feature-list">
                <li>自适应布局计算</li>
                <li>响应式断点支持</li>
                <li>表单项自动排列</li>
                <li>容器尺寸监听</li>
                <li>性能优化机制</li>
              </ul>
            </div>
            <div>
              <h4>🎨 交互功能</h4>
              <ul class="feature-list">
                <li>展开收起控制</li>
                <li>弹窗模式支持</li>
                <li>表单分组管理</li>
                <li>拖拽排序支持</li>
                <li>键盘导航支持</li>
              </ul>
            </div>
            <div>
              <h4>✅ 验证功能</h4>
              <ul class="feature-list">
                <li>实时表单验证</li>
                <li>自定义验证规则</li>
                <li>异步验证支持</li>
                <li>错误信息显示</li>
                <li>验证状态管理</li>
              </ul>
            </div>
            <div>
              <h4>🔧 开发支持</h4>
              <ul class="feature-list">
                <li>TypeScript支持</li>
                <li>Vue3集成</li>
                <li>原生JS适配器</li>
                <li>插件系统</li>
                <li>开发工具支持</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- 使用示例 -->
      <div class="demo-section full-width">
        <div class="demo-header">
          <div class="demo-title">💻 使用示例</div>
          <div class="demo-description">快速开始使用自适应表单布局系统</div>
        </div>
        <div class="demo-content">
          <h4>原生JavaScript使用</h4>
          <div class="code-block">
            // 引入适配器 import { AdaptiveForm } from '@ldesign/form' // 创建表单实例 const form = new AdaptiveForm({
            selector: '#form-container', items: [ { key: 'name', label: '姓名', type: 'input', required: true }, { key:
            'email', label: '邮箱', type: 'email', required: true }, { key: 'phone', label: '电话', type: 'tel' }, ],
            layout: { defaultRows: 2, maxColumns: 3, gap: { horizontal: 16, vertical: 16 } }, display: { labelPosition:
            'left', expandMode: 'modal' } }) // 监听事件 form.on('change', (data) => { console.log('表单值变化:', data)
            })
          </div>

          <h4>Vue3组件使用</h4>
          <div class="code-block">
            &lt;template&gt; &lt;AdaptiveForm v-model="formData" :config="formConfig" @change="handleChange"
            @submit="handleSubmit" /&gt; &lt;/template&gt; &lt;script setup&gt; import { ref } from 'vue' import {
            AdaptiveForm } from '@ldesign/form/vue' const formData = ref({}) const formConfig = ref({ items: [ { key:
            'name', label: '姓名', type: 'input', required: true }, { key: 'email', label: '邮箱', type: 'email',
            required: true } ], layout: { maxColumns: 2 }, display: { expandMode: 'inline' } }) const handleChange =
            (data) => { console.log('表单变化:', data) } &lt;/script&gt;
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      // 模拟表单管理器
      class MockFormManager {
        constructor(config, container) {
          this.config = config
          this.container = container
          this.values = {}
          this.errors = {}
          this.expanded = false
          this.modalOpen = false
          this.eventListeners = new Map()

          this.render()
        }

        render() {
          if (!this.container) return

          this.container.innerHTML = ''

          // 渲染表单项
          const visibleItems = this.getVisibleItems()
          visibleItems.forEach((item) => {
            const formItem = this.createFormItem(item)
            this.container.appendChild(formItem)
          })

          // 渲染展开按钮
          if (this.needsExpandButton()) {
            const expandButton = this.createExpandButton()
            this.container.appendChild(expandButton)
          }

          this.emit('render', { itemCount: visibleItems.length })
        }

        createFormItem(item) {
          const div = document.createElement('div')
          div.className = 'form-item'
          div.innerHTML = `
                    <label>${item.label}${item.required ? ' *' : ''}</label>
                    <input
                        type="${item.type || 'text'}"
                        name="${item.key}"
                        value="${this.values[item.key] || ''}"
                        placeholder="${item.placeholder || ''}"
                        ${item.required ? 'required' : ''}
                    />
                    ${this.errors[item.key] ? `<div style="color: #ff4d4f; font-size: 12px; margin-top: 4px;">${this.errors[item.key]}</div>` : ''}
                `

          const input = div.querySelector('input')
          input.addEventListener('input', (e) => {
            this.setValue(item.key, e.target.value)
          })

          return div
        }

        createExpandButton() {
          const button = document.createElement('div')
          button.className = 'expand-button'
          button.innerHTML = `
                    <span>${this.expanded ? '收起' : '展开更多'}</span>
                    <span style="margin-left: 8px;">${this.expanded ? '▲' : '▼'}</span>
                `

          button.addEventListener('click', () => {
            this.toggle()
          })

          return button
        }

        getVisibleItems() {
          const threshold = this.config.behavior?.expandThreshold || 3
          if (this.expanded) {
            return this.config.items
          }
          return this.config.items.slice(0, threshold)
        }

        needsExpandButton() {
          const threshold = this.config.behavior?.expandThreshold || 3
          return this.config.items.length > threshold
        }

        setValue(key, value) {
          this.values[key] = value
          this.emit('change', { key, value })
        }

        getValue(key) {
          return key ? this.values[key] : { ...this.values }
        }

        validate(key) {
          const errors = []
          const items = key ? [this.config.items.find((item) => item.key === key)] : this.config.items

          items.forEach((item) => {
            if (!item) return

            const value = this.values[item.key]
            if (item.required && (!value || value.trim() === '')) {
              errors.push(`${item.label}是必填项`)
              this.errors[item.key] = `${item.label}是必填项`
            } else {
              delete this.errors[item.key]
            }
          })

          this.render()
          this.emit('validation', { errors })
          return { valid: errors.length === 0, errors }
        }

        reset() {
          this.values = {}
          this.errors = {}
          this.render()
          this.emit('reset')
        }

        expand() {
          this.expanded = true
          this.render()
          this.emit('expand', { expanded: true })
        }

        collapse() {
          this.expanded = false
          this.render()
          this.emit('expand', { expanded: false })
        }

        toggle() {
          if (this.expanded) {
            this.collapse()
          } else {
            this.expand()
          }
        }

        async openModal() {
          this.modalOpen = true
          this.emit('modal', { open: true })
          // 模拟弹窗
          alert('弹窗模式演示 - 这里会显示隐藏的表单项')
        }

        async closeModal() {
          this.modalOpen = false
          this.emit('modal', { open: false })
        }

        on(event, handler) {
          if (!this.eventListeners.has(event)) {
            this.eventListeners.set(event, new Set())
          }
          this.eventListeners.get(event).add(handler)

          return () => {
            const handlers = this.eventListeners.get(event)
            if (handlers) {
              handlers.delete(handler)
            }
          }
        }

        emit(event, data) {
          const handlers = this.eventListeners.get(event)
          if (handlers) {
            handlers.forEach((handler) => handler(data))
          }
        }

        destroy() {
          this.eventListeners.clear()
          if (this.container) {
            this.container.innerHTML = ''
          }
        }
      }

      // 全局状态
      const formInstances = new Map()
      const performanceMetrics = {
        renderCount: 0,
        totalRenderTime: 0,
        formCount: 0,
        startTime: Date.now(),
      }

      // 工具函数
      function updateStatus(id, message, type = 'info') {
        const statusEl = document.getElementById(`${id}-status`)
        if (statusEl) {
          statusEl.textContent = message
          statusEl.className = `status ${type}`
        }
      }

      function createFormConfig(type) {
        const configs = {
          basic: {
            items: [
              { key: 'name', label: '姓名', type: 'text', required: true },
              { key: 'email', label: '邮箱', type: 'email', required: true },
              { key: 'phone', label: '电话', type: 'tel' },
              { key: 'company', label: '公司', type: 'text' },
            ],
            behavior: { expandThreshold: 2 },
          },
          expand: {
            items: [
              { key: 'name', label: '姓名', type: 'text', required: true },
              { key: 'email', label: '邮箱', type: 'email', required: true },
              { key: 'phone', label: '电话', type: 'tel' },
              { key: 'company', label: '公司', type: 'text' },
              { key: 'position', label: '职位', type: 'text' },
              { key: 'address', label: '地址', type: 'text' },
              { key: 'website', label: '网站', type: 'url' },
              { key: 'notes', label: '备注', type: 'textarea' },
            ],
            behavior: { expandThreshold: 3 },
            display: { expandMode: 'inline' },
          },
          validation: {
            items: [
              { key: 'username', label: '用户名', type: 'text', required: true, placeholder: '请输入用户名' },
              { key: 'password', label: '密码', type: 'password', required: true, placeholder: '请输入密码' },
              { key: 'email', label: '邮箱', type: 'email', required: true, placeholder: '请输入邮箱' },
              { key: 'age', label: '年龄', type: 'number', placeholder: '请输入年龄' },
            ],
            behavior: { expandThreshold: 4 },
          },
          group: {
            items: [
              { key: 'name', label: '姓名', type: 'text', required: true, group: 'basic' },
              { key: 'age', label: '年龄', type: 'number', group: 'basic' },
              { key: 'gender', label: '性别', type: 'text', group: 'basic' },
              { key: 'email', label: '邮箱', type: 'email', required: true, group: 'contact' },
              { key: 'phone', label: '电话', type: 'tel', group: 'contact' },
              { key: 'address', label: '地址', type: 'text', group: 'contact' },
              { key: 'theme', label: '主题', type: 'text', group: 'advanced' },
              { key: 'language', label: '语言', type: 'text', group: 'advanced' },
              { key: 'timezone', label: '时区', type: 'text', group: 'advanced' },
            ],
            behavior: { expandThreshold: 6 },
          },
        }
        return configs[type] || configs.basic
      }

      // 全局函数
      window.initBasicForm = () => {
        const container = document.getElementById('basic-form')
        const config = createFormConfig('basic')

        if (formInstances.has('basic')) {
          formInstances.get('basic').destroy()
        }

        const form = new MockFormManager(config, container)
        formInstances.set('basic', form)

        form.on('render', (data) => {
          updateStatus('basic', `表单已渲染，显示 ${data.itemCount} 个字段`, 'success')
          performanceMetrics.renderCount++
          performanceMetrics.formCount = formInstances.size
        })

        form.on('change', (data) => {
          updateStatus('basic', `字段 ${data.key} 值已更新: ${data.value}`, 'info')
        })
      }

      window.resizeContainer = (formId, width) => {
        const container = document.getElementById(`${formId}-form`)
        if (container) {
          container.style.width = `${width}px`
          updateStatus(formId, `容器宽度已调整为 ${width}px`, 'info')
        }
      }

      window.addFormItems = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          const newItems = [
            { key: 'department', label: '部门', type: 'text' },
            { key: 'salary', label: '薪资', type: 'number' },
          ]
          form.config.items.push(...newItems)
          form.render()
          updateStatus(formId, `已添加 ${newItems.length} 个新字段`, 'success')
        }
      }

      window.initExpandForm = () => {
        const container = document.getElementById('expand-form')
        const config = createFormConfig('expand')

        if (formInstances.has('expand')) {
          formInstances.get('expand').destroy()
        }

        const form = new MockFormManager(config, container)
        formInstances.set('expand', form)

        form.on('expand', (data) => {
          updateStatus('expand', `表单已${data.expanded ? '展开' : '收起'}`, 'success')
        })

        form.on('modal', (data) => {
          updateStatus('expand', `弹窗已${data.open ? '打开' : '关闭'}`, 'info')
        })

        updateStatus('expand', '展开收起表单已初始化', 'success')
      }

      window.toggleExpand = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          form.toggle()
        }
      }

      window.switchToModal = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          form.config.display = { expandMode: 'modal' }
          updateStatus(formId, '已切换到弹窗模式', 'info')
        }
      }

      window.openModal = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          form.openModal()
        }
      }

      window.initValidationForm = () => {
        const container = document.getElementById('validation-form')
        const config = createFormConfig('validation')

        if (formInstances.has('validation')) {
          formInstances.get('validation').destroy()
        }

        const form = new MockFormManager(config, container)
        formInstances.set('validation', form)

        form.on('validation', (data) => {
          const status = data.errors.length === 0 ? 'success' : 'error'
          const message = data.errors.length === 0 ? '表单验证通过' : `发现 ${data.errors.length} 个错误`
          updateStatus('validation', message, status)
        })

        updateStatus('validation', '验证表单已初始化', 'success')
      }

      window.validateForm = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          form.validate()
        }
      }

      window.fillValidData = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          form.setValue('username', 'testuser')
          form.setValue('password', '123456')
          form.setValue('email', 'test@example.com')
          form.setValue('age', '25')
          form.render()
          updateStatus(formId, '已填入有效数据', 'success')
        }
      }

      window.clearForm = (formId) => {
        const form = formInstances.get(formId)
        if (form) {
          form.reset()
          updateStatus(formId, '表单已清空', 'info')
        }
      }

      window.initGroupForm = () => {
        const container = document.getElementById('group-form')
        const config = createFormConfig('group')

        if (formInstances.has('group')) {
          formInstances.get('group').destroy()
        }

        // 模拟分组渲染
        container.innerHTML = `
                <div class="form-group-header" onclick="toggleGroup('group', 'basic')">
                    <span style="margin-right: 8px;">▼</span>
                    <span style="flex: 1; font-weight: 600;">基本信息</span>
                    <span style="background: #f5f5f5; padding: 2px 8px; border-radius: 10px; font-size: 12px;">3</span>
                </div>
                <div id="group-basic">
                    <div class="form-item">
                        <label>姓名 *</label>
                        <input type="text" placeholder="请输入姓名">
                    </div>
                    <div class="form-item">
                        <label>年龄</label>
                        <input type="number" placeholder="请输入年龄">
                    </div>
                    <div class="form-item">
                        <label>性别</label>
                        <input type="text" placeholder="请输入性别">
                    </div>
                </div>

                <div class="form-group-header" onclick="toggleGroup('group', 'contact')">
                    <span style="margin-right: 8px;">▼</span>
                    <span style="flex: 1; font-weight: 600;">联系方式</span>
                    <span style="background: #f5f5f5; padding: 2px 8px; border-radius: 10px; font-size: 12px;">3</span>
                </div>
                <div id="group-contact">
                    <div class="form-item">
                        <label>邮箱 *</label>
                        <input type="email" placeholder="请输入邮箱">
                    </div>
                    <div class="form-item">
                        <label>电话</label>
                        <input type="tel" placeholder="请输入电话">
                    </div>
                    <div class="form-item">
                        <label>地址</label>
                        <input type="text" placeholder="请输入地址">
                    </div>
                </div>

                <div class="form-group-header" onclick="toggleGroup('group', 'advanced')">
                    <span style="margin-right: 8px;">▼</span>
                    <span style="flex: 1; font-weight: 600;">高级设置</span>
                    <span style="background: #f5f5f5; padding: 2px 8px; border-radius: 10px; font-size: 12px;">3</span>
                </div>
                <div id="group-advanced">
                    <div class="form-item">
                        <label>主题</label>
                        <input type="text" placeholder="请选择主题">
                    </div>
                    <div class="form-item">
                        <label>语言</label>
                        <input type="text" placeholder="请选择语言">
                    </div>
                    <div class="form-item">
                        <label>时区</label>
                        <input type="text" placeholder="请选择时区">
                    </div>
                </div>
            `

        updateStatus('group', '分组表单已初始化', 'success')
      }

      window.toggleGroup = (formId, groupKey) => {
        const groupEl = document.getElementById(`group-${groupKey}`)
        const headerEl = groupEl?.previousElementSibling

        if (groupEl && headerEl) {
          const isVisible = groupEl.style.display !== 'none'
          groupEl.style.display = isVisible ? 'none' : 'block'

          const icon = headerEl.querySelector('span')
          if (icon) {
            icon.textContent = isVisible ? '▶' : '▼'
          }

          updateStatus(formId, `分组 ${groupKey} 已${isVisible ? '收起' : '展开'}`, 'info')
        }
      }

      window.updateMetrics = () => {
        const now = Date.now()
        const uptime = Math.floor((now - performanceMetrics.startTime) / 1000)
        const avgRenderTime =
          performanceMetrics.renderCount > 0
            ? (performanceMetrics.totalRenderTime / performanceMetrics.renderCount).toFixed(2)
            : 0

        document.getElementById('render-count').textContent = performanceMetrics.renderCount
        document.getElementById('avg-render-time').textContent = `${avgRenderTime}ms`
        document.getElementById('form-count').textContent = formInstances.size
        document.getElementById('memory-usage').textContent =
          `${(performance.memory?.usedJSHeapSize / 1024 / 1024 || 0).toFixed(1)}MB`
      }

      window.clearMetrics = () => {
        performanceMetrics.renderCount = 0
        performanceMetrics.totalRenderTime = 0
        performanceMetrics.startTime = Date.now()
        updateMetrics()
      }

      window.runPerformanceTest = async () => {
        const testButton = event.target
        testButton.innerHTML = '<span class="loading"></span>运行中...'
        testButton.disabled = true

        try {
          // 模拟性能测试
          for (let i = 0; i < 10; i++) {
            const startTime = performance.now()

            // 创建临时表单
            const tempContainer = document.createElement('div')
            const tempForm = new MockFormManager(createFormConfig('basic'), tempContainer)

            // 模拟操作
            tempForm.setValue('name', `测试用户${i}`)
            tempForm.validate()
            tempForm.toggle()

            const endTime = performance.now()
            performanceMetrics.totalRenderTime += endTime - startTime
            performanceMetrics.renderCount++

            tempForm.destroy()

            // 短暂延迟以显示进度
            await new Promise((resolve) => setTimeout(resolve, 100))
          }

          updateMetrics()
          alert('性能测试完成！请查看性能指标。')
        } finally {
          testButton.innerHTML = '性能测试'
          testButton.disabled = false
        }
      }

      // 定期更新指标
      setInterval(updateMetrics, 2000)

      // 初始化
      updateMetrics()

      console.log('🚀 自适应表单布局系统演示已加载')
      console.log(
        '📋 可用的全局函数:',
        Object.keys(window).filter(
          (key) =>
            typeof window[key] === 'function' &&
            ['init', 'toggle', 'resize', 'add', 'validate', 'fill', 'clear', 'switch', 'open', 'update', 'run'].some(
              (prefix) => key.startsWith(prefix),
            ),
        ),
      )
    </script>
  </body>
</html>
