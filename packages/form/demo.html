<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ldesign/form 表单系统演示</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .demo-section { margin-bottom: 30px; border: 1px solid #ddd; padding: 15px; border-radius: 5px; }
        .ldesign-form { display: grid; gap: 15px; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        .ldesign-form-field { display: flex; flex-direction: column; }
        .ldesign-form-label { font-weight: bold; margin-bottom: 5px; }
        .ldesign-form-input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .ldesign-form-error { color: red; font-size: 12px; margin-top: 2px; }
        .ldesign-form-buttons { grid-column: 1 / -1; margin-top: 10px; }
        .ldesign-form-button { padding: 8px 16px; margin-right: 8px; border: none; border-radius: 4px; cursor: pointer; }
        .ldesign-form-button-primary { background: #007bff; color: white; }
        .ldesign-form-button-default { background: #f8f9fa; color: #333; border: 1px solid #ccc; }
        .result { background: #e7f3ff; border: 1px solid #007bff; padding: 10px; margin-top: 10px; border-radius: 4px; }
        .error { background: #ffe6e6; border-color: #ff0000; }
    </style>
</head>
<body>
    <div class="container">
        <h1>@ldesign/form 表单系统演示</h1>

        <div class="demo-section">
            <h3>简单表单示例</h3>
            <div id="simple-form"></div>
            <div id="simple-result"></div>
        </div>

        <div class="demo-section">
            <h3>验证表单示例</h3>
            <div id="validation-form"></div>
            <div id="validation-result"></div>
        </div>
    </div>

    <script>
        // 简化的表单引擎演示
        class SimpleFormEngine {
            constructor(options) {
                this.options = options
                this.data = {}
                this.errors = {}
                this.container = document.querySelector(options.container)
                this.render()
            }

            setFieldValue(name, value) {
                this.data[name] = value
            }

            async validate() {
                this.errors = {}
                let valid = true

                for (const field of this.options.fields) {
                    if (field.required && !this.data[field.name]) {
                        this.errors[field.name] = '此字段为必填项'
                        valid = false
                    }
                    if (field.name === 'email' && this.data[field.name]) {
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
                        if (!emailRegex.test(this.data[field.name])) {
                            this.errors[field.name] = '请输入有效的邮箱地址'
                            valid = false
                        }
                    }
                }

                this.updateErrorDisplay()
                return { valid, errors: this.errors }
            }

            updateErrorDisplay() {
                this.options.fields.forEach(field => {
                    const errorEl = this.container.querySelector(`[data-field-error="${field.name}"]`)
                    if (errorEl) {
                        errorEl.textContent = this.errors[field.name] || ''
                        errorEl.style.display = this.errors[field.name] ? 'block' : 'none'
                    }
                })
            }

            async submit() {
                const result = await this.validate()
                if (this.options.onSubmit) {
                    this.options.onSubmit(this.data, result.valid)
                }
                return result
            }

            render() {
                const form = document.createElement('div')
                form.className = 'ldesign-form'

                this.options.fields.forEach(field => {
                    const fieldDiv = document.createElement('div')
                    fieldDiv.className = 'ldesign-form-field'

                    const label = document.createElement('label')
                    label.className = 'ldesign-form-label'
                    label.textContent = field.title + (field.required ? ' *' : '')

                    const input = document.createElement('input')
                    input.className = 'ldesign-form-input'
                    input.type = field.type || 'text'
                    input.placeholder = field.placeholder || ''
                    input.addEventListener('input', (e) => this.setFieldValue(field.name, e.target.value))

                    const error = document.createElement('div')
                    error.className = 'ldesign-form-error'
                    error.setAttribute('data-field-error', field.name)
                    error.style.display = 'none'

                    fieldDiv.append(label, input, error)
                    form.appendChild(fieldDiv)
                })

                const buttons = document.createElement('div')
                buttons.className = 'ldesign-form-buttons'
                
                const submitBtn = document.createElement('button')
                submitBtn.className = 'ldesign-form-button ldesign-form-button-primary'
                submitBtn.textContent = '提交'
                submitBtn.onclick = () => this.submit()

                buttons.appendChild(submitBtn)
                form.appendChild(buttons)
                this.container.appendChild(form)
            }
        }

        function showResult(containerId, data, isError = false) {
            const container = document.getElementById(containerId)
            container.innerHTML = `<div class="result ${isError ? 'error' : ''}">${JSON.stringify(data, null, 2)}</div>`
        }

        // 创建表单示例
        new SimpleFormEngine({
            container: '#simple-form',
            fields: [
                { name: 'username', title: '用户名', required: true, placeholder: '请输入用户名' },
                { name: 'age', title: '年龄', type: 'number', placeholder: '请输入年龄' }
            ],
            onSubmit: (data, valid) => showResult('simple-result', { valid, data }, !valid)
        })

        new SimpleFormEngine({
            container: '#validation-form',
            fields: [
                { name: 'email', title: '邮箱', required: true, placeholder: '请输入邮箱' },
                { name: 'password', title: '密码', type: 'password', required: true, placeholder: '请输入密码' }
            ],
            onSubmit: (data, valid) => showResult('validation-result', { valid, data }, !valid)
        })
    </script>
</body>
</html>