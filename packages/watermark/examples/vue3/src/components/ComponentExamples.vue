<template>
  <div class="component-examples">
    <h2 class="section-title">ğŸ§© ç»„ä»¶åŒ–ç¤ºä¾‹</h2>
    <p class="section-desc">å±•ç¤ºå¦‚ä½•å°†æ°´å°åŠŸèƒ½å°è£…æˆå¯å¤ç”¨çš„ Vue ç»„ä»¶</p>

    <div class="grid grid-2">
      <!-- åŸºç¡€æ°´å°ç»„ä»¶ -->
      <div class="card glass">
        <h3>åŸºç¡€æ°´å°ç»„ä»¶</h3>
        <div class="form-group">
          <label>æ°´å°æ–‡å­—</label>
          <input v-model="basicWatermarkProps.content" type="text">
        </div>
        <div class="form-group">
          <label>æ˜¯å¦å¯ç”¨</label>
          <input v-model="basicWatermarkProps.enabled" type="checkbox">
        </div>
        
        <WatermarkContainer
          :content="basicWatermarkProps.content"
          :enabled="basicWatermarkProps.enabled"
          :style="{ fontSize: 16, color: '#2196F3', opacity: 0.2 }"
        >
          <div class="demo-content">
            <p>åŸºç¡€æ°´å°ç»„ä»¶ç¤ºä¾‹</p>
            <p>ä½¿ç”¨ WatermarkContainer ç»„ä»¶</p>
          </div>
        </WatermarkContainer>
        
        <div class="code-preview">
          <details>
            <summary>æŸ¥çœ‹ç»„ä»¶ä»£ç </summary>
            <pre><code>{{ basicComponentCode }}</code></pre>
          </details>
        </div>
      </div>

      <!-- é«˜çº§æ°´å°ç»„ä»¶ -->
      <div class="card glass">
        <h3>é«˜çº§æ°´å°ç»„ä»¶</h3>
        <div class="form-group">
          <label>é¢„è®¾ä¸»é¢˜</label>
          <select v-model="advancedWatermarkProps.theme">
            <option value="default">é»˜è®¤</option>
            <option value="security">å®‰å…¨</option>
            <option value="brand">å“ç‰Œ</option>
            <option value="warning">è­¦å‘Š</option>
          </select>
        </div>
        <div class="form-group">
          <label>å¯†åº¦</label>
          <select v-model="advancedWatermarkProps.density">
            <option value="low">ç¨€ç–</option>
            <option value="medium">ä¸­ç­‰</option>
            <option value="high">å¯†é›†</option>
          </select>
        </div>
        
        <AdvancedWatermark
          :theme="advancedWatermarkProps.theme"
          :density="advancedWatermarkProps.density"
          content="é«˜çº§æ°´å°"
        >
          <div class="demo-content">
            <p>é«˜çº§æ°´å°ç»„ä»¶ç¤ºä¾‹</p>
            <p>æ”¯æŒä¸»é¢˜å’Œå¯†åº¦é…ç½®</p>
          </div>
        </AdvancedWatermark>
        
        <div class="code-preview">
          <details>
            <summary>æŸ¥çœ‹ç»„ä»¶ä»£ç </summary>
            <pre><code>{{ advancedComponentCode }}</code></pre>
          </details>
        </div>
      </div>

      <!-- å“åº”å¼æ°´å°ç»„ä»¶ -->
      <div class="card glass">
        <h3>å“åº”å¼æ°´å°ç»„ä»¶</h3>
        <div class="form-group">
          <label>è‡ªåŠ¨è°ƒæ•´</label>
          <input v-model="responsiveWatermarkProps.autoResize" type="checkbox">
        </div>
        <div class="form-group">
          <label>æ–­ç‚¹é…ç½®</label>
          <select v-model="responsiveWatermarkProps.breakpoint">
            <option value="mobile">ç§»åŠ¨ç«¯ä¼˜åŒ–</option>
            <option value="tablet">å¹³æ¿ä¼˜åŒ–</option>
            <option value="desktop">æ¡Œé¢ç«¯ä¼˜åŒ–</option>
          </select>
        </div>
        
        <ResponsiveWatermark
          :auto-resize="responsiveWatermarkProps.autoResize"
          :breakpoint="responsiveWatermarkProps.breakpoint"
          content="å“åº”å¼æ°´å°"
        >
          <div class="demo-content">
            <p>å“åº”å¼æ°´å°ç»„ä»¶ç¤ºä¾‹</p>
            <p>è‡ªåŠ¨é€‚åº”å®¹å™¨å¤§å°</p>
          </div>
        </ResponsiveWatermark>
        
        <div class="code-preview">
          <details>
            <summary>æŸ¥çœ‹ç»„ä»¶ä»£ç </summary>
            <pre><code>{{ responsiveComponentCode }}</code></pre>
          </details>
        </div>
      </div>

      <!-- åŠ¨ç”»æ°´å°ç»„ä»¶ -->
      <div class="card glass">
        <h3>åŠ¨ç”»æ°´å°ç»„ä»¶</h3>
        <div class="form-group">
          <label>åŠ¨ç”»ç±»å‹</label>
          <select v-model="animationWatermarkProps.animation">
            <option value="fade">æ·¡å…¥æ·¡å‡º</option>
            <option value="slide">æ»‘åŠ¨</option>
            <option value="rotate">æ—‹è½¬</option>
            <option value="pulse">è„‰å†²</option>
          </select>
        </div>
        <div class="form-group">
          <label>æ’­æ”¾çŠ¶æ€</label>
          <input v-model="animationWatermarkProps.playing" type="checkbox">
        </div>
        
        <AnimatedWatermark
          :animation="animationWatermarkProps.animation"
          :playing="animationWatermarkProps.playing"
          content="åŠ¨ç”»æ°´å°"
        >
          <div class="demo-content">
            <p>åŠ¨ç”»æ°´å°ç»„ä»¶ç¤ºä¾‹</p>
            <p>æ”¯æŒå¤šç§åŠ¨ç”»æ•ˆæœ</p>
          </div>
        </AnimatedWatermark>
        
        <div class="code-preview">
          <details>
            <summary>æŸ¥çœ‹ç»„ä»¶ä»£ç </summary>
            <pre><code>{{ animationComponentCode }}</code></pre>
          </details>
        </div>
      </div>
    </div>

    <!-- ç»„åˆå¼ç»„ä»¶ -->
    <div class="card glass mt-30">
      <h3>ğŸ¯ ç»„åˆå¼æ°´å°ç»„ä»¶</h3>
      <p>å°†å¤šä¸ªæ°´å°åŠŸèƒ½ç»„åˆåœ¨ä¸€ä¸ªç»„ä»¶ä¸­</p>
      
      <div class="composite-controls">
        <div class="form-group">
          <label>ç”¨æˆ·å</label>
          <input v-model="compositeProps.username" type="text">
        </div>
        <div class="form-group">
          <label>éƒ¨é—¨</label>
          <input v-model="compositeProps.department" type="text">
        </div>
        <div class="form-group">
          <label>å®‰å…¨çº§åˆ«</label>
          <select v-model="compositeProps.securityLevel">
            <option value="low">ä½</option>
            <option value="medium">ä¸­</option>
            <option value="high">é«˜</option>
          </select>
        </div>
        <div class="form-group">
          <label>æ˜¾ç¤ºæ—¶é—´æˆ³</label>
          <input v-model="compositeProps.showTimestamp" type="checkbox">
        </div>
      </div>
      
      <CompositeWatermark
        :username="compositeProps.username"
        :department="compositeProps.department"
        :security-level="compositeProps.securityLevel"
        :show-timestamp="compositeProps.showTimestamp"
        @security-violation="onSecurityViolation"
      >
        <div class="demo-content large">
          <h4>æœºå¯†æ–‡æ¡£</h4>
          <p>è¿™æ˜¯ä¸€ä¸ªåŒ…å«æ•æ„Ÿä¿¡æ¯çš„æ–‡æ¡£</p>
          <p>æ°´å°åŒ…å«ç”¨æˆ·ä¿¡æ¯ã€éƒ¨é—¨ã€æ—¶é—´æˆ³ç­‰</p>
          <p>å…·æœ‰å®‰å…¨é˜²æŠ¤åŠŸèƒ½</p>
          <div class="document-content">
            <p>æ–‡æ¡£å†…å®¹...</p>
            <p>æ›´å¤šå†…å®¹...</p>
          </div>
        </div>
      </CompositeWatermark>
      
      <div v-if="securityViolations.length" class="security-alerts">
        <h4>ğŸš¨ å®‰å…¨è­¦æŠ¥</h4>
        <div class="alert-list">
          <div
            v-for="alert in securityViolations.slice(-3)"
            :key="alert.id"
            class="alert-item"
          >
            <span class="alert-time">{{ alert.time }}</span>
            <span class="alert-message">{{ alert.message }}</span>
          </div>
        </div>
      </div>
      
      <div class="code-preview">
        <details>
          <summary>æŸ¥çœ‹ç»„åˆç»„ä»¶ä»£ç </summary>
          <pre><code>{{ compositeComponentCode }}</code></pre>
        </details>
      </div>
    </div>

    <!-- æŒ‡ä»¤å¼ç”¨æ³• -->
    <div class="card glass mt-30">
      <h3>ğŸ“ æŒ‡ä»¤å¼ç”¨æ³•</h3>
      <p>ä½¿ç”¨ v-watermark æŒ‡ä»¤å¿«é€Ÿæ·»åŠ æ°´å°</p>
      
      <div class="directive-examples">
        <div class="directive-item">
          <h4>ç®€å•æŒ‡ä»¤</h4>
          <div ref="directiveRef1" class="directive-demo">
            <p>ä½¿ç”¨ v-watermark="'æ–‡å­—'" æŒ‡ä»¤</p>
          </div>
        </div>

        <div class="directive-item">
          <h4>é…ç½®å¯¹è±¡æŒ‡ä»¤</h4>
          <div ref="directiveRef2" class="directive-demo">
            <p>ä½¿ç”¨é…ç½®å¯¹è±¡çš„æŒ‡ä»¤</p>
          </div>
        </div>

        <div class="directive-item">
          <h4>ä¿®é¥°ç¬¦æŒ‡ä»¤</h4>
          <div ref="directiveRef3" class="directive-demo">
            <p>ä½¿ç”¨ä¿®é¥°ç¬¦çš„æŒ‡ä»¤</p>
          </div>
        </div>
      </div>
      
      <div class="code-preview">
        <details>
          <summary>æŸ¥çœ‹æŒ‡ä»¤ä»£ç </summary>
          <pre><code>{{ directiveCode }}</code></pre>
        </details>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted, onUnmounted } from 'vue'
import { createWatermark, destroyWatermark } from '../mock/watermark'
import WatermarkContainer from './watermark/WatermarkContainer.vue'
import AdvancedWatermark from './watermark/AdvancedWatermark.vue'
import ResponsiveWatermark from './watermark/ResponsiveWatermark.vue'
import AnimatedWatermark from './watermark/AnimatedWatermark.vue'
import CompositeWatermark from './watermark/CompositeWatermark.vue'

// ç»„ä»¶å±æ€§
const basicWatermarkProps = reactive({
  content: 'åŸºç¡€æ°´å°',
  enabled: true
})

const advancedWatermarkProps = reactive({
  theme: 'default' as 'default' | 'security' | 'brand' | 'warning',
  density: 'medium' as 'low' | 'medium' | 'high'
})

const responsiveWatermarkProps = reactive({
  autoResize: true,
  breakpoint: 'desktop' as 'mobile' | 'tablet' | 'desktop'
})

const animationWatermarkProps = reactive({
  animation: 'fade' as 'fade' | 'slide' | 'rotate' | 'pulse',
  playing: true
})

const compositeProps = reactive({
  username: 'John Doe',
  department: 'ITéƒ¨é—¨',
  securityLevel: 'high' as 'low' | 'medium' | 'high',
  showTimestamp: true
})

// æŒ‡ä»¤é…ç½®
const directiveConfig = reactive({
  content: 'é…ç½®å¯¹è±¡æ°´å°',
  style: {
    fontSize: 14,
    color: '#FF9800',
    opacity: 0.2
  }
})

// å®‰å…¨è¿è§„è®°å½•
const securityViolations = ref<Array<{
  id: number
  time: string
  message: string
}>>([])

// æŒ‡ä»¤ç¤ºä¾‹çš„å¼•ç”¨
const directiveRef1 = ref<HTMLElement>()
const directiveRef2 = ref<HTMLElement>()
const directiveRef3 = ref<HTMLElement>()

// æŒ‡ä»¤ç¤ºä¾‹çš„æ°´å°å®ä¾‹
const directiveInstances = reactive<Record<string, any>>({
  simple: null,
  config: null,
  modifier: null
})

// å®‰å…¨è¿è§„å¤„ç†
const onSecurityViolation = (violation: any) => {
  securityViolations.value.push({
    id: Date.now(),
    time: new Date().toLocaleTimeString(),
    message: `æ£€æµ‹åˆ° ${violation.type} è¿è§„è¡Œä¸º`
  })
}

// åˆ›å»ºæŒ‡ä»¤ç¤ºä¾‹æ°´å°
const createDirectiveWatermarksAuto = async () => {
  try {
    // ç®€å•æŒ‡ä»¤æ°´å°
    if (directiveRef1.value) {
      directiveInstances.simple = await createWatermark(directiveRef1.value, {
        content: 'ç®€å•æŒ‡ä»¤æ°´å°',
        style: {
          fontSize: 14,
          color: 'rgba(0, 0, 0, 0.15)',
          opacity: 1
        }
      })
    }

    // é…ç½®å¯¹è±¡æŒ‡ä»¤æ°´å°
    if (directiveRef2.value) {
      directiveInstances.config = await createWatermark(directiveRef2.value, {
        content: 'é…ç½®å¯¹è±¡æ°´å°',
        style: {
          fontSize: 14,
          color: '#FF9800',
          opacity: 0.2
        }
      })
    }

    // ä¿®é¥°ç¬¦æŒ‡ä»¤æ°´å°
    if (directiveRef3.value) {
      directiveInstances.modifier = await createWatermark(directiveRef3.value, {
        content: 'ä¿®é¥°ç¬¦æ°´å°',
        style: {
          fontSize: 14,
          color: '#9C27B0',
          opacity: 0.25
        },
        security: {
          level: 'high'
        }
      })
    }
  } catch (error) {
    console.error('åˆ›å»ºæŒ‡ä»¤ç¤ºä¾‹æ°´å°å¤±è´¥:', error)
  }
}

// ä»£ç ç¤ºä¾‹
const basicComponentCode = `&lt;template&gt;
  &lt;WatermarkContainer
    :content="content"
    :enabled="enabled"
    :style="{ fontSize: '16px', color: '#2196F3' }"
  &gt;
    &lt;div class="content"&gt;
      &lt;!-- ä½ çš„å†…å®¹ --&gt;
    &lt;/div&gt;
  &lt;/WatermarkContainer&gt;
&lt;/template&gt;

&lt;script setup&gt;
import WatermarkContainer from './WatermarkContainer.vue'

const content = ref('åŸºç¡€æ°´å°')
const enabled = ref(true)
&lt;/script&gt;`

const advancedComponentCode = `&lt;template&gt;
  &lt;AdvancedWatermark
    :theme="theme"
    :density="density"
    content="é«˜çº§æ°´å°"
  &gt;
    &lt;div class="content"&gt;
      &lt;!-- ä½ çš„å†…å®¹ --&gt;
    &lt;/div&gt;
  &lt;/AdvancedWatermark&gt;
&lt;/template&gt;

&lt;script setup&gt;
import AdvancedWatermark from './AdvancedWatermark.vue'

const theme = ref('default')
const density = ref('medium')
&lt;/script&gt;`

const responsiveComponentCode = `&lt;template&gt;
  &lt;ResponsiveWatermark
    :auto-resize="autoResize"
    :breakpoint="breakpoint"
    content="å“åº”å¼æ°´å°"
  &gt;
    &lt;div class="content"&gt;
      &lt;!-- ä½ çš„å†…å®¹ --&gt;
    &lt;/div&gt;
  &lt;/ResponsiveWatermark&gt;
&lt;/template&gt;

&lt;script setup&gt;
import ResponsiveWatermark from './ResponsiveWatermark.vue'

const autoResize = ref(true)
const breakpoint = ref('desktop')
&lt;/script&gt;`

const animationComponentCode = `&lt;template&gt;
  &lt;AnimatedWatermark
    :animation="animation"
    :playing="playing"
    content="åŠ¨ç”»æ°´å°"
  &gt;
    &lt;div class="content"&gt;
      &lt;!-- ä½ çš„å†…å®¹ --&gt;
    &lt;/div&gt;
  &lt;/AnimatedWatermark&gt;
&lt;/template&gt;

&lt;script setup&gt;
import AnimatedWatermark from './AnimatedWatermark.vue'

const animation = ref('fade')
const playing = ref(true)
&lt;/script&gt;`

const compositeComponentCode = `&lt;template&gt;
  &lt;CompositeWatermark
    :username="username"
    :department="department"
    :security-level="securityLevel"
    :show-timestamp="showTimestamp"
    @security-violation="onSecurityViolation"
  &gt;
    &lt;div class="content"&gt;
      &lt;!-- ä½ çš„å†…å®¹ --&gt;
    &lt;/div&gt;
  &lt;/CompositeWatermark&gt;
&lt;/template&gt;

&lt;script setup&gt;
import CompositeWatermark from './CompositeWatermark.vue'

const username = ref('John Doe')
const department = ref('ITéƒ¨é—¨')
const securityLevel = ref('high')
const showTimestamp = ref(true)

const onSecurityViolation = (violation) => {
  console.log('å®‰å…¨è¿è§„:', violation)
}
&lt;/script&gt;`

const directiveCode = `&lt;!-- ç®€å•ç”¨æ³• --&gt;
&lt;div v-watermark="'ç®€å•æ°´å°'"&gt;å†…å®¹&lt;/div&gt;

&lt;!-- é…ç½®å¯¹è±¡ --&gt;
&lt;div v-watermark="{ content: 'é…ç½®æ°´å°', style: { color: '#FF9800' } }"&gt;
  å†…å®¹
&lt;/div&gt;

&lt;!-- ä¿®é¥°ç¬¦ --&gt;
&lt;div v-watermark.secure.responsive="'ä¿®é¥°ç¬¦æ°´å°'"&gt;å†…å®¹&lt;/div&gt;

<!-- æŒ‡ä»¤æ³¨å†Œ -->
app.directive('watermark', {
  mounted(el, binding) {
    const config = typeof binding.value === 'string'
      ? { content: binding.value }
      : binding.value

    // å¤„ç†ä¿®é¥°ç¬¦
    if (binding.modifiers.secure) {
      config.security = { level: 'high' }
    }
    if (binding.modifiers.responsive) {
      config.responsive = { enabled: true }
    }

    createWatermark(el, config)
  }
})`

// ç”Ÿå‘½å‘¨æœŸé’©å­
onMounted(async () => {
  // ç­‰å¾… DOM æ›´æ–°ååˆ›å»ºæŒ‡ä»¤ç¤ºä¾‹æ°´å°
  await new Promise(resolve => setTimeout(resolve, 100))
  await createDirectiveWatermarksAuto()
})

onUnmounted(async () => {
  // æ¸…ç†æŒ‡ä»¤ç¤ºä¾‹æ°´å°
  for (const instance of Object.values(directiveInstances)) {
    if (instance) {
      await destroyWatermark(instance)
    }
  }
})
</script>

<style lang="less" scoped>
.component-examples {
  .section-title {
    color: white;
    font-size: 1.8rem;
    margin-bottom: 10px;
    text-align: center;
  }
  
  .section-desc {
    color: rgba(255, 255, 255, 0.8);
    text-align: center;
    margin-bottom: 30px;
  }
}

.demo-content {
  padding: 20px;
  text-align: center;
  color: #6c757d;
  background: #f8f9fa;
  border-radius: 8px;
  min-height: 150px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  
  &.large {
    min-height: 250px;
    text-align: left;
    
    h4 {
      color: #333;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .document-content {
      margin-top: 20px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 6px;
    }
  }
}

.composite-controls {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.security-alerts {
  margin-top: 20px;
  
  h4 {
    color: var(--danger-color);
    margin-bottom: 10px;
  }
  
  .alert-list {
    background: rgba(244, 67, 54, 0.1);
    border-radius: 6px;
    padding: 15px;
  }
  
  .alert-item {
    display: flex;
    gap: 10px;
    margin-bottom: 8px;
    font-size: 14px;
    
    &:last-child {
      margin-bottom: 0;
    }
    
    .alert-time {
      color: #666;
      min-width: 80px;
    }
    
    .alert-message {
      color: var(--danger-color);
      font-weight: 500;
    }
  }
}

.directive-examples {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 20px;
}

.directive-item {
  h4 {
    color: var(--primary-color);
    margin-bottom: 10px;
    text-align: center;
  }
  
  .directive-demo {
    min-height: 120px;
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: #6c757d;
    position: relative;
    overflow: hidden;
  }
}

.code-preview {
  margin-top: 15px;
  
  details {
    summary {
      cursor: pointer;
      padding: 8px;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 4px;
      font-weight: 500;
    }
    
    pre {
      margin-top: 10px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 6px;
      overflow-x: auto;
      
      code {
        font-family: 'Courier New', monospace;
        font-size: 13px;
        line-height: 1.4;
      }
    }
  }
}

.mt-30 {
  margin-top: 30px;
}

@media (max-width: 768px) {
  .composite-controls {
    grid-template-columns: 1fr;
  }
  
  .directive-examples {
    grid-template-columns: 1fr;
  }
}
</style>
