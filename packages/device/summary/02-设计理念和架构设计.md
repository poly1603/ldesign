# @ldesign/device è®¾è®¡ç†å¿µå’Œæ¶æ„è®¾è®¡

## ğŸ¯ è®¾è®¡ç†å¿µ

### 1. ç²¾ç¡®æ€§ä¼˜å…ˆ (Accuracy First)
è®¾å¤‡æ£€æµ‹çš„å‡†ç¡®æ€§æ˜¯ç”¨æˆ·ä½“éªŒçš„åŸºç¡€ã€‚æˆ‘ä»¬é‡‡ç”¨å¤šé‡ç‰¹å¾æ£€æµ‹ç®—æ³•ï¼Œè€Œä¸æ˜¯å•çº¯ä¾èµ– User-Agent å­—ç¬¦ä¸²ã€‚

```typescript
// å¤šé‡ç‰¹å¾æ£€æµ‹ç¤ºä¾‹
function detectDevice() {
  const features = {
    screenSize: getScreenDimensions(),
    touchSupport: detectTouchCapability(),
    userAgent: parseUserAgent(),
    orientation: getOrientation(),
    pixelRatio: getDevicePixelRatio()
  }

  return analyzeFeatures(features)
}
```

### 2. æ€§èƒ½è‡³ä¸Š (Performance First)
åœ¨ä¿è¯å‡†ç¡®æ€§çš„å‰æä¸‹ï¼Œæœ€å¤§åŒ–æ€§èƒ½è¡¨ç°ï¼š
- **æ™ºèƒ½ç¼“å­˜**: é¿å…é‡å¤è®¡ç®—
- **æ‡’åŠ è½½**: æŒ‰éœ€åŠ è½½æ£€æµ‹æ¨¡å—
- **é˜²æŠ–ä¼˜åŒ–**: å‡å°‘é¢‘ç¹è§¦å‘
- **å†…å­˜ç®¡ç†**: åŠæ—¶æ¸…ç†æ— ç”¨èµ„æº

### 3. å¼€å‘è€…å‹å¥½ (Developer Experience)
æä¾›ç›´è§‚ã€æ˜“ç”¨çš„ API è®¾è®¡ï¼š
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript æ”¯æŒ
- **è¯­ä¹‰åŒ–**: æ–¹æ³•åå’Œå±æ€§åå…·æœ‰æ˜ç¡®å«ä¹‰
- **ä¸€è‡´æ€§**: ç»Ÿä¸€çš„ API é£æ ¼å’Œé”™è¯¯å¤„ç†
- **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ

### 4. å¯æ‰©å±•æ€§ (Extensibility)
æ¨¡å—åŒ–æ¶æ„æ”¯æŒåŠŸèƒ½æ‰©å±•ï¼š
- **æ’ä»¶ç³»ç»Ÿ**: æ”¯æŒè‡ªå®šä¹‰æ£€æµ‹æ¨¡å—
- **äº‹ä»¶é©±åŠ¨**: åŸºäºäº‹ä»¶çš„å“åº”å¼æ›´æ–°
- **é…ç½®çµæ´»**: ä¸°å¯Œçš„é…ç½®é€‰é¡¹
- **å‘åå…¼å®¹**: ä¿æŒ API ç¨³å®šæ€§

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    @ldesign/device                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Vue Integration Layer                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Composables â”‚ â”‚ Directives  â”‚ â”‚   Plugin    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Core Detection Engine                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              DeviceDetector                             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚â”‚
â”‚  â”‚  â”‚   Screen    â”‚ â”‚   Browser   â”‚ â”‚     OS      â”‚      â”‚â”‚
â”‚  â”‚  â”‚  Detection  â”‚ â”‚  Detection  â”‚ â”‚  Detection  â”‚      â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Module System                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   Network   â”‚ â”‚   Battery   â”‚ â”‚ Geolocation â”‚          â”‚
â”‚  â”‚   Module    â”‚ â”‚   Module    â”‚ â”‚   Module    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Foundation Layer                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚EventEmitter â”‚ â”‚ModuleLoader â”‚ â”‚   Utils     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†å±‚æ¶æ„è¯¦è§£

#### 1. Foundation Layer (åŸºç¡€å±‚)
**èŒè´£**: æä¾›æ ¸å¿ƒåŸºç¡€è®¾æ–½å’Œå·¥å…·å‡½æ•°

- **EventEmitter**: äº‹ä»¶ç³»ç»Ÿæ ¸å¿ƒ
  ```typescript
  class EventEmitter<T> {
    private events: Map<keyof T, Set<EventListener>>

    on<K extends keyof T>(event: K, listener: EventListener<T[K]>): void
    emit<K extends keyof T>(event: K, data: T[K]): void
    off<K extends keyof T>(event: K, listener?: EventListener<T[K]>): void
  }
  ```

- **ModuleLoader**: æ¨¡å—åŠ è½½ç®¡ç†å™¨
  ```typescript
  class ModuleLoader {
    private modules: Map<string, DeviceModule>

    async load(name: string, module: DeviceModule): Promise<void>
    async unload(name: string): Promise<void>
    get<T extends DeviceModule>(name: string): T | null
  }
  ```

- **Utils**: å·¥å…·å‡½æ•°é›†åˆ
  ```typescript
  // å®‰å…¨çš„ navigator è®¿é—®
  export function safeNavigatorAccess<T>(accessor: (nav: Navigator) => T, fallback: T): T {
    try {
      return typeof navigator !== 'undefined' ? accessor(navigator) : fallback
    }
    catch {
      return fallback
    }
  }
  ```

#### 2. Module System (æ¨¡å—ç³»ç»Ÿ)
**èŒè´£**: æä¾›å¯æ‰©å±•çš„åŠŸèƒ½æ¨¡å—

- **æ¨¡å—æ¥å£å®šä¹‰**:
  ```typescript
  interface DeviceModule {
    name: string
    init: () => Promise<void>
    destroy: () => Promise<void>
    getData: () => unknown
    isSupported: () => boolean
  }
  ```

- **å†…ç½®æ¨¡å—**:
  - `NetworkModule`: ç½‘ç»œçŠ¶æ€æ£€æµ‹
  - `BatteryModule`: ç”µæ± ä¿¡æ¯è·å–
  - `GeolocationModule`: åœ°ç†ä½ç½®æœåŠ¡

#### 3. Core Detection Engine (æ ¸å¿ƒæ£€æµ‹å¼•æ“)
**èŒè´£**: è®¾å¤‡ä¿¡æ¯æ£€æµ‹å’ŒçŠ¶æ€ç®¡ç†

- **DeviceDetector ä¸»ç±»**:
  ```typescript
  class DeviceDetector extends EventEmitter<DeviceDetectorEvents> {
    private currentDeviceInfo: DeviceInfo
    private moduleLoader: ModuleLoader
    private options: DeviceDetectorOptions

    constructor(options?: DeviceDetectorOptions)
    getDeviceInfo(): DeviceInfo
    detectDeviceType(): DeviceType
    getBrowserInfo(): BrowserInfo
    getOSInfo(): OSInfo
  }
  ```

#### 4. Vue Integration Layer (Vue é›†æˆå±‚)
**èŒè´£**: æä¾› Vue 3 ç”Ÿæ€ç³»ç»Ÿé›†æˆ

- **Composables**: ç»„åˆå¼ API
  ```typescript
  export function useDevice(options?: UseDeviceOptions) {
    const deviceInfo = ref<DeviceInfo>()
    const isMobile = computed(() => deviceInfo.value?.type === 'mobile')
    const isTablet = computed(() => deviceInfo.value?.type === 'tablet')

    return { deviceInfo, isMobile, isTablet }
  }
  ```

## ğŸ”§ è®¾è®¡æ¨¡å¼åº”ç”¨

### 1. è§‚å¯Ÿè€…æ¨¡å¼ (Observer Pattern)
ç”¨äºäº‹ä»¶ç³»ç»Ÿå’Œå“åº”å¼æ›´æ–°ï¼š
```typescript
// è®¾å¤‡ä¿¡æ¯å˜åŒ–æ—¶è‡ªåŠ¨é€šçŸ¥æ‰€æœ‰ç›‘å¬å™¨
detector.on('deviceChange', (deviceInfo) => {
  updateUI(deviceInfo)
})
```

### 2. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
ç”¨äºä¸åŒçš„æ£€æµ‹ç®—æ³•ï¼š
```typescript
interface DetectionStrategy {
  detect: () => DeviceInfo
}

class MobileDetectionStrategy implements DetectionStrategy {
  detect(): DeviceInfo {
    // ç§»åŠ¨è®¾å¤‡æ£€æµ‹é€»è¾‘
  }
}

class DesktopDetectionStrategy implements DetectionStrategy {
  detect(): DeviceInfo {
    // æ¡Œé¢è®¾å¤‡æ£€æµ‹é€»è¾‘
  }
}
```

### 3. å·¥å‚æ¨¡å¼ (Factory Pattern)
ç”¨äºæ¨¡å—åˆ›å»ºå’Œç®¡ç†ï¼š
```typescript
class ModuleFactory {
  static create(type: string, options?: any): DeviceModule {
    switch (type) {
      case 'network':
        return new NetworkModule(options)
      case 'battery':
        return new BatteryModule(options)
      default:
        throw new Error(`Unknown module type: ${type}`)
    }
  }
}
```

### 4. å•ä¾‹æ¨¡å¼ (Singleton Pattern)
ç”¨äºå…¨å±€è®¾å¤‡æ£€æµ‹å™¨å®ä¾‹ï¼š
```typescript
class DeviceDetectorSingleton {
  private static instance: DeviceDetector

  static getInstance(options?: DeviceDetectorOptions): DeviceDetector {
    if (!this.instance) {
      this.instance = new DeviceDetector(options)
    }
    return this.instance
  }
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. ç¼“å­˜æœºåˆ¶
- **ç»“æœç¼“å­˜**: ç¼“å­˜æ£€æµ‹ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—
- **æ—¶é—´ç¼“å­˜**: è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´
- **LRU ç­–ç•¥**: æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ç¼“å­˜æ·˜æ±°

### 2. æ‡’åŠ è½½
- **æ¨¡å—æ‡’åŠ è½½**: æŒ‰éœ€åŠ è½½æ‰©å±•æ¨¡å—
- **æ£€æµ‹æ‡’åŠ è½½**: å»¶è¿Ÿæ‰§è¡Œéå…³é”®æ£€æµ‹

### 3. é˜²æŠ–å’ŒèŠ‚æµ
- **çª—å£å¤§å°å˜åŒ–é˜²æŠ–**: é¿å…é¢‘ç¹è§¦å‘æ£€æµ‹
- **æ–¹å‘å˜åŒ–èŠ‚æµ**: é™åˆ¶æ–¹å‘å˜åŒ–æ£€æµ‹é¢‘ç‡

### 4. å†…å­˜ç®¡ç†
- **äº‹ä»¶ç›‘å¬å™¨æ¸…ç†**: åŠæ—¶ç§»é™¤æ— ç”¨ç›‘å¬å™¨
- **æ¨¡å—ç”Ÿå‘½å‘¨æœŸç®¡ç†**: æ­£ç¡®åˆå§‹åŒ–å’Œé”€æ¯æ¨¡å—

## ğŸ”’ é”™è¯¯å¤„ç†ç­–ç•¥

### 1. ä¼˜é›…é™çº§
å½“æŸä¸ªæ£€æµ‹åŠŸèƒ½ä¸å¯ç”¨æ—¶ï¼Œæä¾›åˆç†çš„é»˜è®¤å€¼ï¼š
```typescript
function getScreenInfo(): ScreenInfo {
  try {
    return {
      width: window.innerWidth,
      height: window.innerHeight,
      // ...
    }
  }
  catch (error) {
    return {
      width: 1920, // é»˜è®¤å€¼
      height: 1080,
      // ...
    }
  }
}
```

### 2. é”™è¯¯è¾¹ç•Œ
åœ¨å…³é”®æ“ä½œå‘¨å›´è®¾ç½®é”™è¯¯è¾¹ç•Œï¼Œé˜²æ­¢å•ç‚¹æ•…éšœï¼š
```typescript
function safeDetect<T>(detector: () => T, fallback: T): T {
  try {
    return detector()
  }
  catch (error) {
    console.warn('Detection failed:', error)
    return fallback
  }
}
```

### 3. é”™è¯¯ä¸ŠæŠ¥
æä¾›é”™è¯¯ä¸ŠæŠ¥æœºåˆ¶ï¼Œå¸®åŠ©æ”¹è¿›æ£€æµ‹ç®—æ³•ï¼š
```typescript
detector.onError((error, context) => {
  // ä¸ŠæŠ¥é”™è¯¯ä¿¡æ¯
  reportError(error, context)
})
```

## ğŸŒ å…¼å®¹æ€§è®¾è®¡

### 1. æµè§ˆå™¨å…¼å®¹æ€§
- **ç‰¹æ€§æ£€æµ‹**: ä½¿ç”¨ç‰¹æ€§æ£€æµ‹è€Œéæµè§ˆå™¨æ£€æµ‹
- **Polyfill**: ä¸ºæ—§æµè§ˆå™¨æä¾›å¿…è¦çš„ polyfill
- **ä¼˜é›…é™çº§**: åœ¨ä¸æ”¯æŒçš„ç¯å¢ƒä¸­æä¾›åŸºç¡€åŠŸèƒ½

### 2. æœåŠ¡ç«¯æ¸²æŸ“æ”¯æŒ
- **SSR å®‰å…¨**: é¿å…åœ¨æœåŠ¡ç«¯è®¿é—®æµè§ˆå™¨ API
- **åŒæ„æ¸²æŸ“**: ç¡®ä¿å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ¸²æŸ“ç»“æœä¸€è‡´

### 3. ç§»åŠ¨ç«¯é€‚é…
- **è§¦æ‘¸äº‹ä»¶**: æ­£ç¡®å¤„ç†è§¦æ‘¸å’Œé¼ æ ‡äº‹ä»¶
- **è§†å£é€‚é…**: æ”¯æŒå„ç§ç§»åŠ¨è®¾å¤‡è§†å£
- **æ€§èƒ½ä¼˜åŒ–**: é’ˆå¯¹ç§»åŠ¨è®¾å¤‡çš„æ€§èƒ½ä¼˜åŒ–
