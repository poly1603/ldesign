<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LDesign Map - 开发演示</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #722ED1, #9254DE);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .controls {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .controls h3 {
            margin-bottom: 15px;
            color: #722ED1;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .btn {
            padding: 8px 16px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .btn:hover {
            border-color: #722ED1;
            color: #722ED1;
        }
        
        .btn.primary {
            background: #722ED1;
            border-color: #722ED1;
            color: white;
        }
        
        .btn.primary:hover {
            background: #9254DE;
            border-color: #9254DE;
        }
        
        .map-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        #map {
            width: 100%;
            height: 500px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 16px;
        }
        
        .status {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .status h3 {
            margin-bottom: 15px;
            color: #722ED1;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-value {
            font-weight: 500;
            color: #52c41a;
        }
        
        .log {
            background: #1f1f1f;
            color: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 5px;
            opacity: 0.8;
        }
        
        .log-entry.error {
            color: #ff4d4f;
        }
        
        .log-entry.success {
            color: #52c41a;
        }
        
        .log-entry.info {
            color: #1890ff;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>LDesign Map 开发演示</h1>
        <p>基于 OpenLayers 的通用地图插件 - 开发版本</p>
    </div>
    
    <div class="container">
        <div class="controls">
            <h3>地图控制</h3>
            <div class="btn-group">
                <button class="btn primary" onclick="initMap()">初始化地图</button>
                <button class="btn" onclick="addOSMLayer()">添加 OSM 图层</button>
                <button class="btn" onclick="addMarker()">添加标记</button>
                <button class="btn" onclick="addControls()">添加控件</button>
            </div>
            <div class="btn-group">
                <button class="btn" onclick="setTheme('default')">默认主题</button>
                <button class="btn" onclick="setTheme('dark')">深色主题</button>
                <button class="btn" onclick="setTheme('light')">浅色主题</button>
                <button class="btn" onclick="clearMap()">清空地图</button>
            </div>
        </div>
        
        <div class="map-container">
            <div id="map">
                点击"初始化地图"按钮开始演示
            </div>
        </div>
        
        <div class="status">
            <h3>地图状态</h3>
            <div class="status-item">
                <span>初始化状态:</span>
                <span class="status-value" id="init-status">未初始化</span>
            </div>
            <div class="status-item">
                <span>图层数量:</span>
                <span class="status-value" id="layer-count">0</span>
            </div>
            <div class="status-item">
                <span>标记数量:</span>
                <span class="status-value" id="marker-count">0</span>
            </div>
            <div class="status-item">
                <span>当前主题:</span>
                <span class="status-value" id="current-theme">default</span>
            </div>
        </div>
        
        <div class="log" id="log">
            <div class="log-entry info">[INFO] 页面加载完成，等待用户操作...</div>
        </div>
    </div>

    <script type="module">
        // 导入我们的地图库
        // import { LDesignMap, LayerType } from './src/index.ts';
        
        let map = null;
        let layerManager = null;
        let markerManager = null;
        let controlManager = null;
        let styleManager = null;
        
        // 日志函数
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${type.toUpperCase()}] ${new Date().toLocaleTimeString()} - ${message}`;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // 更新状态显示
        function updateStatus() {
            document.getElementById('init-status').textContent = map ? '已初始化' : '未初始化';
            document.getElementById('layer-count').textContent = layerManager ? layerManager.getAllLayers().length : 0;
            document.getElementById('marker-count').textContent = markerManager ? markerManager.getAllMarkers().length : 0;
            document.getElementById('current-theme').textContent = styleManager ? styleManager.getCurrentTheme() : 'default';
        }
        
        // 初始化地图
        window.initMap = function() {
            try {
                const mapElement = document.getElementById('map');
                mapElement.innerHTML = '地图初始化中...';
                mapElement.style.background = '#e6f7ff';
                
                log('开始初始化地图...', 'info');
                
                // 模拟地图初始化
                setTimeout(() => {
                    mapElement.innerHTML = '地图已初始化 (模拟) - OpenLayers 地图容器';
                    mapElement.style.background = '#f6ffed';
                    mapElement.style.color = '#52c41a';
                    
                    // 模拟创建管理器
                    layerManager = { getAllLayers: () => [] };
                    markerManager = { getAllMarkers: () => [] };
                    controlManager = { getAllControls: () => [] };
                    styleManager = { getCurrentTheme: () => 'default' };
                    
                    map = { initialized: true };
                    
                    log('地图初始化成功！', 'success');
                    updateStatus();
                }, 1000);
                
                // 实际代码示例：
                /*
                map = new LDesignMap({
                    container: 'map',
                    center: [116.404, 39.915], // 北京
                    zoom: 10,
                    theme: 'default'
                });
                
                layerManager = map.getLayerManager();
                markerManager = map.getMarkerManager();
                controlManager = map.getControlManager();
                styleManager = map.getStyleManager();
                
                log('地图初始化成功！', 'success');
                updateStatus();
                */
            } catch (error) {
                log(`地图初始化失败: ${error.message}`, 'error');
            }
        };
        
        // 添加 OSM 图层
        window.addOSMLayer = function() {
            if (!map) {
                log('请先初始化地图', 'error');
                return;
            }
            
            log('添加 OSM 图层...', 'info');
            
            // 模拟添加图层
            setTimeout(() => {
                layerManager.getAllLayers = () => [{ id: 'osm', name: 'OpenStreetMap', type: 'OSM' }];
                log('OSM 图层添加成功', 'success');
                updateStatus();
            }, 500);
            
            // 实际代码示例：
            /*
            try {
                await layerManager.addLayer({
                    id: 'osm',
                    name: 'OpenStreetMap',
                    type: LayerType.OSM,
                    visible: true
                });
                
                log('OSM 图层添加成功', 'success');
                updateStatus();
            } catch (error) {
                log(`添加图层失败: ${error.message}`, 'error');
            }
            */
        };
        
        // 添加标记
        window.addMarker = function() {
            if (!map) {
                log('请先初始化地图', 'error');
                return;
            }
            
            log('添加标记点...', 'info');
            
            // 模拟添加标记
            setTimeout(() => {
                markerManager.getAllMarkers = () => [{ id: 'marker1', title: '北京', coordinate: [116.404, 39.915] }];
                log('标记点添加成功', 'success');
                updateStatus();
            }, 500);
            
            // 实际代码示例：
            /*
            try {
                markerManager.addMarker({
                    id: 'marker1',
                    coordinate: [116.404, 39.915],
                    title: '北京',
                    description: '中华人民共和国首都',
                    popup: {
                        content: '<h3>北京</h3><p>中华人民共和国首都</p>'
                    }
                });
                
                log('标记点添加成功', 'success');
                updateStatus();
            } catch (error) {
                log(`添加标记失败: ${error.message}`, 'error');
            }
            */
        };
        
        // 添加控件
        window.addControls = function() {
            if (!map) {
                log('请先初始化地图', 'error');
                return;
            }
            
            log('添加地图控件...', 'info');
            
            // 模拟添加控件
            setTimeout(() => {
                log('缩放控件添加成功', 'success');
                log('比例尺控件添加成功', 'success');
                log('全屏控件添加成功', 'success');
            }, 500);
            
            // 实际代码示例：
            /*
            try {
                controlManager.addDefaultControls();
                log('默认控件添加成功', 'success');
            } catch (error) {
                log(`添加控件失败: ${error.message}`, 'error');
            }
            */
        };
        
        // 设置主题
        window.setTheme = function(theme) {
            if (!map) {
                log('请先初始化地图', 'error');
                return;
            }
            
            log(`切换到 ${theme} 主题...`, 'info');
            
            // 模拟主题切换
            setTimeout(() => {
                styleManager.getCurrentTheme = () => theme;
                
                // 更新页面样式以反映主题变化
                const mapElement = document.getElementById('map');
                switch(theme) {
                    case 'dark':
                        mapElement.style.background = '#1f1f1f';
                        mapElement.style.color = '#ffffff';
                        break;
                    case 'light':
                        mapElement.style.background = '#fafafa';
                        mapElement.style.color = '#262626';
                        break;
                    default:
                        mapElement.style.background = '#f6ffed';
                        mapElement.style.color = '#52c41a';
                }
                
                log(`主题切换到 ${theme} 成功`, 'success');
                updateStatus();
            }, 300);
            
            // 实际代码示例：
            /*
            try {
                styleManager.setTheme(theme);
                log(`主题切换到 ${theme} 成功`, 'success');
                updateStatus();
            } catch (error) {
                log(`主题切换失败: ${error.message}`, 'error');
            }
            */
        };
        
        // 清空地图
        window.clearMap = function() {
            if (!map) {
                log('地图未初始化', 'error');
                return;
            }
            
            log('清空地图...', 'info');
            
            // 模拟清空操作
            setTimeout(() => {
                const mapElement = document.getElementById('map');
                mapElement.innerHTML = '地图已清空';
                mapElement.style.background = '#f0f0f0';
                mapElement.style.color = '#666';
                
                // 重置管理器
                layerManager.getAllLayers = () => [];
                markerManager.getAllMarkers = () => [];
                
                log('地图清空完成', 'success');
                updateStatus();
            }, 500);
            
            // 实际代码示例：
            /*
            try {
                if (layerManager) {
                    layerManager.clearLayers();
                }
                if (markerManager) {
                    markerManager.clearMarkers();
                }
                log('地图清空完成', 'success');
                updateStatus();
            } catch (error) {
                log(`清空地图失败: ${error.message}`, 'error');
            }
            */
        };
        
        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            log('LDesign Map 演示页面加载完成', 'info');
            log('当前版本: 1.0.0 (开发版)', 'info');
            log('基于 OpenLayers 8.2.0', 'info');
            updateStatus();
        });
    </script>
</body>
</html>
