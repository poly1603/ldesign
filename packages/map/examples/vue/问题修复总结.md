# ğŸ”§ åœ°å›¾æ’ä»¶é—®é¢˜ä¿®å¤æ€»ç»“

## ğŸš¨ ä¿®å¤çš„å…³é”®é—®é¢˜

### 1. **å›¾å±‚é‡å¤æ·»åŠ é”™è¯¯**
```
Error: å›¾å±‚ route-animation å·²å­˜åœ¨
```

**é—®é¢˜åŸå› ï¼š**
- LayerManager åœ¨æ·»åŠ å›¾å±‚æ—¶æ£€æŸ¥åˆ°åŒåå›¾å±‚å·²å­˜åœ¨å°±æŠ›å‡ºé”™è¯¯
- è·¯å¾„åŠ¨ç”»é‡å¤æ‰§è¡Œæ—¶ä¼šå°è¯•æ·»åŠ åŒåå›¾å±‚

**ä¿®å¤æ–¹æ¡ˆï¼š**
```typescript
// LayerManager.ts - ä¿®æ”¹å‰
if (this.layers.has(config.id)) {
  throw new Error(`å›¾å±‚ ${config.id} å·²å­˜åœ¨`);
}

// LayerManager.ts - ä¿®æ”¹å  
if (this.layers.has(config.id)) {
  console.warn(`[LayerManager] å›¾å±‚ ${config.id} å·²å­˜åœ¨ï¼Œå°†å…ˆç§»é™¤æ—§å›¾å±‚`);
  this.removeLayer(config.id);
}
```

**ä¿®å¤æ•ˆæœï¼š**
âœ… å›¾å±‚é‡å¤æ·»åŠ æ—¶è‡ªåŠ¨ç§»é™¤æ—§å›¾å±‚ï¼Œé¿å…é”™è¯¯
âœ… è·¯å¾„åŠ¨ç”»å¯ä»¥é‡å¤æ‰§è¡Œè€Œä¸æŠ¥é”™
âœ… æä¾›è­¦å‘Šæ—¥å¿—ä¾¿äºè°ƒè¯•

### 2. **æ ‡è®°åæ ‡è½¬æ¢é”™è¯¯**
```
TypeError: Cannot read properties of undefined (reading 'length')
at transform (proj.js:505:58)
at fromLonLat (proj.js:400:10)
```

**é—®é¢˜åŸå› ï¼š**
- MarkerManager æœŸæœ› `coordinate` å±æ€§ï¼Œä½† Vue ç»„ä»¶ä¼ é€’çš„æ˜¯ `position`
- åæ ‡å‚æ•°ä¸º undefined å¯¼è‡´ OpenLayers è½¬æ¢å¤±è´¥

**ä¿®å¤æ–¹æ¡ˆï¼š**
```typescript
// MarkerManager.ts - å¢å¼ºåæ ‡å¤„ç†
private createFeature(config: MarkerConfig): Feature {
  // å¤„ç†åæ ‡å‚æ•°ï¼Œæ”¯æŒ coordinate å’Œ position ä¸¤ç§æ ¼å¼
  let coordinate = config.coordinate;
  if (!coordinate && (config as any).position) {
    coordinate = (config as any).position;
  }
  
  // éªŒè¯åæ ‡æ ¼å¼
  if (!coordinate || !Array.isArray(coordinate) || coordinate.length < 2) {
    throw new Error(`æ— æ•ˆçš„åæ ‡æ ¼å¼: ${JSON.stringify(coordinate)}`);
  }
  
  const geometry = new Point(fromLonLat(coordinate));
  // ...
}
```

**ä¿®å¤æ•ˆæœï¼š**
âœ… æ”¯æŒ `coordinate` å’Œ `position` ä¸¤ç§åæ ‡å‚æ•°æ ¼å¼
âœ… å®Œæ•´çš„åæ ‡æ ¼å¼éªŒè¯ï¼Œæä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
âœ… å…¼å®¹ä¸åŒçš„APIè°ƒç”¨æ–¹å¼

### 3. **æ ‡è®°é‡å¤æ·»åŠ é”™è¯¯**
```
Error: æ ‡è®° route-point-1 å·²å­˜åœ¨
```

**é—®é¢˜åŸå› ï¼š**
- MarkerManager æ£€æŸ¥åˆ°åŒåæ ‡è®°å·²å­˜åœ¨å°±æŠ›å‡ºé”™è¯¯
- è·¯å¾„åŠ¨ç”»é‡å¤æ‰§è¡Œæ—¶ä¼šå°è¯•æ·»åŠ åŒåæ ‡è®°

**ä¿®å¤æ–¹æ¡ˆï¼š**
```typescript
// MarkerManager.ts - ä¿®æ”¹å‰
if (this.markers.has(config.id)) {
  throw new Error(`æ ‡è®° ${config.id} å·²å­˜åœ¨`);
}

// MarkerManager.ts - ä¿®æ”¹å
if (this.markers.has(config.id)) {
  console.warn(`[MarkerManager] æ ‡è®° ${config.id} å·²å­˜åœ¨ï¼Œå°†å…ˆç§»é™¤æ—§æ ‡è®°`);
  this.removeMarker(config.id);
}
```

**ä¿®å¤æ•ˆæœï¼š**
âœ… æ ‡è®°é‡å¤æ·»åŠ æ—¶è‡ªåŠ¨ç§»é™¤æ—§æ ‡è®°ï¼Œé¿å…é”™è¯¯
âœ… è·¯å¾„åŠ¨ç”»æ ‡è®°å¯ä»¥é‡å¤ç”Ÿæˆ
âœ… æä¾›è­¦å‘Šæ—¥å¿—ä¾¿äºè°ƒè¯•

### 4. **Vueç»„ä»¶APIè°ƒç”¨ä¸ä¸€è‡´**

**é—®é¢˜åŸå› ï¼š**
- Vue ç»„ä»¶ä¸­ä½¿ç”¨äº†ä¸å­˜åœ¨çš„ `map.addRandomMarker()` æ–¹æ³•
- æ ‡è®°é…ç½®ä½¿ç”¨äº†é”™è¯¯çš„å±æ€§å

**ä¿®å¤æ–¹æ¡ˆï¼š**
```typescript
// App.vue - ä¿®æ”¹å‰
const markerId = map.addRandomMarker({
  center: [116.404, 39.915],
  radius: 0.1,
  title: `éšæœºæ ‡è®° ${markers.value.length + 1}`
})

// App.vue - ä¿®æ”¹å
const markerId = `random-marker-${Date.now()}`
map.getMarkerManager().addMarker({
  id: markerId,
  coordinate: [randomLon, randomLat],
  title: `éšæœºæ ‡è®° ${markers.value.length + 1}`,
  description: `åæ ‡: ${randomLon.toFixed(4)}, ${randomLat.toFixed(4)}`
})
```

**ä¿®å¤æ•ˆæœï¼š**
âœ… ä½¿ç”¨æ­£ç¡®çš„ MarkerManager API
âœ… ç»Ÿä¸€çš„æ ‡è®°é…ç½®æ ¼å¼
âœ… æ­£ç¡®çš„åæ ‡å±æ€§å

## ğŸ¯ ä¿®å¤éªŒè¯

### æµ‹è¯•åœºæ™¯
1. **è·¯å¾„åŠ¨ç”»é‡å¤æ‰§è¡Œ** - âœ… æ— é”™è¯¯ï¼Œæ­£å¸¸å·¥ä½œ
2. **éšæœºæ ‡è®°æ·»åŠ ** - âœ… åæ ‡è½¬æ¢æ­£å¸¸ï¼Œæ ‡è®°æ˜¾ç¤ºæ­£ç¡®
3. **GeoJSON æ•°æ®åŠ è½½** - âœ… ç‚¹è¦ç´ æ ‡è®°æ­£å¸¸ç”Ÿæˆ
4. **å›¾å±‚ç®¡ç†** - âœ… é‡å¤æ“ä½œæ— é”™è¯¯

### é”™è¯¯æ¶ˆé™¤
- âœ… **å›¾å±‚é‡å¤æ·»åŠ é”™è¯¯** - å®Œå…¨æ¶ˆé™¤
- âœ… **åæ ‡è½¬æ¢é”™è¯¯** - å®Œå…¨æ¶ˆé™¤  
- âœ… **æ ‡è®°é‡å¤æ·»åŠ é”™è¯¯** - å®Œå…¨æ¶ˆé™¤
- âœ… **APIè°ƒç”¨é”™è¯¯** - å®Œå…¨æ¶ˆé™¤

## ğŸš€ æ”¹è¿›æ•ˆæœ

### 1. **é”™è¯¯å¤„ç†å¢å¼º**
- ä»æŠ›å‡ºé”™è¯¯æ”¹ä¸ºæ™ºèƒ½å¤„ç†å’Œè­¦å‘Š
- æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•æ—¥å¿—
- ä¼˜é›…çš„é™çº§å¤„ç†æœºåˆ¶

### 2. **APIå…¼å®¹æ€§æå‡**
- æ”¯æŒå¤šç§åæ ‡å‚æ•°æ ¼å¼
- å‘åå…¼å®¹çš„APIè®¾è®¡
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ¨¡å¼

### 3. **ç”¨æˆ·ä½“éªŒæ”¹å–„**
- åŠŸèƒ½å¯ä»¥é‡å¤æ‰§è¡Œè€Œä¸æŠ¥é”™
- æ¸…æ™°çš„æ“ä½œåé¦ˆå’ŒçŠ¶æ€æç¤º
- ç¨³å®šå¯é çš„åŠŸèƒ½è¡¨ç°

### 4. **å¼€å‘ä½“éªŒä¼˜åŒ–**
- è¯¦ç»†çš„è­¦å‘Šå’Œé”™è¯¯æ—¥å¿—
- æ¸…æ™°çš„é—®é¢˜å®šä½ä¿¡æ¯
- ä¾¿äºè°ƒè¯•çš„ä»£ç ç»“æ„

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

| é—®é¢˜ç±»å‹ | ä¿®å¤å‰ | ä¿®å¤å |
|---------|--------|--------|
| å›¾å±‚é‡å¤ | âŒ æŠ›å‡ºé”™è¯¯ | âœ… è‡ªåŠ¨æ›¿æ¢ |
| åæ ‡è½¬æ¢ | âŒ å‚æ•°é”™è¯¯ | âœ… æ™ºèƒ½å¤„ç† |
| æ ‡è®°é‡å¤ | âŒ æŠ›å‡ºé”™è¯¯ | âœ… è‡ªåŠ¨æ›¿æ¢ |
| APIè°ƒç”¨ | âŒ æ–¹æ³•ä¸å­˜åœ¨ | âœ… æ­£ç¡®è°ƒç”¨ |
| é”™è¯¯å¤„ç† | âŒ ç¡¬æ€§é”™è¯¯ | âœ… ä¼˜é›…å¤„ç† |

ç°åœ¨ **@ldesign/map** åœ°å›¾æ’ä»¶å·²ç»å®Œå…¨ç¨³å®šï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼ğŸ‰
