<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ°å›¾è°ƒè¯•é¡µé¢</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }
    .debug-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .debug-section {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    .debug-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }
    .debug-result {
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover {
      background: #0056b3;
    }
    #map-container {
      width: 100%;
      height: 300px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="debug-container">
    <h1>ğŸ” åœ°å›¾åŠŸèƒ½è°ƒè¯•</h1>
    
    <div class="debug-section">
      <div class="debug-title">1. æ¨¡å—å¯¼å…¥æµ‹è¯•</div>
      <button onclick="testImports()">æµ‹è¯•å¯¼å…¥</button>
      <div id="import-result" class="debug-result" style="display: none;"></div>
    </div>

    <div class="debug-section">
      <div class="debug-title">2. åº”ç”¨çŠ¶æ€æµ‹è¯•</div>
      <button onclick="testAppState()">æµ‹è¯•åº”ç”¨çŠ¶æ€</button>
      <div id="state-result" class="debug-result" style="display: none;"></div>
    </div>

    <div class="debug-section">
      <div class="debug-title">3. åœ°å›¾ç®¡ç†å™¨æµ‹è¯•</div>
      <button onclick="testMapManager()">æµ‹è¯•åœ°å›¾ç®¡ç†å™¨</button>
      <div id="manager-result" class="debug-result" style="display: none;"></div>
    </div>

    <div class="debug-section">
      <div class="debug-title">4. åœ°å›¾åˆå§‹åŒ–æµ‹è¯•</div>
      <button onclick="testMapInit()">åˆå§‹åŒ–åœ°å›¾</button>
      <button onclick="clearMap()">æ¸…ç†åœ°å›¾</button>
      <div id="map-container"></div>
      <div id="init-result" class="debug-result" style="display: none;"></div>
    </div>
  </div>

  <script type="module">
    let currentApp = null;
    let currentMapInstance = null;

    // æ˜¾ç¤ºç»“æœ
    function showResult(elementId, message, type = 'info') {
      const element = document.getElementById(elementId);
      element.style.display = 'block';
      element.className = `debug-result ${type}`;
      element.textContent = message;
    }

    // æµ‹è¯•æ¨¡å—å¯¼å…¥
    window.testImports = async function() {
      try {
        console.log('ğŸ” å¼€å§‹æµ‹è¯•æ¨¡å—å¯¼å…¥...');
        
        // æµ‹è¯•åœ°å›¾ç®¡ç†å™¨å¯¼å…¥
        const mapManager = await import('./src/map/mapManager.js');
        console.log('âœ… mapManager å¯¼å…¥æˆåŠŸ:', Object.keys(mapManager));
        
        // æµ‹è¯•åº”ç”¨æ¨¡å—å¯¼å…¥
        const appModule = await import('./src/app.js');
        console.log('âœ… app å¯¼å…¥æˆåŠŸ:', Object.keys(appModule));
        
        // æµ‹è¯•ç»„ä»¶å¯¼å…¥
        const headerModule = await import('./src/components/Header.js');
        const configModule = await import('./src/components/ConfigPanel.js');
        const rendererModule = await import('./src/components/MapRenderer.js');
        
        console.log('âœ… ç»„ä»¶å¯¼å…¥æˆåŠŸ');
        
        showResult('import-result', 
          `âœ… æ‰€æœ‰æ¨¡å—å¯¼å…¥æˆåŠŸï¼
mapManager: ${Object.keys(mapManager).join(', ')}
app: ${Object.keys(appModule).join(', ')}
components: Header, ConfigPanel, MapRenderer`, 'success');
        
      } catch (error) {
        console.error('âŒ æ¨¡å—å¯¼å…¥å¤±è´¥:', error);
        showResult('import-result', `âŒ æ¨¡å—å¯¼å…¥å¤±è´¥: ${error.message}\n${error.stack}`, 'error');
      }
    };

    // æµ‹è¯•åº”ç”¨çŠ¶æ€
    window.testAppState = async function() {
      try {
        console.log('ğŸ” å¼€å§‹æµ‹è¯•åº”ç”¨çŠ¶æ€...');
        
        const { createApp } = await import('./src/app.js');
        currentApp = createApp();
        
        const state = currentApp.getState();
        console.log('âœ… åº”ç”¨çŠ¶æ€:', state);
        
        showResult('state-result', 
          `âœ… åº”ç”¨çŠ¶æ€åˆ›å»ºæˆåŠŸï¼
mapConfig: ${JSON.stringify(state.mapConfig, null, 2)}
appliedConfig: ${JSON.stringify(state.appliedConfig, null, 2)}
isFullscreen: ${state.isFullscreen}
sidebarCollapsed: ${state.sidebarCollapsed}`, 'success');
        
      } catch (error) {
        console.error('âŒ åº”ç”¨çŠ¶æ€æµ‹è¯•å¤±è´¥:', error);
        showResult('state-result', `âŒ åº”ç”¨çŠ¶æ€æµ‹è¯•å¤±è´¥: ${error.message}\n${error.stack}`, 'error');
      }
    };

    // æµ‹è¯•åœ°å›¾ç®¡ç†å™¨
    window.testMapManager = async function() {
      try {
        console.log('ğŸ” å¼€å§‹æµ‹è¯•åœ°å›¾ç®¡ç†å™¨...');
        
        const { initializeMap, updateMapConfig, validateMapConfig, getDefaultMapConfig } = await import('./src/map/mapManager.js');
        
        // æµ‹è¯•é»˜è®¤é…ç½®
        const defaultConfig = getDefaultMapConfig();
        console.log('âœ… é»˜è®¤é…ç½®:', defaultConfig);
        
        // æµ‹è¯•é…ç½®éªŒè¯
        const isValid = validateMapConfig(defaultConfig);
        console.log('âœ… é…ç½®éªŒè¯:', isValid);
        
        showResult('manager-result', 
          `âœ… åœ°å›¾ç®¡ç†å™¨æµ‹è¯•æˆåŠŸï¼
å‡½æ•°å¯ç”¨: initializeMap, updateMapConfig, validateMapConfig, getDefaultMapConfig
é»˜è®¤é…ç½®: ${JSON.stringify(defaultConfig, null, 2)}
é…ç½®éªŒè¯: ${isValid}`, 'success');
        
      } catch (error) {
        console.error('âŒ åœ°å›¾ç®¡ç†å™¨æµ‹è¯•å¤±è´¥:', error);
        showResult('manager-result', `âŒ åœ°å›¾ç®¡ç†å™¨æµ‹è¯•å¤±è´¥: ${error.message}\n${error.stack}`, 'error');
      }
    };

    // æµ‹è¯•åœ°å›¾åˆå§‹åŒ–
    window.testMapInit = async function() {
      try {
        console.log('ğŸ” å¼€å§‹æµ‹è¯•åœ°å›¾åˆå§‹åŒ–...');
        
        if (!currentApp) {
          throw new Error('è¯·å…ˆè¿è¡Œåº”ç”¨çŠ¶æ€æµ‹è¯•');
        }
        
        const { initializeMap } = await import('./src/map/mapManager.js');
        const container = document.getElementById('map-container');
        const state = currentApp.getState();
        
        console.log('ğŸ—ºï¸ ä½¿ç”¨é…ç½®:', state.appliedConfig);
        
        showResult('init-result', 'â³ æ­£åœ¨åˆå§‹åŒ–åœ°å›¾...', 'info');
        
        currentMapInstance = await initializeMap(container, state.appliedConfig);
        
        console.log('âœ… åœ°å›¾åˆå§‹åŒ–æˆåŠŸ:', currentMapInstance);
        
        showResult('init-result', 
          `âœ… åœ°å›¾åˆå§‹åŒ–æˆåŠŸï¼
å®ä¾‹ID: ${currentMapInstance.id}
é…ç½®: ${JSON.stringify(currentMapInstance.config, null, 2)}`, 'success');
        
      } catch (error) {
        console.error('âŒ åœ°å›¾åˆå§‹åŒ–å¤±è´¥:', error);
        showResult('init-result', `âŒ åœ°å›¾åˆå§‹åŒ–å¤±è´¥: ${error.message}\n${error.stack}`, 'error');
      }
    };

    // æ¸…ç†åœ°å›¾
    window.clearMap = function() {
      const container = document.getElementById('map-container');
      container.innerHTML = '';
      currentMapInstance = null;
      showResult('init-result', 'ğŸ§¹ åœ°å›¾å·²æ¸…ç†', 'info');
    };

    // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
    window.addEventListener('load', () => {
      console.log('ğŸš€ è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ');
    });
  </script>
</body>
</html>
