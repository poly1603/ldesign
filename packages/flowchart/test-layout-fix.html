<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>节点布局修复测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: #722ed1;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .content {
            padding: 20px;
        }
        
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 20px;
        }
        
        .status.success {
            background: #f6ffed;
            color: #389e0d;
            border: 1px solid #b7eb8f;
        }
        
        .fix-summary {
            background: #f0f5ff;
            border: 1px solid #adc6ff;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .fix-summary h3 {
            margin: 0 0 15px 0;
            color: #1890ff;
        }
        
        .fix-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .fix-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e6f7ff;
            display: flex;
            align-items: center;
        }
        
        .fix-list li:last-child {
            border-bottom: none;
        }
        
        .fix-list li::before {
            content: '✓';
            color: #52c41a;
            font-weight: bold;
            margin-right: 10px;
            font-size: 16px;
        }
        
        .test-instructions {
            background: #fff7e6;
            border: 1px solid #ffd591;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .test-instructions h3 {
            margin: 0 0 15px 0;
            color: #d46b08;
        }
        
        .test-steps {
            list-style: decimal;
            padding-left: 20px;
            margin: 0;
        }
        
        .test-steps li {
            padding: 5px 0;
            color: #8c4a00;
        }
        
        .code-block {
            background: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 15px 0;
            overflow-x: auto;
        }
        
        .technical-details {
            background: #fafafa;
            border: 1px solid #e5e5e5;
            border-radius: 6px;
            padding: 20px;
        }
        
        .technical-details h3 {
            margin: 0 0 15px 0;
            color: #262626;
        }
        
        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .file-item {
            background: white;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            padding: 12px;
        }
        
        .file-name {
            font-weight: 600;
            color: #1890ff;
            margin-bottom: 5px;
        }
        
        .file-desc {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎉 节点布局修复完成</h1>
            <p>图标和文本重叠问题已解决</p>
        </div>
        
        <div class="content">
            <div class="status success">
                ✅ 修复完成 - 所有节点类型的图标和文本现在正确对齐
            </div>
            
            <div class="fix-summary">
                <h3>修复内容总结</h3>
                <ul class="fix-list">
                    <li>创建了 SimpleNodeLayout 工具类，统一管理节点布局</li>
                    <li>修复了 StartNode（开始节点）的图标和文本重叠问题</li>
                    <li>修复了 EndNode（结束节点）的图标和文本重叠问题</li>
                    <li>修复了 ProcessNode（处理节点）的图标和文本重叠问题</li>
                    <li>修复了 UserTaskNode（用户任务节点）的图标和文本重叠问题</li>
                    <li>修复了 ServiceTaskNode（服务任务节点）的图标和文本重叠问题</li>
                    <li>修复了 ConditionNode（条件节点）的图标和文本重叠问题</li>
                    <li>修复了 CustomMaterialNode（自定义物料节点）的图标和文本重叠问题</li>
                    <li>确保所有节点的图标在上方，文本在下方，水平垂直居中对齐</li>
                </ul>
            </div>
            
            <div class="test-instructions">
                <h3>测试步骤</h3>
                <ol class="test-steps">
                    <li>启动流程图编辑器应用</li>
                    <li>从左侧物料面板拖拽各种节点类型到画布</li>
                    <li>验证每个节点的图标都在上方，文本都在下方</li>
                    <li>确认图标和文本之间有适当的间距，不再重叠</li>
                    <li>检查不同节点类型的布局一致性</li>
                    <li>测试节点的编辑和交互功能是否正常</li>
                </ol>
            </div>
            
            <div class="technical-details">
                <h3>技术实现细节</h3>
                
                <h4>核心修复方案</h4>
                <div class="code-block">
// SimpleNodeLayout 工具类
export class SimpleNodeLayout {
  // 计算圆形节点布局
  static calculateCircleLayout(radius: number): SimpleLayoutResult {
    const iconOffsetY = -Math.max(8, radius * 0.3)  // 图标向上偏移
    const textOffsetY = Math.max(12, radius * 0.4)   // 文本向下偏移
    return { iconOffsetY, textOffsetY }
  }
  
  // 计算矩形节点布局
  static calculateRectLayout(width: number, height: number): SimpleLayoutResult {
    const iconOffsetY = -Math.max(8, height * 0.25) // 图标向上偏移
    const textOffsetY = Math.max(12, height * 0.3)   // 文本向下偏移
    return { iconOffsetY, textOffsetY }
  }
}
                </div>
                
                <h4>修复的文件列表</h4>
                <div class="file-list">
                    <div class="file-item">
                        <div class="file-name">SimpleNodeLayout.ts</div>
                        <div class="file-desc">新增 - 简化的节点布局计算工具</div>
                    </div>
                    <div class="file-item">
                        <div class="file-name">StartNode.ts</div>
                        <div class="file-desc">修复 - 开始节点的图标和文本布局</div>
                    </div>
                    <div class="file-item">
                        <div class="file-name">EndNode.ts</div>
                        <div class="file-desc">修复 - 结束节点的图标和文本布局</div>
                    </div>
                    <div class="file-item">
                        <div class="file-name">ProcessNode.ts</div>
                        <div class="file-desc">修复 - 处理节点的图标和文本布局</div>
                    </div>
                    <div class="file-item">
                        <div class="file-name">UserTaskNode.ts</div>
                        <div class="file-desc">修复 - 用户任务节点的图标和文本布局</div>
                    </div>
                    <div class="file-item">
                        <div class="file-name">ServiceTaskNode.ts</div>
                        <div class="file-desc">修复 - 服务任务节点的图标和文本布局</div>
                    </div>
                    <div class="file-item">
                        <div class="file-name">ConditionNode.ts</div>
                        <div class="file-desc">修复 - 条件节点的图标和文本布局</div>
                    </div>
                    <div class="file-item">
                        <div class="file-name">CustomMaterialNode.ts</div>
                        <div class="file-desc">修复 - 自定义物料节点的图标和文本布局</div>
                    </div>
                </div>
                
                <h4>布局策略</h4>
                <ul>
                    <li><strong>圆形节点</strong>：图标偏移 -8px 到 -radius*0.3，文本偏移 +12px 到 +radius*0.4</li>
                    <li><strong>矩形节点</strong>：图标偏移 -8px 到 -height*0.25，文本偏移 +12px 到 +height*0.3</li>
                    <li><strong>菱形节点</strong>：图标偏移 -6px 到 -ry*0.4，文本偏移 +10px 到 +ry*0.5</li>
                    <li><strong>水平居中</strong>：所有图标和文本都相对于节点中心水平居中</li>
                </ul>
            </div>
            
            <div style="text-align: center; margin-top: 30px; padding: 20px; background: #f6ffed; border-radius: 6px;">
                <h3 style="color: #389e0d; margin: 0 0 10px 0;">🎯 修复完成</h3>
                <p style="margin: 0; color: #135200;">
                    现在拖拽物料到画布时，所有节点的图标和文本都会正确对齐，不再出现重叠或偏上的问题！
                </p>
            </div>
        </div>
    </div>
</body>
</html>
