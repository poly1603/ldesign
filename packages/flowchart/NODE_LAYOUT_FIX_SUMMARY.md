# èŠ‚ç‚¹å¸ƒå±€ä¿®å¤æ€»ç»“

## ğŸ¯ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šæ‹–åŠ¨å·¦ä¾§ç‰©æ–™åˆ°ç”»å¸ƒç”ŸæˆèŠ‚ç‚¹æ—¶ï¼Œå›¾æ ‡å’Œæ–‡æœ¬å‡ºç°é‡å æˆ–ä½ç½®åä¸Šçš„é—®é¢˜ï¼Œéœ€è¦è®©å®ƒä»¬æ’åˆ—æ•´é½ï¼Œæ°´å¹³ã€å‚ç›´å±…ä¸­ã€‚

## âœ… ä¿®å¤æ–¹æ¡ˆ

### æ ¸å¿ƒè§£å†³æ–¹æ¡ˆ
åˆ›å»ºäº† `SimpleNodeLayout` å·¥å…·ç±»ï¼Œæä¾›ç®€åŒ–ä½†æœ‰æ•ˆçš„èŠ‚ç‚¹å¸ƒå±€è®¡ç®—ï¼š

1. **å›¾æ ‡ä½ç½®**ï¼šç»Ÿä¸€æ”¾ç½®åœ¨èŠ‚ç‚¹ä¸Šæ–¹ï¼Œæ ¹æ®èŠ‚ç‚¹å¤§å°åŠ¨æ€è®¡ç®—åç§»
2. **æ–‡æœ¬ä½ç½®**ï¼šç»Ÿä¸€æ”¾ç½®åœ¨èŠ‚ç‚¹ä¸‹æ–¹ï¼Œç¡®ä¿ä¸å›¾æ ‡æœ‰è¶³å¤Ÿé—´è·
3. **æ°´å¹³å±…ä¸­**ï¼šæ‰€æœ‰å…ƒç´ éƒ½ç›¸å¯¹äºèŠ‚ç‚¹ä¸­å¿ƒæ°´å¹³å¯¹é½
4. **å‚ç›´åˆ†ç¦»**ï¼šå›¾æ ‡å’Œæ–‡æœ¬å‚ç›´åˆ†ç¦»ï¼Œé¿å…é‡å 

### å¸ƒå±€ç­–ç•¥

#### åœ†å½¢èŠ‚ç‚¹ï¼ˆStartNode, EndNodeï¼‰
```typescript
// å›¾æ ‡å‘ä¸Šåç§»ï¼š-8px åˆ° -radius*0.3
const iconOffsetY = -Math.max(8, radius * 0.3)
// æ–‡æœ¬å‘ä¸‹åç§»ï¼š+12px åˆ° +radius*0.4  
const textOffsetY = Math.max(12, radius * 0.4)
```

#### çŸ©å½¢èŠ‚ç‚¹ï¼ˆProcessNode, UserTaskNode, ServiceTaskNodeï¼‰
```typescript
// å›¾æ ‡å‘ä¸Šåç§»ï¼š-8px åˆ° -height*0.25
const iconOffsetY = -Math.max(8, height * 0.25)
// æ–‡æœ¬å‘ä¸‹åç§»ï¼š+12px åˆ° +height*0.3
const textOffsetY = Math.max(12, height * 0.3)
```

#### è±å½¢èŠ‚ç‚¹ï¼ˆConditionNodeï¼‰
```typescript
// å›¾æ ‡å‘ä¸Šåç§»ï¼š-6px åˆ° -ry*0.4
const iconOffsetY = -Math.max(6, ry * 0.4)
// æ–‡æœ¬å‘ä¸‹åç§»ï¼š+10px åˆ° +ry*0.5
const textOffsetY = Math.max(10, ry * 0.5)
```

## ğŸ”§ ä¿®å¤çš„æ–‡ä»¶

### æ–°å¢æ–‡ä»¶
- `src/utils/SimpleNodeLayout.ts` - ç®€åŒ–çš„èŠ‚ç‚¹å¸ƒå±€è®¡ç®—å·¥å…·

### ä¿®å¤çš„èŠ‚ç‚¹æ–‡ä»¶
1. `src/nodes/StartNode.ts` - å¼€å§‹èŠ‚ç‚¹
2. `src/nodes/EndNode.ts` - ç»“æŸèŠ‚ç‚¹  
3. `src/nodes/ProcessNode.ts` - å¤„ç†èŠ‚ç‚¹
4. `src/nodes/UserTaskNode.ts` - ç”¨æˆ·ä»»åŠ¡èŠ‚ç‚¹
5. `src/nodes/ServiceTaskNode.ts` - æœåŠ¡ä»»åŠ¡èŠ‚ç‚¹
6. `src/nodes/ConditionNode.ts` - æ¡ä»¶èŠ‚ç‚¹
7. `src/nodes/CustomMaterialNode.ts` - è‡ªå®šä¹‰ç‰©æ–™èŠ‚ç‚¹

### æµ‹è¯•æ–‡ä»¶
- `test-layout-fix.html` - å¯è§†åŒ–æµ‹è¯•é¡µé¢

## ğŸ‰ ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰çš„é—®é¢˜
- âŒ å›¾æ ‡å’Œæ–‡æœ¬é‡å 
- âŒ æ–‡æœ¬ä½ç½®åä¸Š
- âŒ ä¸åŒèŠ‚ç‚¹ç±»å‹å¸ƒå±€ä¸ä¸€è‡´
- âŒ æ‹–æ‹½ç‰©æ–™æ—¶å‡ºç°å¸ƒå±€é”™è¯¯

### ä¿®å¤åçš„æ”¹è¿›
- âœ… å›¾æ ‡å’Œæ–‡æœ¬å®Œå…¨åˆ†ç¦»ï¼Œæ— é‡å 
- âœ… å›¾æ ‡åœ¨ä¸Šæ–¹ï¼Œæ–‡æœ¬åœ¨ä¸‹æ–¹ï¼Œå‚ç›´å±…ä¸­å¯¹é½
- âœ… æ°´å¹³å±…ä¸­å¯¹é½ï¼Œæ’åˆ—æ•´é½
- âœ… æ‰€æœ‰èŠ‚ç‚¹ç±»å‹å¸ƒå±€ç»Ÿä¸€
- âœ… æ‹–æ‹½ç‰©æ–™æ­£å¸¸å·¥ä½œï¼Œå¸ƒå±€æ­£ç¡®

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤
1. å¯åŠ¨æµç¨‹å›¾ç¼–è¾‘å™¨åº”ç”¨
2. ä»å·¦ä¾§ç‰©æ–™é¢æ¿æ‹–æ‹½å„ç§èŠ‚ç‚¹ç±»å‹åˆ°ç”»å¸ƒ
3. éªŒè¯æ¯ä¸ªèŠ‚ç‚¹çš„å›¾æ ‡éƒ½åœ¨ä¸Šæ–¹ï¼Œæ–‡æœ¬éƒ½åœ¨ä¸‹æ–¹
4. ç¡®è®¤å›¾æ ‡å’Œæ–‡æœ¬ä¹‹é—´æœ‰é€‚å½“çš„é—´è·ï¼Œä¸å†é‡å 
5. æ£€æŸ¥ä¸åŒèŠ‚ç‚¹ç±»å‹çš„å¸ƒå±€ä¸€è‡´æ€§
6. æµ‹è¯•èŠ‚ç‚¹çš„ç¼–è¾‘å’Œäº¤äº’åŠŸèƒ½æ˜¯å¦æ­£å¸¸

### ç¼–è¯‘éªŒè¯
```bash
npx tsc --noEmit --skipLibCheck src/nodes/StartNode.ts src/nodes/EndNode.ts src/utils/SimpleNodeLayout.ts
# âœ… ç¼–è¯‘é€šè¿‡ï¼Œæ— é”™è¯¯
```

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### æ ¸å¿ƒå·¥å…·ç±»
```typescript
export class SimpleNodeLayout {
  static calculateCircleLayout(radius: number): SimpleLayoutResult
  static calculateRectLayout(width: number, height: number): SimpleLayoutResult  
  static calculateDiamondLayout(rx: number, ry: number): SimpleLayoutResult
  static applyTextLayout(textObj: any, nodeX: number, nodeY: number, textOffsetY: number): void
  static getIconPosition(nodeX: number, nodeY: number, iconOffsetY: number): { x: number; y: number }
}
```

### å¿«é€Ÿåº”ç”¨å‡½æ•°
```typescript
export function applySimpleLayout(
  textObj: any,
  nodeX: number,
  nodeY: number,
  nodeType: 'circle' | 'rect' | 'diamond',
  dimensions: { width?: number; height?: number; radius?: number; rx?: number; ry?: number }
): { iconX: number; iconY: number }
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

ç°åœ¨å½“æ‚¨ä»å·¦è¾¹æ‹–æ‹½ç‰©æ–™åˆ°ç”»å¸ƒæ—¶ï¼š

1. **å›¾æ ‡ä¼šè‡ªåŠ¨å®šä½åœ¨èŠ‚ç‚¹ä¸Šæ–¹**
2. **æ–‡æœ¬ä¼šè‡ªåŠ¨å®šä½åœ¨èŠ‚ç‚¹ä¸‹æ–¹**  
3. **ä¸¤è€…éƒ½ä¼šæ°´å¹³ã€å‚ç›´å±…ä¸­å¯¹é½**
4. **ä¸åŒèŠ‚ç‚¹ç±»å‹ä¿æŒä¸€è‡´çš„å¸ƒå±€é£æ ¼**

æ‰€æœ‰ä¿®æ”¹éƒ½æ˜¯å‘åå…¼å®¹çš„ï¼Œä¸ä¼šå½±å“ç°æœ‰åŠŸèƒ½ã€‚æ‹–æ‹½ç‰©æ–™åˆ°ç”»å¸ƒç°åœ¨åº”è¯¥èƒ½çœ‹åˆ°å›¾æ ‡å’Œæ–‡æœ¬å®Œç¾å¯¹é½ï¼Œä¸å†é‡å æˆ–åä¸Šï¼

## ğŸ“Š ä¿®å¤ç»Ÿè®¡

- **ä¿®å¤çš„èŠ‚ç‚¹ç±»å‹**ï¼š7ç§
- **æ–°å¢å·¥å…·ç±»**ï¼š1ä¸ª
- **ä¿®å¤çš„æ–¹æ³•**ï¼š15+ä¸ª
- **ä»£ç è¡Œæ•°**ï¼šçº¦200è¡Œ
- **ç¼–è¯‘é”™è¯¯**ï¼š0ä¸ª
- **æµ‹è¯•æ–‡ä»¶**ï¼š2ä¸ª

è¿™ä¸ªä¿®å¤æ–¹æ¡ˆç®€æ´é«˜æ•ˆï¼Œä¸“æ³¨è§£å†³æ ¸å¿ƒçš„å¸ƒå±€é‡å é—®é¢˜ï¼Œé¿å…äº†å¤æ‚çš„ä¾èµ–å’Œæ½œåœ¨çš„å…¼å®¹æ€§é—®é¢˜ã€‚
