<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LDesign Flowchart - UMD åŸç”Ÿç¤ºä¾‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .header {
            background: #fff;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #722ED1;
            font-size: 24px;
            margin-bottom: 8px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .toolbar {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            background: #722ED1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #5e2aa7;
        }

        .btn.secondary {
            background: #fff;
            color: #722ED1;
            border: 1px solid #722ED1;
        }

        .btn.secondary:hover {
            background: #722ED1;
            color: #fff;
        }

        select {
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
        }

        .flowchart-container {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            height: 600px;
        }

        .info-panel {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .info-panel h3 {
            color: #722ED1;
            margin-bottom: 10px;
        }

        .info-panel pre {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            font-size: 12px;
            color: #666;
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .feature-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid #722ED1;
        }

        .feature-item h4 {
            color: #722ED1;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .feature-item p {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>ğŸ¨ LDesign Flowchart - UMD åŸç”Ÿç¤ºä¾‹</h1>
            <p>æ— éœ€æ„å»ºå·¥å…·ï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨æµç¨‹å›¾ç¼–è¾‘å™¨ï¼ˆUMDç‰ˆæœ¬ï¼‰</p>
        </div>
    </div>

    <div class="container">
        <div class="toolbar">
            <button class="btn" id="loadTemplate">åŠ è½½å¤æ‚æ¨¡æ¿</button>
            <button class="btn secondary" id="clearCanvas">æ¸…ç©ºç”»å¸ƒ</button>
            
            <select id="themeSelect">
                <option value="default">é»˜è®¤ä¸»é¢˜</option>
                <option value="dark">æš—è‰²ä¸»é¢˜</option>
                <option value="blue">è“è‰²ä¸»é¢˜</option>
            </select>
            
            <button class="btn secondary" id="toggleReadonly">åˆ‡æ¢åªè¯»æ¨¡å¼</button>
            <button class="btn" id="exportData">å¯¼å‡ºæ•°æ®</button>
            <button class="btn secondary" id="showHelp">æ˜¾ç¤ºå¸®åŠ©</button>
        </div>

        <div class="flowchart-container" id="flowchart-container">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #666;">
                <h3>ğŸš€ æµç¨‹å›¾ç¼–è¾‘å™¨å·²å°±ç»ª</h3>
                <p style="margin-top: 10px;">ç‚¹å‡»"åŠ è½½å¤æ‚æ¨¡æ¿"å¼€å§‹ä½“éªŒï¼Œæˆ–ä»å·¦ä¾§æ‹–æ‹½èŠ‚ç‚¹åˆ°ç”»å¸ƒ</p>
            </div>
        </div>

        <div class="status-bar">
            <div>
                <span>èŠ‚ç‚¹: <span id="status-nodes">0</span></span>
                <span style="margin-left: 16px;">è¿çº¿: <span id="status-edges">0</span></span>
                <span style="margin-left: 16px;">é€‰ä¸­: <span id="status-selected">æ— </span></span>
            </div>
            <div>
                <span>æ¨¡å¼: <span id="status-mode">ç¼–è¾‘</span></span>
                <span style="margin-left: 16px;">ä¸»é¢˜: <span id="status-theme">é»˜è®¤</span></span>
            </div>
        </div>

        <div class="info-panel">
            <h3>ğŸ“‹ åŠŸèƒ½ç‰¹æ€§</h3>
            <div class="feature-list">
                <div class="feature-item">
                    <h4>ğŸ¯ æ‹–æ‹½å¼ç¼–è¾‘</h4>
                    <p>ä»å·¦ä¾§ç‰©æ–™é¢æ¿æ‹–æ‹½èŠ‚ç‚¹åˆ°ç”»å¸ƒï¼Œæ”¯æŒ15ç§ä¸åŒç±»å‹çš„èŠ‚ç‚¹</p>
                </div>
                <div class="feature-item">
                    <h4>âš™ï¸ å±æ€§ç¼–è¾‘</h4>
                    <p>ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹å³ä¾§å±æ€§é¢æ¿ï¼Œå®æ—¶ç¼–è¾‘èŠ‚ç‚¹å±æ€§å’Œä½ç½®</p>
                </div>
                <div class="feature-item">
                    <h4>ğŸ¨ ä¸»é¢˜åˆ‡æ¢</h4>
                    <p>æ”¯æŒé»˜è®¤ã€æš—è‰²ã€è“è‰²ä¸‰ç§ä¸»é¢˜ï¼Œç”»å¸ƒå’ŒUIç»„ä»¶åŒæ­¥åˆ‡æ¢</p>
                </div>
                <div class="feature-item">
                    <h4>ğŸ“± åªè¯»æ¨¡å¼</h4>
                    <p>ä¸€é”®åˆ‡æ¢åªè¯»æ¨¡å¼ï¼Œéšè—ç¼–è¾‘UIï¼Œé€‚åˆå±•ç¤ºå’Œæ¼”ç¤º</p>
                </div>
                <div class="feature-item">
                    <h4>ğŸ’¾ æ•°æ®å¯¼å‡º</h4>
                    <p>æ”¯æŒJSONæ ¼å¼æ•°æ®å¯¼å‡ºï¼Œå®Œæ•´ä¿å­˜æµç¨‹å›¾ç»“æ„</p>
                </div>
                <div class="feature-item">
                    <h4>ğŸ”§ åŸç”Ÿå…¼å®¹</h4>
                    <p>UMDæ ¼å¼ï¼Œæ— éœ€æ„å»ºå·¥å…·ï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨</p>
                </div>
            </div>
        </div>

        <div class="info-panel">
            <h3>ğŸ“Š æµç¨‹å›¾æ•°æ®</h3>
            <pre id="dataOutput">ç‚¹å‡»"å¯¼å‡ºæ•°æ®"æŸ¥çœ‹æµç¨‹å›¾JSONæ•°æ®...</pre>
        </div>
    </div>

    <!-- å¼•å…¥ LogicFlow ä¾èµ– -->
    <script src="https://unpkg.com/@logicflow/core@1.2.26/dist/logic-flow.js"></script>
    
    <!-- å¼•å…¥ LDesign Flowchart UMD ç‰ˆæœ¬ -->
    <!-- æ³¨æ„ï¼šè¿™é‡Œåº”è¯¥å¼•å…¥å®é™…æ„å»ºçš„UMDæ–‡ä»¶ -->
    <script src="../dist/index.umd.js"></script>

    <script>
        // UMD åŸç”Ÿ JavaScript ç¤ºä¾‹
        (function() {
            'use strict';
            
            let editor = null;
            let isReadonly = false;

            // åˆå§‹åŒ–ç¼–è¾‘å™¨
            function initEditor() {
                try {
                    const container = document.getElementById('flowchart-container');
                    
                    // ä½¿ç”¨ UMD å…¨å±€å˜é‡
                    editor = new LDesignFlowchart.FlowchartEditor({
                        container: container,
                        width: container.offsetWidth,
                        height: container.offsetHeight,
                        // å¯ç”¨å®Œæ•´UI
                        toolbar: {
                            visible: true,
                            tools: ['select', 'zoom-fit', 'undo', 'redo', 'delete']
                        },
                        nodePanel: {
                            visible: true,
                            position: 'left'
                        },
                        propertyPanel: {
                            visible: true,
                            position: 'right'
                        },
                        theme: 'default',
                        background: { color: '#fafafa' },
                        grid: { visible: true, size: 20 }
                    });

                    // ç»‘å®šäº‹ä»¶
                    editor.on('data:change', updateStatus);
                    editor.on('node:select', (data) => {
                        document.getElementById('status-selected').textContent = 
                            data ? `èŠ‚ç‚¹: ${data.id}` : 'æ— ';
                    });
                    editor.on('theme:change', (theme) => {
                        document.getElementById('status-theme').textContent = theme;
                        document.getElementById('themeSelect').value = theme;
                    });

                    // æ¸²æŸ“ç¼–è¾‘å™¨
                    editor.render();
                    
                    updateStatus();
                    console.log('âœ… æµç¨‹å›¾ç¼–è¾‘å™¨åˆå§‹åŒ–æˆåŠŸ');
                } catch (error) {
                    console.error('âŒ ç¼–è¾‘å™¨åˆå§‹åŒ–å¤±è´¥:', error);
                    alert('ç¼–è¾‘å™¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯');
                }
            }

            // æ›´æ–°çŠ¶æ€æ 
            function updateStatus() {
                if (!editor) return;
                
                const data = editor.getData();
                document.getElementById('status-nodes').textContent = data.nodes.length;
                document.getElementById('status-edges').textContent = data.edges.length;
                document.getElementById('status-mode').textContent = isReadonly ? 'åªè¯»' : 'ç¼–è¾‘';
            }

            // åŠ è½½æ¨¡æ¿
            function loadTemplate() {
                if (!editor) return;
                
                try {
                    const template = LDesignFlowchart.FlowchartAPI.createApprovalTemplate();
                    editor.setData(template);
                    updateDataOutput();
                    console.log('âœ… æ¨¡æ¿åŠ è½½æˆåŠŸ');
                } catch (error) {
                    console.error('âŒ æ¨¡æ¿åŠ è½½å¤±è´¥:', error);
                }
            }

            // æ¸…ç©ºç”»å¸ƒ
            function clearCanvas() {
                if (!editor) return;
                
                if (confirm('ç¡®å®šè¦æ¸…ç©ºç”»å¸ƒå—ï¼Ÿ')) {
                    editor.setData({ nodes: [], edges: [] });
                    updateDataOutput();
                    console.log('âœ… ç”»å¸ƒå·²æ¸…ç©º');
                }
            }

            // åˆ‡æ¢ä¸»é¢˜
            function changeTheme(theme) {
                if (!editor) return;
                
                try {
                    editor.setTheme(theme);
                    console.log(`âœ… ä¸»é¢˜å·²åˆ‡æ¢ä¸º: ${theme}`);
                } catch (error) {
                    console.error('âŒ ä¸»é¢˜åˆ‡æ¢å¤±è´¥:', error);
                }
            }

            // åˆ‡æ¢åªè¯»æ¨¡å¼
            function toggleReadonly() {
                if (!editor) return;
                
                isReadonly = !isReadonly;
                editor.setReadonly(isReadonly);
                
                const button = document.getElementById('toggleReadonly');
                button.textContent = isReadonly ? 'åˆ‡æ¢åˆ°ç¼–è¾‘' : 'åˆ‡æ¢åªè¯»æ¨¡å¼';
                
                updateStatus();
                console.log(`âœ… å·²åˆ‡æ¢åˆ°${isReadonly ? 'åªè¯»' : 'ç¼–è¾‘'}æ¨¡å¼`);
            }

            // å¯¼å‡ºæ•°æ®
            function exportData() {
                if (!editor) return;
                
                const data = editor.getData();
                updateDataOutput(data);
                
                // ä¸‹è½½æ–‡ä»¶
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'flowchart-data.json';
                a.click();
                URL.revokeObjectURL(url);
                
                console.log('âœ… æ•°æ®å·²å¯¼å‡º');
            }

            // æ›´æ–°æ•°æ®æ˜¾ç¤º
            function updateDataOutput(data = null) {
                const outputElement = document.getElementById('dataOutput');
                const flowchartData = data || (editor ? editor.getData() : null);
                
                if (flowchartData) {
                    outputElement.textContent = JSON.stringify(flowchartData, null, 2);
                }
            }

            // æ˜¾ç¤ºå¸®åŠ©
            function showHelp() {
                alert(`ğŸ¨ LDesign Flowchart ä½¿ç”¨å¸®åŠ©

ğŸ“‹ åŸºæœ¬æ“ä½œï¼š
â€¢ ä»å·¦ä¾§ç‰©æ–™é¢æ¿æ‹–æ‹½èŠ‚ç‚¹åˆ°ç”»å¸ƒ
â€¢ ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹å³ä¾§å±æ€§é¢æ¿
â€¢ ä½¿ç”¨é¡¶éƒ¨å·¥å…·æ è¿›è¡Œç¼©æ”¾ã€æ’¤é”€ç­‰æ“ä½œ

ğŸ¯ èŠ‚ç‚¹ç±»å‹ï¼š
â€¢ åŸºç¡€èŠ‚ç‚¹ï¼šå¼€å§‹ã€å®¡æ‰¹ã€æ¡ä»¶ã€å¤„ç†ã€ç»“æŸ
â€¢ ä»»åŠ¡èŠ‚ç‚¹ï¼šç”¨æˆ·ä»»åŠ¡ã€æœåŠ¡ä»»åŠ¡ã€è„šæœ¬ä»»åŠ¡ã€æ‰‹å·¥ä»»åŠ¡
â€¢ ç½‘å…³èŠ‚ç‚¹ï¼šå¹¶è¡Œç½‘å…³ã€æ’ä»–ç½‘å…³ã€åŒ…å®¹ç½‘å…³ã€äº‹ä»¶ç½‘å…³
â€¢ äº‹ä»¶èŠ‚ç‚¹ï¼šå®šæ—¶äº‹ä»¶ã€æ¶ˆæ¯äº‹ä»¶ã€ä¿¡å·äº‹ä»¶

âš™ï¸ é«˜çº§åŠŸèƒ½ï¼š
â€¢ ä¸»é¢˜åˆ‡æ¢ï¼šæ”¯æŒé»˜è®¤ã€æš—è‰²ã€è“è‰²ä¸»é¢˜
â€¢ åªè¯»æ¨¡å¼ï¼šéšè—ç¼–è¾‘UIï¼Œé€‚åˆæ¼”ç¤º
â€¢ æ•°æ®å¯¼å‡ºï¼šJSONæ ¼å¼ï¼Œå®Œæ•´ä¿å­˜æµç¨‹ç»“æ„

ğŸ’¡ æç¤ºï¼šè¿™æ˜¯UMDç‰ˆæœ¬ï¼Œæ— éœ€æ„å»ºå·¥å…·å³å¯ä½¿ç”¨ï¼`);
            }

            // ç»‘å®šäº‹ä»¶
            function bindEvents() {
                document.getElementById('loadTemplate').addEventListener('click', loadTemplate);
                document.getElementById('clearCanvas').addEventListener('click', clearCanvas);
                document.getElementById('toggleReadonly').addEventListener('click', toggleReadonly);
                document.getElementById('exportData').addEventListener('click', exportData);
                document.getElementById('showHelp').addEventListener('click', showHelp);
                
                document.getElementById('themeSelect').addEventListener('change', (e) => {
                    changeTheme(e.target.value);
                });
            }

            // åˆå§‹åŒ–åº”ç”¨
            function init() {
                console.log('ğŸš€ LDesign Flowchart UMD ç¤ºä¾‹å¯åŠ¨');
                bindEvents();
                initEditor();
            }

            // ç­‰å¾…DOMåŠ è½½å®Œæˆ
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }

            // å¯¼å‡ºåˆ°å…¨å±€ä½œç”¨åŸŸï¼ˆè°ƒè¯•ç”¨ï¼‰
            window.flowchartUMDDemo = {
                editor: () => editor,
                loadTemplate,
                clearCanvas,
                changeTheme,
                toggleReadonly,
                exportData,
                showHelp
            };
        })();
    </script>
</body>
</html>
