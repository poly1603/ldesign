<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å°åœ°å›¾åŠŸèƒ½æµ‹è¯•</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .header {
      padding: 20px;
      background: linear-gradient(135deg, #722ed1, #9254de);
      color: white;
    }
    
    .header h1 {
      margin: 0 0 10px 0;
      font-size: 24px;
    }
    
    .header p {
      margin: 0;
      opacity: 0.9;
    }
    
    .controls {
      padding: 20px;
      border-bottom: 1px solid #e5e5e5;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 8px 16px;
      border: 1px solid #d9d9d9;
      background: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .btn:hover {
      border-color: #722ed1;
      color: #722ed1;
    }
    
    .btn.primary {
      background: #722ed1;
      border-color: #722ed1;
      color: white;
    }
    
    .btn.primary:hover {
      background: #9254de;
      border-color: #9254de;
    }
    
    .editor-container {
      height: 600px;
      position: relative;
      border: 1px solid #e5e5e5;
    }
    
    .status {
      padding: 15px 20px;
      background: #f8f9fa;
      border-top: 1px solid #e5e5e5;
      font-size: 14px;
      color: #666;
    }
    
    .test-info {
      padding: 20px;
      background: #f0f7ff;
      border-left: 4px solid #1890ff;
      margin: 20px;
    }
    
    .test-info h3 {
      margin: 0 0 10px 0;
      color: #1890ff;
    }
    
    .test-info ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    
    .test-info li {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ—ºï¸ å°åœ°å›¾åŠŸèƒ½æµ‹è¯•</h1>
      <p>æµ‹è¯•å°åœ°å›¾çš„å®æ—¶åŒæ­¥ã€å¯¼èˆªåŠŸèƒ½å’Œè§†å£æ˜¾ç¤º</p>
    </div>
    
    <div class="test-info">
      <h3>ğŸ¯ æµ‹è¯•åŠŸèƒ½æ¸…å•</h3>
      <ul>
        <li><strong>å®æ—¶å†…å®¹åŒæ­¥</strong>ï¼šæ·»åŠ /åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œå°åœ°å›¾ç«‹å³æ›´æ–°</li>
        <li><strong>è§†å£çª—å£æ˜¾ç¤º</strong>ï¼šç´«è‰²è¾¹æ¡†å‡†ç¡®æ˜¾ç¤ºå½“å‰å¯è§†åŒºåŸŸ</li>
        <li><strong>ç‚¹å‡»å¯¼èˆª</strong>ï¼šç‚¹å‡»å°åœ°å›¾ä»»æ„ä½ç½®ï¼Œä¸»ç”»å¸ƒè·³è½¬åˆ°å¯¹åº”åŒºåŸŸ</li>
        <li><strong>æ‹–æ‹½å¯¼èˆª</strong>ï¼šæ‹–æ‹½è§†å£çª—å£ï¼Œä¸»ç”»å¸ƒå¹³æ»‘è·Ÿéš</li>
        <li><strong>ç¼©æ”¾åŒæ­¥</strong>ï¼šä¸»ç”»å¸ƒç¼©æ”¾æ—¶ï¼Œè§†å£çª—å£å¤§å°åŒæ­¥è°ƒæ•´</li>
        <li><strong>èŠ‚ç‚¹ç±»å‹åŒºåˆ†</strong>ï¼šä¸åŒç±»å‹èŠ‚ç‚¹æ˜¾ç¤ºä¸åŒé¢œè‰²å’Œå½¢çŠ¶</li>
      </ul>
    </div>
    
    <div class="controls">
      <button class="btn primary" onclick="addSampleNodes()">â• æ·»åŠ ç¤ºä¾‹èŠ‚ç‚¹</button>
      <button class="btn" onclick="addRandomNode()">ğŸ² æ·»åŠ éšæœºèŠ‚ç‚¹</button>
      <button class="btn" onclick="connectNodes()">ğŸ”— è¿æ¥èŠ‚ç‚¹</button>
      <button class="btn" onclick="testNavigation()">ğŸ§­ æµ‹è¯•å¯¼èˆª</button>
      <button class="btn" onclick="testZoom()">ğŸ” æµ‹è¯•ç¼©æ”¾</button>
      <button class="btn" onclick="clearCanvas()">ğŸ§¹ æ¸…ç©ºç”»å¸ƒ</button>
      <button class="btn" onclick="toggleMiniMap()">ğŸ‘ï¸ åˆ‡æ¢å°åœ°å›¾</button>
    </div>
    
    <div class="editor-container" id="editor-container">
      <!-- æµç¨‹å›¾ç¼–è¾‘å™¨å°†åœ¨è¿™é‡Œåˆå§‹åŒ– -->
    </div>
    
    <div class="status" id="status">
      å‡†å¤‡å°±ç»ª - ç­‰å¾…åˆå§‹åŒ–ç¼–è¾‘å™¨
    </div>
  </div>

  <script type="module">
    import { FlowchartEditor } from '../src/index.js'
    
    let editor = null
    let nodeCounter = 0
    
    // åˆå§‹åŒ–ç¼–è¾‘å™¨
    async function initEditor() {
      try {
        updateStatus('æ­£åœ¨åˆå§‹åŒ–ç¼–è¾‘å™¨...')
        
        editor = new FlowchartEditor({
          container: '#editor-container',
          width: 1200,
          height: 600,
          // å¯ç”¨å°åœ°å›¾
          miniMap: {
            enabled: true,
            width: 200,
            height: 150,
            position: 'bottom-right',
            showZoomControls: true,
            showViewport: true,
            backgroundColor: '#fafafa',
            borderColor: '#d9d9d9',
            viewportColor: '#722ed1'
          },
          // å¯ç”¨ç½‘æ ¼
          grid: {
            size: 20,
            visible: true,
            type: 'dot'
          },
          // å·¥å…·æ é…ç½®
          toolbar: {
            visible: true,
            tools: ['select', 'zoom-fit', 'undo', 'redo', 'delete', 'clear']
          }
        })
        
        // ç›‘å¬äº‹ä»¶
        editor.on('node:add', (data) => {
          updateStatus(`èŠ‚ç‚¹å·²æ·»åŠ : ${data.node.type} (${data.node.id})`)
        })
        
        editor.on('node:delete', (data) => {
          updateStatus(`èŠ‚ç‚¹å·²åˆ é™¤: ${data.node.type} (${data.node.id})`)
        })
        
        editor.on('edge:add', (data) => {
          updateStatus(`è¿çº¿å·²æ·»åŠ : ${data.edge.id}`)
        })
        
        updateStatus('ç¼–è¾‘å™¨åˆå§‹åŒ–å®Œæˆ - å¯ä»¥å¼€å§‹æµ‹è¯•å°åœ°å›¾åŠŸèƒ½')
        
      } catch (error) {
        console.error('åˆå§‹åŒ–å¤±è´¥:', error)
        updateStatus(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`)
      }
    }
    
    // æ›´æ–°çŠ¶æ€
    function updateStatus(message) {
      document.getElementById('status').textContent = `${new Date().toLocaleTimeString()} - ${message}`
    }
    
    // æ·»åŠ ç¤ºä¾‹èŠ‚ç‚¹
    window.addSampleNodes = function() {
      if (!editor) return
      
      const nodes = [
        { type: 'start', x: 200, y: 150, text: 'å¼€å§‹' },
        { type: 'approval', x: 400, y: 150, text: 'å®¡æ‰¹èŠ‚ç‚¹' },
        { type: 'condition', x: 600, y: 150, text: 'æ¡ä»¶åˆ¤æ–­' },
        { type: 'process', x: 800, y: 100, text: 'å¤„ç†ä»»åŠ¡' },
        { type: 'end', x: 1000, y: 150, text: 'ç»“æŸ' }
      ]
      
      nodes.forEach(node => {
        editor.addNode(node)
      })
      
      updateStatus(`å·²æ·»åŠ  ${nodes.length} ä¸ªç¤ºä¾‹èŠ‚ç‚¹`)
    }
    
    // æ·»åŠ éšæœºèŠ‚ç‚¹
    window.addRandomNode = function() {
      if (!editor) return
      
      const types = ['start', 'approval', 'condition', 'process', 'end', 'user-task', 'service-task']
      const type = types[Math.floor(Math.random() * types.length)]
      const x = 200 + Math.random() * 800
      const y = 100 + Math.random() * 400
      
      nodeCounter++
      const node = {
        type,
        x,
        y,
        text: `${type}-${nodeCounter}`
      }
      
      editor.addNode(node)
      updateStatus(`å·²æ·»åŠ éšæœºèŠ‚ç‚¹: ${type} at (${Math.round(x)}, ${Math.round(y)})`)
    }
    
    // è¿æ¥èŠ‚ç‚¹
    window.connectNodes = function() {
      if (!editor) return
      
      const data = editor.getData()
      const nodes = data.nodes
      
      if (nodes.length < 2) {
        updateStatus('éœ€è¦è‡³å°‘2ä¸ªèŠ‚ç‚¹æ‰èƒ½åˆ›å»ºè¿çº¿')
        return
      }
      
      // è¿æ¥å‰ä¸¤ä¸ªèŠ‚ç‚¹
      const edge = {
        sourceNodeId: nodes[0].id,
        targetNodeId: nodes[1].id,
        type: 'polyline'
      }
      
      editor.addEdge(edge)
      updateStatus(`å·²è¿æ¥èŠ‚ç‚¹: ${nodes[0].id} -> ${nodes[1].id}`)
    }
    
    // æµ‹è¯•å¯¼èˆª
    window.testNavigation = function() {
      if (!editor) return
      
      // ç§»åŠ¨åˆ°éšæœºä½ç½®
      const x = Math.random() * 2000 - 1000
      const y = Math.random() * 1500 - 750
      
      editor.translateCenter(x, y)
      updateStatus(`å¯¼èˆªæµ‹è¯•: ç§»åŠ¨åˆ° (${Math.round(x)}, ${Math.round(y)})`)
    }
    
    // æµ‹è¯•ç¼©æ”¾
    window.testZoom = function() {
      if (!editor) return
      
      const scales = [0.5, 0.8, 1.0, 1.5, 2.0]
      const scale = scales[Math.floor(Math.random() * scales.length)]
      
      editor.zoom(scale)
      updateStatus(`ç¼©æ”¾æµ‹è¯•: è®¾ç½®ç¼©æ”¾ä¸º ${scale * 100}%`)
    }
    
    // æ¸…ç©ºç”»å¸ƒ
    window.clearCanvas = function() {
      if (!editor) return
      
      editor.clear()
      nodeCounter = 0
      updateStatus('ç”»å¸ƒå·²æ¸…ç©º')
    }
    
    // åˆ‡æ¢å°åœ°å›¾
    window.toggleMiniMap = function() {
      if (!editor) return
      
      // è¿™é‡Œéœ€è¦å®ç°åˆ‡æ¢é€»è¾‘
      updateStatus('å°åœ°å›¾åˆ‡æ¢åŠŸèƒ½å¾…å®ç°')
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', initEditor)
  </script>
</body>
</html>
