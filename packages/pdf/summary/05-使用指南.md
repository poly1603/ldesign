# @ldesign/pdf 使用指南

## 快速开始

### 1. 安装依赖

```bash
# 使用 pnpm (推荐)
pnpm add @ldesign/pdf

# 使用 npm
npm install @ldesign/pdf

# 使用 yarn
yarn add @ldesign/pdf
```

### 2. 基础使用

#### 原生JavaScript使用

```javascript
import { createPdfViewer } from '@ldesign/pdf'

// 创建PDF预览器实例
const container = document.getElementById('pdf-container')
const viewer = createPdfViewer({
  container,
  enableToolbar: true,
  enableSearch: true,
})

// 加载PDF文档
try {
  await viewer.loadDocument('path/to/document.pdf')
  console.log('PDF加载成功')
} catch (error) {
  console.error('PDF加载失败:', error)
}
```

#### Vue 3组件使用

```vue
<template>
  <div class="pdf-app">
    <PdfViewer
      :src="pdfUrl"
      :enable-toolbar="true"
      :enable-sidebar="true"
      :enable-search="true"
      :initial-scale="1"
      :zoom-mode="'fit-width'"
      @document-loaded="onDocumentLoaded"
      @page-changed="onPageChanged"
      @error="onError"
    />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { PdfViewer } from '@ldesign/pdf/vue'
import type { PdfDocumentInfo } from '@ldesign/pdf'

const pdfUrl = ref('https://example.com/document.pdf')

const onDocumentLoaded = (info: PdfDocumentInfo) => {
  console.log('文档信息:', info)
}

const onPageChanged = (pageNumber: number) => {
  console.log('当前页面:', pageNumber)
}

const onError = (error: Error) => {
  console.error('PDF错误:', error)
}
</script>

<style scoped>
.pdf-app {
  width: 100%;
  height: 100vh;
}
</style>
```

#### Vue 3 Hook使用

```vue
<template>
  <div class="pdf-container">
    <!-- 自定义工具栏 -->
    <div class="toolbar">
      <button @click="previousPage" :disabled="!canGoPrevious">
        上一页
      </button>
      <span>{{ state.currentPage }} / {{ state.totalPages }}</span>
      <button @click="nextPage" :disabled="!canGoNext">
        下一页
      </button>
      <button @click="zoomIn">放大</button>
      <button @click="zoomOut">缩小</button>
    </div>
    
    <!-- PDF容器 -->
    <div ref="containerRef" class="pdf-viewer"></div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { usePdfViewer } from '@ldesign/pdf/vue'

const containerRef = ref<HTMLElement>()

const {
  state,
  canGoPrevious,
  canGoNext,
  loadDocument,
  previousPage,
  nextPage,
  zoomIn,
  zoomOut,
} = usePdfViewer(containerRef, {
  enableToolbar: false, // 使用自定义工具栏
})

// 加载文档
const loadPdf = async () => {
  try {
    await loadDocument('path/to/document.pdf')
  } catch (error) {
    console.error('加载失败:', error)
  }
}

// 页面加载时自动加载PDF
onMounted(() => {
  loadPdf()
})
</script>
```

## 详细配置

### 1. 配置选项

```typescript
interface PdfViewerConfig {
  // 必需配置
  container: HTMLElement              // PDF容器元素
  
  // 初始设置
  initialScale?: number              // 初始缩放比例 (默认: 1)
  initialPage?: number               // 初始页面 (默认: 1)
  zoomMode?: ZoomMode               // 缩放模式 (默认: 'fit-width')
  
  // 功能开关
  enableToolbar?: boolean           // 启用工具栏 (默认: true)
  enableSidebar?: boolean           // 启用侧边栏 (默认: true)
  enableSearch?: boolean            // 启用搜索 (默认: true)
  enableThumbnails?: boolean        // 启用缩略图 (默认: true)
  enableFullscreen?: boolean        // 启用全屏 (默认: true)
  enableDownload?: boolean          // 启用下载 (默认: true)
  enablePrint?: boolean             // 启用打印 (默认: true)
  
  // 渲染选项
  renderOptions?: {
    mode?: RenderMode               // 渲染模式 ('canvas' | 'svg' | 'text')
    enableTextSelection?: boolean   // 启用文本选择 (默认: true)
    enableAnnotations?: boolean     // 启用注释 (默认: true)
    backgroundColor?: string        // 背景颜色 (默认: '#ffffff')
    useHighQuality?: boolean        // 高质量渲染 (默认: false)
  }
  
  // 自定义样式
  customStyles?: Record<string, string>
  
  // 本地化
  locale?: string                   // 语言设置 (默认: 'zh-CN')
}
```

### 2. 事件监听

```javascript
// 监听文档加载完成
viewer.on('documentLoaded', (documentInfo) => {
  console.log('文档标题:', documentInfo.title)
  console.log('总页数:', documentInfo.numPages)
  console.log('文档大小:', documentInfo.fileSize)
})

// 监听页面变化
viewer.on('pageChanged', (pageNumber, pageInfo) => {
  console.log('切换到页面:', pageNumber)
  console.log('页面尺寸:', pageInfo.width, 'x', pageInfo.height)
})

// 监听缩放变化
viewer.on('zoomChanged', (scale, zoomMode) => {
  console.log('缩放比例:', Math.round(scale * 100) + '%')
  console.log('缩放模式:', zoomMode)
})

// 监听搜索结果
viewer.on('searchResult', (results) => {
  console.log('搜索到', results.length, '个结果')
})

// 监听错误
viewer.on('error', (error) => {
  console.error('PDF预览器错误:', error.message)
})
```

## 高级功能使用

### 1. 文档加载

```javascript
// 从URL加载
await viewer.loadDocument('https://example.com/document.pdf')

// 从File对象加载
const fileInput = document.querySelector('input[type="file"]')
const file = fileInput.files[0]
await viewer.loadDocument(file)

// 从ArrayBuffer加载
const response = await fetch('document.pdf')
const arrayBuffer = await response.arrayBuffer()
await viewer.loadDocument(arrayBuffer)

// 从Uint8Array加载
const uint8Array = new Uint8Array(arrayBuffer)
await viewer.loadDocument(uint8Array)
```

### 2. 页面导航

```javascript
// 跳转到指定页面
await viewer.goToPage(5)

// 上一页/下一页
await viewer.previousPage()
await viewer.nextPage()

// 获取当前状态
const state = viewer.getState()
console.log(`当前页面: ${state.currentPage}/${state.totalPages}`)

// 检查是否可以导航
if (viewer.canGoPrevious()) {
  await viewer.previousPage()
}

if (viewer.canGoNext()) {
  await viewer.nextPage()
}
```

### 3. 缩放控制

```javascript
// 设置缩放比例
viewer.setZoom(1.5)  // 150%
viewer.setZoom(0.8)  // 80%

// 设置缩放模式
viewer.setZoomMode('fit-width')  // 适应宽度
viewer.setZoomMode('fit-page')   // 适应页面
viewer.setZoomMode('auto')       // 自动

// 放大/缩小
viewer.zoomIn()   // 放大
viewer.zoomOut()  // 缩小

// 获取当前缩放信息
const state = viewer.getState()
console.log('当前缩放:', Math.round(state.currentScale * 100) + '%')
console.log('缩放模式:', state.currentZoomMode)
```

### 4. 页面旋转

```javascript
// 旋转页面
viewer.rotate(90)   // 顺时针旋转90度
viewer.rotate(180)  // 旋转180度
viewer.rotate(270)  // 旋转270度
viewer.rotate(0)    // 重置旋转

// 获取当前旋转角度
const state = viewer.getState()
console.log('当前旋转角度:', state.currentRotation + '°')
```

### 5. 文本搜索

```javascript
// 基础搜索
const results = await viewer.search({
  query: '搜索关键词',
})

console.log(`找到 ${results.length} 个匹配项`)

// 高级搜索
const advancedResults = await viewer.search({
  query: '关键词',
  caseSensitive: true,    // 大小写敏感
  wholeWords: true,       // 全词匹配
  highlightAll: true,     // 高亮所有结果
})

// 搜索导航
results.forEach((result, index) => {
  console.log(`结果 ${index + 1}: 页面 ${result.pageNumber}, 文本: "${result.text}"`)
})
```

### 6. 全屏模式

```javascript
// 进入全屏
viewer.enterFullscreen()

// 退出全屏
viewer.exitFullscreen()

// 切换全屏状态
const state = viewer.getState()
if (state.isFullscreen) {
  viewer.exitFullscreen()
} else {
  viewer.enterFullscreen()
}

// 监听全屏状态变化
viewer.on('fullscreenChanged', (isFullscreen) => {
  console.log('全屏状态:', isFullscreen ? '已进入' : '已退出')
})
```

### 7. 下载和打印

```javascript
// 下载PDF
viewer.download({
  filename: 'my-document.pdf',
  saveAsCopy: false,
})

// 打印PDF
viewer.print({
  pageRange: '1-5',        // 打印页面范围
  quality: 'high',         // 打印质量
  showDialog: true,        // 显示打印对话框
})

// 打印特定页面
viewer.print({
  pageRange: '1,3,5-8',    // 打印第1页、第3页、第5-8页
  quality: 'normal',
  fitToPage: true,
})
```

## 样式定制

### 1. CSS变量定制

```css
.ldesign-pdf-viewer-wrapper {
  /* 主题颜色 */
  --pdf-primary-color: #007bff;
  --pdf-secondary-color: #6c757d;
  
  /* 背景颜色 */
  --pdf-background: #f8f9fa;
  --pdf-page-background: #ffffff;
  --pdf-toolbar-background: #ffffff;
  
  /* 边框颜色 */
  --pdf-border-color: #dee2e6;
  --pdf-border-radius: 4px;
  
  /* 文字颜色 */
  --pdf-text-color: #212529;
  --pdf-text-muted: #6c757d;
  
  /* 阴影 */
  --pdf-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  --pdf-shadow-lg: 0 4px 8px rgba(0, 0, 0, 0.15);
}
```

### 2. 自定义主题

```css
/* 暗色主题 */
.pdf-dark-theme {
  --pdf-background: #1a1a1a;
  --pdf-page-background: #2d2d2d;
  --pdf-toolbar-background: #333333;
  --pdf-text-color: #ffffff;
  --pdf-text-muted: #cccccc;
  --pdf-border-color: #444444;
}

/* 应用暗色主题 */
.ldesign-pdf-viewer-wrapper.pdf-dark-theme {
  background-color: var(--pdf-background);
  color: var(--pdf-text-color);
}
```

### 3. 响应式设计

```css
/* 移动端适配 */
@media (max-width: 768px) {
  .ldesign-pdf-viewer-wrapper {
    --pdf-toolbar-height: 48px;
    --pdf-sidebar-width: 250px;
  }
  
  .pdf-toolbar {
    flex-wrap: wrap;
    padding: 8px;
  }
  
  .pdf-sidebar {
    position: fixed;
    top: 0;
    left: -100%;
    transition: left 0.3s ease;
    z-index: 1000;
  }
  
  .pdf-sidebar.show {
    left: 0;
  }
}
```

## 错误处理

### 1. 常见错误类型

```javascript
try {
  await viewer.loadDocument(pdfUrl)
} catch (error) {
  if (error.name === 'InvalidPDFException') {
    console.error('无效的PDF文件')
  } else if (error.name === 'MissingPDFException') {
    console.error('PDF文件不存在')
  } else if (error.name === 'UnexpectedResponseException') {
    console.error('网络请求失败')
  } else {
    console.error('未知错误:', error.message)
  }
}
```

### 2. 错误恢复

```javascript
// 设置错误处理器
viewer.on('error', async (error) => {
  console.error('PDF错误:', error)
  
  // 尝试重新加载
  if (error.name === 'UnexpectedResponseException') {
    console.log('尝试重新加载...')
    setTimeout(async () => {
      try {
        await viewer.loadDocument(currentPdfUrl)
      } catch (retryError) {
        console.error('重新加载失败:', retryError)
      }
    }, 3000)
  }
})
```

## 性能优化建议

### 1. 预加载策略

```javascript
// 预加载相邻页面
viewer.on('pageChanged', async (pageNumber) => {
  const documentManager = viewer.getDocumentManager()
  
  // 预加载前后各2页
  const startPage = Math.max(1, pageNumber - 2)
  const endPage = Math.min(viewer.getState().totalPages, pageNumber + 2)
  
  await documentManager.preloadPages(startPage, endPage)
})
```

### 2. 内存管理

```javascript
// 定期清理缓存
setInterval(() => {
  const cacheManager = viewer.getCacheManager()
  const stats = cacheManager.getStats()
  
  // 如果缓存使用率过高，清理旧缓存
  if (stats.size > 100) {
    cacheManager.cleanup()
  }
}, 60000) // 每分钟检查一次

// 页面卸载时清理资源
window.addEventListener('beforeunload', () => {
  viewer.destroy()
})
```

### 3. 渲染优化

```javascript
// 根据设备性能调整渲染质量
const viewer = createPdfViewer({
  container,
  renderOptions: {
    useHighQuality: window.devicePixelRatio > 1, // 高DPI设备启用高质量
    mode: 'canvas', // 使用Canvas渲染获得最佳性能
  },
})
```

这个使用指南涵盖了@ldesign/pdf的所有主要功能和使用方法，帮助开发者快速上手并充分利用库的各种特性。
