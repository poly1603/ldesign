<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Vue 3 PDF Viewer Example - 基于 @ldesign/pdf 的 Vue 3 PDF 查看器示例" />
  <meta name="keywords" content="Vue 3, PDF Viewer, TypeScript, Composition API, PDF, 文档查看器" />
  <meta name="author" content="LDesign Team" />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Vue 3 PDF Viewer Example" />
  <meta property="og:description" content="基于 @ldesign/pdf 的 Vue 3 PDF 查看器示例" />
  <meta property="og:image" content="/og-image.png" />
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:title" content="Vue 3 PDF Viewer Example" />
  <meta property="twitter:description" content="基于 @ldesign/pdf 的 Vue 3 PDF 查看器示例" />
  <meta property="twitter:image" content="/og-image.png" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  
  <!-- Preconnect to external domains -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  
  <!-- Theme color -->
  <meta name="theme-color" content="#1976d2" />
  <meta name="msapplication-TileColor" content="#1976d2" />
  
  <!-- PWA manifest -->
  <link rel="manifest" href="/manifest.json" />
  
  <title>Vue 3 PDF Viewer Example</title>
  
  <!-- 内联样式 - 加载指示器 -->
  <style>
    /* 加载指示器样式 */
    #app-loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: white;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    #app-loading.hidden {
      opacity: 0;
      visibility: hidden;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    .loading-text {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 10px;
      text-align: center;
    }
    
    .loading-subtitle {
      font-size: 14px;
      opacity: 0.8;
      text-align: center;
      max-width: 300px;
      line-height: 1.5;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* 错误页面样式 */
    .error-page {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #f5f5f5;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: #333;
      text-align: center;
      padding: 20px;
      z-index: 9998;
    }
    
    .error-icon {
      font-size: 64px;
      margin-bottom: 20px;
      color: #f44336;
    }
    
    .error-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 10px;
      color: #333;
    }
    
    .error-message {
      font-size: 16px;
      color: #666;
      margin-bottom: 30px;
      max-width: 500px;
      line-height: 1.5;
    }
    
    .error-actions {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .error-button {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .error-button.primary {
      background: #1976d2;
      color: white;
    }
    
    .error-button.primary:hover {
      background: #1565c0;
      transform: translateY(-1px);
    }
    
    .error-button.secondary {
      background: #e0e0e0;
      color: #333;
    }
    
    .error-button.secondary:hover {
      background: #d0d0d0;
    }
    
    /* 响应式设计 */
    @media (max-width: 640px) {
      .loading-text {
        font-size: 16px;
      }
      
      .loading-subtitle {
        font-size: 12px;
      }
      
      .error-title {
        font-size: 20px;
      }
      
      .error-message {
        font-size: 14px;
      }
      
      .error-actions {
        flex-direction: column;
        align-items: center;
      }
      
      .error-button {
        width: 200px;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <!-- Vue 应用挂载点 -->
  <div id="app"></div>
  
  <!-- 加载指示器 -->
  <div id="app-loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">正在加载 Vue PDF Viewer</div>
    <div class="loading-subtitle">基于 Vue 3 + Composition API + TypeScript 构建</div>
  </div>
  
  <!-- 错误页面 -->
  <div id="error-page" class="error-page">
    <div class="error-icon">⚠️</div>
    <h1 class="error-title">应用加载失败</h1>
    <p class="error-message">很抱歉，Vue PDF Viewer 应用无法正常加载。这可能是由于网络问题、浏览器兼容性或其他技术问题导致的。</p>
    <div class="error-actions">
      <button class="error-button primary" onclick="window.location.reload()">
        🔄 重新加载
      </button>
      <button class="error-button secondary" onclick="window.history.back()">
        ← 返回上页
      </button>
      <a href="https://github.com/ldesign-team/pdf" class="error-button secondary" target="_blank">
        📖 查看文档
      </a>
    </div>
  </div>
  
  <!-- Vue 应用入口脚本 -->
  <script type="module" src="/src/main.ts"></script>
  
  <!-- 内联 JavaScript - 全局错误处理和性能监控 -->
  <script>
    (function() {
      'use strict';
      
      // 全局错误处理
      window.addEventListener('error', function(event) {
        console.error('Global Error:', event.error);
        showErrorPage('JavaScript 执行错误: ' + (event.error?.message || '未知错误'));
      });
      
      window.addEventListener('unhandledrejection', function(event) {
        console.error('Unhandled Promise Rejection:', event.reason);
        showErrorPage('Promise 执行错误: ' + (event.reason?.message || '未知错误'));
      });
      
      // 显示错误页面
      function showErrorPage(message) {
        const loadingEl = document.getElementById('app-loading');
        const errorEl = document.getElementById('error-page');
        const messageEl = errorEl?.querySelector('.error-message');
        
        if (loadingEl) {
          loadingEl.style.display = 'none';
        }
        
        if (errorEl) {
          errorEl.style.display = 'flex';
        }
        
        if (messageEl && message) {
          messageEl.textContent = message;
        }
      }
      
      // 浏览器兼容性检查
      function checkBrowserCompatibility() {
        const requiredFeatures = [
          'Promise',
          'fetch',
          'Map',
          'Set',
          'Symbol',
          'Proxy'
        ];
        
        const missingFeatures = requiredFeatures.filter(feature => {
          return typeof window[feature] === 'undefined';
        });
        
        if (missingFeatures.length > 0) {
          showErrorPage(
            '您的浏览器不支持以下必需功能: ' + missingFeatures.join(', ') + 
            '。请升级到现代浏览器（Chrome 61+, Firefox 60+, Safari 12+, Edge 79+）。'
          );
          return false;
        }
        
        return true;
      }
      
      // 性能监控
      function trackPerformance() {
        if ('performance' in window && 'getEntriesByType' in performance) {
          window.addEventListener('load', function() {
            setTimeout(function() {
              const navigation = performance.getEntriesByType('navigation')[0];
              const paint = performance.getEntriesByType('paint');
              
              if (navigation) {
                console.log('页面加载性能:', {
                  domContentLoaded: Math.round(navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart),
                  loadComplete: Math.round(navigation.loadEventEnd - navigation.loadEventStart),
                  totalTime: Math.round(navigation.loadEventEnd - navigation.fetchStart)
                });
              }
              
              if (paint.length > 0) {
                console.log('渲染性能:', paint.reduce((acc, entry) => {
                  acc[entry.name] = Math.round(entry.startTime);
                  return acc;
                }, {}));
              }
            }, 0);
          });
        }
      }
      
      // 内存监控
      function trackMemory() {
        if ('memory' in performance) {
          const logMemory = function() {
            const memory = performance.memory;
            console.log('内存使用情况:', {
              used: Math.round(memory.usedJSHeapSize / 1024 / 1024) + ' MB',
              total: Math.round(memory.totalJSHeapSize / 1024 / 1024) + ' MB',
              limit: Math.round(memory.jsHeapSizeLimit / 1024 / 1024) + ' MB'
            });
          };
          
          // 初始内存状态
          logMemory();
          
          // 定期检查内存使用情况
          setInterval(logMemory, 30000); // 每30秒检查一次
        }
      }
      
      // 网络状态监控
      function trackNetworkStatus() {
        if ('navigator' in window && 'onLine' in navigator) {
          function updateNetworkStatus() {
            const isOnline = navigator.onLine;
            document.body.classList.toggle('offline', !isOnline);
            
            if (!isOnline) {
              console.warn('网络连接已断开');
            } else {
              console.log('网络连接已恢复');
            }
          }
          
          window.addEventListener('online', updateNetworkStatus);
          window.addEventListener('offline', updateNetworkStatus);
          
          // 初始状态检查
          updateNetworkStatus();
        }
      }
      
      // 应用加载完成处理
      function handleAppLoaded() {
        const loadingEl = document.getElementById('app-loading');
        if (loadingEl) {
          loadingEl.classList.add('hidden');
          setTimeout(function() {
            loadingEl.style.display = 'none';
          }, 300);
        }
      }
      
      // 初始化
      if (checkBrowserCompatibility()) {
        trackPerformance();
        trackMemory();
        trackNetworkStatus();
        
        // 监听 Vue 应用加载完成事件
        window.addEventListener('vue-app-loaded', handleAppLoaded);
        
        // 备用方案：如果 Vue 应用在 10 秒内没有加载完成，隐藏加载指示器
        setTimeout(function() {
          const loadingEl = document.getElementById('app-loading');
          if (loadingEl && !loadingEl.classList.contains('hidden')) {
            console.warn('Vue 应用加载超时，隐藏加载指示器');
            handleAppLoaded();
          }
        }, 10000);
      }
      
      // 开发环境下的额外调试信息
      if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
        console.log('🚀 Vue 3 PDF Viewer Example - 开发模式');
        console.log('📦 基于 @ldesign/pdf 构建');
        console.log('⚡ 使用 Vite 构建工具');
        console.log('🎯 Vue 3 + Composition API + TypeScript');
        
        // 开发环境性能提示
        if ('performance' in window && performance.mark) {
          performance.mark('vue-app-start');
          window.addEventListener('vue-app-loaded', function() {
            performance.mark('vue-app-end');
            performance.measure('vue-app-load-time', 'vue-app-start', 'vue-app-end');
            
            const measure = performance.getEntriesByName('vue-app-load-time')[0];
            if (measure) {
              console.log('Vue 应用加载时间:', Math.round(measure.duration) + 'ms');
            }
          });
        }
      }
    })();
  </script>
  
  <!-- NoScript 回退 -->
  <noscript>
    <div style="
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: #333;
      text-align: center;
      padding: 20px;
      z-index: 10000;
    ">
      <div style="font-size: 64px; margin-bottom: 20px; color: #ff9800;">⚠️</div>
      <h1 style="font-size: 24px; font-weight: 600; margin-bottom: 10px;">需要启用 JavaScript</h1>
      <p style="font-size: 16px; color: #666; margin-bottom: 30px; max-width: 500px; line-height: 1.5;">
        Vue PDF Viewer 需要 JavaScript 才能正常运行。请在浏览器设置中启用 JavaScript，然后刷新页面。
      </p>
      <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
        <a href="https://enable-javascript.com/" target="_blank" style="
          padding: 12px 24px;
          background: #1976d2;
          color: white;
          text-decoration: none;
          border-radius: 6px;
          font-size: 14px;
          font-weight: 500;
        ">📖 如何启用 JavaScript</a>
      </div>
    </div>
  </noscript>
</body>
</html>