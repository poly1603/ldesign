<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LDesign Editor - React é›†æˆç¤ºä¾‹</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* åŸºç¡€æ ·å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      background: #61dafb;
      color: #282c34;
      padding: 30px;
      text-align: center;
      position: relative;
    }

    .header::before {
      content: 'âš›ï¸';
      position: absolute;
      top: 20px;
      right: 30px;
      font-size: 2rem;
      opacity: 0.7;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.8;
    }

    .main-content {
      padding: 30px;
    }

    .react-features {
      background: #e3f2fd;
      border: 1px solid #90caf9;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .react-features h3 {
      color: #1976d2;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .react-features ul {
      margin: 0;
      padding-left: 20px;
    }

    .react-features li {
      color: #1976d2;
      margin-bottom: 8px;
    }

    .demo-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .demo-section {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      border: 1px solid #e9ecef;
    }

    .demo-section h3 {
      margin-bottom: 15px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .editor-container {
      border: 1px solid #d9d9d9;
      border-radius: 6px;
      min-height: 200px;
      margin-bottom: 15px;
      background: white;
      padding: 15px;
      outline: none;
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .btn {
      padding: 8px 16px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
    }

    .btn:hover {
      background: #f0f0f0;
      border-color: #61dafb;
    }

    .btn.primary {
      background: #61dafb;
      color: #282c34;
      border-color: #61dafb;
    }

    .btn.primary:hover {
      background: #21a9c7;
    }

    .btn.active {
      background: #282c34;
      color: white;
      border-color: #282c34;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #333;
    }

    .form-control {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: white;
      padding: 15px;
      border-radius: 6px;
      border: 1px solid #e9ecef;
      text-align: center;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #61dafb;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.85rem;
      color: #666;
    }

    .output {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 4px;
      padding: 15px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.85rem;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
    }

    .hooks-demo {
      background: #fff3e0;
      border: 1px solid #ffb74d;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .hooks-demo h4 {
      color: #e65100;
      margin-bottom: 10px;
    }

    .hook-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #ffcc02;
    }

    .hook-item:last-child {
      border-bottom: none;
    }

    .hook-name {
      font-weight: 500;
      color: #e65100;
    }

    .hook-value {
      font-family: monospace;
      background: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 0.85rem;
    }

    @media (max-width: 768px) {
      .demo-grid {
        grid-template-columns: 1fr;
      }
      
      .main-content {
        padding: 20px;
      }
      
      .header {
        padding: 20px;
      }
      
      .header h1 {
        font-size: 2rem;
      }
    }

    /* React åŠ¨ç”»æ•ˆæœ */
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .slide-in {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback, useMemo, useReducer } = React;

    // æ¨¡æ‹Ÿ LDesign Editor
    class ReactLDesignEditor {
      constructor(options) {
        this.container = options.container;
        this.content = options.content || '';
        this.readonly = options.readonly || false;
        this.theme = options.theme || 'default';
        this.onChange = options.onChange;
        this.onSelectionChange = options.onSelectionChange;
        this.initialized = false;
      }
      
      init() {
        if (this.initialized || !this.container) return;
        
        this.container.contentEditable = !this.readonly;
        this.container.innerHTML = this.content || this.getDefaultContent();
        this.container.style.minHeight = '150px';
        this.container.style.outline = 'none';
        
        this.bindEvents();
        this.updateTheme();
        this.initialized = true;
      }
      
      getDefaultContent() {
        return `
          <h2>React é›†æˆç¤ºä¾‹</h2>
          <p>è¿™æ˜¯ä¸€ä¸ªä¸ React 18 é›†æˆçš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ç¤ºä¾‹ã€‚</p>
          <ul>
            <li>ä½¿ç”¨ React Hooks ç®¡ç†çŠ¶æ€</li>
            <li>æ”¯æŒå‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶</li>
            <li>å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†</li>
            <li>æ€§èƒ½ä¼˜åŒ–å’Œ memo ç¼“å­˜</li>
          </ul>
          <p>å¼€å§‹ç¼–è¾‘å†…å®¹ï¼Œä½“éªŒ React çš„å¼ºå¤§åŠŸèƒ½ï¼</p>
        `.trim();
      }
      
      bindEvents() {
        this.container.addEventListener('input', () => {
          this.content = this.container.innerHTML;
          if (this.onChange) {
            this.onChange(this.content);
          }
        });
        
        this.container.addEventListener('selectionchange', () => {
          if (this.onSelectionChange) {
            this.onSelectionChange(window.getSelection());
          }
        });
      }
      
      updateTheme() {
        if (this.theme === 'dark') {
          this.container.style.background = '#1a1a1a';
          this.container.style.color = 'white';
        } else if (this.theme === 'minimal') {
          this.container.style.background = '#fafafa';
          this.container.style.color = '#333';
        } else {
          this.container.style.background = 'white';
          this.container.style.color = '#333';
        }
      }
      
      setContent(content) {
        this.container.innerHTML = content;
        this.content = content;
        if (this.onChange) {
          this.onChange(content);
        }
      }
      
      getContent() {
        return this.container.innerHTML;
      }
      
      setReadonly(readonly) {
        this.readonly = readonly;
        this.container.contentEditable = !readonly;
        this.container.style.backgroundColor = readonly ? '#f5f5f5' : 'white';
      }
      
      setTheme(theme) {
        this.theme = theme;
        this.updateTheme();
      }
      
      executeCommand(command) {
        document.execCommand(command, false, null);
        if (this.onChange) {
          this.onChange(this.container.innerHTML);
        }
      }
      
      clear() {
        this.setContent('');
      }
      
      destroy() {
        if (this.container) {
          this.container.contentEditable = false;
          this.container.innerHTML = '';
        }
      }
    }

    // ç¼–è¾‘å™¨çŠ¶æ€ç®¡ç† Reducer
    const editorReducer = (state, action) => {
      switch (action.type) {
        case 'SET_CONTENT':
          return { ...state, content: action.payload };
        case 'SET_THEME':
          return { ...state, theme: action.payload };
        case 'SET_READONLY':
          return { ...state, readonly: action.payload };
        case 'ADD_HISTORY':
          return {
            ...state,
            history: [...state.history, {
              id: Date.now(),
              timestamp: new Date().toLocaleTimeString(),
              action: action.payload.action,
              content: action.payload.content
            }].slice(-20) // ä¿ç•™æœ€è¿‘20æ¡è®°å½•
          };
        case 'RESET':
          return { ...state, content: '', history: [] };
        default:
          return state;
      }
    };

    // è‡ªå®šä¹‰ Hook: ç¼–è¾‘å™¨ç®¡ç†
    const useEditor = (initialContent = '') => {
      const editorRef = useRef(null);
      const instanceRef = useRef(null);
      const [content, setContent] = useState(initialContent);
      const [isReady, setIsReady] = useState(false);

      const initEditor = useCallback(() => {
        if (editorRef.current && !instanceRef.current) {
          instanceRef.current = new ReactLDesignEditor({
            container: editorRef.current,
            content: content,
            onChange: (newContent) => {
              setContent(newContent);
            }
          });
          instanceRef.current.init();
          setIsReady(true);
        }
      }, [content]);

      const executeCommand = useCallback((command) => {
        if (instanceRef.current) {
          instanceRef.current.executeCommand(command);
        }
      }, []);

      const setTheme = useCallback((theme) => {
        if (instanceRef.current) {
          instanceRef.current.setTheme(theme);
        }
      }, []);

      const setReadonly = useCallback((readonly) => {
        if (instanceRef.current) {
          instanceRef.current.setReadonly(readonly);
        }
      }, []);

      const clear = useCallback(() => {
        if (instanceRef.current) {
          instanceRef.current.clear();
        }
      }, []);

      useEffect(() => {
        initEditor();
        return () => {
          if (instanceRef.current) {
            instanceRef.current.destroy();
            instanceRef.current = null;
          }
        };
      }, [initEditor]);

      return {
        editorRef,
        content,
        isReady,
        executeCommand,
        setTheme,
        setReadonly,
        clear
      };
    };

    // ç»Ÿè®¡ä¿¡æ¯ç»„ä»¶
    const EditorStats = React.memo(({ content }) => {
      const stats = useMemo(() => {
        const text = content.replace(/<[^>]*>/g, '');
        const words = text.trim().split(/\s+/).filter(word => word.length > 0);
        const paragraphs = content.split(/<\/p>|<\/h[1-6]>|<\/li>/).filter(p => p.trim().length > 0);
        
        return {
          charCount: text.length,
          wordCount: words.length,
          paragraphCount: paragraphs.length,
          htmlSize: new Blob([content]).size
        };
      }, [content]);

      return (
        <div className="stats-grid">
          <div className="stat-card fade-in">
            <div className="stat-value">{stats.charCount}</div>
            <div className="stat-label">å­—ç¬¦æ•°</div>
          </div>
          <div className="stat-card fade-in">
            <div className="stat-value">{stats.wordCount}</div>
            <div className="stat-label">å•è¯æ•°</div>
          </div>
          <div className="stat-card fade-in">
            <div className="stat-value">{stats.paragraphCount}</div>
            <div className="stat-label">æ®µè½æ•°</div>
          </div>
          <div className="stat-card fade-in">
            <div className="stat-value">{stats.htmlSize}B</div>
            <div className="stat-label">HTMLå¤§å°</div>
          </div>
        </div>
      );
    });

    // Hooks æ¼”ç¤ºç»„ä»¶
    const HooksDemo = ({ content, theme, readonly }) => {
      const [renderCount, setRenderCount] = useState(0);
      const [lastUpdate, setLastUpdate] = useState(new Date().toLocaleTimeString());

      useEffect(() => {
        setRenderCount(prev => prev + 1);
        setLastUpdate(new Date().toLocaleTimeString());
      }, [content, theme, readonly]);

      const memoizedValue = useMemo(() => {
        return content.length > 100 ? 'é•¿æ–‡æœ¬' : 'çŸ­æ–‡æœ¬';
      }, [content]);

      return (
        <div className="hooks-demo">
          <h4>ğŸ£ React Hooks çŠ¶æ€</h4>
          <div className="hook-item">
            <span className="hook-name">useState (æ¸²æŸ“æ¬¡æ•°)</span>
            <span className="hook-value">{renderCount}</span>
          </div>
          <div className="hook-item">
            <span className="hook-name">useEffect (æœ€åæ›´æ–°)</span>
            <span className="hook-value">{lastUpdate}</span>
          </div>
          <div className="hook-item">
            <span className="hook-name">useMemo (æ–‡æœ¬ç±»å‹)</span>
            <span className="hook-value">{memoizedValue}</span>
          </div>
          <div className="hook-item">
            <span className="hook-name">useRef (ç¼–è¾‘å™¨çŠ¶æ€)</span>
            <span className="hook-value">{readonly ? 'åªè¯»' : 'å¯ç¼–è¾‘'}</span>
          </div>
        </div>
      );
    };

    // ä¸»åº”ç”¨ç»„ä»¶
    const App = () => {
      const { editorRef, content, isReady, executeCommand, setTheme, setReadonly, clear } = useEditor();
      
      const [state, dispatch] = useReducer(editorReducer, {
        content: '',
        theme: 'default',
        readonly: false,
        history: []
      });

      const [autoSave, setAutoSave] = useState(false);
      const [saveStatus, setSaveStatus] = useState('æœªä¿å­˜');

      // åŒæ­¥å†…å®¹åˆ° reducer
      useEffect(() => {
        dispatch({ type: 'SET_CONTENT', payload: content });
      }, [content]);

      // è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
      useEffect(() => {
        if (autoSave && content.trim()) {
          const timer = setTimeout(() => {
            setSaveStatus('å·²è‡ªåŠ¨ä¿å­˜');
            dispatch({ 
              type: 'ADD_HISTORY', 
              payload: { action: 'è‡ªåŠ¨ä¿å­˜', content } 
            });
            setTimeout(() => setSaveStatus('æœªä¿å­˜'), 2000);
          }, 3000);
          
          return () => clearTimeout(timer);
        }
      }, [content, autoSave]);

      const handleThemeChange = (newTheme) => {
        setTheme(newTheme);
        dispatch({ type: 'SET_THEME', payload: newTheme });
        dispatch({ 
          type: 'ADD_HISTORY', 
          payload: { action: `åˆ‡æ¢ä¸»é¢˜: ${newTheme}`, content } 
        });
      };

      const handleReadonlyToggle = () => {
        const newReadonly = !state.readonly;
        setReadonly(newReadonly);
        dispatch({ type: 'SET_READONLY', payload: newReadonly });
        dispatch({ 
          type: 'ADD_HISTORY', 
          payload: { action: newReadonly ? 'è®¾ä¸ºåªè¯»' : 'å–æ¶ˆåªè¯»', content } 
        });
      };

      const handleClear = () => {
        if (window.confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
          clear();
          dispatch({ type: 'RESET' });
          setSaveStatus('å·²æ¸…ç©º');
        }
      };

      const handleSave = () => {
        setSaveStatus('ä¿å­˜ä¸­...');
        setTimeout(() => {
          setSaveStatus('å·²ä¿å­˜');
          dispatch({ 
            type: 'ADD_HISTORY', 
            payload: { action: 'æ‰‹åŠ¨ä¿å­˜', content } 
          });
          setTimeout(() => setSaveStatus('æœªä¿å­˜'), 2000);
        }, 1000);
      };

      return (
        <div className="app-container">
          <div className="header">
            <h1>LDesign Editor</h1>
            <p>React 18 é›†æˆç¤ºä¾‹ - Hooksã€çŠ¶æ€ç®¡ç†ä¸æ€§èƒ½ä¼˜åŒ–</p>
          </div>

          <div className="main-content">
            {/* React ç‰¹æ€§è¯´æ˜ */}
            <div className="react-features">
              <h3>âš›ï¸ React é›†æˆç‰¹æ€§</h3>
              <ul>
                <li>React Hooks - useState, useEffect, useRef, useCallback, useMemo</li>
                <li>useReducer - å¤æ‚çŠ¶æ€ç®¡ç†</li>
                <li>è‡ªå®šä¹‰ Hook - ç¼–è¾‘å™¨é€»è¾‘å°è£…</li>
                <li>React.memo - æ€§èƒ½ä¼˜åŒ–</li>
                <li>å‡½æ•°ç»„ä»¶ - ç°ä»£ React å¼€å‘æ¨¡å¼</li>
              </ul>
            </div>

            {/* ç»Ÿè®¡ä¿¡æ¯ */}
            <EditorStats content={content} />

            {/* Hooks æ¼”ç¤º */}
            <HooksDemo content={content} theme={state.theme} readonly={state.readonly} />

            <div className="demo-grid">
              {/* ä¸»ç¼–è¾‘å™¨ */}
              <div className="demo-section">
                <h3>ğŸ“ React ç¼–è¾‘å™¨</h3>
                
                <div className="controls">
                  <button className="btn" onClick={() => executeCommand('bold')}>åŠ ç²—</button>
                  <button className="btn" onClick={() => executeCommand('italic')}>æ–œä½“</button>
                  <button className="btn" onClick={() => executeCommand('underline')}>ä¸‹åˆ’çº¿</button>
                  <button className="btn" onClick={() => executeCommand('heading1')}>H1</button>
                  <button className="btn" onClick={() => executeCommand('heading2')}>H2</button>
                  <button className="btn" onClick={() => executeCommand('bulletList')}>åˆ—è¡¨</button>
                </div>

                <div ref={editorRef} className="editor-container"></div>

                <div className="controls">
                  <button className="btn primary" onClick={handleSave}>
                    ä¿å­˜ ({saveStatus})
                  </button>
                  <button className="btn" onClick={handleClear}>æ¸…ç©º</button>
                  <button 
                    className={`btn ${state.readonly ? 'active' : ''}`}
                    onClick={handleReadonlyToggle}
                  >
                    {state.readonly ? 'å–æ¶ˆåªè¯»' : 'è®¾ä¸ºåªè¯»'}
                  </button>
                </div>
              </div>

              {/* è®¾ç½®é¢æ¿ */}
              <div className="demo-section">
                <h3>âš™ï¸ React è®¾ç½®</h3>
                
                <div className="form-group">
                  <label>ä¸»é¢˜é€‰æ‹©</label>
                  <select 
                    value={state.theme} 
                    onChange={(e) => handleThemeChange(e.target.value)}
                    className="form-control"
                  >
                    <option value="default">é»˜è®¤ä¸»é¢˜</option>
                    <option value="dark">æš—è‰²ä¸»é¢˜</option>
                    <option value="minimal">ç®€æ´ä¸»é¢˜</option>
                  </select>
                </div>

                <div className="form-group">
                  <label>
                    <input 
                      type="checkbox" 
                      checked={autoSave}
                      onChange={(e) => setAutoSave(e.target.checked)}
                    />
                    {' '}å¯ç”¨è‡ªåŠ¨ä¿å­˜ (3ç§’)
                  </label>
                </div>

                <div className="form-group">
                  <label>ç¼–è¾‘å™¨çŠ¶æ€</label>
                  <div style={{ fontSize: '0.9rem', color: '#666' }}>
                    <div>å°±ç»ªçŠ¶æ€: {isReady ? 'âœ… å·²å°±ç»ª' : 'â³ åˆå§‹åŒ–ä¸­'}</div>
                    <div>å†…å®¹é•¿åº¦: {content.length} å­—ç¬¦</div>
                    <div>å½“å‰ä¸»é¢˜: {state.theme}</div>
                    <div>ç¼–è¾‘æ¨¡å¼: {state.readonly ? 'åªè¯»' : 'å¯ç¼–è¾‘'}</div>
                  </div>
                </div>
              </div>
            </div>

            {/* å®æ—¶é¢„è§ˆ */}
            <div className="demo-section">
              <h3>ğŸ‘ï¸ HTML è¾“å‡º</h3>
              <div className="output">
                {content || 'ç¼–è¾‘å™¨å†…å®¹ä¸ºç©º...'}
              </div>
            </div>

            {/* å†å²è®°å½• */}
            {state.history.length > 0 && (
              <div className="demo-section slide-in">
                <h3>ğŸ“š æ“ä½œå†å² (useReducer)</h3>
                <div style={{ maxHeight: '200px', overflowY: 'auto' }}>
                  {state.history.slice(-10).map((item) => (
                    <div 
                      key={item.id}
                      style={{ 
                        padding: '8px', 
                        borderBottom: '1px solid #eee', 
                        fontSize: '0.85rem' 
                      }}
                    >
                      <strong>{item.timestamp}</strong>: {item.action}
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    // æ¸²æŸ“åº”ç”¨
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
