<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LDesign Editor - 高级示例</title>
  <style>
    /* 引入CSS变量 */
    :root {
      --ldesign-brand-color-1: #f1ecf9;
      --ldesign-brand-color-2: #d8c8ee;
      --ldesign-brand-color-3: #bfa4e5;
      --ldesign-brand-color-4: #a67fdb;
      --ldesign-brand-color-5: #8c5ad3;
      --ldesign-brand-color-6: #7334cb;
      --ldesign-brand-color-7: #5e2aa7;
      --ldesign-brand-color-8: #491f84;
      --ldesign-brand-color-9: #35165f;
      --ldesign-brand-color-10: #200d3b;
      --ldesign-brand-color: var(--ldesign-brand-color-7);
      --ldesign-bg-color-container: #ffffff;
      --ldesign-border-level-1-color: #e5e5e5;
      --ldesign-text-color-primary: rgba(0, 0, 0, 90%);
      --ldesign-text-color-secondary: rgba(0, 0, 0, 70%);
    }

    /* 基础样式 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .app-container {
      max-width: 1400px;
      margin: 0 auto;
      background: var(--ldesign-bg-color-container);
      border-radius: 12px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .app-header {
      background: var(--ldesign-brand-color);
      color: white;
      padding: 30px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .app-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="0.5" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      pointer-events: none;
    }

    .app-header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      position: relative;
      z-index: 1;
    }

    .app-header p {
      font-size: 1.1rem;
      opacity: 0.9;
      position: relative;
      z-index: 1;
    }

    .main-content {
      display: grid;
      grid-template-columns: 300px 1fr;
      min-height: 600px;
    }

    .sidebar {
      background: #f8f9fa;
      border-right: 1px solid var(--ldesign-border-level-1-color);
      padding: 20px;
    }

    .sidebar h3 {
      color: var(--ldesign-text-color-primary);
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    .control-group {
      margin-bottom: 25px;
    }

    .control-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--ldesign-text-color-secondary);
      font-size: 0.9rem;
      font-weight: 500;
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 15px;
    }

    .btn {
      padding: 8px 12px;
      border: 1px solid var(--ldesign-border-level-1-color);
      border-radius: 6px;
      background: white;
      color: var(--ldesign-text-color-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .btn:hover {
      background: var(--ldesign-brand-color-1);
      border-color: var(--ldesign-brand-color);
      color: var(--ldesign-brand-color);
    }

    .btn.active {
      background: var(--ldesign-brand-color);
      color: white;
      border-color: var(--ldesign-brand-color);
    }

    .btn.primary {
      background: var(--ldesign-brand-color);
      color: white;
      border-color: var(--ldesign-brand-color);
    }

    .btn.primary:hover {
      background: var(--ldesign-brand-color-8);
      border-color: var(--ldesign-brand-color-8);
    }

    .select-control {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid var(--ldesign-border-level-1-color);
      border-radius: 6px;
      background: white;
      font-size: 0.9rem;
    }

    .editor-area {
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .editor-toolbar {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      background: #f8f9fa;
      border: 1px solid var(--ldesign-border-level-1-color);
      border-bottom: none;
      border-radius: 8px 8px 0 0;
    }

    .toolbar-group {
      display: flex;
      gap: 5px;
      padding-right: 15px;
      border-right: 1px solid var(--ldesign-border-level-1-color);
    }

    .toolbar-group:last-child {
      border-right: none;
    }

    .editor-container {
      border: 1px solid var(--ldesign-border-level-1-color);
      border-radius: 0 0 8px 8px;
      min-height: 400px;
      background: white;
      position: relative;
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: #f8f9fa;
      border-top: 1px solid var(--ldesign-border-level-1-color);
      font-size: 0.85rem;
      color: var(--ldesign-text-color-secondary);
    }

    .output-panel {
      margin-top: 20px;
      background: #f8f9fa;
      border: 1px solid var(--ldesign-border-level-1-color);
      border-radius: 8px;
      overflow: hidden;
    }

    .output-header {
      padding: 12px 15px;
      background: white;
      border-bottom: 1px solid var(--ldesign-border-level-1-color);
      font-weight: 600;
      color: var(--ldesign-text-color-primary);
    }

    .output-content {
      padding: 15px;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85rem;
      background: #f8f9fa;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    /* 响应式设计 */
    @media (max-width: 1024px) {
      .main-content {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        border-right: none;
        border-bottom: 1px solid var(--ldesign-border-level-1-color);
      }
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .app-container {
        border-radius: 8px;
      }
      
      .app-header {
        padding: 20px;
      }
      
      .app-header h1 {
        font-size: 2rem;
      }
      
      .editor-area {
        padding: 15px;
      }
      
      .btn-group {
        gap: 5px;
      }
      
      .btn {
        padding: 6px 10px;
        font-size: 0.8rem;
      }
    }

    /* 编辑器内容样式 */
    .ldesign-editor {
      padding: 20px;
      line-height: 1.6;
      color: var(--ldesign-text-color-primary);
    }

    .ldesign-editor h1,
    .ldesign-editor h2,
    .ldesign-editor h3 {
      margin: 20px 0 10px 0;
      color: var(--ldesign-text-color-primary);
    }

    .ldesign-editor p {
      margin: 10px 0;
    }

    .ldesign-editor ul,
    .ldesign-editor ol {
      margin: 10px 0;
      padding-left: 30px;
    }

    .ldesign-editor blockquote {
      margin: 15px 0;
      padding: 10px 15px;
      border-left: 4px solid var(--ldesign-brand-color);
      background: var(--ldesign-brand-color-1);
      font-style: italic;
    }

    /* 加载动画 */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid var(--ldesign-brand-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="app-header">
      <h1>LDesign Editor</h1>
      <p>高级功能演示 - 完整的富文本编辑器体验</p>
    </div>

    <div class="main-content">
      <!-- 侧边栏控制面板 -->
      <div class="sidebar">
        <div class="control-group">
          <h3>🎨 主题设置</h3>
          <label for="themeSelect">选择主题</label>
          <select id="themeSelect" class="select-control" onchange="changeTheme(this.value)">
            <option value="default">默认主题</option>
            <option value="dark">暗色主题</option>
            <option value="minimal">简洁主题</option>
          </select>
        </div>

        <div class="control-group">
          <h3>📱 响应式测试</h3>
          <label>当前设备</label>
          <div id="deviceInfo" style="padding: 8px; background: white; border-radius: 4px; font-size: 0.9rem;">
            <div>类型: <span id="deviceType">-</span></div>
            <div>宽度: <span id="screenWidth">-</span>px</div>
          </div>
        </div>

        <div class="control-group">
          <h3>⚙️ 编辑器设置</h3>
          <div class="btn-group">
            <button class="btn" onclick="toggleReadonly()">
              <span id="readonlyText">设为只读</span>
            </button>
            <button class="btn" onclick="clearContent()">清空内容</button>
          </div>
        </div>

        <div class="control-group">
          <h3>💾 内容操作</h3>
          <div class="btn-group">
            <button class="btn primary" onclick="exportContent()">导出HTML</button>
            <button class="btn" onclick="importContent()">导入内容</button>
            <button class="btn" onclick="copyToClipboard()">复制内容</button>
          </div>
        </div>

        <div class="control-group">
          <h3>📊 编辑器状态</h3>
          <div id="editorStats" style="font-size: 0.85rem; color: var(--ldesign-text-color-secondary);">
            <div>字符数: <span id="charCount">0</span></div>
            <div>段落数: <span id="paragraphCount">0</span></div>
            <div>选中文本: <span id="selectedText">无</span></div>
          </div>
        </div>
      </div>

      <!-- 主编辑区域 -->
      <div class="editor-area">
        <!-- 工具栏 -->
        <div class="editor-toolbar">
          <div class="toolbar-group">
            <button class="btn" onclick="executeCommand('bold')" title="加粗">
              <strong>B</strong>
            </button>
            <button class="btn" onclick="executeCommand('italic')" title="斜体">
              <em>I</em>
            </button>
            <button class="btn" onclick="executeCommand('underline')" title="下划线">
              <u>U</u>
            </button>
          </div>
          
          <div class="toolbar-group">
            <button class="btn" onclick="executeCommand('heading1')" title="标题1">H1</button>
            <button class="btn" onclick="executeCommand('heading2')" title="标题2">H2</button>
            <button class="btn" onclick="executeCommand('heading3')" title="标题3">H3</button>
          </div>
          
          <div class="toolbar-group">
            <button class="btn" onclick="executeCommand('bulletList')" title="无序列表">• 列表</button>
            <button class="btn" onclick="executeCommand('orderedList')" title="有序列表">1. 列表</button>
            <button class="btn" onclick="executeCommand('blockquote')" title="引用">" 引用</button>
          </div>
          
          <div class="toolbar-group">
            <button class="btn" onclick="insertSampleContent()" title="插入示例内容">📝 示例</button>
            <button class="btn" onclick="insertCurrentTime()" title="插入时间">🕐 时间</button>
          </div>
        </div>

        <!-- 编辑器容器 -->
        <div id="editor" class="editor-container"></div>

        <!-- 状态栏 -->
        <div class="status-bar">
          <div>
            <span id="statusText">就绪</span>
          </div>
          <div>
            <span id="cursorPosition">行: 1, 列: 1</span>
          </div>
        </div>

        <!-- 输出面板 -->
        <div class="output-panel">
          <div class="output-header">
            📄 HTML 输出预览
          </div>
          <div id="htmlOutput" class="output-content">
            编辑器内容将在这里实时显示...
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // 模拟 LDesign Editor 的高级版本
    class AdvancedLDesignEditor {
      constructor(options) {
        this.container = typeof options.container === 'string' 
          ? document.querySelector(options.container)
          : options.container
        this.content = options.content || ''
        this.readonly = options.readonly || false
        this.theme = options.theme || 'default'
        this.onChange = options.onChange
        this.onSelectionChange = options.onSelectionChange
        this.initialized = false
        this.destroyed = false
        
        // 统计信息
        this.stats = {
          charCount: 0,
          paragraphCount: 0,
          selectedText: ''
        }
        
        // 模拟管理器
        this.themes = {
          setTheme: (theme) => {
            this.theme = theme
            this.updateThemeClass()
            this.updateStatus(`主题已切换到: ${theme}`)
          },
          getCurrentTheme: () => this.theme,
          getAllThemes: () => [
            { name: 'default', displayName: '默认主题' },
            { name: 'dark', displayName: '暗色主题' },
            { name: 'minimal', displayName: '简洁主题' }
          ]
        }
        
        this.responsive = {
          getCurrentDevice: () => {
            const width = window.innerWidth
            if (width < 768) return 'mobile'
            if (width < 1024) return 'tablet'
            return 'desktop'
          },
          getScreenWidth: () => window.innerWidth,
          onDeviceChange: (callback) => {
            window.addEventListener('resize', () => {
              callback(this.responsive.getCurrentDevice())
            })
          }
        }
        
        this.commands = {
          execute: (command) => {
            this.updateStatus(`执行命令: ${command}`)
            console.log(`Executing command: ${command}`)
            return { success: true }
          }
        }
      }
      
      init() {
        if (this.initialized) return
        
        this.container.contentEditable = true
        this.container.innerHTML = this.content || this.getDefaultContent()
        this.container.className = 'ldesign-editor'
        
        this.updateThemeClass()
        this.bindEvents()
        this.updateStats()
        this.updateDeviceInfo()
        
        this.initialized = true
        this.updateStatus('编辑器初始化完成')
        console.log('Advanced Editor initialized')
      }
      
      getDefaultContent() {
        return `
          <h1>欢迎使用 LDesign Editor</h1>
          <p>这是一个功能强大的富文本编辑器，支持多种格式和主题。</p>
          
          <h2>主要特性</h2>
          <ul>
            <li><strong>丰富的格式支持</strong> - 支持加粗、斜体、下划线等格式</li>
            <li><strong>多级标题</strong> - 支持 H1 到 H6 标题</li>
            <li><strong>列表功能</strong> - 支持有序和无序列表</li>
            <li><strong>引用块</strong> - 支持引用格式</li>
          </ul>
          
          <h3>主题系统</h3>
          <p>编辑器支持多种主题，您可以在左侧面板中切换不同的主题风格。</p>
          
          <blockquote>
            这是一个引用示例。您可以使用引用来突出显示重要内容。
          </blockquote>
          
          <h3>响应式设计</h3>
          <p>编辑器完美适配各种设备，包括桌面、平板和手机。调整浏览器窗口大小来体验响应式效果。</p>
          
          <p>开始编辑这些内容，体验强大的编辑功能吧！</p>
        `.trim()
      }
      
      updateThemeClass() {
        this.container.className = `ldesign-editor ldesign-editor-theme-${this.theme}`
        
        // 更新CSS变量以支持主题
        const root = document.documentElement
        if (this.theme === 'dark') {
          root.style.setProperty('--ldesign-bg-color-container', '#1a1a1a')
          root.style.setProperty('--ldesign-text-color-primary', 'rgba(255, 255, 255, 90%)')
          root.style.setProperty('--ldesign-text-color-secondary', 'rgba(255, 255, 255, 70%)')
          root.style.setProperty('--ldesign-border-level-1-color', '#333')
          this.container.style.background = '#1a1a1a'
          this.container.style.color = 'rgba(255, 255, 255, 90%)'
        } else if (this.theme === 'minimal') {
          root.style.setProperty('--ldesign-brand-color', '#666')
          this.container.style.background = '#fafafa'
        } else {
          // 恢复默认主题
          root.style.setProperty('--ldesign-bg-color-container', '#ffffff')
          root.style.setProperty('--ldesign-text-color-primary', 'rgba(0, 0, 0, 90%)')
          root.style.setProperty('--ldesign-text-color-secondary', 'rgba(0, 0, 0, 70%)')
          root.style.setProperty('--ldesign-border-level-1-color', '#e5e5e5')
          root.style.setProperty('--ldesign-brand-color', '#5e2aa7')
          this.container.style.background = 'white'
          this.container.style.color = 'rgba(0, 0, 0, 90%)'
        }
      }
      
      bindEvents() {
        // 内容变更事件
        this.container.addEventListener('input', () => {
          this.content = this.container.innerHTML
          this.updateStats()
          if (this.onChange) {
            this.onChange(this.content)
          }
        })
        
        // 选区变更事件
        this.container.addEventListener('selectionchange', () => {
          this.updateSelectionInfo()
        })
        
        // 焦点事件
        this.container.addEventListener('focus', () => {
          this.updateStatus('编辑器获得焦点')
        })
        
        this.container.addEventListener('blur', () => {
          this.updateStatus('编辑器失去焦点')
        })
      }
      
      updateStats() {
        const text = this.container.textContent || ''
        const paragraphs = this.container.querySelectorAll('p, h1, h2, h3, h4, h5, h6, li')
        
        this.stats.charCount = text.length
        this.stats.paragraphCount = paragraphs.length
        
        // 更新显示
        document.getElementById('charCount').textContent = this.stats.charCount
        document.getElementById('paragraphCount').textContent = this.stats.paragraphCount
      }
      
      updateSelectionInfo() {
        const selection = window.getSelection()
        const selectedText = selection.toString()
        
        this.stats.selectedText = selectedText
        document.getElementById('selectedText').textContent = selectedText || '无'
        
        if (this.onSelectionChange) {
          this.onSelectionChange(selection)
        }
      }
      
      updateDeviceInfo() {
        document.getElementById('deviceType').textContent = this.responsive.getCurrentDevice()
        document.getElementById('screenWidth').textContent = this.responsive.getScreenWidth()
      }
      
      updateStatus(message) {
        document.getElementById('statusText').textContent = message
        setTimeout(() => {
          document.getElementById('statusText').textContent = '就绪'
        }, 3000)
      }
      
      // 公共方法
      getContent() {
        return this.container.innerHTML
      }
      
      setContent(content) {
        this.container.innerHTML = content
        this.content = content
        this.updateStats()
        if (this.onChange) {
          this.onChange(content)
        }
      }
      
      clear() {
        this.setContent('')
      }
      
      setReadonly(readonly) {
        this.readonly = readonly
        this.container.contentEditable = !readonly
        this.container.style.backgroundColor = readonly ? '#f5f5f5' : 'white'
        this.updateStatus(readonly ? '已设为只读模式' : '已取消只读模式')
      }
      
      insertContent(content) {
        document.execCommand('insertHTML', false, content)
        this.updateStats()
      }
      
      exportHTML() {
        return this.getContent()
      }
      
      get state() {
        return {
          content: this.content,
          readonly: this.readonly,
          deviceType: this.responsive.getCurrentDevice(),
          stats: this.stats
        }
      }
    }
    
    // 全局变量
    window.AdvancedLDesignEditor = AdvancedLDesignEditor
    
    // 创建编辑器实例
    const editor = new AdvancedLDesignEditor({
      container: '#editor',
      onChange: (content) => {
        document.getElementById('htmlOutput').textContent = content
      },
      onSelectionChange: (selection) => {
        // 可以在这里处理选区变更
      }
    })
    
    // 初始化编辑器
    editor.init()
    
    // 全局函数
    window.executeCommand = (command) => {
      editor.commands.execute(command)
    }
    
    window.changeTheme = (theme) => {
      editor.themes.setTheme(theme)
    }
    
    window.toggleReadonly = () => {
      const isReadonly = editor.state.readonly
      editor.setReadonly(!isReadonly)
      document.getElementById('readonlyText').textContent = isReadonly ? '设为只读' : '取消只读'
    }
    
    window.clearContent = () => {
      if (confirm('确定要清空所有内容吗？')) {
        editor.clear()
      }
    }
    
    window.exportContent = () => {
      const content = editor.exportHTML()
      const blob = new Blob([content], { type: 'text/html' })
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a')
      a.href = url
      a.download = 'editor-content.html'
      a.click()
      URL.revokeObjectURL(url)
      editor.updateStatus('内容已导出')
    }
    
    window.importContent = () => {
      const input = document.createElement('input')
      input.type = 'file'
      input.accept = '.html,.txt'
      input.onchange = (e) => {
        const file = e.target.files[0]
        if (file) {
          const reader = new FileReader()
          reader.onload = (e) => {
            editor.setContent(e.target.result)
            editor.updateStatus('内容已导入')
          }
          reader.readAsText(file)
        }
      }
      input.click()
    }
    
    window.copyToClipboard = async () => {
      try {
        await navigator.clipboard.writeText(editor.getContent())
        editor.updateStatus('内容已复制到剪贴板')
      } catch (err) {
        editor.updateStatus('复制失败')
      }
    }
    
    window.insertSampleContent = () => {
      const sampleContent = `
        <h3>插入的示例内容</h3>
        <p>这是通过按钮插入的示例内容，包含了多种格式：</p>
        <ul>
          <li><strong>加粗文本</strong></li>
          <li><em>斜体文本</em></li>
          <li><u>下划线文本</u></li>
        </ul>
        <blockquote>这是一个引用块示例</blockquote>
      `
      editor.insertContent(sampleContent)
    }
    
    window.insertCurrentTime = () => {
      const now = new Date()
      const timeString = now.toLocaleString('zh-CN')
      editor.insertContent(`<p>插入时间: ${timeString}</p>`)
    }
    
    // 监听窗口大小变化
    window.addEventListener('resize', () => {
      editor.updateDeviceInfo()
    })
    
    // 初始化输出
    document.getElementById('htmlOutput').textContent = editor.getContent()
  </script>
</body>
</html>
