<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LDesign Editor - Vue 集成示例</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    /* 基础样式 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      background: #722ED1;
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .main-content {
      padding: 30px;
    }

    .demo-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .demo-section {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      border: 1px solid #e9ecef;
    }

    .demo-section h3 {
      margin-bottom: 15px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .editor-container {
      border: 1px solid #d9d9d9;
      border-radius: 6px;
      min-height: 200px;
      margin-bottom: 15px;
      background: white;
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .btn {
      padding: 8px 16px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
    }

    .btn:hover {
      background: #f0f0f0;
      border-color: #722ED1;
    }

    .btn.primary {
      background: #722ED1;
      color: white;
      border-color: #722ED1;
    }

    .btn.primary:hover {
      background: #5e2aa7;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #333;
    }

    .form-control {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .output {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 4px;
      padding: 15px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.85rem;
      max-height: 200px;
      overflow-y: auto;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: white;
      padding: 15px;
      border-radius: 6px;
      border: 1px solid #e9ecef;
      text-align: center;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #722ED1;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.85rem;
      color: #666;
    }

    .vue-features {
      background: #e8f5e8;
      border: 1px solid #c3e6c3;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .vue-features h4 {
      color: #2d5a2d;
      margin-bottom: 10px;
    }

    .vue-features ul {
      margin: 0;
      padding-left: 20px;
    }

    .vue-features li {
      color: #2d5a2d;
      margin-bottom: 5px;
    }

    @media (max-width: 768px) {
      .demo-grid {
        grid-template-columns: 1fr;
      }
      
      .main-content {
        padding: 20px;
      }
      
      .header {
        padding: 20px;
      }
      
      .header h1 {
        font-size: 2rem;
      }
    }

    /* Vue 过渡动画 */
    .fade-enter-active, .fade-leave-active {
      transition: opacity 0.3s ease;
    }
    .fade-enter-from, .fade-leave-to {
      opacity: 0;
    }

    .slide-enter-active, .slide-leave-active {
      transition: all 0.3s ease;
    }
    .slide-enter-from {
      transform: translateX(-20px);
      opacity: 0;
    }
    .slide-leave-to {
      transform: translateX(20px);
      opacity: 0;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="app-container">
      <div class="header">
        <h1>LDesign Editor</h1>
        <p>Vue 3 集成示例 - 响应式数据绑定与组件化</p>
      </div>

      <div class="main-content">
        <!-- Vue 特性说明 -->
        <div class="vue-features">
          <h4>🎯 Vue 集成特性</h4>
          <ul>
            <li>响应式数据绑定 - 编辑器内容与 Vue 数据双向同步</li>
            <li>组件化封装 - 可复用的编辑器组件</li>
            <li>生命周期管理 - 自动处理组件挂载和销毁</li>
            <li>事件处理 - Vue 风格的事件监听和处理</li>
            <li>计算属性 - 实时统计和状态计算</li>
          </ul>
        </div>

        <!-- 统计信息 -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value">{{ stats.charCount }}</div>
            <div class="stat-label">字符数</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ stats.wordCount }}</div>
            <div class="stat-label">单词数</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ stats.paragraphCount }}</div>
            <div class="stat-label">段落数</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ currentTheme }}</div>
            <div class="stat-label">当前主题</div>
          </div>
        </div>

        <div class="demo-grid">
          <!-- 主编辑器 -->
          <div class="demo-section">
            <h3>📝 主编辑器</h3>
            
            <div class="controls">
              <button class="btn" @click="executeCommand('bold')">加粗</button>
              <button class="btn" @click="executeCommand('italic')">斜体</button>
              <button class="btn" @click="executeCommand('underline')">下划线</button>
              <button class="btn" @click="executeCommand('heading1')">H1</button>
              <button class="btn" @click="executeCommand('heading2')">H2</button>
              <button class="btn" @click="executeCommand('bulletList')">列表</button>
            </div>

            <div ref="mainEditor" class="editor-container"></div>

            <div class="controls">
              <button class="btn primary" @click="saveContent">保存内容</button>
              <button class="btn" @click="clearContent">清空</button>
              <button class="btn" @click="toggleReadonly">
                {{ isReadonly ? '取消只读' : '设为只读' }}
              </button>
            </div>
          </div>

          <!-- 设置面板 -->
          <div class="demo-section">
            <h3>⚙️ 设置面板</h3>
            
            <div class="form-group">
              <label>主题选择</label>
              <select v-model="currentTheme" @change="changeTheme" class="form-control">
                <option value="default">默认主题</option>
                <option value="dark">暗色主题</option>
                <option value="minimal">简洁主题</option>
              </select>
            </div>

            <div class="form-group">
              <label>占位符文本</label>
              <input 
                v-model="placeholder" 
                @input="updatePlaceholder"
                class="form-control" 
                placeholder="输入占位符文本"
              >
            </div>

            <div class="form-group">
              <label>自动保存</label>
              <label style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" v-model="autoSave" @change="toggleAutoSave">
                启用自动保存 ({{ autoSaveInterval }}秒)
              </label>
            </div>

            <div class="form-group" v-if="autoSave">
              <label>保存间隔 (秒)</label>
              <input 
                type="range" 
                min="5" 
                max="60" 
                v-model="autoSaveInterval"
                class="form-control"
              >
            </div>
          </div>
        </div>

        <!-- 实时预览 -->
        <div class="demo-section">
          <h3>👁️ 实时预览</h3>
          
          <transition name="fade">
            <div v-if="content" class="output">
              {{ content }}
            </div>
            <div v-else class="output" style="color: #999; font-style: italic;">
              编辑器内容为空...
            </div>
          </transition>
        </div>

        <!-- 历史记录 -->
        <div class="demo-section" v-if="history.length > 0">
          <h3>📚 编辑历史</h3>
          
          <div style="max-height: 200px; overflow-y: auto;">
            <transition-group name="slide" tag="div">
              <div 
                v-for="(item, index) in history.slice(-10)" 
                :key="item.id"
                style="padding: 8px; border-bottom: 1px solid #eee; font-size: 0.85rem;"
              >
                <strong>{{ item.timestamp }}</strong>: {{ item.action }}
                <button 
                  class="btn" 
                  style="float: right; padding: 2px 8px; font-size: 0.8rem;"
                  @click="restoreFromHistory(item)"
                >
                  恢复
                </button>
              </div>
            </transition-group>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, computed, onMounted, onUnmounted, watch, nextTick } = Vue

    // 模拟 LDesign Editor
    class VueLDesignEditor {
      constructor(options) {
        this.container = options.container
        this.content = options.content || ''
        this.readonly = options.readonly || false
        this.theme = options.theme || 'default'
        this.placeholder = options.placeholder || ''
        this.onChange = options.onChange
        this.onSelectionChange = options.onSelectionChange
        this.initialized = false
      }
      
      init() {
        if (this.initialized) return
        
        this.container.contentEditable = !this.readonly
        this.container.innerHTML = this.content || this.getDefaultContent()
        this.container.style.padding = '15px'
        this.container.style.outline = 'none'
        this.container.style.minHeight = '150px'
        
        this.bindEvents()
        this.updateTheme()
        this.initialized = true
      }
      
      getDefaultContent() {
        return `
          <h2>Vue 集成示例</h2>
          <p>这是一个与 Vue 3 集成的富文本编辑器示例。</p>
          <ul>
            <li>支持响应式数据绑定</li>
            <li>自动同步编辑器状态</li>
            <li>组件化封装</li>
          </ul>
          <p>开始编辑内容，体验 Vue 的响应式特性！</p>
        `.trim()
      }
      
      bindEvents() {
        this.container.addEventListener('input', () => {
          this.content = this.container.innerHTML
          if (this.onChange) {
            this.onChange(this.content)
          }
        })
        
        this.container.addEventListener('selectionchange', () => {
          if (this.onSelectionChange) {
            this.onSelectionChange(window.getSelection())
          }
        })
      }
      
      updateTheme() {
        this.container.className = `editor-container ldesign-editor-theme-${this.theme}`
        
        if (this.theme === 'dark') {
          this.container.style.background = '#1a1a1a'
          this.container.style.color = 'white'
        } else if (this.theme === 'minimal') {
          this.container.style.background = '#fafafa'
          this.container.style.color = '#333'
        } else {
          this.container.style.background = 'white'
          this.container.style.color = '#333'
        }
      }
      
      setContent(content) {
        this.container.innerHTML = content
        this.content = content
        if (this.onChange) {
          this.onChange(content)
        }
      }
      
      getContent() {
        return this.container.innerHTML
      }
      
      setReadonly(readonly) {
        this.readonly = readonly
        this.container.contentEditable = !readonly
        this.container.style.backgroundColor = readonly ? '#f5f5f5' : 'white'
      }
      
      setTheme(theme) {
        this.theme = theme
        this.updateTheme()
      }
      
      executeCommand(command) {
        document.execCommand(command, false, null)
        if (this.onChange) {
          this.onChange(this.container.innerHTML)
        }
      }
      
      clear() {
        this.setContent('')
      }
      
      destroy() {
        if (this.container) {
          this.container.contentEditable = false
          this.container.innerHTML = ''
        }
      }
    }

    createApp({
      setup() {
        // 响应式数据
        const content = ref('')
        const currentTheme = ref('default')
        const placeholder = ref('请输入内容...')
        const isReadonly = ref(false)
        const autoSave = ref(false)
        const autoSaveInterval = ref(10)
        const history = ref([])
        
        // 编辑器实例
        const mainEditor = ref(null)
        let editorInstance = null
        let autoSaveTimer = null
        
        // 计算属性
        const stats = computed(() => {
          const text = content.value.replace(/<[^>]*>/g, '') // 移除HTML标签
          const words = text.trim().split(/\s+/).filter(word => word.length > 0)
          const paragraphs = content.value.split(/<\/p>|<\/h[1-6]>|<\/li>/).filter(p => p.trim().length > 0)
          
          return {
            charCount: text.length,
            wordCount: words.length,
            paragraphCount: paragraphs.length
          }
        })
        
        // 方法
        const initEditor = () => {
          if (mainEditor.value) {
            editorInstance = new VueLDesignEditor({
              container: mainEditor.value,
              content: content.value,
              theme: currentTheme.value,
              placeholder: placeholder.value,
              readonly: isReadonly.value,
              onChange: (newContent) => {
                content.value = newContent
                addToHistory('内容变更')
              },
              onSelectionChange: (selection) => {
                // 处理选区变更
              }
            })
            
            editorInstance.init()
          }
        }
        
        const executeCommand = (command) => {
          if (editorInstance) {
            editorInstance.executeCommand(command)
            addToHistory(`执行命令: ${command}`)
          }
        }
        
        const changeTheme = () => {
          if (editorInstance) {
            editorInstance.setTheme(currentTheme.value)
            addToHistory(`切换主题: ${currentTheme.value}`)
          }
        }
        
        const updatePlaceholder = () => {
          addToHistory(`更新占位符: ${placeholder.value}`)
        }
        
        const toggleReadonly = () => {
          isReadonly.value = !isReadonly.value
          if (editorInstance) {
            editorInstance.setReadonly(isReadonly.value)
            addToHistory(isReadonly.value ? '设为只读' : '取消只读')
          }
        }
        
        const saveContent = () => {
          // 模拟保存到服务器
          console.log('保存内容:', content.value)
          addToHistory('手动保存内容')
          alert('内容已保存！')
        }
        
        const clearContent = () => {
          if (confirm('确定要清空所有内容吗？')) {
            if (editorInstance) {
              editorInstance.clear()
              addToHistory('清空内容')
            }
          }
        }
        
        const toggleAutoSave = () => {
          if (autoSave.value) {
            startAutoSave()
            addToHistory('启用自动保存')
          } else {
            stopAutoSave()
            addToHistory('禁用自动保存')
          }
        }
        
        const startAutoSave = () => {
          stopAutoSave() // 清除之前的定时器
          autoSaveTimer = setInterval(() => {
            if (content.value.trim()) {
              console.log('自动保存:', content.value)
              addToHistory('自动保存')
            }
          }, autoSaveInterval.value * 1000)
        }
        
        const stopAutoSave = () => {
          if (autoSaveTimer) {
            clearInterval(autoSaveTimer)
            autoSaveTimer = null
          }
        }
        
        const addToHistory = (action) => {
          const now = new Date()
          history.value.push({
            id: Date.now(),
            timestamp: now.toLocaleTimeString(),
            action: action,
            content: content.value
          })
          
          // 限制历史记录数量
          if (history.value.length > 50) {
            history.value = history.value.slice(-50)
          }
        }
        
        const restoreFromHistory = (item) => {
          if (confirm(`确定要恢复到 ${item.timestamp} 的状态吗？`)) {
            content.value = item.content
            if (editorInstance) {
              editorInstance.setContent(item.content)
            }
            addToHistory(`恢复历史记录: ${item.timestamp}`)
          }
        }
        
        // 监听器
        watch(autoSaveInterval, () => {
          if (autoSave.value) {
            startAutoSave()
          }
        })
        
        // 生命周期
        onMounted(() => {
          nextTick(() => {
            initEditor()
            addToHistory('编辑器初始化')
          })
        })
        
        onUnmounted(() => {
          if (editorInstance) {
            editorInstance.destroy()
          }
          stopAutoSave()
        })
        
        return {
          // 数据
          content,
          currentTheme,
          placeholder,
          isReadonly,
          autoSave,
          autoSaveInterval,
          history,
          stats,
          
          // 引用
          mainEditor,
          
          // 方法
          executeCommand,
          changeTheme,
          updatePlaceholder,
          toggleReadonly,
          saveContent,
          clearContent,
          toggleAutoSave,
          restoreFromHistory
        }
      }
    }).mount('#app')
  </script>
</body>
</html>
