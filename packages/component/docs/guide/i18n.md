# 国际化

LDesign 提供了完整的国际化（i18n）支持，帮助你构建多语言应用程序。

## 基础概念

### 什么是国际化

国际化（Internationalization，简称 i18n）是指设计和开发应用程序，使其能够适应不同的语言、地区和文化，而无需进行工程更改。

### LDesign 的 i18n 特性

- **多语言支持** - 内置多种语言包
- **动态切换** - 运行时动态切换语言
- **自定义翻译** - 支持自定义翻译内容
- **RTL 支持** - 支持从右到左的语言
- **日期时间格式化** - 本地化的日期时间显示

## 快速开始

### 基础用法

```javascript
import { setLocale, getLocale } from '@ldesign/components/dist/utils/i18n';

// 设置语言为中文
setLocale('zh-CN');

// 设置语言为英文
setLocale('en-US');

// 获取当前语言
const currentLocale = getLocale(); // 'zh-CN'
```

### HTML 中使用

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>LDesign 国际化示例</title>
</head>
<body>
  <!-- 组件会自动使用当前设置的语言 -->
  <ld-button type="primary">按钮</ld-button>
  <ld-input placeholder="请输入内容"></ld-input>
  
  <script type="module">
    import { defineCustomElements } from '@ldesign/components/loader';
    import { setLocale } from '@ldesign/components/dist/utils/i18n';
    
    defineCustomElements();
    setLocale('zh-CN');
  </script>
</body>
</html>
```

## 支持的语言

LDesign 内置了以下语言支持：

| 语言 | 代码 | 状态 |
|------|------|------|
| 简体中文 | zh-CN | ✅ 完整支持 |
| 繁体中文 | zh-TW | ✅ 完整支持 |
| 英语 | en-US | ✅ 完整支持 |
| 日语 | ja-JP | ✅ 完整支持 |
| 韩语 | ko-KR | ✅ 完整支持 |
| 法语 | fr-FR | 🚧 部分支持 |
| 德语 | de-DE | 🚧 部分支持 |
| 西班牙语 | es-ES | 🚧 部分支持 |

## 语言包结构

### 默认语言包

```javascript
// zh-CN.js
export default {
  common: {
    confirm: '确定',
    cancel: '取消',
    ok: '好的',
    close: '关闭',
    loading: '加载中...',
    noData: '暂无数据',
    total: '共 {total} 条',
  },
  button: {
    loading: '加载中...',
  },
  input: {
    placeholder: '请输入',
  },
  modal: {
    confirm: '确定',
    cancel: '取消',
  },
  table: {
    noData: '暂无数据',
    total: '共 {total} 条记录',
  },
  form: {
    required: '此字段为必填项',
    invalid: '格式不正确',
  },
  pagination: {
    prev: '上一页',
    next: '下一页',
    goto: '跳至',
    page: '页',
    total: '共 {total} 条',
    pageSize: '条/页',
  },
};
```

### 英文语言包

```javascript
// en-US.js
export default {
  common: {
    confirm: 'Confirm',
    cancel: 'Cancel',
    ok: 'OK',
    close: 'Close',
    loading: 'Loading...',
    noData: 'No Data',
    total: 'Total {total} items',
  },
  button: {
    loading: 'Loading...',
  },
  input: {
    placeholder: 'Please input',
  },
  modal: {
    confirm: 'Confirm',
    cancel: 'Cancel',
  },
  table: {
    noData: 'No Data',
    total: 'Total {total} records',
  },
  form: {
    required: 'This field is required',
    invalid: 'Invalid format',
  },
  pagination: {
    prev: 'Previous',
    next: 'Next',
    goto: 'Go to',
    page: 'Page',
    total: 'Total {total} items',
    pageSize: 'items per page',
  },
};
```

## 自定义语言包

### 添加新语言

```javascript
import { addLocale, setLocale } from '@ldesign/components/dist/utils/i18n';

// 添加俄语支持
const ruRU = {
  common: {
    confirm: 'Подтвердить',
    cancel: 'Отмена',
    ok: 'ОК',
    close: 'Закрыть',
    loading: 'Загрузка...',
    noData: 'Нет данных',
    total: 'Всего {total} элементов',
  },
  button: {
    loading: 'Загрузка...',
  },
  // ... 其他翻译
};

// 注册语言包
addLocale('ru-RU', ruRU);

// 使用新语言
setLocale('ru-RU');
```

### 覆盖默认翻译

```javascript
import { updateLocale } from '@ldesign/components/dist/utils/i18n';

// 覆盖部分中文翻译
updateLocale('zh-CN', {
  common: {
    confirm: '确认', // 将"确定"改为"确认"
    loading: '正在加载...', // 自定义加载文本
  },
  button: {
    loading: '请稍候...', // 自定义按钮加载文本
  },
});
```

## 在组件中使用

### 获取翻译文本

```javascript
import { t } from '@ldesign/components/dist/utils/i18n';

// 获取翻译文本
const confirmText = t('common.confirm'); // "确定" 或 "Confirm"
const loadingText = t('common.loading'); // "加载中..." 或 "Loading..."

// 带参数的翻译
const totalText = t('common.total', { total: 100 }); // "共 100 条" 或 "Total 100 items"
```

### 在自定义组件中使用

```javascript
class CustomComponent extends HTMLElement {
  constructor() {
    super();
    this.render();
    
    // 监听语言变化
    document.addEventListener('localeChange', () => {
      this.render();
    });
  }
  
  render() {
    const confirmText = t('common.confirm');
    const cancelText = t('common.cancel');
    
    this.innerHTML = `
      <div class="custom-dialog">
        <div class="dialog-content">
          <p>确认执行此操作吗？</p>
          <div class="dialog-actions">
            <ld-button type="primary">${confirmText}</ld-button>
            <ld-button>${cancelText}</ld-button>
          </div>
        </div>
      </div>
    `;
  }
}
```

## 动态语言切换

### 语言切换器

```html
<div class="language-switcher">
  <select id="language-select">
    <option value="zh-CN">简体中文</option>
    <option value="zh-TW">繁體中文</option>
    <option value="en-US">English</option>
    <option value="ja-JP">日本語</option>
    <option value="ko-KR">한국어</option>
  </select>
</div>

<script>
import { setLocale, getLocale } from '@ldesign/components/dist/utils/i18n';

const languageSelect = document.getElementById('language-select');

// 设置当前语言
languageSelect.value = getLocale();

// 监听语言切换
languageSelect.addEventListener('change', (event) => {
  const newLocale = event.target.value;
  setLocale(newLocale);
  
  // 保存用户偏好
  localStorage.setItem('preferred-language', newLocale);
  
  // 可选：刷新页面以确保所有内容都更新
  // window.location.reload();
});

// 页面加载时恢复用户偏好
const savedLanguage = localStorage.getItem('preferred-language');
if (savedLanguage) {
  setLocale(savedLanguage);
  languageSelect.value = savedLanguage;
}
</script>
```

### 自动检测语言

```javascript
import { setLocale, hasLocale } from '@ldesign/components/dist/utils/i18n';

function detectAndSetLanguage() {
  // 1. 检查 URL 参数
  const urlParams = new URLSearchParams(window.location.search);
  const urlLang = urlParams.get('lang');
  if (urlLang && hasLocale(urlLang)) {
    setLocale(urlLang);
    return;
  }
  
  // 2. 检查本地存储
  const savedLang = localStorage.getItem('preferred-language');
  if (savedLang && hasLocale(savedLang)) {
    setLocale(savedLang);
    return;
  }
  
  // 3. 检查浏览器语言
  const browserLang = navigator.language || navigator.languages[0];
  const supportedLangs = ['zh-CN', 'zh-TW', 'en-US', 'ja-JP', 'ko-KR'];
  
  for (const lang of supportedLangs) {
    if (browserLang.startsWith(lang.split('-')[0])) {
      setLocale(lang);
      return;
    }
  }
  
  // 4. 默认语言
  setLocale('zh-CN');
}

// 页面加载时自动检测
detectAndSetLanguage();
```

## RTL 支持

### 启用 RTL

```javascript
import { setLocale, setDirection } from '@ldesign/components/dist/utils/i18n';

// 设置阿拉伯语并启用 RTL
setLocale('ar-SA');
setDirection('rtl');

// 或者自动根据语言设置方向
function setLocaleWithDirection(locale) {
  setLocale(locale);
  
  const rtlLanguages = ['ar', 'he', 'fa', 'ur'];
  const isRTL = rtlLanguages.some(lang => locale.startsWith(lang));
  
  setDirection(isRTL ? 'rtl' : 'ltr');
  document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
}
```

### RTL 样式

```css
/* RTL 样式支持 */
[dir="rtl"] ld-button {
  /* RTL 特定样式 */
}

[dir="rtl"] ld-input {
  text-align: right;
}

[dir="rtl"] .ld-form-item__label {
  text-align: left;
}
```

## 日期时间本地化

### 日期格式化

```javascript
import { formatDate, formatTime } from '@ldesign/components/dist/utils/i18n';

const date = new Date();

// 根据当前语言格式化日期
const formattedDate = formatDate(date); 
// zh-CN: "2024年1月15日"
// en-US: "January 15, 2024"
// ja-JP: "2024年1月15日"

// 格式化时间
const formattedTime = formatTime(date);
// zh-CN: "下午 3:30"
// en-US: "3:30 PM"
// ja-JP: "午後 3:30"
```

### 相对时间

```javascript
import { formatRelativeTime } from '@ldesign/components/dist/utils/i18n';

const now = new Date();
const pastDate = new Date(now.getTime() - 2 * 60 * 60 * 1000); // 2小时前

const relativeTime = formatRelativeTime(pastDate);
// zh-CN: "2小时前"
// en-US: "2 hours ago"
// ja-JP: "2時間前"
```

## 数字本地化

### 数字格式化

```javascript
import { formatNumber, formatCurrency } from '@ldesign/components/dist/utils/i18n';

const number = 1234567.89;

// 格式化数字
const formattedNumber = formatNumber(number);
// zh-CN: "1,234,567.89"
// en-US: "1,234,567.89"
// de-DE: "1.234.567,89"

// 格式化货币
const formattedCurrency = formatCurrency(number, 'CNY');
// zh-CN: "¥1,234,567.89"
// en-US: "CN¥1,234,567.89"
```

## 最佳实践

### 1. 文本外部化

```javascript
// ❌ 避免：硬编码文本
const button = document.createElement('ld-button');
button.textContent = '提交';

// ✅ 推荐：使用翻译函数
const button = document.createElement('ld-button');
button.textContent = t('common.submit');
```

### 2. 处理复数形式

```javascript
// 复数规则
const pluralRules = {
  'zh-CN': (n) => 0, // 中文没有复数形式
  'en-US': (n) => n === 1 ? 0 : 1, // 英文复数规则
};

function formatPlural(key, count, locale) {
  const rule = pluralRules[locale] || pluralRules['en-US'];
  const pluralIndex = rule(count);
  return t(`${key}.${pluralIndex}`, { count });
}

// 使用示例
const itemCount = 5;
const text = formatPlural('items', itemCount, getLocale());
// zh-CN: "5个项目"
// en-US: "5 items"
```

### 3. 上下文相关翻译

```javascript
// 根据上下文提供不同翻译
const contextualTranslations = {
  'button.save': {
    'form': '保存',
    'document': '存储',
    'game': '存档',
  }
};

function tWithContext(key, context) {
  const contextual = contextualTranslations[key];
  if (contextual && contextual[context]) {
    return contextual[context];
  }
  return t(key);
}
```

### 4. 翻译缺失处理

```javascript
import { onTranslationMissing } from '@ldesign/components/dist/utils/i18n';

// 处理翻译缺失
onTranslationMissing((key, locale) => {
  console.warn(`Missing translation: ${key} for locale: ${locale}`);
  
  // 上报到监控系统
  // analytics.reportMissingTranslation(key, locale);
  
  // 返回默认值
  return `[${key}]`;
});
```

## 工具和工作流

### 翻译文件管理

建议的目录结构：

```
src/
  locales/
    zh-CN/
      common.json
      components.json
      pages.json
    en-US/
      common.json
      components.json
      pages.json
    ja-JP/
      common.json
      components.json
      pages.json
```

### 自动化翻译检查

```javascript
// 翻译完整性检查脚本
const fs = require('fs');
const path = require('path');

function checkTranslationCompleteness() {
  const localesDir = path.join(__dirname, 'src/locales');
  const languages = fs.readdirSync(localesDir);
  const baseLanguage = 'zh-CN';
  
  const baseTranslations = loadTranslations(baseLanguage);
  const allKeys = getAllKeys(baseTranslations);
  
  languages.forEach(lang => {
    if (lang === baseLanguage) return;
    
    const translations = loadTranslations(lang);
    const missingKeys = findMissingKeys(allKeys, translations);
    
    if (missingKeys.length > 0) {
      console.log(`Missing translations in ${lang}:`);
      missingKeys.forEach(key => console.log(`  - ${key}`));
    }
  });
}
```

## 总结

LDesign 的国际化系统提供了：

1. **完整的多语言支持** - 内置多种语言包
2. **灵活的自定义能力** - 支持添加和修改翻译
3. **动态语言切换** - 运行时切换语言
4. **RTL 支持** - 支持从右到左的语言
5. **本地化格式** - 日期、时间、数字的本地化

通过合理使用这些功能，你可以轻松构建支持多语言的国际化应用程序。
