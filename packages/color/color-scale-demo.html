<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>改进后的色阶效果演示</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 40px;
      }

      .theme-section {
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 32px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .theme-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 16px;
        color: #333;
      }

      .color-row {
        margin-bottom: 20px;
      }

      .color-label {
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 8px;
        color: #666;
      }

      .color-scale {
        display: flex;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .color-item {
        flex: 1;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 500;
        color: white;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        transition: transform 0.2s;
      }

      .color-item:hover {
        transform: scale(1.05);
        z-index: 1;
        position: relative;
      }

      .mode-toggle {
        text-align: center;
        margin-bottom: 30px;
      }

      .toggle-btn {
        background: #1677ff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .toggle-btn:hover {
        background: #0958d9;
      }

      .comparison {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
      }

      .comparison-item {
        background: white;
        padding: 16px;
        border-radius: 8px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
      }

      .comparison-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 12px;
        color: #333;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🎨 基于chroma-js的色阶生成效果</h1>

      <div class="mode-toggle">
        <button class="toggle-btn" onclick="toggleMode()">切换到<span id="mode-text">暗色</span>模式</button>
      </div>

      <div id="themes-container">
        <!-- 主题色阶将通过JavaScript生成 -->
      </div>
    </div>

    <script type="module">
      // 模拟色阶生成算法
      function hexToHsl(hex) {
        const r = parseInt(hex.slice(1, 3), 16) / 255
        const g = parseInt(hex.slice(3, 5), 16) / 255
        const b = parseInt(hex.slice(5, 7), 16) / 255

        const max = Math.max(r, g, b)
        const min = Math.min(r, g, b)
        let h,
          s,
          l = (max + min) / 2

        if (max === min) {
          h = s = 0
        } else {
          const d = max - min
          s = l > 0.5 ? d / (2 - max - min) : d / (max + min)
          switch (max) {
            case r:
              h = (g - b) / d + (g < b ? 6 : 0)
              break
            case g:
              h = (b - r) / d + 2
              break
            case b:
              h = (r - g) / d + 4
              break
          }
          h /= 6
        }

        return { h: h * 360, s: s * 100, l: l * 100 }
      }

      function hslToHex(h, s, l) {
        h = h % 360
        s = Math.max(0, Math.min(100, s)) / 100
        l = Math.max(0, Math.min(100, l)) / 100

        const c = (1 - Math.abs(2 * l - 1)) * s
        const x = c * (1 - Math.abs(((h / 60) % 2) - 1))
        const m = l - c / 2

        let r, g, b
        if (h >= 0 && h < 60) {
          r = c
          g = x
          b = 0
        } else if (h >= 60 && h < 120) {
          r = x
          g = c
          b = 0
        } else if (h >= 120 && h < 180) {
          r = 0
          g = c
          b = x
        } else if (h >= 180 && h < 240) {
          r = 0
          g = x
          b = c
        } else if (h >= 240 && h < 300) {
          r = x
          g = 0
          b = c
        } else {
          r = c
          g = 0
          b = x

        r = Math.round((r + m) * 255)
        g = Math.round((g + m) * 255)
        b = Math.round((b + m) * 255)

        return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`
      }

      // 修复后的色阶生成算法 - 匹配后端逻辑
      function generateColorScale(baseColor, count = 12, mode = 'light') {
        const colors = []
        const baseHsl = hexToHsl(baseColor)

        for (let i = 0; i < count; i++) {
          const factor = i / (count - 1)
          let lightness

          if (mode === 'dark') {
            // 暗色模式：从深到浅（1级=最深色，12级=最浅色）
            lightness = 5 + factor * 80 // 从5到85
          } else {
            // 亮色模式：从浅到深（1级=最浅色，12级=最深色）
            lightness = 95 - factor * 90 // 从95到5
          }

          // 保持饱和度相对稳定，在中间位置稍微提高
          const saturationFactor = 1.0 - Math.abs(factor - 0.5) * 0.3
          const saturation = baseHsl.s * saturationFactor

          colors.push(hslToHex(baseHsl.h, saturation, lightness))
        }

        return colors
      }

      function easeInOutCubic(t) {
        return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2
      }

      // 测试主题
      const themes = {
        海洋蓝: '#1677ff',
        翡翠绿: '#00b96b',
        珊瑚红: '#ff4d4f',
        紫罗兰: '#722ed1',
        日落橙: '#fa8c16',
        天空青: '#13c2c2',
        樱花粉: '#eb2f96',
        金盏花: '#faad14',
        石墨灰: '#595959',
      }

      let currentMode = 'light'

      function renderThemes() {
        const container = document.getElementById('themes-container')
        container.innerHTML = ''

        Object.entries(themes).forEach(([name, color]) => {
          const section = document.createElement('div')
          section.className = 'theme-section'

          const title = document.createElement('div')
          title.className = 'theme-title'
          title.textContent = `${name} (${color})`
          section.appendChild(title)

          // 主色调色阶
          const primaryRow = document.createElement('div')
          primaryRow.className = 'color-row'

          const primaryLabel = document.createElement('div')
          primaryLabel.className = 'color-label'
          primaryLabel.textContent = '主色调 (12级)'
          primaryRow.appendChild(primaryLabel)

          const primaryScale = document.createElement('div')
          primaryScale.className = 'color-scale'

          const primaryColors = generateColorScale(color, 12, currentMode)
          primaryColors.forEach((c, index) => {
            const item = document.createElement('div')
            item.className = 'color-item'
            item.style.backgroundColor = c
            item.textContent = index + 1
            item.title = c
            item.onclick = () => navigator.clipboard?.writeText(c)
            primaryScale.appendChild(item)
          })

          primaryRow.appendChild(primaryScale)
          section.appendChild(primaryRow)

          container.appendChild(section)
        })
      }

      window.toggleMode = function () {
        currentMode = currentMode === 'light' ? 'dark' : 'light'
        document.getElementById('mode-text').textContent = currentMode === 'light' ? '暗色' : '亮色'
        renderThemes()
      }

      // 初始渲染
      renderThemes()
    </script>
  </body>
</html>
