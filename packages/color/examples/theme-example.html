<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>@ldesign/color - Theme Generation Example</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1, h2, h3 {
      color: #333;
    }
    .controls {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    .color-input {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    .color-input input[type="color"] {
      width: 50px;
      height: 40px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .color-input input[type="text"] {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    .btn {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    .btn:hover {
      background: #0056b3;
    }
    .palette-section {
      margin-bottom: 30px;
    }
    .palette-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    .color-box {
      height: 60px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 12px;
      font-weight: bold;
      transition: transform 0.2s;
      cursor: pointer;
      position: relative;
    }
    .color-box:hover {
      transform: scale(1.05);
    }
    .color-label {
      background: rgba(0, 0, 0, 0.5);
      padding: 2px 6px;
      border-radius: 2px;
    }
    .css-output {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 15px;
    }
    .demo-elements {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .demo-card {
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      color: white;
    }
    .demo-primary { background: var(--color-primary-6); }
    .demo-success { background: var(--color-success-6); }
    .demo-warning { background: var(--color-warning-6); }
    .demo-danger { background: var(--color-danger-6); }
    .demo-info { background: var(--color-info-6); }
    
    .gray-scale {
      display: flex;
      gap: 5px;
      margin-top: 15px;
    }
    .gray-box {
      flex: 1;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¨ @ldesign/color - Theme Generation Example</h1>
  
  <div class="controls">
    <h3>Theme Configuration</h3>
    <div class="color-input">
      <label>Primary Color:</label>
      <input type="color" id="primaryColor" value="#1890ff">
      <input type="text" id="primaryHex" value="#1890ff">
    </div>
    
    <label>
      <input type="checkbox" id="generateScales" checked> Generate Color Scales
    </label>
    <br><br>
    
    <label>
      <input type="checkbox" id="includeGrays" checked> Include Gray Scale
    </label>
    <br><br>
    
    <button class="btn" onclick="generateTheme()">Generate Theme</button>
    <button class="btn" onclick="applyToPage()">Apply to Page</button>
    <button class="btn" onclick="downloadCSS()">Download CSS</button>
  </div>

  <div class="palette-section">
    <h3>Primary Palette</h3>
    <div class="palette-grid" id="primaryPalette"></div>
  </div>

  <div class="palette-section">
    <h3>Success Palette</h3>
    <div class="palette-grid" id="successPalette"></div>
  </div>

  <div class="palette-section">
    <h3>Warning Palette</h3>
    <div class="palette-grid" id="warningPalette"></div>
  </div>

  <div class="palette-section">
    <h3>Danger Palette</h3>
    <div class="palette-grid" id="dangerPalette"></div>
  </div>

  <div class="palette-section">
    <h3>Info Palette</h3>
    <div class="palette-grid" id="infoPalette"></div>
  </div>

  <div class="palette-section">
    <h3>Gray Scale</h3>
    <div class="gray-scale" id="grayPalette"></div>
  </div>

  <div class="palette-section">
    <h3>Demo Elements</h3>
    <div class="demo-elements">
      <div class="demo-card demo-primary">Primary</div>
      <div class="demo-card demo-success">Success</div>
      <div class="demo-card demo-warning">Warning</div>
      <div class="demo-card demo-danger">Danger</div>
      <div class="demo-card demo-info">Info</div>
    </div>
  </div>

  <div class="palette-section">
    <h3>Generated CSS Variables</h3>
    <div class="css-output" id="cssOutput"></div>
  </div>

  <script type="module">
    // Import the color library (in real usage, this would be from npm)
    // For demo purposes, we'll simulate the functions
    
    // Simulated Color library functions
    const Color = {
      fromHex: (hex) => ({ hex, toHSL: () => hexToHSL(hex) }),
      fromHSL: (h, s, l) => ({ hex: hslToHex(h, s, l) })
    };
    
    function hexToHSL(hex) {
      const r = parseInt(hex.slice(1, 3), 16) / 255;
      const g = parseInt(hex.slice(3, 5), 16) / 255;
      const b = parseInt(hex.slice(5, 7), 16) / 255;
      
      const max = Math.max(r, g, b);
      const min = Math.min(r, g, b);
      const l = (max + min) / 2;
      let h = 0, s = 0;
      
      if (max !== min) {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        
        switch (max) {
          case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
          case g: h = ((b - r) / d + 2) / 6; break;
          case b: h = ((r - g) / d + 4) / 6; break;
        }
      }
      
      return { h: h * 360, s: s * 100, l: l * 100 };
    }
    
    function hslToHex(h, s, l) {
      h = h / 360;
      s = s / 100;
      l = l / 100;
      
      let r, g, b;
      if (s === 0) {
        r = g = b = l;
      } else {
        const hue2rgb = (p, q, t) => {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1/6) return p + (q - p) * 6 * t;
          if (t < 1/2) return q;
          if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
          return p;
        };
        
        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
      }
      
      const toHex = x => {
        const hex = Math.round(x * 255).toString(16);
        return hex.length === 1 ? '0' + hex : hex;
      };
      
      return '#' + toHex(r) + toHex(g) + toHex(b);
    }
    
    // Natural semantic color generation based on a-nice-red algorithm
    function generateNaturalSemanticColors(primaryHex) {
      const primary = hexToHSL(primaryHex);
      
      // Generate success color
      let successH, successS, successL;
      if (primary.h < 25 || primary.h >= 335) {
        successH = 120;
      } else if (primary.h >= 25 && primary.h < 75) {
        successH = 80;
      } else if (primary.h >= 75 && primary.h < 150) {
        successH = primary.h;
      } else if (primary.h >= 150 && primary.h < 210) {
        successH = 90;
      } else if (primary.h >= 210 && primary.h < 285) {
        successH = 100;
      } else {
        successH = 130;
      }
      successS = Math.min(70, Math.max(55, primary.s - 5));
      successL = Math.min(60, Math.max(45, primary.l + 5));
      
      // Generate warning color
      let warningH, warningS, warningL;
      if (primary.h >= 240 || primary.h < 60) {
        warningH = 42;
      } else if (primary.h >= 60 && primary.h < 140) {
        warningH = 40;
      } else if (primary.h >= 140 && primary.h < 240) {
        warningH = 38;
      } else {
        warningH = primary.h;
      }
      warningS = Math.min(100, Math.max(80, primary.s + 5));
      warningL = Math.min(65, Math.max(55, primary.l + 15));
      
      // Generate danger color
      let dangerH, dangerS, dangerL;
      if (primary.h >= 15 && primary.h < 60) {
        dangerH = 5;
      } else if (primary.h >= 60 && primary.h < 140) {
        dangerH = 10;
      } else if (primary.h >= 140 && primary.h < 190) {
        dangerH = 357;
      } else if (primary.h >= 190 && primary.h < 240) {
        dangerH = 0;
      } else if (primary.h >= 240 && primary.h < 350) {
        dangerH = 355;
      } else {
        dangerH = primary.h;
      }
      dangerS = Math.min(85, Math.max(75, primary.s));
      dangerL = Math.min(55, Math.max(45, primary.l + 5));
      
      // Generate info color
      let infoH, infoS, infoL;
      if (primary.h >= 180 && primary.h < 240) {
        infoH = primary.h;
      } else if (primary.h < 60 || primary.h >= 300) {
        infoH = 210;
      } else if (primary.h >= 60 && primary.h < 180) {
        infoH = 200;
      } else {
        infoH = 220;
      }
      infoS = Math.min(75, Math.max(60, primary.s - 10));
      infoL = Math.min(60, Math.max(45, primary.l));
      
      return {
        primary: primaryHex,
        success: hslToHex(successH, successS, successL),
        warning: hslToHex(warningH, warningS, warningL),
        danger: hslToHex(dangerH, dangerS, dangerL),
        info: hslToHex(infoH, infoS, infoL)
      };
    }
    
    // Natural scale generation with tailwindcss-palette-generator algorithm
    function generateNaturalScale(baseHex) {
      const baseHSL = hexToHSL(baseHex);
      const shades = [
        { name: 1, lightness: 98 },
        { name: 2, lightness: 95 },
        { name: 3, lightness: 90 },
        { name: 4, lightness: 82 },
        { name: 5, lightness: 64 },
        { name: 6, lightness: 46 },
        { name: 7, lightness: 33 },
        { name: 8, lightness: 24 },
        { name: 9, lightness: 14 },
        { name: 10, lightness: 7 }
      ];
      
      const palette = {};
      let closestShade = null;
      let closestDelta = Infinity;
      
      shades.forEach(({ name, lightness }) => {
        let h = baseHSL.h;
        let s = baseHSL.s;
        let l = lightness;
        
        // Adjust saturation at extremes for natural look
        if (lightness > 90) {
          s = s * (0.3 + (100 - lightness) * 0.07);
        } else if (lightness > 70) {
          s = s * (0.7 + (90 - lightness) * 0.015);
        } else if (lightness < 20) {
          s = s * (0.8 + lightness * 0.01);
        } else if (lightness < 40) {
          s = s * (0.9 + (lightness - 20) * 0.005);
        }
        
        // Slight hue shift at extremes
        if (lightness > 85) {
          h = (h + 2) % 360;
        } else if (lightness < 15) {
          h = (h - 2 + 360) % 360;
        }
        
        palette[name] = hslToHex(h, s, l);
        
        // Track closest shade to preserve original
        const delta = Math.abs(baseHSL.l - lightness);
        if (delta < closestDelta) {
          closestDelta = delta;
          closestShade = name;
        }
      });
      
      // Preserve original color at closest shade
      if (closestShade) {
        palette[closestShade] = baseHex;
      }
      
      return palette;
    }
    
    // Natural gray scale with tint
    function generateNaturalGrayScale(primaryHSL) {
      let tintHue;
      if (primaryHSL.h < 40 || primaryHSL.h >= 160) {
        tintHue = 200;
      } else if (primaryHSL.h >= 40 && primaryHSL.h < 100) {
        tintHue = 220;
      } else {
        tintHue = 210;
      }
      
      const grays = {};
      const shades = [
        { name: 1, lightness: 98 },
        { name: 2, lightness: 95 },
        { name: 3, lightness: 90 },
        { name: 4, lightness: 82 },
        { name: 5, lightness: 64 },
        { name: 6, lightness: 46 },
        { name: 7, lightness: 33 },
        { name: 8, lightness: 24 },
        { name: 9, lightness: 14 },
        { name: 10, lightness: 7 }
      ];
      
      shades.forEach(({ name, lightness }) => {
        let saturation;
        if (lightness > 90 || lightness < 10) {
          saturation = 2;
        } else if (lightness > 70 || lightness < 30) {
          saturation = 5;
        } else {
          saturation = 8;
        }
        grays[name] = hslToHex(tintHue, saturation, lightness);
      });
      
      return grays;
    }
    
    function generateThemePalette(primaryHex) {
      const primaryHSL = hexToHSL(primaryHex);
      const semanticColors = generateNaturalSemanticColors(primaryHex);
      const theme = {};
      
      // Generate natural scales for each semantic color
      Object.entries(semanticColors).forEach(([key, baseHex]) => {
        theme[key] = generateNaturalScale(baseHex);
      });
      
      // Generate natural gray scale
      theme.gray = generateNaturalGrayScale(primaryHSL);
      
      return theme;
    }
    
    function generateCSSVariables(theme, prefix = '--color') {
      const lines = [];
      
      Object.entries(theme).forEach(([colorName, shades]) => {
        Object.entries(shades).forEach(([shade, hex]) => {
          lines.push(`  ${prefix}-${colorName}-${shade}: ${hex};`);
        });
      });
      
      return `:root {\n${lines.join('\n')}\n}`;
    }
    
    let currentTheme = null;
    let currentCSS = null;
    
    window.generateTheme = function() {
      const primaryColor = document.getElementById('primaryColor').value;
      const generateScales = document.getElementById('generateScales').checked;
      const includeGrays = document.getElementById('includeGrays').checked;
      
      if (generateScales) {
        currentTheme = generateThemePalette(primaryColor);
        if (!includeGrays) {
          delete currentTheme.gray;
        }
      } else {
        // Simple theme without scales
        const primary = hexToHSL(primaryColor);
        currentTheme = {
          primary: { 6: primaryColor },
          success: { 6: hslToHex(120, primary.s * 0.9, primary.l) },
          warning: { 6: hslToHex(45, primary.s * 1.1, primary.l * 1.1) },
          danger: { 6: hslToHex(0, primary.s * 0.95, primary.l * 0.95) },
          info: { 6: hslToHex(200, primary.s * 0.85, primary.l) }
        };
      }
      
      // Display palettes
      displayPalette('primaryPalette', currentTheme.primary);
      displayPalette('successPalette', currentTheme.success);
      displayPalette('warningPalette', currentTheme.warning);
      displayPalette('dangerPalette', currentTheme.danger);
      displayPalette('infoPalette', currentTheme.info);
      
      if (currentTheme.gray) {
        displayGrayScale('grayPalette', currentTheme.gray);
      } else {
        document.getElementById('grayPalette').innerHTML = '<div style="color: #999;">Gray scale disabled</div>';
      }
      
      // Generate and display CSS
      currentCSS = generateCSSVariables(currentTheme);
      document.getElementById('cssOutput').textContent = currentCSS;
    };
    
    function displayPalette(elementId, palette) {
      const container = document.getElementById(elementId);
      container.innerHTML = '';
      
      Object.entries(palette).forEach(([shade, color]) => {
        const box = document.createElement('div');
        box.className = 'color-box';
        box.style.backgroundColor = color;
        box.innerHTML = `<span class="color-label">${shade}</span>`;
        box.title = color;
        box.onclick = () => copyToClipboard(color);
        container.appendChild(box);
      });
    }
    
    function displayGrayScale(elementId, palette) {
      const container = document.getElementById(elementId);
      container.innerHTML = '';
      
      Object.entries(palette).forEach(([shade, color]) => {
        const box = document.createElement('div');
        box.className = 'gray-box';
        box.style.backgroundColor = color;
        box.style.color = parseInt(shade) > 5 ? 'white' : 'black';
        box.textContent = shade;
        box.title = color;
        box.onclick = () => copyToClipboard(color);
        container.appendChild(box);
      });
    }
    
    window.applyToPage = function() {
      if (!currentCSS) {
        generateTheme();
      }
      
      // Remove existing style if present
      const existing = document.getElementById('theme-styles');
      if (existing) {
        existing.remove();
      }
      
      // Insert new styles
      const style = document.createElement('style');
      style.id = 'theme-styles';
      style.textContent = currentCSS;
      document.head.appendChild(style);
      
      alert('Theme applied to page! Check the demo elements.');
    };
    
    window.downloadCSS = function() {
      if (!currentCSS) {
        generateTheme();
      }
      
      const blob = new Blob([currentCSS], { type: 'text/css' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'theme.css';
      a.click();
      URL.revokeObjectURL(url);
    };
    
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        // Show a brief notification
        const notification = document.createElement('div');
        notification.textContent = `Copied: ${text}`;
        notification.style.cssText = `
          position: fixed;
          bottom: 20px;
          right: 20px;
          background: #333;
          color: white;
          padding: 10px 20px;
          border-radius: 4px;
          z-index: 1000;
        `;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 2000);
      });
    }
    
    // Sync color inputs
    document.getElementById('primaryColor').addEventListener('input', (e) => {
      document.getElementById('primaryHex').value = e.target.value;
    });
    
    document.getElementById('primaryHex').addEventListener('input', (e) => {
      if (/^#[0-9A-Fa-f]{6}$/.test(e.target.value)) {
        document.getElementById('primaryColor').value = e.target.value;
      }
    });
    
    // Generate initial theme
    generateTheme();
  </script>
</body>
</html>