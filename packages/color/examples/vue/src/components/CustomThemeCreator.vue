<script setup lang="ts">
import { createCustomTheme, isValidHex, useNotification } from '@ldesign/color'
import { useTheme } from '@ldesign/color/vue'
import { computed, ref } from 'vue'

const { registerTheme, setTheme } = useTheme()
const { showNotification } = useNotification()

const themeName = ref('')
const lightPrimary = ref('#1890ff')
const darkPrimary = ref('#177ddc')

const canCreate = computed(() => {
  return (
<<<<<<< HEAD
    themeName.value.trim() &&
    isValidHex(lightPrimary.value) &&
    isValidHex(darkPrimary.value)
=======
    themeName.value.trim()
    && isValidHex(lightPrimary.value)
    && isValidHex(darkPrimary.value)
>>>>>>> d558c53bb81f65625318631d106345bf8a2cfdfe
  )
})

async function createTheme() {
  if (!canCreate.value) return

  try {
    const customTheme = createCustomTheme(
      themeName.value.trim(),
      lightPrimary.value,
      {
        displayName: themeName.value.trim(),
        description: `è‡ªå®šä¹‰ä¸»é¢˜ï¼š${themeName.value.trim()}`,
        darkPrimaryColor: darkPrimary.value,
      }
    )

    registerTheme(customTheme)
    await setTheme(customTheme.name)

    showNotification(`ä¸»é¢˜ "${themeName.value}" åˆ›å»ºæˆåŠŸï¼`, 'success')

    // é‡ç½®è¡¨å•
    themeName.value = ''
    lightPrimary.value = '#1890ff'
    darkPrimary.value = '#177ddc'
  } catch {
    showNotification('åˆ›å»ºä¸»é¢˜å¤±è´¥', 'error')
  }
}
</script>

<template>
  <div class="card">
    <h2 class="card-title">ğŸ› ï¸ è‡ªå®šä¹‰ä¸»é¢˜</h2>

    <form class="theme-form" @submit.prevent="createTheme">
      <div class="form-group">
        <label class="form-label">ä¸»é¢˜åç§°</label>
        <input
          v-model="themeName"
          type="text"
          class="form-control"
          placeholder="è¾“å…¥ä¸»é¢˜åç§°"
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label">äº®è‰²æ¨¡å¼ä¸»è‰²è°ƒ</label>
        <div class="color-input-group">
<<<<<<< HEAD
          <input v-model="lightPrimary" type="color" class="color-picker" />
=======
          <input v-model="lightPrimary" type="color" class="color-picker">
>>>>>>> d558c53bb81f65625318631d106345bf8a2cfdfe
          <input
            v-model="lightPrimary"
            type="text"
            class="form-control"
            placeholder="#1890ff"
          />
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">æš—è‰²æ¨¡å¼ä¸»è‰²è°ƒ</label>
        <div class="color-input-group">
<<<<<<< HEAD
          <input v-model="darkPrimary" type="color" class="color-picker" />
=======
          <input v-model="darkPrimary" type="color" class="color-picker">
>>>>>>> d558c53bb81f65625318631d106345bf8a2cfdfe
          <input
            v-model="darkPrimary"
            type="text"
            class="form-control"
            placeholder="#177ddc"
          />
        </div>
      </div>

      <button type="submit" class="btn btn-primary" :disabled="!canCreate">
        <span class="icon">âœ¨</span>
        åˆ›å»ºå¹¶åº”ç”¨ä¸»é¢˜
      </button>
    </form>
  </div>
</template>

<style scoped>
.theme-form {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.color-input-group {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.color-picker {
  width: 50px;
  height: 40px;
  border: 1px solid var(--color-border, #e8e8e8);
  border-radius: 6px;
  cursor: pointer;
  background: none;
}

.icon {
  margin-right: 0.25rem;
}
</style>
