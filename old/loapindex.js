if(!window.lbcp){LBCP={};window.lbcp=LBCP;}else{LBCP=window.lbcp;}if(!LEAP.LOAP){LEAP.LOAP={};}LEAP.LOAP.indextodolist={};LEAP.LOAP.indextodolist.ctf={_body:"body"};LEAP.LOAP.toporg=LEAP.routerRequest("lbcp_GetTopOrganCurrentBean");if(LEAP.LOAP.toporg){LEAP.LOAP.toporgid=LEAP.LOAP.toporg.id;LEAP.LOAP.toporgname=LEAP.LOAP.toporg.cnname;
LEAP.LOAP.curTopSyscode=LEAP.LOAP.toporg.syscode;}LEAP.LOAP.toporg2=LEAP.routerRequest("lbcp_getCurrentRootOrg2Bean");if(LEAP.LOAP.toporg){LEAP.LOAP.toporg2id=LEAP.LOAP.toporg2.id;LEAP.LOAP.toporg2name=LEAP.LOAP.toporg2.cnname;}LEAP.LOAP.OpenBytab=false;if(LWFP.Config&&LWFP.Config.openFlowInWorkarea&&LWFP.Config.openFlowInWorkarea==1){LEAP.LOAP.OpenBytab=true;
}LEAP.LOAP.curTopSyscodeAddOne=LEAP.routerRequest("lbcp_selectTopOrgSyscode");LEAP.LOAP.WfConfig=LEAP.routerRequest("loap_GetWfConfig");LEAP.LOAP.isarchCheckBox=function(c,d,a,f){if(!d){d=2014;}LEAP.checkbox2.clearItems(c);var e=new Date().getFullYear();if(typeof(f)=="undefined"||f==true){LEAP.checkbox2.addItem(c,"全部","all",false);
}LEAP.checkbox2.addItem(c,e+"年","now",true);for(var b=e-1;b>=d;b--){LEAP.checkbox2.addItem(c,b+"年",b,false);}};LEAP.LOAP.cacheManageMap=new hashtable();LEAP.LOAP.clearCacheManageMap=function(){if(LEAP.LOAP.cacheManageMap&&LEAP.LOAP.cacheManageMap.count>0&&LEAP.LOAP.cacheManageMap.keys){for(var b in LEAP.LOAP.cacheManageMap.keys){var a=b.substring(4);
if(!PageObjectModel.getModule(a)){LEAP.LOAP.cacheManageMap.remove(a);}}}};LEAP.LOAP.clearCacheManageMap();LEAP.LOAP.addExtendParam=false;LEAP.LOAP.indextodolist.d="loap_index_todolist";LEAP.LOAP.indextodolist.init=function(){if(document!=null&&document.body!=null){LEAP.LOAP.indextodolist._init();}else{UIEventManager.addEvent(window,"load",LEAP.LOAP.indextodolist._init);
}ElementEventManager.addManagedEventType(LEAP.LOAP.indextodolist.d,"dataLoaded");ElementEventManager.addManagedEventType(LEAP.LOAP.indextodolist.d,"rowClick");ElementEventManager.addManagedEventType(LEAP.LOAP.indextodolist.d,"rowOperationClick");};LEAP.LOAP.indextodolist._init=function(){LEAP.addEvent(document.body,"click",LEAP.LOAP.indextodolist.uiProcess,null,null,true);
UIEventManager.removeEvent(window,"load",LEAP.LOAP.indextodolist._init);};LEAP.LOAP.indextodolist.uiProcess=function(b){if(b==null){return;}var f=b.e.srcElement;if(f==null){return;}var c=LEAP._match(f,LEAP.LOAP.indextodolist.d);if(null==c){return;}var d=b.e.type;if(d==null){return;}var a=f.tagName;if(a==null){return;
}var e=f.getAttribute(commfields.ctf);};LEAP.LOAP.indextodolist.callBackRefresh=function(a){if(this.indextodolistElement==null){return;}var c=this.indextodolistElement;var b=LEAP.getLoadedModule(c.getAttribute("instance"));if(b.parentPageModule){b.parentPageModule.refreshFn();}else{LEAP.LOAP.indextodolist.refresh(this.indextodolistElement);
}};LEAP.LOAP.indextodolist.getCurMonth=function(){var b=new Date();var d=b.getFullYear();var c=b.getMonth()+1;var e=b.getDate();var a=d+"-"+c+"-"+e;return a;};LEAP.LOAP.indextodolist.getLastMonth=function(){var b=new Date();b.setMonth(b.getMonth()-1);var c=b.getFullYear();var a=b.getMonth()+1;var d=b.getDate();
var e=c+"-"+a+"-"+d;return e;};LEAP.LOAP.indextodolist.refresh=function(d,a){var d=LEAP._match(d,LEAP.LOAP.indextodolist.d);if(null==d){return;}var b=LEAP.getLoadedModule(d.getAttribute("instance"));if(!a){var g=d._todolist;a=g;g=null;}if(a==null){return;}try{var c="";var k={};var f=a._listarg;if(f&&f.search){var i="searchmethod,searchpar,openmodule";
for(var j in f.search){if(i.indexOf(j)!=-1){continue;}k[j]=f.search[j];}if(f.search.searchmethod){c=f.search.searchmethod;}if(f.search.searchpar){k.tempbean=f.search.searchpar;}if(f.search.isread){k.isread=f.search.isread;k.state=f.search.isread;}if(f.search.addExtendParam){LEAP.LOAP.addExtendParam=true;
}else{LEAP.LOAP.addExtendParam=false;}if(f.search.stime){k.stime=LEAP.LOAP.indextodolist.getLastMonth();}if(f.search.etime){k.etime=LEAP.LOAP.indextodolist.getCurMonth();}k.iscount=false;k.isresult=true;k.pagenum=1;k.beanname=LEAP.getUserInfo().userid;if(f.search.isfilterolddata){k.isapp=f.search.isfilterolddata;
}}if(!c){return;}var l=LEAP.wfrouter.getRouter(d);var h=null;if(l){h=window.createRouterClient(l);}LEAP.asynrequest(c,{bean:k},null,LEAP.LOAP.indextodolist.List_CallbackFn,b,null,h);if(window.__lastmodule&&LEAP.LOAP.refreshindexids){window.__lastmodule.fireEvent("refreshindex",LEAP.LOAP.refreshindexids);
}}catch(g){LEAP.messagebox.alert("错误："+g.number+":"+g.description);}finally{d=par=result=null;}};LEAP.LOAP.indextodolist.List_CallbackFn=function(k){if(this.indextodolistElement==null){return;}var c=LEAP._match(this.indextodolistElement,LEAP.LOAP.indextodolist.d);if(null==c){return;}var a=null;if(!a){var h=c._todolist;
a=h;h=null;}if(a==null){return;}if(k){k=LEAP.convertResult(k);}if(!k||k.length<1){var g=LEAP.getElement("[ctf="+LEAP.LOAP.indextodolist.ctf._body+"]",a);if(g==null){return;}var j="../../../LOAP/Plugin/images/nodata.png";if(LEAP.LOAP.nodataimg){j=leapconfig.server+LEAP.LOAP.nodataimg;}g.innerHTML='<div style="text-align:center;padding-top:8%;"><img src="'+j+'" alt="" /></div>';
}else{for(var d=0;d<k.length;d++){if(k[d].lwfp_step_bepushback&&k[d].lwfp_step_hsid){var b=LEAP.routerRequest("lbcp_GetPushbackUser",{hsid:k[d].lwfp_step_hsid});if(b||k[d].lwfp_step_caller||k[d].lwfp_step_callername){if(!b){b=k[d].lwfp_step_callername;}if(!b){b=k[d].lwfp_step_caller;}k[d].lwfp_entry_eventname="[退回] "+k[d].lwfp_entry_eventname+"  --[来自:"+b+"]";
}}else{var b="";if(b||k[d].lwfp_step_caller||k[d].lwfp_step_callername){if(!b){b=k[d].lwfp_step_callername;}if(!b){b=k[d].lwfp_step_caller;}}if(b){k[d].lwfp_entry_eventname=k[d].lwfp_entry_eventname+"  --[来自:"+b+"]";}}}LEAP.OA.list.bind(a,k);}var f=a._listarg;if(f&&f.search&&f.search.loapindex_searchCallBackFn){try{JSON.parse(f.search.loapindex_searchCallBackFn)(k);
}catch(h){}}};LEAP.LOAP.indextodolist.getNowFormatDate=function(){var a=new Date();var d=a.getMonth()+1;var c=a.getDate();if(d>=1&&d<=9){d="0"+d;}if(c>=0&&c<=9){c="0"+c;}var b=a.getFullYear()+"-"+d+"-"+c+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();return b;};LEAP.LOAP.indextodolist.indextodolistDataLoaded=function(f){if(f==null||f.arg2==null||f.arg2.table==null){return;
}var m=f.arg2.table;var h=m._listarg;var q=LEAP.OA.list.getRows(m);if(h&&h.dataloaded&&q!=null&&q.length>0){var r=h.dataloaded.rows;for(var w=0;w<q.length;w++){for(var v=0;v<r.length;v++){var n=LEAP.getElement('[ctf="'+r[v].ctf+'"]',q[w]);if(n&&r[v].ctf&&(q[w].data[r[v].ctf]==r[v].value||(!q[w].data[r[v].ctf]&&!r[v].value))){if(r[v].className){n.className=r[v].className;
}if(r[v].innerText){n.innerText=r[v].innerText;}if(r[v].uctf){var c=LEAP.getElement('[ctf="'+r[v].uctf+'"]',q[w]);if(c&&r[v].uctf&&r[v].uclassName){c.className+=" "+r[v].uclassName;}}}if(v==r.length-1&&r[v].tctf&&q[w].data[r[v].tctf]){if(r[v].uctf){var c=LEAP.getElement('[ctf="'+r[v].uctf+'"]',q[w]);
if(c&&r[v].uctf&&r[v].uclassName){c.className+=" "+r[v].uclassName;}}}if(v==r.length-1&&r[v].hctf&&q[w].data[r[v].hctf]){if(r[v].uctf){var c=LEAP.getElement('[ctf="'+r[v].uctf+'"]',q[w]);if(c&&q[w].data[r[v].hctf]<LEAP.LOAP.indextodolist.getNowFormatDate()){c.style.color="#D9B300";c.style.fontWeight="bold";
}}}if(n&&r[v].ctf=="code"&&r[v].value){var l=r[v].value;var A=LEAP.getCodeValue(l);if(!n.innerText){n.innerText="其他";}if(A&&A.length>0){for(var u=0;u<A.length;u++){if(n.innerText==A[u].codeid){n.innerText=A[u].codevalue;break;}}}}}}}if(h&&h.search&&q&&q.length>0){for(var w=0;w<q.length;w++){var g=q[w];
var p=q[w].data;var o=LEAP.getElement("[md=lwfp_entry_businessname]",g);if(!o){o=LEAP.getElement("[md=en_businessname]",g);}if(o&&p){if(h.search.isshowalias=="true"){o.innerText=!!p.lwfp_entry_busialiasname?p.lwfp_entry_busialiasname:p.lwfp_entry_businessname;o.title=!!p.lwfp_entry_busialiasname?p.lwfp_entry_busialiasname:p.lwfp_entry_businessname;
if(o.innerText=="undefined"||!o.innerText){o.innerText=!!p.en_busialiasname?p.en_busialiasname:p.en_businessname;o.title=!!p.en_busialiasname?p.en_busialiasname:p.en_businessname;}}if(h.search.eventmarks){if(h.search.eventmarks[p.lwfp_entry_businessname]){o.style.color=h.search.eventmarks[p.lwfp_entry_businessname];
}else{if(h.search.eventmarks[p.en_businessname]){o.style.color=h.search.eventmarks[p.en_businessname];}}}}if(h.search.imgtypes){var B=h.search.imgtypes;for(var v=0;v<B.length;v++){var z=B[v];var t=LEAP.getElement("["+z.elflag+"]",g);if(t&&p[z.dataflag]&&z[p[z.dataflag]]){t.innerHTML="";t.style.backgroundImage="url("+leapconfig.server+z[p[z.dataflag]]+")";
t.style.backgroundRepeat="no-repeat";t.style.backgroundPosition="center";}}}}}var x='<img title="@ownername" style="cursor:pointer;position:absolute;top:-14px;left:-20px;" src="'+leapconfig.server+'LEAP/LOAP/LOAPGovGwcl/Searchlist/dltb.png" >';if(q&&q.length>0){for(var w=0;w<q.length;w++){var d=LEAP.getElement("[ctf=topflag]",q[w]);
if(d){d.style.width="1px";if(d.tagName=="SPAN"){d.style.setProperty("width","18px","important");}if(q[w].data&&q[w].data.topflag==1){d.style.backgroundImage="url('../../../LOAP/LOAPGovHyxt/HYXT/login/image/zd.png')";d.style.backgroundRepeat="no-repeat";d.style.backgroundPosition="center";}}var s=LEAP.getElement("[ctf=jjcd]",q[w]);
if(s&&q[w].data){if(q[w].data.lwfp_step_owner&&q[w].data.lwfp_step_owner!=LEAP.getUserInfo().userflag){s.style.position="relative";if(s.parentElement&&s.parentElement.nodeName=="TD"){s.parentElement.style.overflow="visible";}var a=x.replace("@ownername","委托人："+q[w].data.lwfp_step_ownername);s.innerHTML=a+s.innerHTML;
}}}}if(h&&h.search&&h.search.loapindex_dataLoadedFn){try{JSON.parse(h.search.loapindex_dataLoadedFn)(h.search,q);}catch(y){}}var b=LEAP._match(m,LEAP.LOAP.indextodolist.d);if(null!=b){ElementEventManager.handleEvent(b,"dataLoaded",{table:m});}};LEAP.LOAP.indextodolist.gwclRowClick=function(o){if(o==null||o.arg2==null||o.arg2.row==null){return;
}var f=o.arg2.data;var g=o.arg2.element;var j=g._listarg;var n=null;var i=false;if(j&&j.search){n=j.search.openmodule;i=j.search.isopennew;}var c=LEAP.getLoadedModule(g.getAttribute("instance"));var m=null;var e=null;if(!n){var d=f.lwfp_entry_entryid;if(!d){d=f.entryid;}if(!d){d=f.lwfp_entryid;}if(!d){d=f.wf_entry_id;
}if(!d){return;}if(LEAP.LOAP.addExtendParam){e=f;}var b={entryId:d,csid:f.lwfp_step_hsid,delegate:null,archCategory:null,extendParam:e,maxsize:true,formtype:3,callBackFunc:LWFP.Config.openFlowInWorkarea==1?null:LEAP.LOAP.indextodolist.callBackRefresh,holdParent:true,closeCallbackFunc:LWFP.Config.openFlowInWorkarea==1?LEAP.LOAP.indextodolist.callBackRefresh:null};
if(i){LWFP.API.OpenFlow_newWindow(b,c);}else{m=LWFP.API.OpenFlow(b,c);}}else{if(n=="ismeetingmodule"){var a=leapconfig.server+"LEAP/LOAP/LOAPGovHyxt/HYXT/ldhy/loapmymeetinginfo2.html?_meetid="+f.id+"&_meettype="+f.groupid;var l=window.open(a,"_blank");return;}else{if(n=="issoftmodule"){var o=null;var p=null;
if(f.downloadpath){o=JSON.parse(f.downloadpath);}var p=LEAP.upload.getPath(o.nameedPath,o.name,null,o.showName,o.title,null,null,o.fileid);if(p){window.open(p);}return;}}f.pn=1;f.js=1;if(LWFP.Config.openFlowInWorkarea==1&&n){var h=n.title||"";var k=f.id||UUID.randomUUID().replaceall("-","");n.closeCallback=LEAP.LOAP.indextodolist.callBackRefresh;
n.holdParent=true;n.domain=c;m=LEAP.modulebar.addModuleBar(h,k,n);if(m.setIndex){m.setIndex(f);}m.setPageData(f);}else{if(c){m=c.loadForm3(n);}else{m=LEAP.form.create3(n);}m.maxSize();LEAP.form.show(m.form);if(m.module.setIndex){m.module.setIndex(f);}m.module.setPageData(f);}}if(m){if(LEAP.form.hideOperResize){LEAP.form.hideOperResize(m.form);
}LEAP.addEvent(m.form,"formHided",LEAP.LOAP.indextodolist.callBackRefresh,null,c);}m=null;};LEAP.LOAP.indextodolist._p=function(g){if(g==null){return;}var a=g.indexOf("<!--@");if(a>-1){var d=g.substr(a+5,g.indexOf("-->",a)-a-5);var f=null;try{var b=d.replaceall(" =","=").replaceall("= ","=").replaceall("pagemodulearg=","").Trim().replaceall("\r\n"," ").replaceall("\n"," ").replaceall("\t"," ");
var f=JSON.parse(b);}catch(c){LEAP.messagebox.alert("LEAP.LOAP.indextodolist配置错误： "+c);}}return f;};LEAP.LOAP.indextodolist.i=function(g,b){if(!b){if(!event){return;}b=event.srcElement;}if(!b){return;}var d=LEAP._match(b,LEAP.LOAP.indextodolist.d);if(null==d){return;}try{var c=LEAP.getLoadedModule(d.getAttribute("instance"));
if(!c){console.log("---LEAP.LOAP.indextodolist.i 方法，module值为空。");return;}c.indextodolistElement=d;var j=LEAP.LOAP.indextodolist._p(c.moduleElement.innerHTML);if(c.pageArg){for(var k in c.pageArg){j.search[k]=c.pageArg[k];}if(j.dataloaded&&j.dataloaded.rows&&j.dataloaded.rows.length>0){var l=j.dataloaded.rows;
for(var f=0;f<l.length;f++){if(!c.pageArg["ctf_"+l[f].ctf]){continue;}if(c.pageArg["ctf_"+l[f].ctf][l[f].value]){l[f].innerText=c.pageArg["ctf_"+l[f].ctf][l[f].value];}}}}if(j){var a=LEAP.getElement("[ut="+j.ut+"]",d);a._listarg=j;LEAP.addEvent(a,"rowClick",LEAP.LOAP.indextodolist.gwclRowClick,null,c);
LEAP.addEvent(a,"dataLoaded",LEAP.LOAP.indextodolist.indextodolistDataLoaded,null,c);d._todolist=a;a=null;}LEAP.LOAP.indextodolist.refresh(d);}catch(h){LEAP.messagebox.alert("LEAP.LOAP.indextodolist "+h);}finally{}};LEAP.LOAP.indextodolist.init();LEAP.LOAP.ArrayObjectPX=function(b,a,c){if(b instanceof Array){b.sort(LEAP.LOAP.compareObject(a));
}return b;};LEAP.LOAP.compareObject=function(a){return function(e,d){var c=e[a];var b=d[a];if(a=="orderID"){c=e.orgObject["orderid"];b=d.orgObject["orderid"];}if(!isNaN(Number(c))&&!isNaN(Number(b))){c=Number(c);b=Number(b);}if(c<b){return -1;}else{if(c>b){return 1;}else{return 0;}}};};LEAP.LOAP.setLwfpUploadButton=function(e){if(LEAP.Environment&&LEAP.Environment=="AK"){if(e){var a=e.moduleElement;
var d=["btnBatchDownload","btnscan","btnbatchupload","btnupload2","btnDocView"];for(var c=0;c<d.length;c++){var f=LEAP.getElements("[ctf="+d[c]+"]",a);if(f&&f.length>0){for(var b=0;b<f.length;b++){if(f[b]){f[b].parentNode.removeChild(f[b]);}}}}}}else{if(e){var a=e.moduleElement;var d=["btnupload2"];for(var c=0;
c<d.length;c++){var f=LEAP.getElements("[ctf="+d[c]+"]",a);if(f&&f.length>0){for(var b=0;b<f.length;b++){if(f[b]!=null){f[b].parentNode.removeChild(f[b]);}}}}}}};