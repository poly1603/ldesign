<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•åŠ¨ç”»é—®é¢˜</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 40px 0;
        }
        
        .test-card {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: var(--td-brand-color-1, #f0f7ff);
        }
        
        .t-button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background: var(--td-brand-color, #0052d9);
            color: white;
            cursor: pointer;
            margin: 5px;
        }
        
        .td-tag {
            padding: 4px 8px;
            background: var(--td-brand-color-2, #d9e1ff);
            color: var(--td-brand-color-8, #052b87);
            border-radius: 4px;
            display: inline-block;
            margin: 5px;
        }
        
        .controls {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .controls button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 14px;
        }
        
        #log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .log-entry {
            margin: 2px 0;
        }
        
        .log-time {
            color: #999;
        }
        
        .log-error {
            color: #f00;
        }
        
        .log-success {
            color: #0f0;
        }
        
        .log-info {
            color: #ff0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” è°ƒè¯•ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»</h1>
    
    <div class="controls">
        <h3>æµ‹è¯•æ§åˆ¶å°</h3>
        
        <div>
            <button onclick="testDirect()">ç›´æ¥æµ‹è¯•ï¼ˆä¸é€šè¿‡setThemeï¼‰</button>
            <button onclick="testSetTheme()">æµ‹è¯• setTheme</button>
            <button onclick="testWithOptions()">æµ‹è¯•å¸¦é€‰é¡¹çš„ setTheme</button>
            <button onclick="checkInstance()">æ£€æŸ¥å…¨å±€å®ä¾‹</button>
            <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <div style="margin-top: 10px;">
            <button onclick="manualCascade()">æ‰‹åŠ¨çº§è”åŠ¨ç”»</button>
            <button onclick="checkElements()">æ£€æŸ¥ç›®æ ‡å…ƒç´ </button>
            <button onclick="testViewTransition()">æµ‹è¯• View Transition API</button>
        </div>
    </div>
    
    <div class="test-grid">
        <div class="test-card t-1">
            <h3>æµ‹è¯•å¡ç‰‡ 1</h3>
            <button class="t-button">TæŒ‰é’®</button>
            <span class="td-tag">TDæ ‡ç­¾</span>
        </div>
        
        <div class="test-card td-2">
            <h3>æµ‹è¯•å¡ç‰‡ 2</h3>
            <button class="t-button">TæŒ‰é’®</button>
            <span class="td-tag">TDæ ‡ç­¾</span>
        </div>
        
        <div class="test-card t-3">
            <h3>æµ‹è¯•å¡ç‰‡ 3</h3>
            <button class="t-button">TæŒ‰é’®</button>
            <span class="td-tag">TDæ ‡ç­¾</span>
        </div>
    </div>
    
    <div id="log"></div>
    
    <script type="module">
        import { setTheme, getCurrentTheme } from '../ldesign-all/packages/shared/color-generate/es/simple.js';
        
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span class="log-time">[${time}]</span> <span class="log-${type}">${message}</span>`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[${type}]`, message);
        }
        
        // æ¸…ç©ºæ—¥å¿—
        window.clearLog = function() {
            document.getElementById('log').innerHTML = '';
        }
        
        // ç›´æ¥æµ‹è¯•åŠ¨ç”»ï¼ˆä¸é€šè¿‡setThemeï¼‰
        window.testDirect = function() {
            log('å¼€å§‹ç›´æ¥æµ‹è¯•åŠ¨ç”»æ•ˆæœ...', 'info');
            
            const elements = document.querySelectorAll('[class*="t-"], [class*="td-"]');
            log(`æ‰¾åˆ° ${elements.length} ä¸ªç›®æ ‡å…ƒç´ `, 'success');
            
            // ä¸ºæ¯ä¸ªå…ƒç´ æ·»åŠ è¿‡æ¸¡
            elements.forEach((el, index) => {
                el.style.transition = `all 300ms ease ${index * 50}ms`;
                log(`å…ƒç´  ${index}: ${el.className} - æ·»åŠ è¿‡æ¸¡å»¶è¿Ÿ ${index * 50}ms`, 'info');
            });
            
            // æ¨¡æ‹Ÿæ”¹å˜CSSå˜é‡
            setTimeout(() => {
                document.documentElement.style.setProperty('--td-brand-color', '#ff6b6b');
                document.documentElement.style.setProperty('--td-brand-color-1', '#ffe0e0');
                document.documentElement.style.setProperty('--td-brand-color-2', '#ffb3b3');
                document.documentElement.style.setProperty('--td-brand-color-8', '#cc0000');
                log('CSSå˜é‡å·²æ›´æ–°', 'success');
                
                // æ¸…ç†è¿‡æ¸¡
                setTimeout(() => {
                    elements.forEach(el => {
                        el.style.transition = '';
                    });
                    log('è¿‡æ¸¡æ ·å¼å·²æ¸…ç†', 'info');
                }, 1500);
            }, 100);
        }
        
        // æµ‹è¯• setTheme åŸºç¡€è°ƒç”¨
        window.testSetTheme = function() {
            log('æµ‹è¯•åŸºç¡€ setTheme è°ƒç”¨...', 'info');
            try {
                const result = setTheme('techBlue');
                log(`setTheme è¿”å›: ${result}`, 'success');
                log(`è¿”å›å¯¹è±¡ç±»å‹: ${typeof result}`, 'info');
                if (result) {
                    log(`æœ‰å±æ€§: ${Object.keys(result).join(', ')}`, 'info');
                }
            } catch (error) {
                log(`é”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        // æµ‹è¯•å¸¦é€‰é¡¹çš„ setTheme
        window.testWithOptions = function() {
            log('æµ‹è¯•å¸¦åŠ¨ç”»é€‰é¡¹çš„ setTheme...', 'info');
            
            const options = {
                transition: 'cascade',
                duration: 500,
                cascadeDelay: 100
            };
            
            log(`è°ƒç”¨é€‰é¡¹: ${JSON.stringify(options)}`, 'info');
            
            try {
                const result = setTheme('mintGreen', options);
                log(`setTheme è¿”å›æˆåŠŸ`, 'success');
                
                // æ£€æŸ¥å®ä¾‹çš„é€‰é¡¹
                if (result && result.options) {
                    log(`å®ä¾‹é€‰é¡¹: enableTransition = ${result.options.enableTransition}`, 'info');
                    log(`å®ä¾‹é€‰é¡¹: transitionOptions = ${JSON.stringify(result.options.transitionOptions)}`, 'info');
                }
                
                // æ£€æŸ¥æ˜¯å¦æœ‰è¿‡æ¸¡æ ·å¼
                setTimeout(() => {
                    const elements = document.querySelectorAll('[class*="t-"], [class*="td-"]');
                    let hasTransition = false;
                    elements.forEach((el, index) => {
                        if (el.style.transition) {
                            hasTransition = true;
                            log(`å…ƒç´  ${index} æœ‰è¿‡æ¸¡: ${el.style.transition}`, 'success');
                        }
                    });
                    if (!hasTransition) {
                        log('è­¦å‘Š: æ²¡æœ‰å…ƒç´ æœ‰è¿‡æ¸¡æ ·å¼ï¼', 'error');
                    }
                }, 100);
                
            } catch (error) {
                log(`é”™è¯¯: ${error.message}`, 'error');
                log(`é”™è¯¯å †æ ˆ: ${error.stack}`, 'error');
            }
        }
        
        // æ£€æŸ¥å…¨å±€å®ä¾‹
        window.checkInstance = function() {
            log('æ£€æŸ¥å…¨å±€ä¸»é¢˜å®ä¾‹...', 'info');
            const instance = getCurrentTheme();
            if (instance) {
                log('æ‰¾åˆ°å…¨å±€å®ä¾‹', 'success');
                log(`å®ä¾‹ç±»å‹: ${instance.constructor.name}`, 'info');
                log(`å®ä¾‹é€‰é¡¹: ${JSON.stringify(instance.options)}`, 'info');
                
                // æµ‹è¯•ç›´æ¥è°ƒç”¨åŠ¨ç”»æ–¹æ³•
                if (instance.applyCascadeTransition) {
                    log('å®ä¾‹æœ‰ applyCascadeTransition æ–¹æ³•', 'success');
                } else {
                    log('è­¦å‘Š: å®ä¾‹æ²¡æœ‰ applyCascadeTransition æ–¹æ³•ï¼', 'error');
                }
                
                // å°è¯•æ‰‹åŠ¨è°ƒç”¨
                if (instance.updateTheme) {
                    log('å°è¯•æ‰‹åŠ¨è°ƒç”¨ updateTheme...', 'info');
                    instance.setTransitionOptions({
                        transition: 'cascade',
                        duration: 800,
                        cascadeDelay: 80
                    });
                    instance.updateTheme('coralOrange');
                    log('æ‰‹åŠ¨è°ƒç”¨å®Œæˆ', 'success');
                }
                
            } else {
                log('æ²¡æœ‰æ‰¾åˆ°å…¨å±€å®ä¾‹', 'error');
            }
        }
        
        // æ‰‹åŠ¨å®ç°çº§è”åŠ¨ç”»
        window.manualCascade = function() {
            log('æ‰‹åŠ¨å®ç°çº§è”åŠ¨ç”»...', 'info');
            
            const colors = ['#2196f3', '#4caf50', '#ff9800', '#9c27b0', '#0052d9'];
            let colorIndex = 0;
            
            const animate = () => {
                const elements = document.querySelectorAll('[class*="t-"], [class*="td-"]');
                const color = colors[colorIndex % colors.length];
                
                log(`åˆ‡æ¢åˆ°é¢œè‰²: ${color}`, 'info');
                
                elements.forEach((el, index) => {
                    el.style.transition = `background-color 300ms ease ${index * 50}ms`;
                    setTimeout(() => {
                        el.style.backgroundColor = color + '20';
                    }, 10);
                });
                
                document.documentElement.style.setProperty('--td-brand-color', color);
                
                setTimeout(() => {
                    elements.forEach(el => {
                        el.style.transition = '';
                        el.style.backgroundColor = '';
                    });
                }, 1500);
                
                colorIndex++;
            };
            
            animate();
        }
        
        // æ£€æŸ¥ç›®æ ‡å…ƒç´ 
        window.checkElements = function() {
            log('æ£€æŸ¥é¡µé¢å…ƒç´ ...', 'info');
            
            const selectors = [
                '[class*="t-"]',
                '[class*="td-"]',
                '.t-button',
                '.td-tag',
                '.test-card'
            ];
            
            selectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                log(`${selector}: æ‰¾åˆ° ${elements.length} ä¸ªå…ƒç´ `, elements.length > 0 ? 'success' : 'error');
            });
            
            // åˆ—å‡ºæ‰€æœ‰æ‰¾åˆ°çš„ç±»å
            const allElements = document.querySelectorAll('[class*="t-"], [class*="td-"]');
            const classNames = new Set();
            allElements.forEach(el => {
                el.classList.forEach(cls => classNames.add(cls));
            });
            log(`æ‰€æœ‰ç±»å: ${Array.from(classNames).join(', ')}`, 'info');
        }
        
        // æµ‹è¯• View Transition API
        window.testViewTransition = function() {
            log('æµ‹è¯• View Transition API...', 'info');
            
            if ('startViewTransition' in document) {
                log('æµè§ˆå™¨æ”¯æŒ View Transition API', 'success');
                
                // æµ‹è¯•ä¸€ä¸ªç®€å•çš„è¿‡æ¸¡
                document.startViewTransition(() => {
                    document.body.style.backgroundColor = '#' + Math.floor(Math.random()*16777215).toString(16);
                    log('View Transition æ‰§è¡ŒæˆåŠŸ', 'success');
                });
            } else {
                log('æµè§ˆå™¨ä¸æ”¯æŒ View Transition API', 'error');
            }
        }
        
        // åˆå§‹åŒ–
        log('è°ƒè¯•å·¥å…·å·²åŠ è½½', 'success');
        log('ç­‰å¾…å‘½ä»¤...', 'info');
    </script>
</body>
</html>