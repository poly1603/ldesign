# ğŸ“¦ åŒ…æ„å»ºäº§ç‰©æ ‡å‡†åŒ– - å®Œæ•´æ€»ç»“

> **ä»»åŠ¡çŠ¶æ€**: âœ… å®Œæˆ | **å®Œæˆåº¦**: 100% (24/24) | **æ—¥æœŸ**: 2025-10-24

---

## ğŸ¯ ä»»åŠ¡æ¦‚è¿°

**ç›®æ ‡**: è§„èŒƒæ‰€æœ‰packagesä½¿ç”¨@ldesign/builderè¿›è¡Œæ‰“åŒ…,ç¡®ä¿æ¯ä¸ªåŒ…éƒ½ç”Ÿæˆæ ‡å‡†çš„ESMã€CJSå’ŒUMDæ ¼å¼äº§ç‰©ã€‚

**èµ·å§‹çŠ¶æ€**:
- 21ä¸ªåŒ…æ­£å¸¸ (æœ‰es/lib/dist)
- 2ä¸ªåŒ…ç¼ºdist (animation, shared)
- 2ä¸ªåŒ…å®Œå…¨æœªæ„å»º (notification, websocket)

**å®ŒæˆçŠ¶æ€**:
- âœ… **24ä¸ªåŒ…å…¨éƒ¨æ­£å¸¸** (100%)
- âœ… æ‰€æœ‰åŒ…éƒ½æœ‰es/lib/distä¸‰ä¸ªç›®å½•
- âœ… é…ç½®æ ‡å‡†åŒ–
- âœ… æ–‡æ¡£å®Œå–„

---

## ğŸ” é—®é¢˜æ ¹æº

### æŠ€æœ¯é—®é¢˜

1. **Builderè‡ªåŠ¨æ£€æµ‹è¦†ç›–é…ç½®**
   - `animation`åŒ…å«4ä¸ªVueæ–‡ä»¶ â†’ è¢«æ£€æµ‹ä¸ºVue3é¡¹ç›®
   - `shared`åŒ…å«æ ·å¼æ–‡ä»¶ â†’ è¢«æ£€æµ‹ä¸ºSTYLEé¡¹ç›®
   - ç”¨æˆ·é…ç½®çš„`libraryType: 'typescript'`è¢«å¿½ç•¥

2. **å¤šå…¥å£é¡¹ç›®UMDè¢«è¿‡æ»¤**
   - Vue3Strategyæ‰«ææ‰€æœ‰srcæ–‡ä»¶ä½œä¸ºå…¥å£
   - RollupAdapteræ£€æµ‹åˆ°å¤šå…¥å£åè¿‡æ»¤UMD
   - ä»£ç ä½ç½®: `RollupAdapter.ts` ç¬¬540è¡Œ

3. **ä»£ç é”™è¯¯**
   - notification: åŠ¨æ€importè¯­æ³•é”™è¯¯ + å‘½åå†²çª
   - websocket: ç¼ºå°‘socketio-adapteræ¨¡å—

---

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒä¿®å¤ (Builder)

ä¿®æ”¹ `tools/builder/src/core/LibraryBuilder.ts`:

```typescript
// ç¬¬156è¡Œå’Œ256è¡Œ
// ä¿®æ”¹å‰:
let libraryType = mergedConfig.libraryType || await this.detectLibraryType(projectRoot)

// ä¿®æ”¹å:
let libraryType = mergedConfig.libraryType
if (!libraryType) {
  libraryType = await this.detectLibraryType(projectRoot)
}
```

**æ•ˆæœ**: ç”¨æˆ·é…ç½®ä¼˜å…ˆ,åªæœ‰æœªé…ç½®æ—¶æ‰è‡ªåŠ¨æ£€æµ‹

### åŒ…çº§ä¿®å¤

#### animation & sharedåŒ…

1. **åˆ›å»ºUMDä¸“ç”¨å…¥å£**: `src/index-lib.ts`
2. **åˆ›å»ºRollupé…ç½®**: `rollup.umd.config.js`
3. **æ‰‹åŠ¨ç”ŸæˆUMD**: `npx rollup -c rollup.umd.config.js`
4. **æ›´æ–°package.json**: fileså­—æ®µæ·»åŠ `"dist"`
5. **æ›´æ–°ldesign.config.ts**: æ·»åŠ é¡¶å±‚umdé…ç½®

#### notificationåŒ…

1. **ä¿®å¤Vue pluginè¯­æ³•é”™è¯¯**: ç§»é™¤ç®­å¤´å‡½æ•°ä¸­çš„åŠ¨æ€import
2. **ä¿®å¤å‘½åå†²çª**: NotificationItemç±»å‹æ”¹ä¸ºNotificationItemType
3. **åˆ›å»ºUMDå…¥å£**: `src/index-lib.ts`
4. **Builderæ„å»º**: æˆåŠŸç”Ÿæˆæ‰€æœ‰äº§ç‰©

#### websocketåŒ…

1. **åˆ›å»ºç¼ºå¤±æ¨¡å—**: `src/adapters/socketio-adapter.ts`
2. **åˆ›å»ºUMDå…¥å£**: `src/index-lib.ts`
3. **Builderæ„å»º**: æˆåŠŸç”Ÿæˆæ‰€æœ‰äº§ç‰©

---

## ğŸ“¦ æ ‡å‡†åŒ–æˆæœ

### ç»Ÿä¸€çš„é…ç½®ç»“æ„

æ‰€æœ‰24ä¸ªåŒ…ä½¿ç”¨ç›¸åŒçš„é…ç½®æ¨¡æ¿:

```typescript
import { defineConfig } from '@ldesign/builder'

export default defineConfig({
  libraryType: 'typescript',
  input: 'src/index.ts',
  output: {
    format: ['esm', 'cjs', 'umd'],
    esm: { dir: 'es', preserveStructure: true },
    cjs: { dir: 'lib', preserveStructure: true },
    umd: { dir: 'dist', name: 'LDesign[PackageName]' },
  },
  dts: true,
  sourcemap: true,
  clean: true,
  external: [/*...*/],
  typescript: { declaration: true, declarationMap: true },
  umd: { enabled: true, entry: 'src/index-lib.ts' },
})
```

### ç»Ÿä¸€çš„äº§ç‰©ç»“æ„

```
packages/[package-name]/
â”œâ”€â”€ es/           # ESM - ä¿ç•™ç›®å½•ç»“æ„ (2-520ä¸ªæ–‡ä»¶)
â”œâ”€â”€ lib/          # CJS - ä¿ç•™ç›®å½•ç»“æ„ (2-520ä¸ªæ–‡ä»¶)
â””â”€â”€ dist/         # UMD - å•æ–‡ä»¶æ‰“åŒ… (4-8ä¸ªæ–‡ä»¶)
    â”œâ”€â”€ index.js
    â”œâ”€â”€ index.js.map
    â”œâ”€â”€ index.min.js
    â””â”€â”€ index.min.js.map
```

---

## ğŸ“ˆ æ•°æ®ç»Ÿè®¡

### äº§ç‰©å®Œæ•´æ€§

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ€»åŒ…æ•° | 24 |
| å®Œæ•´åŒ…æ•° | 24 (100%) |
| æ€»æ–‡ä»¶æ•° | ~7000+ |
| å¹³å‡åŒ…å¤§å° | 400-1200 KB |

### æ„å»ºæ–¹å¼åˆ†å¸ƒ

| æ–¹å¼ | åŒ…æ•° | åŒ…å |
|------|------|------|
| Builderç›´æ¥ç”Ÿæˆ | 22 | api, auth, cache, color, crypto, device, engine, file, http, i18n, icons, logger, notification, permission, router, size, storage, store, tabs, template, validator, websocket |
| Builder+Rollupè¾…åŠ© | 2 | animation, shared |

---

## ğŸ“š å®Œæ•´æ–‡ä»¶æ¸…å•

### æ–°åˆ›å»ºçš„æ–‡ä»¶ (25ä¸ª)

**UMDå…¥å£æ–‡ä»¶ (4ä¸ª)**:
- packages/animation/src/index-lib.ts
- packages/shared/src/index-lib.ts
- packages/notification/src/index-lib.ts
- packages/websocket/src/index-lib.ts

**Rollupé…ç½®æ–‡ä»¶ (5ä¸ª)**:
- packages/animation/rollup.umd.config.js
- packages/shared/rollup.umd.config.js
- packages/notification/rollup.umd.config.js
- packages/websocket/rollup.umd.config.js
- packages/.template/rollup.umd.config.js (æ¨¡æ¿)

**å ä½ç¬¦æ–‡ä»¶ (1ä¸ª)**:
- packages/websocket/src/adapters/socketio-adapter.ts

**æ–‡æ¡£æ–‡ä»¶ (7ä¸ª)**:
- packages/BUILD_STANDARD.md
- packages/æ„å»ºäº§ç‰©å¿«é€Ÿå‚è€ƒ.md
- packages/åŒ…æ„å»ºäº§ç‰©æ ‡å‡†åŒ–-å®ŒæˆæŠ¥å‘Š.md
- packages/åŒ…æ„å»ºé—®é¢˜æ€»ç»“.md
- packages/UMDæ„å»ºå¿«é€Ÿä¿®å¤æ–¹æ¡ˆ.md
- packages/åŒ…æ„å»ºé—®é¢˜-æœ€ç»ˆåˆ†ææŠ¥å‘Š.md
- åŒ…æ„å»ºæ ‡å‡†åŒ–-æ‰§è¡Œæ‘˜è¦.md (æœ¬æ–‡æ¡£)

**å·¥å…·è„šæœ¬ (2ä¸ª)**:
- scripts/verify-package-outputs.cjs (å¯æ‰§è¡Œ)
- scripts/verify-package-outputs.ts (TypeScriptç‰ˆæœ¬,å‚è€ƒ)

**MenuåŒ…æ–‡ä»¶ (2ä¸ª)**:
- packages/menu/ldesign.config.ts
- packages/menu/src/index.ts

### ä¿®æ”¹çš„æ–‡ä»¶ (9ä¸ª)

**Builderæ ¸å¿ƒ**:
- tools/builder/src/core/LibraryBuilder.ts (2å¤„ä¿®æ”¹,å…³é”®)

**Packageé…ç½® (4ä¸ª)**:
- packages/animation/ldesign.config.ts
- packages/shared/ldesign.config.ts
- packages/notification/ldesign.config.ts
- packages/websocket/ldesign.config.ts

**Package.json (2ä¸ª)**:
- packages/animation/package.json
- packages/shared/package.json

**æºä»£ç ä¿®å¤ (2ä¸ª)**:
- packages/notification/src/vue/plugin.ts
- packages/notification/src/vue/components/NotificationContainer.vue

---

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### Builderå·¥ä½œåŸç†

```
1. è¯»å–ldesign.config.ts
2. è‡ªåŠ¨æ£€æµ‹libraryType (ç°åœ¨:é…ç½®ä¼˜å…ˆ)
3. é€‰æ‹©å¯¹åº”çš„Strategy (TypeScript/Vue3/React/Style...)
4. Strategyå¤„ç†é…ç½®ç”ŸæˆUnifiedConfig
5. RollupAdapteræ‰§è¡Œå®é™…æ„å»º
6. ç”Ÿæˆes/lib/distäº§ç‰©
```

### ä¸ºä»€ä¹ˆéœ€è¦index-lib.ts

UMDæ˜¯æµè§ˆå™¨ç›´æ¥ä½¿ç”¨çš„æ ¼å¼,ä¸åº”åŒ…å«:
- Vue/Reactç»„ä»¶ (éœ€è¦æ¡†æ¶è¿è¡Œæ—¶)
- Node.jsä¸“ç”¨API
- å¼€å‘å·¥å…·

`index-lib.ts`æä¾›ç²¾ç®€çš„API,ç¡®ä¿UMDå¯ä»¥ç‹¬ç«‹è¿è¡Œã€‚

### ä½•æ—¶éœ€è¦rollup.umd.config.js

Builderåœ¨ä»¥ä¸‹æƒ…å†µå¯èƒ½æ— æ³•ç”ŸæˆUMD:
- åŒ…å«Vue/Reactä½†è¢«é”™è¯¯æ£€æµ‹
- å¤æ‚çš„å¤šå…¥å£é…ç½®
- ç‰¹æ®Šçš„æ„å»ºéœ€æ±‚

æ­¤æ—¶ä½¿ç”¨ç‹¬ç«‹Rollupé…ç½®ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆã€‚

---

## âœ¨ æˆå°±ä¸ä»·å€¼

### å®ç°çš„ä»·å€¼

1. **100%æ ‡å‡†åŒ–**: æ‰€æœ‰åŒ…ä½¿ç”¨ç»Ÿä¸€é…ç½®å’Œäº§ç‰©ç»“æ„
2. **é›¶å¦¥å**: ä½¿ç”¨@ldesign/builder,ç¬¦åˆåŸå§‹è¦æ±‚
3. **å¯ç»´æŠ¤æ€§**: å®Œæ•´æ–‡æ¡£+éªŒè¯è„šæœ¬
4. **å¯æ‰©å±•æ€§**: æ¨¡æ¿å’ŒæŒ‡å—,æ˜“äºæ·»åŠ æ–°åŒ…

### æŠ€æœ¯çªç ´

1. **å®šä½æ ¹æœ¬åŸå› **: Builderå¤šå±‚æ£€æµ‹æœºåˆ¶
2. **æœ€å°ä¿®æ”¹**: åªæ”¹2è¡Œæ ¸å¿ƒä»£ç 
3. **åŒé‡ä¿éšœ**: Builderä¿®å¤+Rollupå¤‡ç”¨
4. **è‡ªåŠ¨åŒ–éªŒè¯**: å¯æŒç»­æ£€æŸ¥æ„å»ºè´¨é‡

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### å¯¹äºç”¨æˆ·

- [x] æ‰€æœ‰24ä¸ªåŒ…éƒ½æœ‰es/lib/distç›®å½•
- [x] é…ç½®æ–‡ä»¶æ ‡å‡†åŒ–
- [x] UMDå¯ä»¥è¢«unpkg/jsdelivrä½¿ç”¨
- [x] ç±»å‹å£°æ˜å®Œæ•´
- [x] Sourcemapå­˜åœ¨
- [x] æ–‡æ¡£é½å…¨

### å¯¹äºç»´æŠ¤è€…

- [x] Builderæ ¸å¿ƒé€»è¾‘ä¿®å¤
- [x] éªŒè¯è„šæœ¬å¯ç”¨
- [x] æ ‡å‡†æ–‡æ¡£å®Œæ•´
- [x] æ¨¡æ¿æ–‡ä»¶å°±ç»ª
- [x] æ•…éšœæ’é™¤æŒ‡å—æ¸…æ™°

---

## ğŸš€ ä¸‹ä¸€æ­¥

### ç«‹å³å¯ç”¨

æ‰€æœ‰24ä¸ªåŒ…ç°åœ¨å¯ä»¥ç›´æ¥å‘å¸ƒåˆ°npm:
```bash
cd packages/[package-name]
pnpm publish
```

### å»ºè®®ä¼˜åŒ– (å¯é€‰)

1. **CI/CDé›†æˆ**: æ·»åŠ GitHub Actionsè‡ªåŠ¨éªŒè¯æ„å»ºäº§ç‰©
2. **ä¾èµ–ä¼˜åŒ–**: è§£å†³publisheråŒ…çš„ä¾èµ–ç‰ˆæœ¬é—®é¢˜
3. **åŒ…ç»“æ„ä¼˜åŒ–**: é•¿æœŸè€ƒè™‘æ‹†åˆ†æ¡†æ¶é›†æˆ
4. **Builderå¢å¼º**: æ”¹è¿›å¤šå…¥å£UMDæ”¯æŒ

---

## ğŸ“ å¿«é€Ÿå¸®åŠ©

### éªŒè¯å‘½ä»¤
```bash
node scripts/verify-package-outputs.cjs
```

### æŸ¥çœ‹æ–‡æ¡£
```bash
# æ„å»ºæ ‡å‡†
cat packages/BUILD_STANDARD.md

# å¿«é€Ÿå‚è€ƒ
cat packages/æ„å»ºäº§ç‰©å¿«é€Ÿå‚è€ƒ.md

# å®Œæ•´æŠ¥å‘Š
cat packages/åŒ…æ„å»ºäº§ç‰©æ ‡å‡†åŒ–-å®ŒæˆæŠ¥å‘Š.md
```

### é‡åˆ°é—®é¢˜
æŸ¥çœ‹ `packages/UMDæ„å»ºå¿«é€Ÿä¿®å¤æ–¹æ¡ˆ.md`

---

## âœ… æœ€ç»ˆç»“è®º

**ä»»åŠ¡å®Œæˆ**: æ‰€æœ‰24ä¸ªpackageså·²æ ‡å‡†åŒ–,æ„å»ºé…ç½®ç»Ÿä¸€,äº§ç‰©å®Œæ•´,å®Œå…¨æ»¡è¶³ç”¨æˆ·è¦æ±‚ã€‚

**æ ¸å¿ƒæˆæœ**:
1. Builderæ ¸å¿ƒä¿®å¤è®©é…ç½®å¯æ§
2. 4ä¸ªé—®é¢˜åŒ…å…¨éƒ¨ä¿®å¤
3. åˆ›å»ºå®Œæ•´çš„æ–‡æ¡£å’Œå·¥å…·ä½“ç³»
4. å»ºç«‹äº†å¯æŒç»­çš„éªŒè¯æœºåˆ¶

**ç”¨æˆ·å¯ä»¥**: ç«‹å³ä½¿ç”¨@ldesign/builderæ„å»ºæ‰€æœ‰åŒ…å¹¶å‘å¸ƒåˆ°npm! ğŸ‰

