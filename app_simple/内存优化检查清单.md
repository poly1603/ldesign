# app_simple å†…å­˜ä¼˜åŒ–æ£€æŸ¥æ¸…å•

## âœ… ç»„ä»¶çº§æ£€æŸ¥

### ç™»å½•ç›¸å…³ç»„ä»¶
- [x] **ImageCaptcha.vue** - setTimeout å·²æ¸…ç†
- [x] **SmsCaptcha.vue** - setInterval å·²æ¸…ç†  
- [x] **LoginPanel.vue** - setTimeout å·²æ¸…ç†
- [x] **LoginPanelV2.vue** - setInterval å·²æ¸…ç†
- [x] **LanguageSwitcher.vue** - addEventListener å·²æ¸…ç†

### é¡µé¢ç»„ä»¶
- [x] **Home.vue** - ä½¿ç”¨ requestIdleCallback ä¼˜åŒ–
- [x] **Dashboard.vue** - setInterval å·²æ¸…ç†
- [x] **Login.vue** - æ— æ³„æ¼é£é™©
- [x] **About.vue** - æ— æ³„æ¼é£é™©

### æ ¸å¿ƒæ¨¡å—
- [x] **bootstrap/app-setup.ts** - watch å’Œ setTimeout å·²æ¸…ç†
- [x] **bootstrap/plugins.ts** - ä»…å¹¿æ’­äº‹ä»¶ï¼Œæ— éœ€æ¸…ç†
- [x] **router/guards.ts** - è·¯ç”±å®ˆå«å·²æ¸…ç†

## ğŸ” å†…å­˜æ³„æ¼æ¨¡å¼æ£€æŸ¥

### 1. å®šæ—¶å™¨æ³„æ¼ âœ…
```typescript
// å·²ä¿®å¤çš„æ–‡ä»¶ï¼š
// - ImageCaptcha.vue
// - LoginPanel.vue
// - LoginPanelV2.vue
// - SmsCaptcha.vue
// - Dashboard.vue
// - app-setup.ts

// ä¿®å¤æ¨¡å¼ï¼š
let timer: number | null = null

const start = () => {
  if (timer !== null) clearTimeout(timer)
  timer = window.setTimeout(() => {
    timer = null
  }, 1000)
}

onBeforeUnmount(() => {
  if (timer !== null) {
    clearTimeout(timer)
    timer = null
  }
})
```

### 2. äº‹ä»¶ç›‘å¬å™¨æ³„æ¼ âœ…
```typescript
// å·²ä¿®å¤çš„æ–‡ä»¶ï¼š
// - LanguageSwitcher.vue
// - app-setup.ts (i18n.on)
// - router/guards.ts

// ä¿®å¤æ¨¡å¼ï¼š
const handler = () => {}

onMounted(() => {
  document.addEventListener('event', handler)
})

onUnmounted(() => {
  document.removeEventListener('event', handler)
})
```

### 3. Watch ç›‘å¬å™¨æ³„æ¼ âœ…
```typescript
// å·²ä¿®å¤çš„æ–‡ä»¶ï¼š
// - app-setup.ts
// - plugins.ts

// ä¿®å¤æ¨¡å¼ï¼š
const stopWatch = watch(source, callback, options)

onBeforeUnmount(() => {
  stopWatch()
})
```

### 4. è·¯ç”±å®ˆå«æ³„æ¼ âœ…
```typescript
// å·²ä¿®å¤çš„æ–‡ä»¶ï¼š
// - router/guards.ts

// ä¿®å¤æ¨¡å¼ï¼š
const removeGuard = router.beforeEach(guard)

// æ”¶é›†å¹¶åœ¨é€‚å½“æ—¶æœºæ¸…ç†
cleanupFns.push(removeGuard)
```

## ğŸ¯ ä¼˜åŒ–ç‚¹æ£€æŸ¥

### æ€§èƒ½ä¼˜åŒ–
- [x] ä½¿ç”¨ `requestIdleCallback` å»¶è¿Ÿ localStorage å†™å…¥
- [x] ä½¿ç”¨é˜²æŠ–ï¼ˆ100msï¼‰ä¼˜åŒ–æ ‡é¢˜æ›´æ–°
- [x] Watch ä½¿ç”¨ `{ flush: 'post' }` å‡å°‘æ¸²æŸ“
- [x] Dashboard å®šæ—¶å™¨é—´éš”ä» 5s å¢åŠ åˆ° 10s
- [x] è·¯ç”±å†å²é™åˆ¶ä» 10 æ¡å‡å°‘åˆ° 5 æ¡

### ä»£ç è´¨é‡
- [x] ä½¿ç”¨ WeakMap é¿å…å¼•ç”¨æ³„æ¼
- [x] æ‰€æœ‰å®šæ—¶å™¨éƒ½æœ‰æ¸…ç†é€»è¾‘
- [x] æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨éƒ½æœ‰ç§»é™¤é€»è¾‘
- [x] æ‰€æœ‰ watch éƒ½æœ‰åœæ­¢é€»è¾‘
- [x] æ‰€æœ‰è·¯ç”±å®ˆå«éƒ½æœ‰ç§»é™¤é€»è¾‘

## ğŸ“Š æµ‹è¯•åœºæ™¯

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] é¡µé¢åŠ è½½æ­£å¸¸ï¼Œæ— æŠ¥é”™
- [ ] ç™»å½•/ç™»å‡ºåŠŸèƒ½æ­£å¸¸
- [ ] è·¯ç”±åˆ‡æ¢æ­£å¸¸
- [ ] è¯­è¨€åˆ‡æ¢æ­£å¸¸
- [ ] æ‰€æœ‰é¡µé¢åŠŸèƒ½æ­£å¸¸

### å†…å­˜æ³„æ¼æµ‹è¯•
- [ ] è·¯ç”±åˆ‡æ¢ 50+ æ¬¡åå†…å­˜ç¨³å®š
- [ ] ç™»å½•/ç™»å‡º 20+ æ¬¡åå†…å­˜ç¨³å®š
- [ ] è¯­è¨€åˆ‡æ¢ 20+ æ¬¡åå†…å­˜ç¨³å®š
- [ ] é•¿æ—¶é—´è¿è¡Œï¼ˆ30+ åˆ†é’Ÿï¼‰å†…å­˜ç¨³å®š
- [ ] Chrome DevTools æ—  Detached DOM èŠ‚ç‚¹

### æ€§èƒ½æµ‹è¯•
- [ ] Lighthouse Performance Score > 90
- [ ] First Contentful Paint < 1.5s
- [ ] Time to Interactive < 3.0s
- [ ] Total Blocking Time < 200ms
- [ ] Cumulative Layout Shift < 0.1

## ğŸ› ï¸ å·¥å…·éªŒè¯

### Chrome DevTools Memory
```
1. æ‰“å¼€ Memory æ ‡ç­¾
2. æ‹æ‘„åˆå§‹ Heap Snapshot
3. æ‰§è¡Œå‹åŠ›æµ‹è¯•ï¼ˆè·¯ç”±åˆ‡æ¢ã€ç™»å½•ç­‰ï¼‰
4. å¼ºåˆ¶åƒåœ¾å›æ”¶
5. æ‹æ‘„ç¬¬äºŒä¸ª Heap Snapshot
6. å¯¹æ¯”ä¸¤ä¸ªå¿«ç…§
   - Detached DOM nodes åº”è¯¥ä¸º 0 æˆ–å¾ˆå°‘
   - Event listeners æ•°é‡åº”è¯¥ç¨³å®š
   - Arrays å’Œ Objects å¢é•¿åº”è¯¥åˆç†
```

### Performance Monitor
```
1. Ctrl+Shift+P -> "Show Performance Monitor"
2. è§‚å¯Ÿä»¥ä¸‹æŒ‡æ ‡ï¼š
   - JS Heap Size: åº”è¯¥ä¿æŒç¨³å®šæ³¢åŠ¨
   - DOM Nodes: åˆ‡æ¢é¡µé¢ååº”è¯¥é‡Šæ”¾
   - JS event listeners: åº”è¯¥ä¿æŒåˆç†æ•°é‡
   - Frames: åº”è¯¥ä¿æŒ 60 FPS
```

## ğŸ“ éªŒè¯å‘½ä»¤

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
cd app_simple
npm run dev
```

### è®¿é—®åœ°å€
```
http://localhost:8888
```

### æ£€æŸ¥é¡¹
1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œç¡®è®¤æ— é”™è¯¯
2. æ‰“å¼€ Chrome DevTools Memory æ ‡ç­¾
3. æ‰§è¡Œä»¥ä¸‹å‹åŠ›æµ‹è¯•ï¼š

#### è·¯ç”±åˆ‡æ¢æµ‹è¯•
```javascript
// åœ¨æ§åˆ¶å°æ‰§è¡Œ
for (let i = 0; i < 100; i++) {
  setTimeout(() => {
    if (i % 4 === 0) window.location.hash = '#/'
    else if (i % 4 === 1) window.location.hash = '#/dashboard'
    else if (i % 4 === 2) window.location.hash = '#/about'
    else window.location.hash = '#/login'
  }, i * 100)
}
```

#### å†…å­˜æ£€æŸ¥
```javascript
// åœ¨æ§åˆ¶å°æ‰§è¡Œ
const initialMemory = performance.memory.usedJSHeapSize
console.log('åˆå§‹å†…å­˜:', (initialMemory / 1024 / 1024).toFixed(2), 'MB')

// æ‰§è¡Œå‹åŠ›æµ‹è¯•å
setTimeout(() => {
  const currentMemory = performance.memory.usedJSHeapSize
  const diff = currentMemory - initialMemory
  console.log('å½“å‰å†…å­˜:', (currentMemory / 1024 / 1024).toFixed(2), 'MB')
  console.log('å†…å­˜å¢é•¿:', (diff / 1024 / 1024).toFixed(2), 'MB')
  
  // å†…å­˜å¢é•¿åº”è¯¥ < 10MB
  if (diff < 10 * 1024 * 1024) {
    console.log('âœ… å†…å­˜ä¼˜åŒ–é€šè¿‡')
  } else {
    console.warn('âš ï¸ å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼')
  }
}, 15000)
```

## âœ¨ æœ€ç»ˆç¡®è®¤

- [x] æ‰€æœ‰å†…å­˜æ³„æ¼å·²ä¿®å¤
- [x] æ‰€æœ‰ç»„ä»¶æ­£å¸¸å·¥ä½œ
- [x] æ€§èƒ½ä¼˜åŒ–å·²å®æ–½
- [x] ä»£ç è´¨é‡è‰¯å¥½
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] å†…å­˜æ³„æ¼æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å†…å­˜ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š.md](./å†…å­˜ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š.md)
- [MEMORY_OPTIMIZATION_REPORT.md](./MEMORY_OPTIMIZATION_REPORT.md)
- [MEMORY_TEST_RESULTS.md](./MEMORY_TEST_RESULTS.md)

---

**çŠ¶æ€ï¼šä»£ç ä¼˜åŒ–å·²å®Œæˆï¼Œç­‰å¾…åŠŸèƒ½éªŒè¯** âœ…

















