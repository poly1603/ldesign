<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡æ¿é€‰æ‹©ç¼“å­˜æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .device-simulator {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .device-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .device-btn:hover {
            background: #f0f0f0;
        }
        
        .device-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .template-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .template-item {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .template-item:hover {
            background: #f8f9fa;
            border-color: #007bff;
        }
        
        .template-item.selected {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .storage-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #f0f0f0;
        }
        
        .btn.primary {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .btn.danger {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª æ¨¡æ¿é€‰æ‹©ç¼“å­˜åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="status info">
            <strong>æµ‹è¯•è¯´æ˜ï¼š</strong>
            <br>1. é€‰æ‹©ä¸åŒè®¾å¤‡ç±»å‹å’Œæ¨¡æ¿ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜æ‚¨çš„é€‰æ‹©
            <br>2. åˆ·æ–°é¡µé¢æˆ–åˆ‡æ¢è®¾å¤‡ç±»å‹ï¼Œç³»ç»Ÿä¼šæ¢å¤æ‚¨ä¹‹å‰çš„é€‰æ‹©
            <br>3. æŸ¥çœ‹ localStorage ä¸­çš„ç¼“å­˜æ•°æ®
        </div>

        <div class="test-section">
            <h3>ğŸ“± è®¾å¤‡ç±»å‹åˆ‡æ¢</h3>
            <div class="device-simulator">
                <button class="device-btn active" data-device="desktop">æ¡Œé¢ç«¯</button>
                <button class="device-btn" data-device="tablet">å¹³æ¿ç«¯</button>
                <button class="device-btn" data-device="mobile">ç§»åŠ¨ç«¯</button>
            </div>
            <div class="status" id="deviceStatus">å½“å‰è®¾å¤‡: desktop</div>
        </div>

        <div class="test-section">
            <h3>ğŸ¨ æ¨¡æ¿é€‰æ‹©</h3>
            <div class="template-list" id="templateList">
                <!-- æ¨¡æ¿åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="status" id="templateStatus">å½“å‰æ¨¡æ¿: æœªé€‰æ‹©</div>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ æ§åˆ¶é¢æ¿</h3>
            <div class="controls">
                <button class="btn primary" onclick="refreshPage()">åˆ·æ–°é¡µé¢</button>
                <button class="btn" onclick="showStorageData()">æŸ¥çœ‹ç¼“å­˜</button>
                <button class="btn danger" onclick="clearStorage()">æ¸…ç©ºç¼“å­˜</button>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ’¾ å­˜å‚¨æ•°æ®</h3>
            <div class="storage-info" id="storageInfo">ç‚¹å‡»"æŸ¥çœ‹ç¼“å­˜"æŒ‰é’®æŸ¥çœ‹å­˜å‚¨çš„æ•°æ®</div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ¨¡æ¿æ•°æ®
        const mockTemplates = {
            desktop: ['classic', 'modern', 'minimal', 'corporate'],
            tablet: ['responsive', 'touch-friendly', 'compact'],
            mobile: ['mobile-first', 'simple', 'gesture-based']
        };

        // å½“å‰çŠ¶æ€
        let currentDevice = 'desktop';
        let currentTemplate = null;

        // å­˜å‚¨ç®¡ç†å™¨ï¼ˆæ¨¡æ‹Ÿ TemplateStorageManagerï¼‰
        class MockTemplateStorage {
            constructor() {
                this.key = 'ldesign-template-selections';
                this.loadData();
            }

            loadData() {
                try {
                    const stored = localStorage.getItem(this.key);
                    if (stored) {
                        this.data = JSON.parse(stored);
                    } else {
                        this.data = { selections: {}, lastUpdated: Date.now(), version: '1.0.0' };
                    }
                } catch (error) {
                    console.warn('Failed to load template selections:', error);
                    this.data = { selections: {}, lastUpdated: Date.now(), version: '1.0.0' };
                }
            }

            saveData() {
                try {
                    this.data.lastUpdated = Date.now();
                    localStorage.setItem(this.key, JSON.stringify(this.data));
                } catch (error) {
                    console.warn('Failed to save template selections:', error);
                }
            }

            getSelectionKey(category, device) {
                return `${category}:${device}`;
            }

            saveSelection(category, device, template) {
                const key = this.getSelectionKey(category, device);
                this.data.selections[key] = {
                    category,
                    device,
                    template,
                    timestamp: Date.now()
                };
                this.saveData();
                console.log(`ğŸ’¾ ä¿å­˜æ¨¡æ¿é€‰æ‹©: ${key} -> ${template}`);
            }

            getSelection(category, device) {
                const key = this.getSelectionKey(category, device);
                return this.data.selections[key] || null;
            }

            clearAll() {
                this.data = { selections: {}, lastUpdated: Date.now(), version: '1.0.0' };
                this.saveData();
            }
        }

        // åˆå§‹åŒ–å­˜å‚¨ç®¡ç†å™¨
        const storage = new MockTemplateStorage();

        // åˆå§‹åŒ–é¡µé¢
        function init() {
            updateDeviceButtons();
            updateTemplateList();
            loadSavedSelection();
            updateStatus();
        }

        // æ›´æ–°è®¾å¤‡æŒ‰é’®çŠ¶æ€
        function updateDeviceButtons() {
            document.querySelectorAll('.device-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.device === currentDevice);
                btn.onclick = () => switchDevice(btn.dataset.device);
            });
        }

        // æ›´æ–°æ¨¡æ¿åˆ—è¡¨
        function updateTemplateList() {
            const templateList = document.getElementById('templateList');
            const templates = mockTemplates[currentDevice] || [];
            
            templateList.innerHTML = templates.map(template => `
                <div class="template-item" data-template="${template}">
                    <strong>${template}</strong>
                    <br><small>${currentDevice} æ¨¡æ¿</small>
                </div>
            `).join('');

            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            templateList.querySelectorAll('.template-item').forEach(item => {
                item.onclick = () => selectTemplate(item.dataset.template);
            });

            updateTemplateSelection();
        }

        // æ›´æ–°æ¨¡æ¿é€‰ä¸­çŠ¶æ€
        function updateTemplateSelection() {
            document.querySelectorAll('.template-item').forEach(item => {
                item.classList.toggle('selected', item.dataset.template === currentTemplate);
            });
        }

        // åˆ‡æ¢è®¾å¤‡
        function switchDevice(device) {
            const oldDevice = currentDevice;
            currentDevice = device;
            
            console.log(`ğŸ“± è®¾å¤‡åˆ‡æ¢: ${oldDevice} -> ${device}`);
            
            updateDeviceButtons();
            updateTemplateList();
            loadSavedSelection();
            updateStatus();
        }

        // é€‰æ‹©æ¨¡æ¿
        function selectTemplate(template) {
            currentTemplate = template;
            
            // ä¿å­˜é€‰æ‹©
            storage.saveSelection('login', currentDevice, template);
            
            updateTemplateSelection();
            updateStatus();
            
            console.log(`ğŸ¨ ç”¨æˆ·é€‰æ‹©æ¨¡æ¿: ${template}`);
        }

        // åŠ è½½ä¿å­˜çš„é€‰æ‹©
        function loadSavedSelection() {
            const saved = storage.getSelection('login', currentDevice);
            if (saved && mockTemplates[currentDevice].includes(saved.template)) {
                currentTemplate = saved.template;
                console.log(`ğŸ“‹ æ¢å¤ä¿å­˜çš„é€‰æ‹©: ${saved.template}`);
            } else {
                // ä½¿ç”¨é»˜è®¤æ¨¡æ¿
                currentTemplate = mockTemplates[currentDevice][0];
                console.log(`ğŸ¯ ä½¿ç”¨é»˜è®¤æ¨¡æ¿: ${currentTemplate}`);
            }
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            document.getElementById('deviceStatus').textContent = `å½“å‰è®¾å¤‡: ${currentDevice}`;
            document.getElementById('templateStatus').textContent = `å½“å‰æ¨¡æ¿: ${currentTemplate || 'æœªé€‰æ‹©'}`;
        }

        // æ˜¾ç¤ºå­˜å‚¨æ•°æ®
        function showStorageData() {
            const data = JSON.stringify(storage.data, null, 2);
            document.getElementById('storageInfo').textContent = data;
        }

        // æ¸…ç©ºå­˜å‚¨
        function clearStorage() {
            storage.clearAll();
            currentTemplate = null;
            updateTemplateList();
            updateStatus();
            showStorageData();
            console.log('ğŸ—‘ï¸ å·²æ¸…ç©ºæ‰€æœ‰ç¼“å­˜æ•°æ®');
        }

        // åˆ·æ–°é¡µé¢
        function refreshPage() {
            location.reload();
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
