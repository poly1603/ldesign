<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mention æœ€ç»ˆä¿®å¤æµ‹è¯•</title>
  <style>
    body {
      padding: 40px;
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 0 auto;
    }
    .test-item {
      margin: 30px 0;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      background: #f9f9f9;
    }
    .test-item h3 {
      margin-top: 0;
      color: #333;
      border-bottom: 1px solid #e0e0e0;
      padding-bottom: 8px;
    }
    .tips {
      background: #e3f2fd;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      font-size: 14px;
    }
    button {
      margin: 5px;
      padding: 8px 16px;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #1565c0;
    }
    .status {
      margin-top: 10px;
      padding: 10px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
    }
  </style>
  <script type="module" src="/dist/webcomponent/webcomponent.esm.js"></script>
  <link rel="stylesheet" href="/dist/webcomponent/webcomponent.css">
</head>
<body>
  <h1>ğŸ‰ Mention ç»„ä»¶ - åˆå§‹å€¼é—®é¢˜ä¿®å¤</h1>

  <div class="test-item">
    <h3>âœ… ä¿®å¤æ–¹æ¡ˆ1ï¼šä½¿ç”¨ setOptions æ–¹æ³•</h3>
    <div class="tips">ğŸ’¡ åœ¨åˆå§‹å†…å®¹åè¾“å…¥ @ æˆ– # åº”è¯¥æ­£å¸¸å¼¹å‡ºé€‰æ‹©æ¡†</div>
    <ldesign-mention 
      id="test1"
      value="è¿™æ˜¯åˆå§‹å†…å®¹ï¼Œè¯·è¾“å…¥è§¦å‘ç¬¦ï¼š"
      triggers="@,#">
    </ldesign-mention>
    <div class="status" id="status1">ç­‰å¾…åˆå§‹åŒ–...</div>
  </div>

  <div class="test-item">
    <h3>âœ… ä¿®å¤æ–¹æ¡ˆ2ï¼šé€šè¿‡HTMLå±æ€§ä¼ é€’é€‰é¡¹</h3>
    <div class="tips">ğŸ’¡ é€‰é¡¹é€šè¿‡HTMLå±æ€§è®¾ç½®ï¼Œåº”è¯¥èƒ½æ­£å¸¸å·¥ä½œ</div>
    <ldesign-mention 
      id="test2"
      value="HTMLå±æ€§æ–¹å¼ï¼Œè¾“å…¥è§¦å‘ç¬¦ï¼š"
      triggers="@,#"
      options='[{"value":"alice","label":"Alice"},{"value":"bob","label":"Bob"},{"value":"charlie","label":"Charlie"}]'>
    </ldesign-mention>
    <div class="status" id="status2">é€šè¿‡HTMLå±æ€§è®¾ç½®é€‰é¡¹</div>
  </div>

  <div class="test-item">
    <h3>ğŸ”§ å¯¹æ¯”æµ‹è¯•ï¼šæ— åˆå§‹å€¼</h3>
    <div class="tips">ğŸ’¡ æ— åˆå§‹å€¼çš„æƒ…å†µåº”è¯¥ä¸€ç›´æ­£å¸¸å·¥ä½œ</div>
    <ldesign-mention 
      id="test3"
      placeholder="æ— åˆå§‹å€¼ï¼Œè¾“å…¥ @ æˆ– # æµ‹è¯•"
      triggers="@,#">
    </ldesign-mention>
    <div class="status" id="status3">ç­‰å¾…åˆå§‹åŒ–...</div>
  </div>

  <script>
    // å®šä¹‰é€‰é¡¹æ•°æ®
    const globalOptions = [
      { value: 'alice', label: 'Alice' },
      { value: 'bob', label: 'Bob' },
      { value: 'charlie', label: 'Charlie' },
      { value: 'diana', label: 'Diana' },
      { value: 'eve', label: 'Eve' }
    ];

    const hashOptions = [
      { value: 'bug', label: 'BugæŠ¥å‘Š' },
      { value: 'feature', label: 'æ–°åŠŸèƒ½' },
      { value: 'question', label: 'é—®é¢˜' },
      { value: 'discussion', label: 'è®¨è®º' }
    ];

    // åˆå§‹åŒ–å‡½æ•°
    async function initMentions() {
      console.log('=== å¼€å§‹åˆå§‹åŒ– Mention ç»„ä»¶ ===');
      
      // æµ‹è¯•1ï¼šä½¿ç”¨ setOptions æ–¹æ³•
      const test1 = document.getElementById('test1');
      if (test1) {
        try {
          // ä½¿ç”¨æ–°çš„ setOptions æ–¹æ³•
          await test1.setOptions(globalOptions);
          document.getElementById('status1').textContent = 'âœ… ä½¿ç”¨ setOptions æ–¹æ³•è®¾ç½®äº† ' + globalOptions.length + ' ä¸ªé€‰é¡¹';
          console.log('[test1] setOptions è°ƒç”¨æˆåŠŸ');
          
          // è®¾ç½® triggerConfigs æ¥æ”¯æŒä¸åŒè§¦å‘ç¬¦çš„ä¸åŒé€‰é¡¹
          test1.triggerConfigs = [
            { char: '@', options: globalOptions },
            { char: '#', options: hashOptions }
          ];
        } catch (e) {
          console.error('[test1] setOptions å¤±è´¥:', e);
          // å¤‡ç”¨æ–¹æ¡ˆï¼šé€šè¿‡å±æ€§è®¾ç½®
          test1.options = globalOptions;
          document.getElementById('status1').textContent = 'âš ï¸ ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆè®¾ç½®é€‰é¡¹';
        }
      }

      // æµ‹è¯•3ï¼šæ— åˆå§‹å€¼çš„æƒ…å†µ
      const test3 = document.getElementById('test3');
      if (test3) {
        await test3.setOptions(globalOptions);
        test3.triggerConfigs = [
          { char: '@', options: globalOptions },
          { char: '#', options: hashOptions }
        ];
        document.getElementById('status3').textContent = 'âœ… ä½¿ç”¨ setOptions æ–¹æ³•è®¾ç½®äº†é€‰é¡¹';
      }

      // ä¸ºæ‰€æœ‰ç»„ä»¶æ·»åŠ äº‹ä»¶ç›‘å¬
      document.querySelectorAll('ldesign-mention').forEach(el => {
        // ç›‘å¬æœç´¢äº‹ä»¶
        el.addEventListener('ldesignSearch', (e) => {
          console.log(`[${el.id}] æœç´¢äº‹ä»¶:`, e.detail);
        });
        
        // ç›‘å¬é€‰æ‹©äº‹ä»¶
        el.addEventListener('ldesignSelect', (e) => {
          console.log(`[${el.id}] é€‰æ‹©äº‹ä»¶:`, e.detail);
          const statusEl = document.getElementById('status' + el.id.slice(-1));
          if (statusEl) {
            statusEl.textContent = `âœ… é€‰ä¸­äº†: ${e.detail.value.label}`;
          }
        });
      });
      
      console.log('=== Mention ç»„ä»¶åˆå§‹åŒ–å®Œæˆ ===');
    }

    // ç­‰å¾…ç»„ä»¶åŠ è½½å®Œæˆååˆå§‹åŒ–
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(initMentions, 100); // ç¨å¾®å»¶è¿Ÿç¡®ä¿ç»„ä»¶å®Œå…¨åŠ è½½
      });
    } else {
      setTimeout(initMentions, 100);
    }
  </script>
</body>
</html>