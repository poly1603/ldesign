# 实施计划: Changelog 工具增强

## 概述

本实施计划将 @ldesign/changelog 工具的增强功能分解为可执行的编码任务。任务按照依赖关系和优先级排序，确保增量开发和持续可测试性。

## 任务列表

- [x] 1. 实现依赖追踪功能
  - [x] 1.1 创建 DependencyTracker 核心类
    - 创建 `src/core/DependencyTracker.ts`
    - 实现 package.json 差异解析
    - 支持检测 added/updated/removed 依赖
    - 支持所有依赖类型 (dependencies, devDependencies, peerDependencies, optionalDependencies)
    - _需求: 1.1, 1.2, 1.3, 1.4_
  - [x] 1.2 编写依赖变更检测属性测试
    - **属性 1: 依赖变更检测和记录**
    - **验证: 需求 1.1, 1.2, 1.3, 1.4**
  - [x] 1.3 集成依赖追踪到 ChangelogGenerator
    - 在生成流程中调用 DependencyTracker
    - 添加 Dependencies 部分到输出
    - 处理无依赖变更的情况
    - _需求: 1.5, 1.6_
  - [x] 1.4 添加 `--track-deps` CLI 选项
    - 支持启用/禁用依赖追踪
    - 添加配置文件支持
    - _需求: 1.1_

- [x] 2. 检查点 - 依赖追踪完成
  - 确保所有测试通过，如有问题请询问用户

- [x] 3. 实现安全扫描功能
  - [x] 3.1 创建 SecurityScanner 核心类
    - 创建 `src/core/SecurityScanner.ts`
    - 实现安全关键词检测
    - 支持 CVE ID 解析
    - 实现严重性分级
    - _需求: 2.1_
  - [x] 3.2 编写安全问题识别属性测试
    - **属性 2: 安全问题识别**
    - **验证: 需求 2.1, 2.2**
  - [x] 3.3 集成安全扫描到 ChangelogGenerator
    - 添加安全徽章到提交条目
    - 创建 Security 部分
    - 确保 Security 部分置顶
    - _需求: 2.2, 2.3, 2.4_
  - [x] 3.4 编写安全部分排序属性测试
    - **属性 3: 安全部分排序**
    - **验证: 需求 2.3, 2.4**
  - [x] 3.5 实现 CVE 链接生成
    - 检测 CVE ID 并生成链接
    - 支持可选的 CVE 详情获取
    - _需求: 2.5_

- [x] 4. 检查点 - 安全扫描完成
  - 确保所有测试通过，如有问题请询问用户

- [x] 5. 实现迁移指南生成功能
  - [x] 5.1 创建 MigrationGenerator 核心类
    - 创建 `src/core/MigrationGenerator.ts`
    - 实现破坏性变更检测
    - 从提交体提取描述
    - 按 scope 组织条目
    - _需求: 3.1, 3.2, 3.5_
  - [x] 5.2 编写迁移指南生成属性测试
    - **属性 4: 迁移指南生成**
    - **验证: 需求 3.1, 3.2, 3.4, 3.5**
  - [x] 5.3 实现 Markdown 输出格式
    - 创建迁移指南模板
    - 支持代码示例
    - _需求: 3.4, 3.6_
  - [x] 5.4 集成 AI 增强（可选）
    - 使用 AIEnhancer 生成详细步骤
    - 处理 AI 不可用的情况
    - _需求: 3.3_
  - [x] 5.5 添加 `migration` CLI 命令
    - 支持独立生成迁移指南
    - 支持输出到文件
    - _需求: 3.1_

- [x] 6. 检查点 - 迁移指南完成
  - 确保所有测试通过，如有问题请询问用户

- [x] 7. 实现 Changelog 合并功能
  - [x] 7.1 创建 ChangelogMerger 核心类
    - 创建 `src/core/ChangelogMerger.ts`
    - 实现 Markdown 和 JSON 格式解析
    - 实现合并策略 (by-date, by-version, by-package)
    - _需求: 4.1, 4.2, 4.6_
  - [x] 7.2 编写 Changelog 合并正确性属性测试
    - **属性 5: Changelog 合并正确性**
    - **验证: 需求 4.2, 4.3, 4.4, 4.5, 4.6**
  - [x] 7.3 实现去重和分组逻辑
    - 基于 commit hash 去重
    - 按版本和日期分组
    - 保留包名/scope 信息
    - _需求: 4.3, 4.4, 4.5_
  - [x] 7.4 添加 `merge` CLI 命令
    - 支持多文件输入
    - 支持合并策略选择
    - _需求: 4.1_

- [x] 8. 检查点 - Changelog 合并完成
  - 确保所有测试通过，如有问题请询问用户

- [x] 9. 实现提交验证增强
  - [x] 9.1 增强 CommitParser 模板支持
    - 添加自定义模板配置
    - 实现模板验证逻辑
    - _需求: 7.1, 7.2_
  - [x] 9.2 编写提交验证反馈属性测试
    - **属性 6: 提交验证反馈**
    - **验证: 需求 7.2, 7.3, 7.4, 7.5, 7.6**
  - [x] 9.3 实现详细错误反馈
    - 提供具体的验证失败原因
    - 支持 scope 白名单验证
    - 检测过长的提交主题
    - _需求: 7.3, 7.4, 7.5_
  - [x] 9.4 实现自动修复建议
    - 检测常见错误模式
    - 生成修复建议
    - _需求: 7.6_

- [x] 10. 检查点 - 提交验证增强完成
  - 确保所有测试通过，如有问题请询问用户

- [x] 11. 实现 Changelog 导入功能
  - [x] 11.1 创建 ChangelogImporter 核心类
    - 创建 `src/core/ChangelogImporter.ts`
    - 实现格式自动检测
    - _需求: 8.1_
  - [x] 11.2 实现多格式解析器
    - Keep a Changelog 格式解析
    - conventional-changelog 格式解析
    - 纯 Markdown 格式解析
    - _需求: 8.2, 8.3, 8.4_
  - [x] 11.3 编写导入格式往返属性测试
    - **属性 7: 导入格式往返**
    - **验证: 需求 8.2, 8.3, 8.4, 8.5**
  - [x] 11.4 实现错误处理和部分导入
    - 报告解析错误
    - 继续处理有效条目
    - _需求: 8.5, 8.6_
  - [x] 11.5 添加 `import` CLI 命令
    - 支持格式指定
    - 支持日期和版本保留选项
    - _需求: 8.1_

- [x] 12. 检查点 - Changelog 导入完成
  - 确保所有测试通过，如有问题请询问用户

- [x] 13. 实现监视模式功能
  - [x] 13.1 创建 WatchManager 核心类
    - 创建 `src/core/WatchManager.ts`
    - 实现提交监视逻辑
    - 实现状态文件管理
    - _需求: 9.1, 9.5_
  - [x] 13.2 编写监视模式增量处理属性测试
    - **属性 8: 监视模式增量处理**
    - **验证: 需求 9.2, 9.4, 9.5**
  - [x] 13.3 实现增量处理逻辑
    - 只处理新提交
    - 跳过无新提交的情况
    - _需求: 9.2, 9.4, 9.6_
  - [x] 13.4 实现 Cron 调度支持
    - 解析 cron 表达式
    - 实现定时触发
    - _需求: 9.3_
  - [x] 13.5 添加 `watch` CLI 命令
    - 支持间隔配置
    - 支持 cron 配置
    - _需求: 9.1_

- [x] 14. 检查点 - 监视模式完成
  - 确保所有测试通过，如有问题请询问用户

- [x] 15. 实现多语言生成功能
  - [x] 15.1 创建 MultiLangTranslator 核心类
    - 创建 `src/core/MultiLangTranslator.ts`
    - 实现语言特定格式化
    - 实现文件命名模式
    - _需求: 10.1, 10.3, 10.4_
  - [x] 15.2 编写多语言输出一致性属性测试
    - **属性 9: 多语言输出一致性**
    - **验证: 需求 10.1, 10.3, 10.4, 10.5**
  - [x] 15.3 实现翻译集成
    - 集成 AI 翻译
    - 实现翻译失败回退
    - _需求: 10.2, 10.6_
  - [x] 15.4 添加 `--languages` CLI 选项
    - 支持多语言同时生成
    - 支持术语表配置
    - _需求: 10.1_

- [x] 16. 检查点 - 多语言生成完成
  - 确保所有测试通过，如有问题请询问用户

- [x] 17. 实现搜索和过滤 API
  - [x] 17.1 创建 SearchEngine 核心类
    - 创建 `src/core/SearchEngine.ts`
    - 实现关键词搜索
    - 实现多条件过滤
    - _需求: 11.1, 11.2_
  - [x] 17.2 编写搜索和过滤正确性属性测试
    - **属性 10: 搜索和过滤正确性**
    - **验证: 需求 11.1, 11.2, 11.3, 11.5, 11.6**
  - [x] 17.3 实现分页和排序
    - 支持分页参数
    - 支持多种排序方式
    - _需求: 11.3, 11.6_
  - [x] 17.4 实现全文搜索
    - 搜索提交消息和描述
    - 返回结构化 JSON
    - _需求: 11.4, 11.5_
  - [x] 17.5 添加 `search` CLI 命令
    - 支持关键词和过滤参数
    - 支持输出格式选择
    - _需求: 11.1_

- [x] 18. 检查点 - 搜索和过滤完成
  - 确保所有测试通过，如有问题请询问用户

- [x] 19. 实现变更影响分析功能
  - [x] 19.1 创建 DiffAnalyzer 核心类
    - 创建 `src/core/DiffAnalyzer.ts`
    - 实现文件变更统计
    - 实现模块识别
    - _需求: 6.1, 6.2_
  - [x] 19.2 编写风险评分计算属性测试
    - **属性 11: 风险评分计算**
    - **验证: 需求 6.1, 6.3, 6.4, 6.5**
  - [x] 19.3 编写受影响模块识别属性测试
    - **属性 12: 受影响模块识别**
    - **验证: 需求 6.2, 6.6**
  - [x] 19.4 实现风险评分算法
    - 计算风险评分
    - 确定风险等级
    - 识别风险因素
    - _需求: 6.3, 6.4, 6.5_
  - [x] 19.5 实现影响摘要生成
    - 生成受影响区域摘要
    - 添加到发布说明
    - _需求: 6.6_
  - [x] 19.6 添加 `analyze` CLI 命令
    - 支持版本范围分析
    - 支持详细输出
    - _需求: 6.1_

- [x] 20. 检查点 - 变更影响分析完成
  - 确保所有测试通过，如有问题请询问用户

- [x] 21. 实现交互式 CLI
  - [x] 21.1 创建 InteractiveCLI 核心类
    - 创建 `src/cli/InteractiveCLI.ts`
    - 实现主菜单
    - 实现键盘导航
    - _需求: 5.1, 5.6_
  - [x] 21.2 实现生成向导
    - 版本选择引导
    - 预览功能
    - _需求: 5.2, 5.3_
  - [x] 21.3 实现发布向导
    - 步骤式发布流程
    - 确认对话框
    - _需求: 5.4_
  - [x] 21.4 实现错误处理和恢复
    - 清晰的错误消息
    - 恢复选项
    - _需求: 5.5_
  - [x] 21.5 添加 `interactive` CLI 命令
    - 启动交互式模式
    - 支持主题配置
    - _需求: 5.1_

- [x] 22. 检查点 - 交互式 CLI 完成
  - 确保所有测试通过，如有问题请询问用户

- [x] 23. 增强可视化仪表板
  - [x] 23.1 实现交互式时间线
    - 添加发布时间线视图
    - 支持点击查看详情
    - _需求: 12.1_
  - [x] 23.2 实现统计图表
    - 添加贡献者统计图
    - 添加提交类型分布图
    - 添加时间趋势图
    - _需求: 12.2_
  - [x] 23.3 实现搜索功能
    - 添加搜索框
    - 集成 SearchEngine
    - _需求: 12.3_
  - [x] 23.4 实现依赖变更历史视图
    - 显示依赖变更时间线
    - 支持版本对比
    - _需求: 12.4_
  - [x] 23.5 实现发布指标
    - 显示发布频率
    - 显示速度指标
    - _需求: 12.5_
  - [x] 23.6 实现数据导出
    - 支持导出 JSON/CSV
    - 支持导出图表
    - _需求: 12.6_

- [x] 24. 最终检查点 - 所有功能完成
  - 确保所有测试通过
  - 运行完整的测试套件
  - 验证所有 CLI 命令
  - 更新文档
  - 如有问题请询问用户

## 注意事项

- 所有属性测试任务都是必需的，确保全面测试覆盖
- 每个属性测试必须引用设计文档中的属性编号
- 属性测试使用 fast-check 库，每个测试至少运行 100 次迭代
- 检查点任务用于验证阶段性成果，确保代码质量
- 所有新模块应遵循现有代码风格和架构模式
