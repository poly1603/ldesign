# LDesign æ„å»ºæŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•æ„å»º LDesign é¡¹ç›®çš„æ‰€æœ‰åŒ…ã€‚

## ğŸ“¦ é¡¹ç›®ç»“æ„

LDesign æ˜¯ä¸€ä¸ª monorepo é¡¹ç›®ï¼ŒåŒ…å«ä»¥ä¸‹å­é¡¹ç›®ï¼š

```
ldesign/
â”œâ”€â”€ packages/          # æ ¸å¿ƒåŒ…
â”‚   â”œâ”€â”€ kit/          # Node.js å·¥å…·åº“ï¼ˆä¼˜å…ˆçº§ï¼‰
â”‚   â”œâ”€â”€ builder/      # æ„å»ºå·¥å…·ï¼ˆä¼˜å…ˆçº§ï¼‰
â”‚   â”œâ”€â”€ launcher/     # å¯åŠ¨å™¨ï¼ˆä¼˜å…ˆçº§ï¼‰
â”‚   â”œâ”€â”€ webcomponent/ # Web Componentsï¼ˆç‰¹æ®Šï¼‰
â”‚   â”œâ”€â”€ api/          # æ ‡å‡†åŒ…
â”‚   â”œâ”€â”€ cache/        # æ ‡å‡†åŒ…
â”‚   â””â”€â”€ ...           # å…¶ä»–æ ‡å‡†åŒ…
â””â”€â”€ library/          # ç»„ä»¶åº“
    â”œâ”€â”€ cropper/
    â”œâ”€â”€ editor/
    â”œâ”€â”€ flowchart/
    â””â”€â”€ ...
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®æ„å»ºæ‰€æœ‰é¡¹ç›®

```bash
# ä½¿ç”¨ pnpm è„šæœ¬ï¼ˆæ¨èï¼‰
pnpm build:all

# æˆ–ç›´æ¥è¿è¡Œ TypeScript è„šæœ¬
tsx scripts/build-all.ts

# Windows PowerShell
.\scripts\build-all.ps1
```

### æ¸…ç†åé‡æ–°æ„å»º

```bash
pnpm build:all:clean
```

### æŸ¥çœ‹è¯¦ç»†æ„å»ºä¿¡æ¯

```bash
pnpm build:all:verbose
```

### æ¨¡æ‹Ÿè¿è¡Œï¼ˆä¸å®é™…æ„å»ºï¼‰

```bash
pnpm build:all:dry
```

## ğŸ“‹ å¯ç”¨çš„æ„å»ºå‘½ä»¤

åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `pnpm build:all` | æ„å»ºæ‰€æœ‰åŒ… |
| `pnpm build:all:clean` | æ¸…ç†åæ„å»ºæ‰€æœ‰åŒ… |
| `pnpm build:all:verbose` | è¯¦ç»†è¾“å‡ºæ¨¡å¼æ„å»º |
| `pnpm build:all:dry` | æ¨¡æ‹Ÿè¿è¡Œï¼Œä¸å®é™…æ„å»º |

## ğŸ—ï¸ æ„å»ºæµç¨‹

### 1. ä¼˜å…ˆçº§åŒ…ï¼ˆæŒ‰é¡ºåºæ„å»ºï¼‰

ä»¥ä¸‹åŒ…å¿…é¡»ä¼˜å…ˆæ„å»ºï¼Œå› ä¸ºå…¶ä»–åŒ…ä¾èµ–å®ƒä»¬ï¼š

1. **@ldesign/kit** - Node.js å·¥å…·åº“
   - æ„å»ºå·¥å…·: tsup
   - äº§ç‰©: `dist/`

2. **@ldesign/builder** - æ„å»ºå·¥å…·
   - æ„å»ºå·¥å…·: tsup
   - äº§ç‰©: `dist/`

3. **@ldesign/launcher** - å¯åŠ¨å™¨
   - æ„å»ºå·¥å…·: tsup
   - äº§ç‰©: `dist/`

âš ï¸ **é‡è¦**: å¦‚æœä»»ä¸€ä¼˜å…ˆçº§åŒ…æ„å»ºå¤±è´¥ï¼Œæ•´ä¸ªæ„å»ºä¼šç«‹å³ç»ˆæ­¢ã€‚

### 2. ç‰¹æ®ŠåŒ…

- **@ldesign/webcomponent** - Web Components
  - æ„å»ºå·¥å…·: Stencil
  - äº§ç‰©: `dist/`, `loader/`

### 3. æ ‡å‡† packages

ä½¿ç”¨ @ldesign/builder æ„å»ºçš„æ ‡å‡†åŒ…ï¼š

- api, cache, color, crypto, device, engine
- http, i18n, router, shared, size, store, template

äº§ç‰©ç»“æ„ï¼š
```
es/           # ESM æ ¼å¼ + TypeScript ç±»å‹
lib/          # CommonJS æ ¼å¼ + TypeScript ç±»å‹
dist/         # UMD æ ¼å¼ï¼ˆå‹ç¼©ï¼‰
```

### 4. Library é¡¹ç›®

library ç›®å½•ä¸‹çš„ç»„ä»¶åº“é¡¹ç›®ï¼š

- cropper, editor, flowchart, form, pdf, qrcode

äº§ç‰©ç»“æ„åŒæ ‡å‡† packagesã€‚

## ğŸ” äº§ç‰©éªŒè¯

æ„å»ºè„šæœ¬ä¼šè‡ªåŠ¨éªŒè¯ä»¥ä¸‹äº§ç‰©ï¼š

### ä¼˜å…ˆçº§åŒ…
- âœ… `dist/` ç›®å½•å­˜åœ¨

### æ ‡å‡†åŒ… & Library é¡¹ç›®
- âœ… `es/` ç›®å½•å­˜åœ¨ï¼ˆESM æ ¼å¼ï¼‰
- âœ… `lib/` ç›®å½•å­˜åœ¨ï¼ˆCommonJS æ ¼å¼ï¼‰
- âœ… `dist/` ç›®å½•å­˜åœ¨ï¼ˆUMD æ ¼å¼ï¼‰

### webcomponent
- âœ… `dist/` ç›®å½•å­˜åœ¨
- âœ… `loader/` ç›®å½•å­˜åœ¨

## ğŸ“Š æ„å»ºæŠ¥å‘Š

æ„å»ºå®Œæˆåï¼Œè„šæœ¬ä¼šç”Ÿæˆè¯¦ç»†æŠ¥å‘Šï¼š

```
================================================================================
æ„å»ºç»“æœæ±‡æ€»
================================================================================

ä¼˜å…ˆçº§åŒ…:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… @ldesign/kit
   çŠ¶æ€: SUCCESS
   è€—æ—¶: 12.35s
   äº§ç‰©: 1/1

âœ… @ldesign/builder
   çŠ¶æ€: SUCCESS
   è€—æ—¶: 18.72s
   äº§ç‰©: 1/1

...

================================================================================
ç»Ÿè®¡ä¿¡æ¯
================================================================================
æ€»è®¡åŒ…æ•°: 24
âœ… æˆåŠŸ: 24
âŒ å¤±è´¥: 0

æ€»è€—æ—¶: 5m 32s

ğŸ‰ æ‰€æœ‰é¡¹ç›®æ„å»ºæˆåŠŸï¼
```

## ğŸ› ï¸ å•ç‹¬æ„å»ºæŸä¸ªåŒ…

å¦‚æœåªéœ€è¦æ„å»ºæŸä¸ªç‰¹å®šçš„åŒ…ï¼š

```bash
# è¿›å…¥åŒ…ç›®å½•
cd packages/api

# æ‰§è¡Œæ„å»º
pnpm build
```

## ğŸ”§ é…ç½®æ–‡ä»¶

ä¸åŒç±»å‹çš„åŒ…ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼š

### ä¼˜å…ˆçº§åŒ…ï¼ˆkit, builder, launcherï¼‰

é…ç½®æ–‡ä»¶ï¼š`tsup.config.ts`

```typescript
import { defineConfig } from 'tsup'

export default defineConfig({
  entry: ['src/index.ts'],
  format: ['esm', 'cjs'],
  dts: true,
  clean: true,
  // ...
})
```

### æ ‡å‡†åŒ… & Library é¡¹ç›®

é…ç½®æ–‡ä»¶ï¼š`.ldesign/builder.config.ts`

```typescript
import { defineConfig } from '@ldesign/builder'

export default defineConfig({
  dts: true,
  sourcemap: true,
  clean: true,
  umd: {
    enabled: true,
    minify: true,
    fileName: 'index.js'
  },
  // ...
})
```

è¯¦ç»†é…ç½®è¯·å‚è€ƒï¼š[Builder é…ç½®æ¨¡æ¿](packages/.ldesign-builder-config-template.md)

### webcomponent

é…ç½®æ–‡ä»¶ï¼š`stencil.config.ts`

```typescript
import { Config } from '@stencil/core'

export const config: Config = {
  namespace: 'ldesign-webcomponent',
  outputTargets: [
    // ...
  ]
}
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ„å»ºè„šæœ¬ README](scripts/README.md) - è¯¦ç»†çš„è„šæœ¬ä½¿ç”¨è¯´æ˜
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](scripts/QUICK_START.md) - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
- [Builder é…ç½®æ¨¡æ¿](packages/.ldesign-builder-config-template.md) - æ ‡å‡†é…ç½®æ¨¡æ¿
- [Builder è§„èŒƒåŒ–æŠ¥å‘Š](packages/BUILDER_STANDARDIZATION_REPORT.md) - æ‰“åŒ…æµç¨‹è§„èŒƒåŒ–è¯´æ˜

## â“ å¸¸è§é—®é¢˜

### tsx å‘½ä»¤æœªæ‰¾åˆ°ï¼Ÿ

å®‰è£… tsxï¼š

```bash
pnpm add -g tsx
# æˆ–åœ¨é¡¹ç›®ä¸­å®‰è£…
pnpm add -D tsx
```

### æŸä¸ªåŒ…æ„å»ºå¤±è´¥ï¼Ÿ

1. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
2. ä½¿ç”¨ `--verbose` æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š
   ```bash
   pnpm build:all:verbose
   ```
3. å•ç‹¬æ„å»ºè¯¥åŒ…ä»¥è·å–æ›´å¤šä¿¡æ¯ï¼š
   ```bash
   cd packages/åŒ…å
   pnpm build
   ```

### äº§ç‰©éªŒè¯å¤±è´¥ï¼Ÿ

æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼š
- æ ‡å‡†åŒ…ï¼š`.ldesign/builder.config.ts`
- ç¡®ä¿ `dts: true` å’Œ `umd.enabled: true`

### æ„å»ºå¤ªæ…¢ï¼Ÿ

- é¿å…é¢‘ç¹ä½¿ç”¨ `--clean` é€‰é¡¹
- ä½¿ç”¨å•ç‹¬æ„å»ºè€Œä¸æ˜¯å…¨é‡æ„å»º
- ç¡®ä¿ç³»ç»Ÿæœ‰è¶³å¤Ÿçš„èµ„æº

### å¦‚ä½•æ·»åŠ æ–°åŒ…ï¼Ÿ

1. åœ¨ `packages/` æˆ– `library/` åˆ›å»ºæ–°åŒ…ç›®å½•
2. æ·»åŠ  `package.json` å’Œæ„å»ºé…ç½®
3. å®šä¹‰ `build` è„šæœ¬
4. è¿è¡Œ `pnpm build:all` è‡ªåŠ¨æ£€æµ‹å¹¶æ„å»º

è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹æ–°åŒ…å¹¶åŠ å…¥æ„å»ºæµç¨‹ã€‚

## ğŸš¨ æ•…éšœæ’æŸ¥

### ä¾èµ–é—®é¢˜

```bash
# é‡æ–°å®‰è£…æ‰€æœ‰ä¾èµ–
pnpm install

# æ¸…ç†ä¾èµ–åé‡æ–°å®‰è£…
rm -rf node_modules
rm pnpm-lock.yaml
pnpm install
```

### ç¼“å­˜é—®é¢˜

```bash
# æ¸…ç†æ‰€æœ‰äº§ç‰©
pnpm build:all:clean

# æ‰‹åŠ¨æ¸…ç†ç‰¹å®šåŒ…
cd packages/åŒ…å
rimraf es lib dist
pnpm build
```

### ç±»å‹æ£€æŸ¥å¤±è´¥

```bash
# è¿è¡Œç±»å‹æ£€æŸ¥
cd packages/åŒ…å
pnpm type-check
```

## ğŸ’» å¼€å‘å·¥ä½œæµ

### æ—¥å¸¸å¼€å‘

```bash
# 1. ä¿®æ”¹ä»£ç 
# 2. æ„å»ºä¿®æ”¹çš„åŒ…
cd packages/modified-package
pnpm build

# 3. æˆ–æ„å»ºæ‰€æœ‰ä¾èµ–è¯¥åŒ…çš„é¡¹ç›®
pnpm build:all
```

### å‘å¸ƒå‰

```bash
# 1. æ¸…ç†åå®Œæ•´æ„å»º
pnpm build:all:clean

# 2. è¿è¡Œæµ‹è¯•
pnpm test

# 3. éªŒè¯äº§ç‰©
pnpm build:all:verbose
```

### CI/CD

```yaml
# .github/workflows/build.yml
- name: Build all packages
  run: pnpm build:all:clean --verbose
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å¹¶è¡Œæ„å»º

ç›®å‰è„šæœ¬æŒ‰é¡ºåºæ„å»ºæ‰€æœ‰åŒ…ã€‚æœªæ¥ç‰ˆæœ¬å¯èƒ½æ”¯æŒå¹¶è¡Œæ„å»ºéä¾èµ–åŒ…ã€‚

### å¢é‡æ„å»º

é¿å…ä½¿ç”¨ `--clean` é€‰é¡¹å¯ä»¥åˆ©ç”¨å¢é‡æ„å»ºåŠ å¿«é€Ÿåº¦ã€‚

### ç¼“å­˜

æ„å»ºå·¥å…·ï¼ˆtsupã€builderã€Stencilï¼‰éƒ½æ”¯æŒç¼“å­˜ã€‚ç¡®ä¿ä¸è¦é¢‘ç¹åˆ é™¤ç¼“å­˜ç›®å½•ã€‚

## ğŸ¯ æœ€ä½³å®è·µ

1. **ä¼˜å…ˆçº§åŒ…å¤±è´¥ç«‹å³ä¿®å¤** - å› ä¸ºå…¶ä»–åŒ…ä¾èµ–å®ƒä»¬
2. **ä½¿ç”¨ dry-run é¢„è§ˆ** - åœ¨å¤§è§„æ¨¡æ„å»ºå‰å…ˆæŸ¥çœ‹è®¡åˆ’
3. **å®šæœŸæ¸…ç†æ„å»º** - é¿å…ç¼“å­˜å¯¼è‡´çš„é—®é¢˜
4. **éªŒè¯äº§ç‰©å®Œæ•´æ€§** - ä½¿ç”¨ `--verbose` æ£€æŸ¥æ‰€æœ‰äº§ç‰©
5. **é…ç½®æ ‡å‡†åŒ–** - éµå¾ªé…ç½®æ¨¡æ¿ï¼Œä¿æŒä¸€è‡´æ€§

---

**ç»´æŠ¤è€…**: LDesign Team  
**æœ€åæ›´æ–°**: 2025-10-11  

æœ‰é—®é¢˜ï¼ŸæŸ¥çœ‹ [scripts/README.md](scripts/README.md) æˆ–æäº¤ Issueã€‚
