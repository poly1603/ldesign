<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™ºèƒ½è·¯ç”±è¿çº¿å±•ç¤º</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 32px;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .header p {
      font-size: 16px;
      opacity: 0.95;
    }
    
    .main-container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    
    .toolbar {
      background: linear-gradient(to right, #f5f7fa, #ffffff);
      padding: 16px 24px;
      border-bottom: 1px solid #e8ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }
    
    .toolbar-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.6);
    }
    
    .btn-secondary {
      background: white;
      color: #4a5568;
      border: 1px solid #e2e8f0;
    }
    
    .btn-secondary:hover {
      background: #f7fafc;
      border-color: #cbd5e0;
    }
    
    .btn-success {
      background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
      color: #1a5f3f;
    }
    
    .btn-warning {
      background: linear-gradient(135deg, #ffd89b 0%, #ffaa45 100%);
      color: #744210;
    }
    
    .switch-container {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 12px;
      background: #f7fafc;
      border-radius: 8px;
    }
    
    .switch {
      position: relative;
      width: 44px;
      height: 24px;
      background: #cbd5e0;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .switch.active {
      background: #667eea;
    }
    
    .switch-slider {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .switch.active .switch-slider {
      transform: translateX(20px);
    }
    
    .chart-container {
      position: relative;
      height: 700px;
      background: #fafbfc;
      background-image: 
        linear-gradient(#e8ecef 1px, transparent 1px),
        linear-gradient(90deg, #e8ecef 1px, transparent 1px);
      background-size: 20px 20px;
    }
    
    #flowchart {
      width: 100%;
      height: 100%;
    }
    
    .status-bar {
      background: #2d3748;
      color: white;
      padding: 12px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #48bb78;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .badge {
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      background: rgba(255,255,255,0.2);
    }
    
    .tooltip {
      position: absolute;
      background: #1a202c;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 13px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 1000;
    }
    
    .tooltip.show {
      opacity: 1;
    }
    
    .tooltip::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-style: solid;
      border-width: 4px 4px 0 4px;
      border-color: #1a202c transparent transparent transparent;
    }
    
    .feature-tags {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .tag {
      padding: 4px 10px;
      background: linear-gradient(135deg, #667eea20, #764ba220);
      border: 1px solid #667eea40;
      border-radius: 16px;
      font-size: 12px;
      color: #5a67d8;
      font-weight: 500;
    }

    /* åŠ¨ç”»æ•ˆæœ */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .main-container {
      animation: fadeIn 0.5s ease;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸš€ æ™ºèƒ½è·¯ç”±è¿çº¿ç³»ç»Ÿ</h1>
    <p>åŸºäº Draw.io å’Œ Lucidchart ç®—æ³•çš„æ™ºèƒ½è¿çº¿è·¯ç”±ï¼Œè‡ªåŠ¨é¿å…é‡å ï¼Œä¼˜åŒ–å¸ƒå±€ç¾è§‚æ€§</p>
  </div>
  
  <div class="main-container">
    <div class="toolbar">
      <div class="toolbar-group">
        <button class="btn btn-primary" onclick="loadApprovalFlow()">
          <span>ğŸ“‹</span> å®¡æ‰¹æµç¨‹
        </button>
        <button class="btn btn-primary" onclick="loadComplexFlow()">
          <span>ğŸ”„</span> å¤æ‚æµç¨‹
        </button>
        <button class="btn btn-primary" onclick="loadDiamondDemo()">
          <span>ğŸ’</span> è±å½¢èŠ‚ç‚¹
        </button>
        <button class="btn btn-primary" onclick="loadNetworkFlow()">
          <span>ğŸŒ</span> ç½‘ç»œæ‹“æ‰‘
        </button>
      </div>
      
      <div class="toolbar-group">
        <div class="switch-container">
          <span>æ™ºèƒ½è·¯ç”±</span>
          <div class="switch active" onclick="toggleSmartRouter(this)">
            <div class="switch-slider"></div>
          </div>
        </div>
        <button class="btn btn-secondary" onclick="exportSVG()">
          <span>ğŸ“¥</span> å¯¼å‡º
        </button>
        <button class="btn btn-warning" onclick="resetView()">
          <span>ğŸ”„</span> é‡ç½®
        </button>
      </div>
      
      <div class="feature-tags">
        <span class="tag">è‡ªåŠ¨é¿éšœ</span>
        <span class="tag">åœ†è§’ç¾åŒ–</span>
        <span class="tag">æ™ºèƒ½é”šç‚¹</span>
        <span class="tag">è·¯å¾„ä¼˜åŒ–</span>
      </div>
    </div>
    
    <div class="chart-container">
      <div id="flowchart"></div>
      <div class="tooltip" id="tooltip"></div>
    </div>
    
    <div class="status-bar">
      <div class="status-item">
        <span class="status-dot"></span>
        <span>å°±ç»ª</span>
        <span class="badge" id="nodeCount">0 èŠ‚ç‚¹</span>
        <span class="badge" id="edgeCount">0 è¿çº¿</span>
      </div>
      <div class="status-item">
        <span>æ¸²æŸ“å¼•æ“: SVG</span>
        <span>|</span>
        <span>è·¯ç”±ç®—æ³•: Smart Router v2.0</span>
      </div>
    </div>
  </div>
  
  <script src="../dist/flowchart.js"></script>
  <script>
    let flowChart;
    let smartRouterEnabled = true;
    
    // åˆå§‹åŒ–
    function init() {
      flowChart = new FlowChart.FlowChart({
        container: document.getElementById('flowchart'),
        enableZoom: true,
        enablePan: true,
        enableNodeDrag: true,
        autoLayout: false,
        primaryColor: '#667eea',
        zoom: {
          initialScale: 0.9,
          minScale: 0.3,
          maxScale: 2,
          centerOnInit: true
        }
      });
      
      // é»˜è®¤åŠ è½½å®¡æ‰¹æµç¨‹
      loadApprovalFlow();
    }
    
    // å®¡æ‰¹æµç¨‹
    function loadApprovalFlow() {
      flowChart.clear();
      
      // æ·»åŠ èŠ‚ç‚¹
      const nodes = [
        { id: 'start', type: 'start', label: 'æäº¤ç”³è¯·', position: { x: 400, y: 50 } },
        { id: 'review', type: 'approval', label: 'éƒ¨é—¨å®¡æ‰¹', position: { x: 400, y: 150 } },
        { id: 'check', type: 'condition', label: 'é‡‘é¢åˆ¤æ–­', position: { x: 400, y: 280 } },
        { id: 'finance1', type: 'process', label: 'è´¢åŠ¡åˆå®¡', position: { x: 200, y: 400 } },
        { id: 'finance2', type: 'process', label: 'è´¢åŠ¡å¤å®¡', position: { x: 600, y: 400 } },
        { id: 'gm', type: 'approval', label: 'æ€»ç»ç†å®¡æ‰¹', position: { x: 400, y: 520 } },
        { id: 'end', type: 'end', label: 'å®¡æ‰¹å®Œæˆ', position: { x: 400, y: 640 } },
        { id: 'reject', type: 'end', label: 'é©³å›', position: { x: 700, y: 280 } }
      ];
      
      nodes.forEach(node => {
        flowChart.addNode({ ...node, manualPosition: true });
      });
      
      // æ·»åŠ è¿çº¿
      const edges = [
        { source: 'start', target: 'review' },
        { source: 'review', target: 'check', label: 'é€šè¿‡' },
        { source: 'check', target: 'finance1', label: '< 10ä¸‡' },
        { source: 'check', target: 'finance2', label: '>= 10ä¸‡' },
        { source: 'check', target: 'reject', label: 'æ‹’ç»' },
        { source: 'finance1', target: 'gm' },
        { source: 'finance2', target: 'gm' },
        { source: 'gm', target: 'end', label: 'æ‰¹å‡†' },
        { source: 'review', target: 'reject', label: 'é©³å›' }
      ];
      
      edges.forEach((edge, index) => {
        flowChart.addEdge({
          id: `e${index + 1}`,
          ...edge,
          style: {
            type: 'polyline',
            strokeColor: '#667eea',
            strokeWidth: 2,
            radius: 12
          }
        });
      });
      
      flowChart.render();
      updateStatus();
    }
    
    // å¤æ‚æµç¨‹
    function loadComplexFlow() {
      flowChart.clear();
      
      // åˆ›å»ºç½‘æ ¼å¸ƒå±€çš„èŠ‚ç‚¹
      const positions = [
        { x: 200, y: 100 }, { x: 400, y: 100 }, { x: 600, y: 100 },
        { x: 200, y: 250 }, { x: 400, y: 250 }, { x: 600, y: 250 },
        { x: 200, y: 400 }, { x: 400, y: 400 }, { x: 600, y: 400 },
        { x: 400, y: 550 }
      ];
      
      const nodeTypes = ['start', 'process', 'approval', 'condition', 'process', 'condition', 'process', 'approval', 'process', 'end'];
      const labels = ['å¼€å§‹', 'æ•°æ®æ”¶é›†', 'åˆæ­¥å®¡æ ¸', 'æ¡ä»¶1', 'å¤„ç†A', 'æ¡ä»¶2', 'å¤„ç†B', 'æœ€ç»ˆå®¡æ ¸', 'æ‰§è¡Œ', 'å®Œæˆ'];
      
      positions.forEach((pos, i) => {
        if (i < nodeTypes.length) {
          flowChart.addNode({
            id: `n${i + 1}`,
            type: nodeTypes[i],
            label: labels[i],
            position: pos,
            manualPosition: true
          });
        }
      });
      
      // åˆ›å»ºå¤æ‚çš„è¿çº¿å…³ç³»
      const edges = [
        { source: 'n1', target: 'n2' },
        { source: 'n2', target: 'n3' },
        { source: 'n3', target: 'n4' },
        { source: 'n4', target: 'n5', label: 'æ˜¯' },
        { source: 'n4', target: 'n6', label: 'å¦' },
        { source: 'n5', target: 'n8' },
        { source: 'n6', target: 'n7', label: 'æ¡ä»¶A' },
        { source: 'n6', target: 'n9', label: 'æ¡ä»¶B' },
        { source: 'n7', target: 'n8' },
        { source: 'n8', target: 'n10' },
        { source: 'n9', target: 'n10' },
        // æ·»åŠ ä¸€äº›å›ç¯
        { source: 'n10', target: 'n2', label: 'é‡è¯•' },
        { source: 'n7', target: 'n4', label: 'è¿”å›' }
      ];
      
      edges.forEach((edge, index) => {
        flowChart.addEdge({
          id: `e${index + 1}`,
          ...edge,
          style: {
            type: 'polyline',
            strokeColor: index < 11 ? '#667eea' : '#f56565',
            strokeWidth: 2,
            radius: 10
          }
        });
      });
      
      flowChart.render();
      updateStatus();
    }
    
    // è±å½¢èŠ‚ç‚¹æ¼”ç¤º
    function loadDiamondDemo() {
      flowChart.clear();
      
      // ä¸­å¿ƒè±å½¢
      flowChart.addNode({
        id: 'center',
        type: 'condition',
        label: 'æ ¸å¿ƒåˆ¤æ–­',
        position: { x: 400, y: 300 },
        manualPosition: true
      });
      
      // å››å‘¨èŠ‚ç‚¹
      const surrounding = [
        { id: 'top', label: 'å¤„ç†A', pos: { x: 400, y: 150 } },
        { id: 'right', label: 'å¤„ç†B', pos: { x: 600, y: 300 } },
        { id: 'bottom', label: 'å¤„ç†C', pos: { x: 400, y: 450 } },
        { id: 'left', label: 'å¤„ç†D', pos: { x: 200, y: 300 } },
        { id: 'topLeft', label: 'å¼‚å¸¸1', pos: { x: 250, y: 150 } },
        { id: 'topRight', label: 'å¼‚å¸¸2', pos: { x: 550, y: 150 } },
        { id: 'bottomLeft', label: 'å›æ»š', pos: { x: 250, y: 450 } },
        { id: 'bottomRight', label: 'é‡è¯•', pos: { x: 550, y: 450 } }
      ];
      
      surrounding.forEach(node => {
        flowChart.addNode({
          id: node.id,
          type: node.id.includes('top') || node.id.includes('bottom') ? 'process' : 'approval',
          label: node.label,
          position: node.pos,
          manualPosition: true
        });
      });
      
      // ä»ä¸­å¿ƒè±å½¢å‡ºå‘çš„è¿çº¿
      const edges = [
        { source: 'center', target: 'top', label: 'A' },
        { source: 'center', target: 'right', label: 'B' },
        { source: 'center', target: 'bottom', label: 'C' },
        { source: 'center', target: 'left', label: 'D' },
        // äº¤å‰è¿çº¿
        { source: 'top', target: 'topLeft' },
        { source: 'top', target: 'topRight' },
        { source: 'bottom', target: 'bottomLeft' },
        { source: 'bottom', target: 'bottomRight' },
        // å›ç¯
        { source: 'topLeft', target: 'left' },
        { source: 'topRight', target: 'right' },
        { source: 'bottomLeft', target: 'left' },
        { source: 'bottomRight', target: 'right' },
        // è¿”å›ä¸­å¿ƒ
        { source: 'left', target: 'center', label: 'é‡æ–°åˆ¤æ–­' },
        { source: 'right', target: 'center', label: 'é‡æ–°è¯„ä¼°' }
      ];
      
      edges.forEach((edge, index) => {
        const color = index < 4 ? '#667eea' : 
                     index < 8 ? '#48bb78' : 
                     index < 12 ? '#ed8936' : '#e53e3e';
        
        flowChart.addEdge({
          id: `e${index + 1}`,
          ...edge,
          style: {
            type: 'polyline',
            strokeColor: color,
            strokeWidth: 2,
            radius: 15
          }
        });
      });
      
      flowChart.render();
      updateStatus();
    }
    
    // ç½‘ç»œæ‹“æ‰‘æµç¨‹
    function loadNetworkFlow() {
      flowChart.clear();
      
      // åˆ›å»ºç½‘ç»œæ‹“æ‰‘ç»“æ„
      const layers = [
        { y: 100, nodes: [{ id: 'gw', label: 'ç½‘å…³', x: 400, type: 'start' }] },
        { y: 200, nodes: [
          { id: 'lb1', label: 'è´Ÿè½½å‡è¡¡1', x: 300, type: 'process' },
          { id: 'lb2', label: 'è´Ÿè½½å‡è¡¡2', x: 500, type: 'process' }
        ]},
        { y: 320, nodes: [
          { id: 'app1', label: 'åº”ç”¨æœåŠ¡1', x: 200, type: 'approval' },
          { id: 'app2', label: 'åº”ç”¨æœåŠ¡2', x: 400, type: 'approval' },
          { id: 'app3', label: 'åº”ç”¨æœåŠ¡3', x: 600, type: 'approval' }
        ]},
        { y: 440, nodes: [
          { id: 'cache', label: 'ç¼“å­˜', x: 300, type: 'condition' },
          { id: 'queue', label: 'æ¶ˆæ¯é˜Ÿåˆ—', x: 500, type: 'condition' }
        ]},
        { y: 560, nodes: [
          { id: 'db1', label: 'ä¸»æ•°æ®åº“', x: 400, type: 'end' },
          { id: 'db2', label: 'ä»æ•°æ®åº“', x: 600, type: 'end' }
        ]}
      ];
      
      // æ·»åŠ èŠ‚ç‚¹
      layers.forEach(layer => {
        layer.nodes.forEach(node => {
          flowChart.addNode({
            ...node,
            position: { x: node.x, y: layer.y },
            manualPosition: true
          });
        });
      });
      
      // åˆ›å»ºè¿çº¿
      const edges = [
        // ç½‘å…³åˆ°è´Ÿè½½å‡è¡¡
        { source: 'gw', target: 'lb1' },
        { source: 'gw', target: 'lb2' },
        // è´Ÿè½½å‡è¡¡åˆ°åº”ç”¨
        { source: 'lb1', target: 'app1' },
        { source: 'lb1', target: 'app2' },
        { source: 'lb2', target: 'app2' },
        { source: 'lb2', target: 'app3' },
        // åº”ç”¨åˆ°ä¸­é—´ä»¶
        { source: 'app1', target: 'cache' },
        { source: 'app2', target: 'cache' },
        { source: 'app2', target: 'queue' },
        { source: 'app3', target: 'queue' },
        // ä¸­é—´ä»¶åˆ°æ•°æ®åº“
        { source: 'cache', target: 'db1' },
        { source: 'queue', target: 'db1' },
        { source: 'queue', target: 'db2' },
        // æ•°æ®åº“åŒæ­¥
        { source: 'db1', target: 'db2', label: 'åŒæ­¥' }
      ];
      
      edges.forEach((edge, index) => {
        flowChart.addEdge({
          id: `e${index + 1}`,
          ...edge,
          style: {
            type: 'polyline',
            strokeColor: '#667eea',
            strokeWidth: 2,
            radius: 8,
            strokeDasharray: edge.label === 'åŒæ­¥' ? '5 5' : undefined
          }
        });
      });
      
      flowChart.render();
      updateStatus();
    }
    
    // åˆ‡æ¢æ™ºèƒ½è·¯ç”±
    function toggleSmartRouter(element) {
      element.classList.toggle('active');
      smartRouterEnabled = !smartRouterEnabled;
      
      // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„åˆ‡æ¢é€»è¾‘
      console.log('æ™ºèƒ½è·¯ç”±:', smartRouterEnabled ? 'å¼€å¯' : 'å…³é—­');
      
      // é‡æ–°æ¸²æŸ“å½“å‰æµç¨‹å›¾
      if (flowChart) {
        flowChart.render();
      }
    }
    
    // å¯¼å‡ºSVG
    function exportSVG() {
      console.log('å¯¼å‡ºSVGåŠŸèƒ½å¾…å®ç°');
      showTooltip('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...', event);
    }
    
    // é‡ç½®è§†å›¾
    function resetView() {
      if (flowChart) {
        const renderer = flowChart.getRenderer();
        if (renderer && renderer.resetZoom) {
          renderer.resetZoom();
        }
        flowChart.render();
      }
    }
    
    // æ›´æ–°çŠ¶æ€æ 
    function updateStatus() {
      const nodes = flowChart.getNodes();
      const edges = flowChart.getEdges();
      document.getElementById('nodeCount').textContent = `${nodes.length} èŠ‚ç‚¹`;
      document.getElementById('edgeCount').textContent = `${edges.length} è¿çº¿`;
    }
    
    // æ˜¾ç¤ºå·¥å…·æç¤º
    function showTooltip(text, event) {
      const tooltip = document.getElementById('tooltip');
      tooltip.textContent = text;
      tooltip.style.left = event.pageX + 'px';
      tooltip.style.top = (event.pageY - 40) + 'px';
      tooltip.classList.add('show');
      
      setTimeout(() => {
        tooltip.classList.remove('show');
      }, 2000);
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>