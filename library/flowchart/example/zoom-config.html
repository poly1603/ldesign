<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµç¨‹å›¾ç¼©æ”¾é…ç½®ç¤ºä¾‹</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    
    .control-panel {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .control-group {
      display: inline-block;
      margin-right: 20px;
      margin-bottom: 10px;
    }
    
    .control-group label {
      display: inline-block;
      margin-right: 8px;
      font-weight: 500;
      color: #555;
    }
    
    .control-group input[type="number"] {
      width: 80px;
      padding: 5px 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .control-group button {
      padding: 6px 12px;
      background: #2196f3;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
    
    .control-group button:hover {
      background: #1976d2;
    }
    
    .control-group button:active {
      transform: translateY(1px);
    }
    
    .zoom-info {
      display: inline-block;
      padding: 6px 12px;
      background: #e3f2fd;
      color: #1976d2;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      margin-left: 20px;
    }
    
    #flowchart {
      width: 100%;
      height: 500px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .config-code {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
      color: #333;
      overflow-x: auto;
    }
    
    .config-code pre {
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” æµç¨‹å›¾ç¼©æ”¾é…ç½®ç¤ºä¾‹</h1>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
      <div class="control-group">
        <label>åˆå§‹ç¼©æ”¾:</label>
        <input type="number" id="initialScale" value="1.2" min="0.1" max="3" step="0.1">
      </div>
      
      <div class="control-group">
        <label>æœ€å°ç¼©æ”¾:</label>
        <input type="number" id="minScale" value="0.5" min="0.1" max="1" step="0.1">
      </div>
      
      <div class="control-group">
        <label>æœ€å¤§ç¼©æ”¾:</label>
        <input type="number" id="maxScale" value="2" min="1" max="5" step="0.5">
      </div>
      
      <div class="control-group">
        <label>ç¼©æ”¾æ­¥é•¿:</label>
        <input type="number" id="scaleStep" value="0.15" min="0.05" max="0.5" step="0.05">
      </div>
      
      <div class="control-group">
        <label>
          <input type="checkbox" id="autoFit"> è‡ªåŠ¨é€‚åº”
        </label>
      </div>
      
      <div class="control-group">
        <label>
          <input type="checkbox" id="centerOnInit" checked> åˆå§‹å±…ä¸­
        </label>
      </div>
      
      <div class="control-group">
        <label>åˆå§‹ä½ç½®:</label>
        <select id="initialPosition">
          <option value="center">å±…ä¸­</option>
          <option value="top-left">å·¦ä¸Š</option>
          <option value="top-center">ä¸Šä¸­</option>
          <option value="top-right">å³ä¸Š</option>
          <option value="middle-left">å·¦ä¸­</option>
          <option value="middle-right">å³ä¸­</option>
          <option value="bottom-left">å·¦ä¸‹</option>
          <option value="bottom-center">ä¸‹ä¸­</option>
          <option value="bottom-right">å³ä¸‹</option>
        </select>
      </div>
      
      <div class="control-group">
        <button onclick="createFlowChart()">é‡æ–°åˆ›å»º</button>
      </div>
      
      <div class="control-group">
        <button onclick="zoomIn()">æ”¾å¤§ +</button>
        <button onclick="zoomOut()">ç¼©å° -</button>
        <button onclick="resetZoom()">é‡ç½®</button>
        <button onclick="fitView()">é€‚åº”è§†å›¾</button>
      </div>
      
      <span class="zoom-info" id="zoomInfo">å½“å‰ç¼©æ”¾: 100%</span>
    </div>
    
    <!-- æµç¨‹å›¾å®¹å™¨ -->
    <div id="flowchart"></div>
    
    <!-- é…ç½®ä»£ç å±•ç¤º -->
    <div class="config-code">
      <strong>å½“å‰é…ç½®ä»£ç :</strong>
      <pre id="configCode"></pre>
    </div>
  </div>

  <script type="module">
    // è¿™é‡Œå‡è®¾å·²ç»æ„å»ºäº†åº“æ–‡ä»¶
    // import { FlowChart } from '../dist/flowchart.esm.js';
    
    let flowChart = null;
    
    // åˆ›å»ºæµç¨‹å›¾çš„å‡½æ•°ï¼ˆæ¨¡æ‹Ÿï¼‰
    window.createFlowChart = function() {
      // è·å–é…ç½®å€¼
      const initialScale = parseFloat(document.getElementById('initialScale').value);
      const minScale = parseFloat(document.getElementById('minScale').value);
      const maxScale = parseFloat(document.getElementById('maxScale').value);
      const scaleStep = parseFloat(document.getElementById('scaleStep').value);
      const autoFit = document.getElementById('autoFit').checked;
      const centerOnInit = document.getElementById('centerOnInit').checked;
      const initialPosition = document.getElementById('initialPosition').value;
      
      // æ„å»ºé…ç½®å¯¹è±¡
      const config = {
        container: '#flowchart',
        width: document.getElementById('flowchart').offsetWidth,
        height: 500,
        enableZoom: true,
        enablePan: true,
        enableNodeDrag: true,
        autoLayout: true,
        zoom: {
          initialScale: initialScale,
          minScale: minScale,
          maxScale: maxScale,
          scaleStep: scaleStep,
          autoFit: autoFit,
          fitPadding: 50,
          centerOnInit: centerOnInit,
          initialPosition: centerOnInit ? undefined : initialPosition
        },
        onZoomChange: (scale) => {
          document.getElementById('zoomInfo').textContent = `å½“å‰ç¼©æ”¾: ${Math.round(scale * 100)}%`;
        }
      };
      
      // æ›´æ–°é…ç½®ä»£ç æ˜¾ç¤º
      updateConfigCode(config);
      
      // é”€æ¯æ—§å®ä¾‹
      if (flowChart) {
        // flowChart.destroy();
      }
      
      // åˆ›å»ºæ–°å®ä¾‹ï¼ˆå®é™…ä½¿ç”¨æ—¶ï¼‰
      // flowChart = new FlowChart(config);
      
      // æ·»åŠ ç¤ºä¾‹èŠ‚ç‚¹å’Œè¾¹
      createSampleFlow();
      
      // æ˜¾ç¤ºæç¤º
      console.log('FlowChart created with config:', config);
      alert('æµç¨‹å›¾å·²åˆ›å»ºï¼è¯·æŸ¥çœ‹æ§åˆ¶å°å’Œé…ç½®ä»£ç ã€‚');
    };
    
    // åˆ›å»ºç¤ºä¾‹æµç¨‹
    function createSampleFlow() {
      if (!flowChart) return;
      
      // æ·»åŠ èŠ‚ç‚¹
      flowChart.addNode({
        id: 'start',
        type: 'start',
        label: 'å¼€å§‹',
        position: { x: 100, y: 100 }
      });
      
      flowChart.addNode({
        id: 'process1',
        type: 'process',
        label: 'æ•°æ®å¤„ç†',
        position: { x: 300, y: 100 }
      });
      
      flowChart.addNode({
        id: 'condition',
        type: 'condition',
        label: 'æ¡ä»¶åˆ¤æ–­',
        position: { x: 500, y: 100 }
      });
      
      flowChart.addNode({
        id: 'process2',
        type: 'process',
        label: 'å¤„ç†A',
        position: { x: 700, y: 50 }
      });
      
      flowChart.addNode({
        id: 'process3',
        type: 'process',
        label: 'å¤„ç†B',
        position: { x: 700, y: 150 }
      });
      
      flowChart.addNode({
        id: 'end',
        type: 'end',
        label: 'ç»“æŸ',
        position: { x: 900, y: 100 }
      });
      
      // æ·»åŠ è¾¹
      flowChart.addEdge({ id: 'e1', source: 'start', target: 'process1' });
      flowChart.addEdge({ id: 'e2', source: 'process1', target: 'condition' });
      flowChart.addEdge({ id: 'e3', source: 'condition', target: 'process2', label: 'æ˜¯' });
      flowChart.addEdge({ id: 'e4', source: 'condition', target: 'process3', label: 'å¦' });
      flowChart.addEdge({ id: 'e5', source: 'process2', target: 'end' });
      flowChart.addEdge({ id: 'e6', source: 'process3', target: 'end' });
      
      // æ¸²æŸ“
      flowChart.render();
    }
    
    // ç¼©æ”¾æ§åˆ¶å‡½æ•°
    window.zoomIn = function() {
      if (flowChart && flowChart.getRenderer) {
        const renderer = flowChart.getRenderer();
        renderer.zoomIn();
      }
      console.log('Zoom in');
    };
    
    window.zoomOut = function() {
      if (flowChart && flowChart.getRenderer) {
        const renderer = flowChart.getRenderer();
        renderer.zoomOut();
      }
      console.log('Zoom out');
    };
    
    window.resetZoom = function() {
      if (flowChart && flowChart.getRenderer) {
        const renderer = flowChart.getRenderer();
        renderer.resetZoom();
      }
      console.log('Reset zoom');
    };
    
    window.fitView = function() {
      if (flowChart && flowChart.getRenderer) {
        const renderer = flowChart.getRenderer();
        renderer.fitView();
      }
      console.log('Fit view');
    };
    
    // æ›´æ–°é…ç½®ä»£ç æ˜¾ç¤º
    function updateConfigCode(config) {
      const codeStr = `const flowChart = new FlowChart({
  container: '#flowchart',
  width: ${config.width},
  height: ${config.height},
  enableZoom: ${config.enableZoom},
  enablePan: ${config.enablePan},
  enableNodeDrag: ${config.enableNodeDrag},
  autoLayout: ${config.autoLayout},
  zoom: {
    initialScale: ${config.zoom.initialScale},    // åˆå§‹ç¼©æ”¾æ¯”ä¾‹
    minScale: ${config.zoom.minScale},            // æœ€å°ç¼©æ”¾æ¯”ä¾‹
    maxScale: ${config.zoom.maxScale},            // æœ€å¤§ç¼©æ”¾æ¯”ä¾‹  
    scaleStep: ${config.zoom.scaleStep},          // ç¼©æ”¾æ­¥é•¿
    autoFit: ${config.zoom.autoFit},              // è‡ªåŠ¨é€‚åº”è§†å›¾
    fitPadding: ${config.zoom.fitPadding},        // é€‚åº”æ—¶çš„å†…è¾¹è·
    centerOnInit: ${config.zoom.centerOnInit},    // åˆå§‹åŒ–æ—¶å±…ä¸­
    initialPosition: '${config.zoom.initialPosition || 'center'}'  // åˆå§‹ä½ç½®
  },
  onZoomChange: (scale) => {
    console.log('å½“å‰ç¼©æ”¾æ¯”ä¾‹:', scale);
  }
});

// ç¼©æ”¾æ§åˆ¶API
flowChart.getRenderer().setScale(1.5);           // è®¾ç½®ç¼©æ”¾æ¯”ä¾‹
flowChart.getRenderer().zoomIn();                // æ”¾å¤§
flowChart.getRenderer().zoomOut();               // ç¼©å°
flowChart.getRenderer().resetZoom();             // é‡ç½®ç¼©æ”¾
flowChart.getRenderer().fitView(50);             // é€‚åº”è§†å›¾
flowChart.getRenderer().getScale();              // è·å–å½“å‰ç¼©æ”¾æ¯”ä¾‹`;
      
      document.getElementById('configCode').textContent = codeStr;
    }
    
    // é¡µé¢åŠ è½½æ—¶åˆ›å»ºé»˜è®¤æµç¨‹å›¾
    window.addEventListener('DOMContentLoaded', () => {
      createFlowChart();
    });
  </script>
</body>
</html>