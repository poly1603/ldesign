<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>流程图缩放配置示例</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    
    .control-panel {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .control-group {
      display: inline-block;
      margin-right: 20px;
      margin-bottom: 10px;
    }
    
    .control-group label {
      display: inline-block;
      margin-right: 8px;
      font-weight: 500;
      color: #555;
    }
    
    .control-group input[type="number"] {
      width: 80px;
      padding: 5px 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .control-group button {
      padding: 6px 12px;
      background: #2196f3;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
    
    .control-group button:hover {
      background: #1976d2;
    }
    
    .control-group button:active {
      transform: translateY(1px);
    }
    
    .zoom-info {
      display: inline-block;
      padding: 6px 12px;
      background: #e3f2fd;
      color: #1976d2;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      margin-left: 20px;
    }
    
    #flowchart {
      width: 100%;
      height: 500px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .config-code {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
      color: #333;
      overflow-x: auto;
    }
    
    .config-code pre {
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🔍 流程图缩放配置示例</h1>
    
    <!-- 控制面板 -->
    <div class="control-panel">
      <div class="control-group">
        <label>初始缩放:</label>
        <input type="number" id="initialScale" value="1.2" min="0.1" max="3" step="0.1">
      </div>
      
      <div class="control-group">
        <label>最小缩放:</label>
        <input type="number" id="minScale" value="0.5" min="0.1" max="1" step="0.1">
      </div>
      
      <div class="control-group">
        <label>最大缩放:</label>
        <input type="number" id="maxScale" value="2" min="1" max="5" step="0.5">
      </div>
      
      <div class="control-group">
        <label>缩放步长:</label>
        <input type="number" id="scaleStep" value="0.15" min="0.05" max="0.5" step="0.05">
      </div>
      
      <div class="control-group">
        <label>
          <input type="checkbox" id="autoFit"> 自动适应
        </label>
      </div>
      
      <div class="control-group">
        <label>
          <input type="checkbox" id="centerOnInit" checked> 初始居中
        </label>
      </div>
      
      <div class="control-group">
        <label>初始位置:</label>
        <select id="initialPosition">
          <option value="center">居中</option>
          <option value="top-left">左上</option>
          <option value="top-center">上中</option>
          <option value="top-right">右上</option>
          <option value="middle-left">左中</option>
          <option value="middle-right">右中</option>
          <option value="bottom-left">左下</option>
          <option value="bottom-center">下中</option>
          <option value="bottom-right">右下</option>
        </select>
      </div>
      
      <div class="control-group">
        <button onclick="createFlowChart()">重新创建</button>
      </div>
      
      <div class="control-group">
        <button onclick="zoomIn()">放大 +</button>
        <button onclick="zoomOut()">缩小 -</button>
        <button onclick="resetZoom()">重置</button>
        <button onclick="fitView()">适应视图</button>
      </div>
      
      <span class="zoom-info" id="zoomInfo">当前缩放: 100%</span>
    </div>
    
    <!-- 流程图容器 -->
    <div id="flowchart"></div>
    
    <!-- 配置代码展示 -->
    <div class="config-code">
      <strong>当前配置代码:</strong>
      <pre id="configCode"></pre>
    </div>
  </div>

  <script type="module">
    // 这里假设已经构建了库文件
    // import { FlowChart } from '../dist/flowchart.esm.js';
    
    let flowChart = null;
    
    // 创建流程图的函数（模拟）
    window.createFlowChart = function() {
      // 获取配置值
      const initialScale = parseFloat(document.getElementById('initialScale').value);
      const minScale = parseFloat(document.getElementById('minScale').value);
      const maxScale = parseFloat(document.getElementById('maxScale').value);
      const scaleStep = parseFloat(document.getElementById('scaleStep').value);
      const autoFit = document.getElementById('autoFit').checked;
      const centerOnInit = document.getElementById('centerOnInit').checked;
      const initialPosition = document.getElementById('initialPosition').value;
      
      // 构建配置对象
      const config = {
        container: '#flowchart',
        width: document.getElementById('flowchart').offsetWidth,
        height: 500,
        enableZoom: true,
        enablePan: true,
        enableNodeDrag: true,
        autoLayout: true,
        zoom: {
          initialScale: initialScale,
          minScale: minScale,
          maxScale: maxScale,
          scaleStep: scaleStep,
          autoFit: autoFit,
          fitPadding: 50,
          centerOnInit: centerOnInit,
          initialPosition: centerOnInit ? undefined : initialPosition
        },
        onZoomChange: (scale) => {
          document.getElementById('zoomInfo').textContent = `当前缩放: ${Math.round(scale * 100)}%`;
        }
      };
      
      // 更新配置代码显示
      updateConfigCode(config);
      
      // 销毁旧实例
      if (flowChart) {
        // flowChart.destroy();
      }
      
      // 创建新实例（实际使用时）
      // flowChart = new FlowChart(config);
      
      // 添加示例节点和边
      createSampleFlow();
      
      // 显示提示
      console.log('FlowChart created with config:', config);
      alert('流程图已创建！请查看控制台和配置代码。');
    };
    
    // 创建示例流程
    function createSampleFlow() {
      if (!flowChart) return;
      
      // 添加节点
      flowChart.addNode({
        id: 'start',
        type: 'start',
        label: '开始',
        position: { x: 100, y: 100 }
      });
      
      flowChart.addNode({
        id: 'process1',
        type: 'process',
        label: '数据处理',
        position: { x: 300, y: 100 }
      });
      
      flowChart.addNode({
        id: 'condition',
        type: 'condition',
        label: '条件判断',
        position: { x: 500, y: 100 }
      });
      
      flowChart.addNode({
        id: 'process2',
        type: 'process',
        label: '处理A',
        position: { x: 700, y: 50 }
      });
      
      flowChart.addNode({
        id: 'process3',
        type: 'process',
        label: '处理B',
        position: { x: 700, y: 150 }
      });
      
      flowChart.addNode({
        id: 'end',
        type: 'end',
        label: '结束',
        position: { x: 900, y: 100 }
      });
      
      // 添加边
      flowChart.addEdge({ id: 'e1', source: 'start', target: 'process1' });
      flowChart.addEdge({ id: 'e2', source: 'process1', target: 'condition' });
      flowChart.addEdge({ id: 'e3', source: 'condition', target: 'process2', label: '是' });
      flowChart.addEdge({ id: 'e4', source: 'condition', target: 'process3', label: '否' });
      flowChart.addEdge({ id: 'e5', source: 'process2', target: 'end' });
      flowChart.addEdge({ id: 'e6', source: 'process3', target: 'end' });
      
      // 渲染
      flowChart.render();
    }
    
    // 缩放控制函数
    window.zoomIn = function() {
      if (flowChart && flowChart.getRenderer) {
        const renderer = flowChart.getRenderer();
        renderer.zoomIn();
      }
      console.log('Zoom in');
    };
    
    window.zoomOut = function() {
      if (flowChart && flowChart.getRenderer) {
        const renderer = flowChart.getRenderer();
        renderer.zoomOut();
      }
      console.log('Zoom out');
    };
    
    window.resetZoom = function() {
      if (flowChart && flowChart.getRenderer) {
        const renderer = flowChart.getRenderer();
        renderer.resetZoom();
      }
      console.log('Reset zoom');
    };
    
    window.fitView = function() {
      if (flowChart && flowChart.getRenderer) {
        const renderer = flowChart.getRenderer();
        renderer.fitView();
      }
      console.log('Fit view');
    };
    
    // 更新配置代码显示
    function updateConfigCode(config) {
      const codeStr = `const flowChart = new FlowChart({
  container: '#flowchart',
  width: ${config.width},
  height: ${config.height},
  enableZoom: ${config.enableZoom},
  enablePan: ${config.enablePan},
  enableNodeDrag: ${config.enableNodeDrag},
  autoLayout: ${config.autoLayout},
  zoom: {
    initialScale: ${config.zoom.initialScale},    // 初始缩放比例
    minScale: ${config.zoom.minScale},            // 最小缩放比例
    maxScale: ${config.zoom.maxScale},            // 最大缩放比例  
    scaleStep: ${config.zoom.scaleStep},          // 缩放步长
    autoFit: ${config.zoom.autoFit},              // 自动适应视图
    fitPadding: ${config.zoom.fitPadding},        // 适应时的内边距
    centerOnInit: ${config.zoom.centerOnInit},    // 初始化时居中
    initialPosition: '${config.zoom.initialPosition || 'center'}'  // 初始位置
  },
  onZoomChange: (scale) => {
    console.log('当前缩放比例:', scale);
  }
});

// 缩放控制API
flowChart.getRenderer().setScale(1.5);           // 设置缩放比例
flowChart.getRenderer().zoomIn();                // 放大
flowChart.getRenderer().zoomOut();               // 缩小
flowChart.getRenderer().resetZoom();             // 重置缩放
flowChart.getRenderer().fitView(50);             // 适应视图
flowChart.getRenderer().getScale();              // 获取当前缩放比例`;
      
      document.getElementById('configCode').textContent = codeStr;
    }
    
    // 页面加载时创建默认流程图
    window.addEventListener('DOMContentLoaded', () => {
      createFlowChart();
    });
  </script>
</body>
</html>