# 🚀 连线优化快速指南

## ✅ 优化完成！

连线系统已经全面优化，现在更符合流程审批图的特点。

## 📋 优化内容速览

### 1. 多条出线智能分布
- ✨ 同一节点的多条出线会自动左右分散
- 📊 不再重叠，每条线有自己的空间

### 2. 回路走外侧
- 🔄 "退回"、"驳回"等回路连线走更外侧
- 💜 使用紫色标识，不遮挡主流程

### 3. 连线间距增大
- 📏 最小间距 50px，更清晰
- 🎯 自动避让，减少重叠

### 4. 智能颜色
- 🟢 通过/同意 → 绿色
- 🔴 拒绝/不通过 → 红色
- 💜 退回/驳回 → 紫色
- 🟡 待审核 → 橙色

## 🎮 如何查看效果

### 方法1：快速查看（推荐）
服务器已经在后台启动，直接访问：
```
http://localhost:8000
```

### 方法2：手动启动
如果服务器未运行，执行：
```bash
cd example
npm run dev
```

然后访问 `http://localhost:8000`

## 👀 重点观察

在浏览器中打开后，重点查看：

### ✅ 检查点1：部门主管审批节点
- "同意"线应该从左侧出发（绿色）
- "拒绝"线应该从右侧出发（红色）
- "退回修改"线应该走外侧回路（紫色）

### ✅ 检查点2：金额判断节点
- "小额报销"从左侧出发
- "大额报销"从右侧出发
- 两条线清晰分离，不重叠

### ✅ 检查点3：整体效果
- 主流程从上到下流畅
- 回路线在外侧，不遮挡主流程
- 所有连线颜色正确
- 没有明显的线条重叠

## 🔍 测试场景

### 场景1：费用报销流程（当前demo）
```
提交申请
  ↓
部门主管审批
  ├─ 同意 → 金额判断
  │         ├─ 小额 → 财务审核 → 付款
  │         └─ 大额 → 总经理审批 → 财务审核 → 付款
  ├─ 拒绝 → 审批拒绝（结束）
  └─ 退回 → 提交申请（回路）
```

## 📊 优化前后对比

### 优化前
- ❌ 多条出线从同一点出发，重叠
- ❌ 回路线遮挡主流程
- ❌ 连线间距小，视觉混乱

### 优化后
- ✅ 多条出线智能分散
- ✅ 回路线走外侧
- ✅ 连线清晰，间距合理

## 🛠️ 技术细节

### 修改的文件
1. `src/renderer/ConnectionPointManager.ts` - 连接点管理
2. `src/renderer/OptimizedEdgeRouter.ts` - 路由算法
3. `src/renderer/EdgeRenderer.ts` - 渲染器

### 关键参数
```typescript
{
  minDistance: 50,        // 最小距离
  loopOffset: 120,        // 回路偏移
  edgeSpacing: 25,        // 连线间距
  verticalPriority: true  // 垂直优先
}
```

## 📝 反馈

如果发现任何问题，请检查：
1. 是否有连线重叠？→ 记录具体场景
2. 回路线是否走外侧？→ 检查起始和终止节点
3. 颜色是否正确？→ 检查连线标签文字

## 🔜 后续改进

如果需要进一步优化，可以考虑：
- 调整 `loopOffset` 参数（更大 = 回路走更外侧）
- 调整 `edgeSpacing` 参数（更大 = 连线间距更宽）
- 添加更多颜色规则（基于标签关键词）

## 📚 完整文档

详细的优化说明请查看：
- [CONNECTION_OPTIMIZATION_SUMMARY.md](./CONNECTION_OPTIMIZATION_SUMMARY.md)

---

**优化时间**: 2025-01-20  
**状态**: ✅ 已完成并测试  
**服务器地址**: http://localhost:8000


