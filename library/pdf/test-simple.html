<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF查看器测试</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      height: 100vh;
      overflow: hidden;
    }
    
    #app {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .header {
      background: #2c3e50;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    
    #pdf-container {
      flex: 1;
      overflow: hidden;
      background: #f5f5f5;
    }
    
    .controls {
      padding: 1rem;
      background: white;
      border-bottom: 1px solid #ddd;
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    
    .controls button {
      padding: 0.5rem 1rem;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .controls button:hover {
      background: #357abd;
    }
    
    .controls input[type="file"] {
      padding: 0.5rem;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="header">
      <h1>PDF 查看器 - 核心功能测试</h1>
    </div>
    
    <div class="controls">
      <input type="file" id="fileInput" accept=".pdf">
      <button id="loadSample">加载示例PDF</button>
      <span id="status">就绪</span>
    </div>
    
    <div id="pdf-container"></div>
  </div>

  <!-- 引入PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  
  <script type="module">
    // 设置 PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    
    // 导入我们的PDF查看器
    import { PDFViewer, SimpleToolbar } from './src/index.js';
    
    const container = document.getElementById('pdf-container');
    const fileInput = document.getElementById('fileInput');
    const loadSampleBtn = document.getElementById('loadSample');
    const statusEl = document.getElementById('status');
    
    let currentViewer = null;
    let currentToolbar = null;
    
    // 加载PDF
    function loadPDF(url) {
      // 清理旧的查看器
      if (currentViewer) {
        currentViewer.destroy();
        currentViewer = null;
      }
      if (currentToolbar) {
        currentToolbar.destroy();
        currentToolbar = null;
      }
      container.innerHTML = '';
      
      // 创建容器
      const viewerWrapper = document.createElement('div');
      viewerWrapper.style.height = '100%';
      viewerWrapper.style.display = 'flex';
      viewerWrapper.style.flexDirection = 'column';
      
      // 创建工具栏容器
      const toolbarContainer = document.createElement('div');
      viewerWrapper.appendChild(toolbarContainer);
      
      // 创建查看器容器
      const viewerContainer = document.createElement('div');
      viewerContainer.style.flex = '1';
      viewerContainer.style.overflow = 'hidden';
      viewerWrapper.appendChild(viewerContainer);
      
      container.appendChild(viewerWrapper);
      
      // 创建PDF查看器
      currentViewer = new PDFViewer({
        container: viewerContainer,
        pdfUrl: url,
        initialScale: 1.5,
        fitMode: 'width',
        enableSearch: true,
        enableDownload: true,
        enablePrint: true
      });
      
      // 创建工具栏
      currentToolbar = new SimpleToolbar({
        viewer: currentViewer,
        container: toolbarContainer,
        showSearch: true,
        showDownload: true,
        showPrint: true,
        showRotate: true,
        showZoom: true
      });
      
      // 监听事件
      currentViewer.on('document-loaded', (data) => {
        statusEl.textContent = `已加载 ${data.numPages} 页`;
        statusEl.style.color = 'green';
      });
      
      currentViewer.on('error', (error) => {
        statusEl.textContent = '加载失败';
        statusEl.style.color = 'red';
        console.error(error);
      });
      
      statusEl.textContent = '正在加载...';
      statusEl.style.color = '#4a90e2';
    }
    
    // 加载本地文件
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file && file.type === 'application/pdf') {
        const url = URL.createObjectURL(file);
        loadPDF(url);
      }
    });
    
    // 加载示例PDF
    loadSampleBtn.addEventListener('click', () => {
      const sampleUrl = 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf';
      loadPDF(sampleUrl);
    });
    
    // 页面加载完成后的提示
    console.log('PDF查看器已准备就绪');
    console.log('功能包括：翻页、缩放、搜索、下载、打印');
  </script>
</body>
</html>