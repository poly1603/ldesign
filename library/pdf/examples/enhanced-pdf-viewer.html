<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢å¼ºå‹PDFæŸ¥çœ‹å™¨ - å®Œæ•´æ³¨é‡ŠåŠŸèƒ½æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
            background: #f5f5f5;
        }

        #app {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* å¤´éƒ¨æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
            border-bottom: 1px solid #e0e0e0;
            padding: 12px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .controls-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: inline-block;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
        }

        .file-input-label:hover {
            background: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,123,255,0.3);
        }

        select, input[type="number"], input[type="text"] {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            transition: all 0.3s ease;
        }

        select:focus, input[type="number"]:focus, input[type="text"]:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        input[type="number"] {
            width: 80px;
        }

        button {
            padding: 8px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #218838;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(40,167,69,0.3);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .theme-selector button {
            background: #6c757d;
            padding: 6px 12px;
            font-size: 13px;
        }

        .theme-selector button.active {
            background: #007bff;
        }

        .theme-selector button:hover {
            background: #5a6268;
        }

        .theme-selector button.active:hover {
            background: #0056b3;
        }

        /* æŸ¥çœ‹å™¨å®¹å™¨ */
        #viewer-container {
            flex: 1;
            position: relative;
            background: white;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        }

        /* çŠ¶æ€æ˜¾ç¤º */
        .status-bar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .status-bar.show {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, 10px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        /* åŠŸèƒ½æç¤º */
        .feature-tips {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .feature-tips h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }

        .feature-tips ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .feature-tips li {
            padding: 5px 0;
            color: #666;
            font-size: 13px;
            display: flex;
            align-items: center;
        }

        .feature-tips li::before {
            content: 'âœ“';
            color: #28a745;
            margin-right: 8px;
            font-weight: bold;
        }

        .close-tips {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 20px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-tips:hover {
            color: #333;
            background: #f0f0f0;
            border-radius: 4px;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }

        .loading-spinner.show {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .controls-container {
                flex-wrap: wrap;
            }

            .control-group {
                flex: 1 1 auto;
                min-width: 200px;
            }

            .feature-tips {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <div class="controls-container">
                <div class="control-group">
                    <div class="file-input-wrapper">
                        <input type="file" id="fileInput" accept=".pdf">
                        <label for="fileInput" class="file-input-label">é€‰æ‹©PDFæ–‡ä»¶</label>
                    </div>
                    <span id="fileName" style="color: #666; font-size: 14px;"></span>
                </div>

                <div class="control-group">
                    <label>é¡µç :</label>
                    <input type="number" id="pageInput" min="1" value="1">
                    <span id="pageInfo" style="color: #666; font-size: 14px;">/ 0</span>
                    <button id="gotoPage">è·³è½¬</button>
                </div>

                <div class="control-group">
                    <label>ç¼©æ”¾:</label>
                    <select id="zoomSelect">
                        <option value="0.5">50%</option>
                        <option value="0.75">75%</option>
                        <option value="1" selected>100%</option>
                        <option value="1.25">125%</option>
                        <option value="1.5">150%</option>
                        <option value="2">200%</option>
                        <option value="page-width">é€‚åº”å®½åº¦</option>
                        <option value="page-height">é€‚åº”é«˜åº¦</option>
                    </select>
                </div>

                <div class="control-group theme-selector">
                    <label>ä¸»é¢˜:</label>
                    <button class="active" data-theme="light">æ˜äº®</button>
                    <button data-theme="modern">ç°ä»£</button>
                    <button data-theme="dark">æ·±è‰²</button>
                </div>

                <div class="control-group">
                    <button id="testAnnotations" style="background: #ff6b6b;">æµ‹è¯•æ³¨é‡ŠåŠŸèƒ½</button>
                </div>
            </div>
        </div>

        <!-- æŸ¥çœ‹å™¨å®¹å™¨ -->
        <div id="viewer-container">
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
            </div>
        </div>

        <!-- çŠ¶æ€æ  -->
        <div class="status-bar" id="statusBar"></div>

        <!-- åŠŸèƒ½æç¤º -->
        <div class="feature-tips" id="featureTips">
            <button class="close-tips" onclick="document.getElementById('featureTips').style.display='none'">Ã—</button>
            <h3>ğŸš€ å¢å¼ºåŠŸèƒ½</h3>
            <ul>
                <li>çŸ©å½¢ã€ç®­å¤´ã€è‡ªç”±ç»˜åˆ¶æ³¨é‡Š</li>
                <li>æ–‡æœ¬æ³¨é‡Šå’Œæ‰¹æ³¨</li>
                <li>æ’¤é”€/é‡åšæ“ä½œ</li>
                <li>å¤šç§é¢œè‰²å’Œçº¿å®½é€‰æ‹©</li>
                <li>æ©¡çš®æ“¦å’Œæ¸…é™¤åŠŸèƒ½</li>
                <li>ä¹¦ç­¾ç®¡ç†å’Œé¡µé¢è·³è½¬</li>
                <li>å…¨æ–‡æœç´¢å’Œé«˜äº®</li>
                <li>ä¾§è¾¹æ ç¼©ç•¥å›¾å¯¼èˆª</li>
                <li>æ‰“å°å’Œå¯¼å‡ºåŠŸèƒ½</li>
                <li>ä¸‰ç§ä¸»é¢˜åˆ‡æ¢</li>
            </ul>
        </div>
    </div>

    <!-- å¼•å…¥PDF.jsåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <!-- å¼•å…¥æ’ä»¶ -->
    <link rel="stylesheet" href="../dist/styles/light.css" id="theme-style">
    <script src="../dist/pdf-viewer.js"></script>

    <script>
        let viewer = null;
        let currentPDF = null;

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, duration = 3000) {
            const statusBar = document.getElementById('statusBar');
            statusBar.textContent = message;
            statusBar.classList.add('show');
            setTimeout(() => {
                statusBar.classList.remove('show');
            }, duration);
        }

        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        function showLoading(show = true) {
            const spinner = document.getElementById('loadingSpinner');
            spinner.classList.toggle('show', show);
        }

        // åˆå§‹åŒ–æŸ¥çœ‹å™¨
        async function initViewer(pdfUrl) {
            showLoading(true);
            
            try {
                const container = document.getElementById('viewer-container');
                
                // æ¸…ç†æ—§çš„æŸ¥çœ‹å™¨
                if (viewer) {
                    viewer.destroy();
                    container.innerHTML = '<div class="loading-spinner" id="loadingSpinner"><div class="spinner"></div></div>';
                }

                // åˆ›å»ºæ–°çš„æŸ¥çœ‹å™¨
                viewer = new PDFViewer.PDFViewer(container, {
                    theme: 'light',
                    enableToolbar: true,
                    enableSidebar: true,
                    enableSearch: true,
                    enableAnnotations: true,
                    enableBookmarks: true,
                    enablePrint: true,
                    sidebarWidth: 250,
                    defaultZoom: 'page-width'
                });

                // åŠ è½½PDF
                await viewer.loadPDF(pdfUrl);
                currentPDF = pdfUrl;

                // æ›´æ–°é¡µé¢ä¿¡æ¯
                updatePageInfo();
                
                showStatus('PDFåŠ è½½æˆåŠŸï¼æ‰€æœ‰å¢å¼ºåŠŸèƒ½å·²å¯ç”¨ã€‚');
                showLoading(false);
                
                // è®¾ç½®äº‹ä»¶ç›‘å¬
                setupEventListeners();
                
            } catch (error) {
                console.error('åŠ è½½PDFå¤±è´¥:', error);
                showStatus('åŠ è½½PDFå¤±è´¥: ' + error.message);
                showLoading(false);
            }
        }

        // æ›´æ–°é¡µé¢ä¿¡æ¯
        function updatePageInfo() {
            if (viewer) {
                const pageInfo = document.getElementById('pageInfo');
                const pageInput = document.getElementById('pageInput');
                pageInfo.textContent = `/ ${viewer.getTotalPages()}`;
                pageInput.max = viewer.getTotalPages();
                pageInput.value = viewer.getCurrentPage();
            }
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æ–‡ä»¶é€‰æ‹©
            document.getElementById('fileInput').addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (file && file.type === 'application/pdf') {
                    const fileUrl = URL.createObjectURL(file);
                    document.getElementById('fileName').textContent = file.name;
                    await initViewer(fileUrl);
                } else {
                    showStatus('è¯·é€‰æ‹©æœ‰æ•ˆçš„PDFæ–‡ä»¶');
                }
            });

            // é¡µé¢è·³è½¬
            document.getElementById('gotoPage').addEventListener('click', () => {
                const pageInput = document.getElementById('pageInput');
                const page = parseInt(pageInput.value);
                if (viewer && page > 0 && page <= viewer.getTotalPages()) {
                    viewer.goToPage(page);
                    updatePageInfo();
                    showStatus(`å·²è·³è½¬åˆ°ç¬¬ ${page} é¡µ`);
                }
            });

            // ç¼©æ”¾æ§åˆ¶
            document.getElementById('zoomSelect').addEventListener('change', (e) => {
                if (viewer) {
                    const value = e.target.value;
                    if (value === 'page-width' || value === 'page-height') {
                        viewer.setZoom(value);
                    } else {
                        viewer.setZoom(parseFloat(value));
                    }
                    showStatus(`ç¼©æ”¾è®¾ç½®ä¸º ${value === 'page-width' ? 'é€‚åº”å®½åº¦' : value === 'page-height' ? 'é€‚åº”é«˜åº¦' : (value * 100) + '%'}`);
                }
            });

            // ä¸»é¢˜åˆ‡æ¢
            document.querySelectorAll('.theme-selector button').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const theme = e.target.dataset.theme;
                    
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    document.querySelectorAll('.theme-selector button').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    // åˆ‡æ¢ä¸»é¢˜æ ·å¼
                    const themeStyle = document.getElementById('theme-style');
                    themeStyle.href = `../dist/styles/${theme}.css`;
                    
                    // æ›´æ–°æŸ¥çœ‹å™¨ä¸»é¢˜
                    if (viewer) {
                        viewer.setTheme(theme);
                    }
                    
                    showStatus(`å·²åˆ‡æ¢åˆ°${theme === 'light' ? 'æ˜äº®' : theme === 'modern' ? 'ç°ä»£' : 'æ·±è‰²'}ä¸»é¢˜`);
                });
            });

            // æµ‹è¯•æ³¨é‡ŠåŠŸèƒ½
            document.getElementById('testAnnotations').addEventListener('click', () => {
                if (viewer) {
                    testAnnotationFeatures();
                } else {
                    showStatus('è¯·å…ˆåŠ è½½PDFæ–‡ä»¶');
                }
            });

            // ç›‘å¬æŸ¥çœ‹å™¨äº‹ä»¶
            if (viewer) {
                viewer.on('pagechange', () => {
                    updatePageInfo();
                });

                viewer.on('annotationAdded', (annotation) => {
                    showStatus(`å·²æ·»åŠ ${annotation.type}æ³¨é‡Š`);
                });

                viewer.on('bookmarkAdded', (bookmark) => {
                    showStatus(`å·²æ·»åŠ ä¹¦ç­¾ï¼šç¬¬${bookmark.page}é¡µ`);
                });

                viewer.on('searchComplete', (results) => {
                    showStatus(`æ‰¾åˆ° ${results.length} ä¸ªåŒ¹é…é¡¹`);
                });
            }
        }

        // æµ‹è¯•æ³¨é‡ŠåŠŸèƒ½
        function testAnnotationFeatures() {
            if (!viewer) return;

            showStatus('æ­£åœ¨æ¼”ç¤ºæ³¨é‡ŠåŠŸèƒ½...');

            // è®¾ç½®æ³¨é‡Šå·¥å…·
            setTimeout(() => {
                viewer.setAnnotationTool('rectangle');
                viewer.setAnnotationColor('#FF0000');
                viewer.setAnnotationLineWidth(2);
                showStatus('å·²åˆ‡æ¢åˆ°çŸ©å½¢å·¥å…· - çº¢è‰²');
            }, 1000);

            setTimeout(() => {
                viewer.setAnnotationTool('arrow');
                viewer.setAnnotationColor('#00FF00');
                showStatus('å·²åˆ‡æ¢åˆ°ç®­å¤´å·¥å…· - ç»¿è‰²');
            }, 3000);

            setTimeout(() => {
                viewer.setAnnotationTool('pen');
                viewer.setAnnotationColor('#0000FF');
                viewer.setAnnotationLineWidth(3);
                showStatus('å·²åˆ‡æ¢åˆ°è‡ªç”±ç»˜åˆ¶å·¥å…· - è“è‰²');
            }, 5000);

            setTimeout(() => {
                viewer.setAnnotationTool('text');
                showStatus('å·²åˆ‡æ¢åˆ°æ–‡æœ¬æ³¨é‡Šå·¥å…·');
            }, 7000);

            setTimeout(() => {
                viewer.addBookmark();
                showStatus('å·²æ·»åŠ å½“å‰é¡µä¹¦ç­¾');
            }, 9000);

            setTimeout(() => {
                // æ¼”ç¤ºæ’¤é”€
                viewer.undo();
                showStatus('æ‰§è¡Œæ’¤é”€æ“ä½œ');
            }, 11000);

            setTimeout(() => {
                // æ¼”ç¤ºé‡åš
                viewer.redo();
                showStatus('æ‰§è¡Œé‡åšæ“ä½œ');
            }, 13000);

            setTimeout(() => {
                showStatus('æ³¨é‡ŠåŠŸèƒ½æ¼”ç¤ºå®Œæˆï¼ç°åœ¨æ‚¨å¯ä»¥æ‰‹åŠ¨å°è¯•å„ç§å·¥å…·ã€‚');
            }, 15000);
        }

        // åŠ è½½ç¤ºä¾‹PDF
        async function loadSamplePDF() {
            const sampleUrl = '../assets/sample.pdf';
            
            // æ£€æŸ¥ç¤ºä¾‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
            try {
                const response = await fetch(sampleUrl);
                if (response.ok) {
                    await initViewer(sampleUrl);
                    document.getElementById('fileName').textContent = 'sample.pdf';
                }
            } catch (error) {
                console.log('ç¤ºä¾‹PDFä¸å­˜åœ¨ï¼Œç­‰å¾…ç”¨æˆ·é€‰æ‹©æ–‡ä»¶');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // å°è¯•åŠ è½½ç¤ºä¾‹PDF
            loadSamplePDF();
            
            // 3ç§’åè‡ªåŠ¨éšè—åŠŸèƒ½æç¤º
            setTimeout(() => {
                const tips = document.getElementById('featureTips');
                if (tips) {
                    tips.style.transition = 'opacity 0.5s';
                    tips.style.opacity = '0';
                    setTimeout(() => {
                        tips.style.display = 'none';
                    }, 500);
                }
            }, 10000);
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            if (!viewer) return;

            // Ctrl/Cmd + Z: æ’¤é”€
            if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
                e.preventDefault();
                viewer.undo();
                showStatus('æ’¤é”€');
            }
            
            // Ctrl/Cmd + Shift + Z æˆ– Ctrl/Cmd + Y: é‡åš
            if (((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'z') || 
                ((e.ctrlKey || e.metaKey) && e.key === 'y')) {
                e.preventDefault();
                viewer.redo();
                showStatus('é‡åš');
            }

            // Ctrl/Cmd + F: æœç´¢
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                viewer.toggleSearch();
                showStatus('æ‰“å¼€æœç´¢');
            }

            // Ctrl/Cmd + B: æ·»åŠ ä¹¦ç­¾
            if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                e.preventDefault();
                viewer.addBookmark();
                showStatus('æ·»åŠ ä¹¦ç­¾');
            }

            // Ctrl/Cmd + P: æ‰“å°
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                viewer.print();
                showStatus('æ‰“å¼€æ‰“å°å¯¹è¯æ¡†');
            }

            // PageUp/PageDown: ç¿»é¡µ
            if (e.key === 'PageUp') {
                e.preventDefault();
                viewer.previousPage();
                updatePageInfo();
            } else if (e.key === 'PageDown') {
                e.preventDefault();
                viewer.nextPage();
                updatePageInfo();
            }

            // æ•°å­—é”® 1-5: å¿«é€Ÿåˆ‡æ¢æ³¨é‡Šå·¥å…·
            if (e.key >= '1' && e.key <= '5' && !e.ctrlKey && !e.metaKey && !e.altKey) {
                const tools = ['rectangle', 'arrow', 'pen', 'text', 'eraser'];
                const toolIndex = parseInt(e.key) - 1;
                if (toolIndex < tools.length) {
                    viewer.setAnnotationTool(tools[toolIndex]);
                    showStatus(`åˆ‡æ¢åˆ°${['çŸ©å½¢', 'ç®­å¤´', 'ç”»ç¬”', 'æ–‡æœ¬', 'æ©¡çš®æ“¦'][toolIndex]}å·¥å…·`);
                }
            }
        });
    </script>
</body>
</html>