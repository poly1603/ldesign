<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Excel Renderer Test - 样式预览测试</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    
    h1 {
      color: #333;
      margin-bottom: 20px;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 10px;
    }
    
    .controls {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    input[type="file"] {
      padding: 10px;
      border: 2px dashed #4CAF50;
      border-radius: 5px;
      background: #f9f9f9;
      cursor: pointer;
      flex: 1;
      min-width: 200px;
    }
    
    input[type="file"]:hover {
      background: #e8f5e9;
    }
    
    button {
      padding: 10px 20px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
    
    button:hover {
      background: #45a049;
    }
    
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .viewer-container {
      width: 100%;
      height: 600px;
      border: 1px solid #ddd;
      border-radius: 5px;
      overflow: hidden;
      position: relative;
    }
    
    #status {
      margin-top: 10px;
      padding: 10px;
      border-radius: 5px;
      font-size: 14px;
    }
    
    .status-info {
      background: #e3f2fd;
      color: #1976d2;
    }
    
    .status-success {
      background: #e8f5e9;
      color: #388e3c;
    }
    
    .status-error {
      background: #ffebee;
      color: #c62828;
    }
    
    .test-info {
      margin-top: 20px;
      padding: 15px;
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      border-radius: 4px;
    }
    
    .test-info h3 {
      margin-top: 0;
      color: #e65100;
    }
    
    .test-info ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    
    .test-info li {
      margin: 5px 0;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🎯 Excel 文件预览测试 - 样式完整展示</h1>
    
    <div class="controls">
      <input type="file" id="fileInput" accept=".xlsx,.xls" />
      <button id="loadBtn">加载文件</button>
      <button id="createTestBtn">创建测试Excel</button>
    </div>
    
    <div id="status"></div>
    
    <div id="viewer-container" class="viewer-container"></div>
    
    <div class="test-info">
      <h3>📋 测试说明</h3>
      <ul>
        <li><strong>样式支持：</strong>字体（粗体、斜体、下划线、删除线）、颜色、背景色</li>
        <li><strong>格式支持：</strong>数字格式、日期格式、货币格式、百分比格式</li>
        <li><strong>单元格特性：</strong>合并单元格、行高列宽、边框样式</li>
        <li><strong>高级功能：</strong>公式计算、超链接、富文本、冻结窗格</li>
        <li><strong>对齐方式：</strong>水平对齐（左、中、右）、垂直对齐、文字旋转、缩进</li>
      </ul>
    </div>
  </div>
  
  <script type="module">
    import { ExcelViewer } from './dist/index.esm.js';
    
    let viewer = null;
    
    function updateStatus(message, type = 'info') {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = `status-${type}`;
    }
    
    async function loadFile(file) {
      const container = document.getElementById('viewer-container');
      
      // Clear previous viewer
      if (viewer) {
        viewer.destroy();
        viewer = null;
      }
      container.innerHTML = '';
      
      updateStatus('正在加载文件...', 'info');
      
      try {
        viewer = new ExcelViewer({
          excel: {
            showGridLines: true,
            showFormulaBar: true,
            enableEditing: false
          },
          onLoad: () => {
            updateStatus(`文件加载成功: ${file.name}`, 'success');
          },
          onError: (error) => {
            updateStatus(`加载失败: ${error.message}`, 'error');
            console.error('Error:', error);
          }
        });
        
        const arrayBuffer = await file.arrayBuffer();
        await viewer.render(container, arrayBuffer);
      } catch (error) {
        updateStatus(`渲染失败: ${error.message}`, 'error');
        console.error('Render error:', error);
      }
    }
    
    // File input handler
    document.getElementById('loadBtn').addEventListener('click', () => {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];
      
      if (!file) {
        updateStatus('请先选择一个Excel文件', 'error');
        return;
      }
      
      loadFile(file);
    });
    
    // Auto-load on file selection
    document.getElementById('fileInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        loadFile(file);
      }
    });
    
    // Create test Excel file
    document.getElementById('createTestBtn').addEventListener('click', async () => {
      updateStatus('正在创建测试文件...', 'info');
      
      try {
        // Import ExcelJS for creating test file
        const ExcelJS = (await import('exceljs')).default;
        
        const workbook = new ExcelJS.Workbook();
        const sheet = workbook.addWorksheet('样式测试');
        
        // Set column widths
        sheet.columns = [
          { width: 15 },
          { width: 20 },
          { width: 15 },
          { width: 25 },
          { width: 15 }
        ];
        
        // Title with merged cells
        sheet.mergeCells('A1:E1');
        const titleCell = sheet.getCell('A1');
        titleCell.value = 'Excel 样式展示测试';
        titleCell.font = { name: 'Arial', size: 16, bold: true, color: { argb: 'FFFFFFFF' } };
        titleCell.fill = {
          type: 'pattern',
          pattern: 'solid',
          fgColor: { argb: 'FF4472C4' }
        };
        titleCell.alignment = { horizontal: 'center', vertical: 'middle' };
        sheet.getRow(1).height = 30;
        
        // Headers
        const headers = ['类别', '示例内容', '数值', '格式化', '备注'];
        const headerRow = sheet.getRow(3);
        headers.forEach((header, index) => {
          const cell = headerRow.getCell(index + 1);
          cell.value = header;
          cell.font = { bold: true, color: { argb: 'FF000000' } };
          cell.fill = {
            type: 'pattern',
            pattern: 'solid',
            fgColor: { argb: 'FFE7E6E6' }
          };
          cell.border = {
            top: { style: 'thin' },
            left: { style: 'thin' },
            bottom: { style: 'medium' },
            right: { style: 'thin' }
          };
        });
        headerRow.height = 25;
        
        // Font styles
        sheet.getCell('A4').value = '字体样式';
        sheet.getCell('B4').value = '粗体文本';
        sheet.getCell('B4').font = { bold: true };
        
        sheet.getCell('B5').value = '斜体文本';
        sheet.getCell('B5').font = { italic: true };
        
        sheet.getCell('B6').value = '下划线文本';
        sheet.getCell('B6').font = { underline: true };
        
        sheet.getCell('B7').value = '删除线文本';
        sheet.getCell('B7').font = { strike: true };
        
        // Colors
        sheet.getCell('A9').value = '颜色';
        sheet.getCell('B9').value = '红色文字';
        sheet.getCell('B9').font = { color: { argb: 'FFFF0000' } };
        
        sheet.getCell('B10').value = '蓝色背景';
        sheet.getCell('B10').fill = {
          type: 'pattern',
          pattern: 'solid',
          fgColor: { argb: 'FF4472C4' }
        };
        sheet.getCell('B10').font = { color: { argb: 'FFFFFFFF' } };
        
        // Numbers
        sheet.getCell('A12').value = '数字格式';
        sheet.getCell('C12').value = 1234.56;
        sheet.getCell('D12').value = 1234.56;
        sheet.getCell('D12').numFmt = '#,##0.00';
        
        sheet.getCell('C13').value = 0.125;
        sheet.getCell('D13').value = 0.125;
        sheet.getCell('D13').numFmt = '0.00%';
        
        sheet.getCell('C14').value = 1234.56;
        sheet.getCell('D14').value = 1234.56;
        sheet.getCell('D14').numFmt = '"¥"#,##0.00';
        
        // Dates
        const now = new Date();
        sheet.getCell('A16').value = '日期格式';
        sheet.getCell('C16').value = now;
        sheet.getCell('D16').value = now;
        sheet.getCell('D16').numFmt = 'yyyy-mm-dd';
        
        // Formula
        sheet.getCell('A18').value = '公式';
        sheet.getCell('C18').value = 10;
        sheet.getCell('C19').value = 20;
        sheet.getCell('C20').value = { formula: 'C18+C19', result: 30 };
        sheet.getCell('D20').value = '=C18+C19';
        
        // Alignment
        sheet.getCell('A22').value = '对齐方式';
        sheet.mergeCells('B22:D22');
        const alignCell = sheet.getCell('B22');
        alignCell.value = '居中对齐';
        alignCell.alignment = { horizontal: 'center', vertical: 'middle' };
        alignCell.fill = {
          type: 'pattern',
          pattern: 'solid',
          fgColor: { argb: 'FFFFF2CC' }
        };
        
        // Border styles
        const borderRange = 'B24:D26';
        sheet.getCell('A24').value = '边框样式';
        sheet.getCell('B24').value = '细边框';
        sheet.getCell('B24').border = {
          top: { style: 'thin' },
          left: { style: 'thin' },
          bottom: { style: 'thin' },
          right: { style: 'thin' }
        };
        
        sheet.getCell('C24').value = '粗边框';
        sheet.getCell('C24').border = {
          top: { style: 'thick', color: { argb: 'FF0000FF' } },
          left: { style: 'thick', color: { argb: 'FF0000FF' } },
          bottom: { style: 'thick', color: { argb: 'FF0000FF' } },
          right: { style: 'thick', color: { argb: 'FF0000FF' } }
        };
        
        sheet.getCell('D24').value = '双线边框';
        sheet.getCell('D24').border = {
          top: { style: 'double' },
          left: { style: 'double' },
          bottom: { style: 'double' },
          right: { style: 'double' }
        };
        
        // Generate file
        const buffer = await workbook.xlsx.writeBuffer();
        const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
        
        // Create virtual file for loading
        const file = new File([blob], 'test-styles.xlsx', { type: blob.type });
        await loadFile(file);
        
        // Also offer download
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'test-styles.xlsx';
        a.click();
        URL.revokeObjectURL(url);
        
        updateStatus('测试文件已创建并加载', 'success');
      } catch (error) {
        updateStatus(`创建测试文件失败: ${error.message}`, 'error');
        console.error('Create test file error:', error);
      }
    });
    
    // Initial status
    updateStatus('请选择Excel文件或创建测试文件', 'info');
  </script>
</body>
</html>