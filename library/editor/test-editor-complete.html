<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®Œæ•´ç¼–è¾‘å™¨æµ‹è¯• - åŒ…å«æ ‡é¢˜åŠŸèƒ½</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 36px;
      margin: 0 0 10px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    
    .main-content {
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    }
    
    .editor-wrapper {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 30px;
    }
    
    .editor-container {
      min-height: 500px;
      background: white;
    }
    
    .test-controls {
      background: #f9fafb;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .test-controls h3 {
      margin: 0 0 15px 0;
      color: #1f2937;
    }
    
    .test-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .test-button {
      padding: 10px 20px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .test-button:hover {
      background: #2563eb;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    
    .test-button.heading {
      background: #10b981;
    }
    
    .test-button.heading:hover {
      background: #059669;
    }
    
    .status-message {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      display: none;
    }
    
    .status-message.success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #6ee7b7;
      display: block;
    }
    
    .status-message.error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fca5a5;
      display: block;
    }
    
    .info-box {
      background: #eff6ff;
      border: 1px solid #93c5fd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .info-box h4 {
      margin: 0 0 10px 0;
      color: #1e40af;
    }
    
    .info-box ul {
      margin: 0;
      padding-left: 20px;
    }
    
    .info-box li {
      margin-bottom: 5px;
      color: #3730a3;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>å®Œæ•´ç¼–è¾‘å™¨æµ‹è¯•</h1>
      <p>åŒ…å«æ‰€æœ‰æ’ä»¶åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯æ ‡é¢˜å’Œæ®µè½åŠŸèƒ½</p>
    </div>
    
    <div class="main-content">
      <div class="info-box">
        <h4>ğŸ¯ æµ‹è¯•è¯´æ˜</h4>
        <ul>
          <li>ç¼–è¾‘å™¨å·²åŠ è½½æ‰€æœ‰é»˜è®¤æ’ä»¶</li>
          <li>æ ‡é¢˜æ’ä»¶å·²æ­£ç¡®æ³¨å†Œ</li>
          <li>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æµ‹è¯•å„ç§åŠŸèƒ½</li>
          <li>å·¥å…·æ ä¼šæ˜¾ç¤ºå½“å‰æ ‡é¢˜çº§åˆ«</li>
        </ul>
      </div>
      
      <div class="test-controls">
        <h3>å¿«é€Ÿæµ‹è¯•æŒ‰é’®</h3>
        <div class="test-buttons">
          <button class="test-button heading" data-command="setParagraph">è®¾ä¸ºæ®µè½</button>
          <button class="test-button heading" data-command="setHeading1">H1 æ ‡é¢˜</button>
          <button class="test-button heading" data-command="setHeading2">H2 æ ‡é¢˜</button>
          <button class="test-button heading" data-command="setHeading3">H3 æ ‡é¢˜</button>
          <button class="test-button heading" data-command="setHeading4">H4 æ ‡é¢˜</button>
          <button class="test-button heading" data-command="setHeading5">H5 æ ‡é¢˜</button>
          <button class="test-button heading" data-command="setHeading6">H6 æ ‡é¢˜</button>
          <button class="test-button" data-command="bold">åŠ ç²—</button>
          <button class="test-button" data-command="italic">æ–œä½“</button>
          <button class="test-button" data-command="underline">ä¸‹åˆ’çº¿</button>
        </div>
      </div>
      
      <div class="editor-wrapper">
        <div class="editor-container" id="editor"></div>
      </div>
      
      <div id="status" class="status-message"></div>
    </div>
  </div>

  <script type="module">
    // æ­£ç¡®å¯¼å…¥ Editor ç±»å’Œæ‰€æœ‰æ’ä»¶
    import { Editor } from './src/index.ts'
    
    // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
    function showStatus(message, type = 'success') {
      const statusEl = document.getElementById('status')
      statusEl.className = `status-message ${type}`
      statusEl.textContent = message
      setTimeout(() => {
        statusEl.className = 'status-message'
      }, 3000)
    }
    
    try {
      // åˆå§‹åŒ–ç¼–è¾‘å™¨ - ä¸æŒ‡å®šæ’ä»¶åˆ—è¡¨ï¼Œå°†è‡ªåŠ¨åŠ è½½æ‰€æœ‰é»˜è®¤æ’ä»¶
      const editor = new Editor({
        element: document.getElementById('editor'),
        placeholder: 'å¼€å§‹è¾“å…¥å†…å®¹ï¼Œæˆ–ä½¿ç”¨ä¸Šæ–¹æŒ‰é’®æµ‹è¯•åŠŸèƒ½...',
        content: `
          <h1>æ ‡é¢˜åŠŸèƒ½æµ‹è¯•</h1>
          <p>è¿™æ˜¯ä¸€ä¸ªæ®µè½ã€‚å°†å…‰æ ‡æ”¾åœ¨ä¸åŒçš„ä½ç½®ï¼Œå·¥å…·æ ä¼šæ˜¾ç¤ºå½“å‰çš„æ ‡é¢˜çº§åˆ«ã€‚</p>
          <h2>äºŒçº§æ ‡é¢˜</h2>
          <p>é€‰ä¸­æ–‡æœ¬åï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·æ æˆ–å¿«æ·é”®è®¾ç½®æ ‡é¢˜çº§åˆ«ã€‚</p>
          <h3>ä¸‰çº§æ ‡é¢˜</h3>
          <p>ç¼–è¾‘å™¨æ”¯æŒ H1 åˆ° H6 å…­ä¸ªçº§åˆ«çš„æ ‡é¢˜ã€‚</p>
          <blockquote>
            <p>æç¤ºï¼šå·¥å…·æ çš„æ ‡é¢˜æŒ‰é’®ä¼šåŠ¨æ€æ˜¾ç¤ºå½“å‰é€‰ä¸­æ–‡æœ¬çš„æ ‡é¢˜çº§åˆ«ã€‚</p>
          </blockquote>
        `,
        autofocus: true
      })
      
      // å°†ç¼–è¾‘å™¨å®ä¾‹æš´éœ²åˆ°å…¨å±€ï¼Œæ–¹ä¾¿è°ƒè¯•
      window.editor = editor
      
      // æ£€æŸ¥æ’ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½
      console.log('âœ… ç¼–è¾‘å™¨åˆå§‹åŒ–æˆåŠŸ')
      console.log('ğŸ“¦ å·²åŠ è½½æ’ä»¶:', editor.plugins.getPlugins().map(p => p.name))
      console.log('âŒ¨ï¸ å·²æ³¨å†Œå‘½ä»¤:', editor.commands.getCommands())
      
      // éªŒè¯æ ‡é¢˜å‘½ä»¤æ˜¯å¦å­˜åœ¨
      const headingCommands = ['setParagraph', 'setHeading1', 'setHeading2', 'setHeading3', 'setHeading4', 'setHeading5', 'setHeading6']
      const missingCommands = headingCommands.filter(cmd => !editor.commands.hasCommand(cmd))
      
      if (missingCommands.length === 0) {
        console.log('âœ… æ‰€æœ‰æ ‡é¢˜å‘½ä»¤å·²æˆåŠŸæ³¨å†Œ')
        showStatus('ç¼–è¾‘å™¨åˆå§‹åŒ–æˆåŠŸï¼Œæ‰€æœ‰åŠŸèƒ½å°±ç»ªï¼', 'success')
      } else {
        console.warn('âš ï¸ ç¼ºå°‘ä»¥ä¸‹æ ‡é¢˜å‘½ä»¤:', missingCommands)
        showStatus('è­¦å‘Šï¼šéƒ¨åˆ†æ ‡é¢˜å‘½ä»¤æœªæ³¨å†Œ', 'error')
      }
      
      // ç»‘å®šæµ‹è¯•æŒ‰é’®
      document.querySelectorAll('.test-button').forEach(button => {
        button.addEventListener('click', () => {
          const command = button.dataset.command
          if (command) {
            try {
              // å…ˆç¡®ä¿ç¼–è¾‘å™¨è·å¾—ç„¦ç‚¹
              editor.focus()
              
              // æ‰§è¡Œå‘½ä»¤
              const result = editor.commands.execute(command)
              
              if (result) {
                console.log(`âœ… æ‰§è¡Œå‘½ä»¤ '${command}' æˆåŠŸ`)
                showStatus(`å‘½ä»¤ '${command}' æ‰§è¡ŒæˆåŠŸ`, 'success')
              } else {
                console.warn(`âš ï¸ æ‰§è¡Œå‘½ä»¤ '${command}' å¤±è´¥`)
                showStatus(`å‘½ä»¤ '${command}' æ‰§è¡Œå¤±è´¥`, 'error')
              }
            } catch (error) {
              console.error(`âŒ æ‰§è¡Œå‘½ä»¤ '${command}' å‡ºé”™:`, error)
              showStatus(`é”™è¯¯: ${error.message}`, 'error')
            }
          }
        })
      })
      
      // ç›‘å¬é€‰åŒºå˜åŒ–ï¼Œæ˜¾ç¤ºå½“å‰æ ‡é¢˜çº§åˆ«
      editor.on('selectionUpdate', (selection) => {
        const sel = window.getSelection()
        if (sel && sel.rangeCount > 0) {
          const node = sel.anchorNode
          if (node) {
            const block = node.nodeType === Node.TEXT_NODE 
              ? node.parentElement 
              : node
            
            if (block) {
              const tagName = block.tagName?.toLowerCase()
              let levelText = 'æ®µè½'
              
              if (tagName && tagName.startsWith('h')) {
                const level = tagName.charAt(1)
                levelText = `æ ‡é¢˜ ${level}`
              }
              
              // æ›´æ–°å·¥å…·æ æ ‡é¢˜æŒ‰é’®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
              const headingButton = document.querySelector('.ldesign-toolbar button[data-command="heading"]')
              if (headingButton) {
                const buttonText = headingButton.querySelector('.button-text')
                if (buttonText) {
                  buttonText.textContent = levelText
                }
              }
            }
          }
        }
      })
      
    } catch (error) {
      console.error('âŒ ç¼–è¾‘å™¨åˆå§‹åŒ–å¤±è´¥:', error)
      showStatus(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error')
    }
  </script>
</body>
</html>