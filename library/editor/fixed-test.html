<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LDesign Editor - 修复版测试</title>
  <link rel="stylesheet" href="./dist/editor.css">
  <style>
    /* 页面样式 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 36px;
      margin-bottom: 10px;
    }
    
    .header p {
      font-size: 18px;
      opacity: 0.9;
    }
    
    /* 编辑器容器样式 - 确保高度正确 */
    .editor-wrapper {
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 30px;
      min-height: 500px;
      display: flex;
      flex-direction: column;
    }
    
    /* 重要：设置编辑器容器的高度 */
    #editor-container {
      height: 600px;
      position: relative;
    }
    
    /* 额外的样式覆盖，确保没有黑边 */
    .ldesign-editor-content:focus,
    .ldesign-editor-content[contenteditable="true"]:focus {
      outline: none !important;
      outline-width: 0 !important;
      box-shadow: none !important;
      border: none !important;
    }
    
    /* 状态指示器 */
    .status-bar {
      margin-top: 20px;
      padding: 15px;
      background: #f0f9ff;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #0369a1;
    }
    
    .status-item .icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .test-buttons {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .test-btn {
      padding: 10px 20px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    
    .test-btn:hover {
      background: #2563eb;
    }
    
    .test-btn.success {
      background: #10b981;
    }
    
    .test-btn.success:hover {
      background: #059669;
    }
    
    .test-btn.warning {
      background: #f59e0b;
    }
    
    .test-btn.warning:hover {
      background: #d97706;
    }
    
    .test-btn.danger {
      background: #ef4444;
    }
    
    .test-btn.danger:hover {
      background: #dc2626;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>✨ LDesign Editor - 修复版</h1>
      <p>所有问题已修复：无黑边、正常滚动、单次弹窗</p>
    </div>
    
    <div class="editor-wrapper">
      <div id="editor-container"></div>
      
      <div class="status-bar">
        <div class="status-item">
          <span class="icon">✅</span>
          <span>无黑边聚焦</span>
        </div>
        <div class="status-item">
          <span class="icon">✅</span>
          <span>滚动条正常</span>
        </div>
        <div class="status-item">
          <span class="icon">✅</span>
          <span>单次图片选择</span>
        </div>
        <div class="status-item">
          <span class="icon">📝</span>
          <span id="char-count">字数：0</span>
        </div>
      </div>
      
      <div class="test-buttons">
        <button class="test-btn" onclick="addLongContent()">添加长内容（测试滚动）</button>
        <button class="test-btn success" onclick="insertImage()">插入图片</button>
        <button class="test-btn success" onclick="insertVideo()">插入视频</button>
        <button class="test-btn success" onclick="insertAudio()">插入音频</button>
        <button class="test-btn warning" onclick="testFocus()">测试聚焦</button>
        <button class="test-btn danger" onclick="clearContent()">清空内容</button>
      </div>
    </div>
  </div>

  <script type="module">
    // 导入编辑器和插件
    import { Editor, MediaDialogPlugin, ImagePlugin } from './dist/index.js'
    
    // 创建编辑器实例
    const editor = new Editor({
      element: '#editor-container',
      placeholder: '开始输入内容，或使用工具栏插入媒体...',
      autofocus: false, // 初始不自动聚焦，避免看到黑边
      plugins: [
        MediaDialogPlugin,  // 媒体对话框插件（必须先加载）
        ImagePlugin        // 图片右键菜单插件
      ],
      onChange: (content) => {
        // 更新字数统计
        const text = content.replace(/<[^>]*>/g, '').trim()
        document.getElementById('char-count').textContent = `字数：${text.length}`
      }
    })
    
    // 设置初始内容
    editor.setHTML(`
      <h1>欢迎使用修复后的 LDesign Editor！</h1>
      <p>这个版本已经修复了所有已知问题：</p>
      <ul>
        <li><strong>✅ 无黑边问题：</strong>编辑器获取焦点时不会出现黑色边框</li>
        <li><strong>✅ 滚动条正常：</strong>内容超过最大高度时自动显示优雅的滚动条</li>
        <li><strong>✅ 单次弹窗：</strong>插入图片只会弹出一次选择框</li>
        <li><strong>✅ 错误修复：</strong>插入媒体后不会报错</li>
      </ul>
      <p>请使用下方的测试按钮验证各项功能。</p>
    `)
    
    // 全局函数
    window.editor = editor
    
    window.addLongContent = function() {
      const longText = `
        <h2>长内容测试区域</h2>
        <p>这是一段很长的测试内容，用于验证滚动条功能是否正常工作。</p>
        ${Array(30).fill('<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>').join('')}
        <p>内容结束。如果滚动条正常显示并且可以平滑滚动，说明功能正常。</p>
      `
      editor.setHTML(editor.getHTML() + longText)
      alert('已添加长内容，请查看滚动条效果！')
    }
    
    window.insertImage = function() {
      // 直接调用编辑器命令
      editor.commands.execute('insertImage')
    }
    
    window.insertVideo = function() {
      editor.commands.execute('insertVideo')
    }
    
    window.insertAudio = function() {
      editor.commands.execute('insertAudio')
    }
    
    window.testFocus = function() {
      // 先失焦再聚焦
      editor.blur()
      setTimeout(() => {
        editor.focus()
        alert('编辑器已聚焦！请检查是否有黑色边框（应该没有）')
      }, 100)
    }
    
    window.clearContent = function() {
      if (confirm('确定要清空所有内容吗？')) {
        editor.clear()
      }
    }
    
    // 初始化时延迟聚焦，避免初始黑边
    setTimeout(() => {
      editor.focus()
    }, 500)
  </script>
</body>
</html>