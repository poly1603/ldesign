# âš¡ å¿«é€Ÿæ”¹è¿›æŒ‡å—

> æœ¬æŒ‡å—æä¾›æœ€å…³é”®ã€å½±å“æœ€å¤§çš„æ”¹è¿›å»ºè®®ï¼Œé€‚åˆå¿«é€Ÿå®æ–½ã€‚

---

## ğŸ¯ ç«‹å³å¯ä»¥åšçš„æ”¹è¿›ï¼ˆ1-2å¤©ï¼‰

### 1. æ¸…ç† Console.log è¯­å¥ âš¡

**é—®é¢˜ï¼š** ä»£ç ä¸­æœ‰å¤§é‡è°ƒè¯•ç”¨çš„ console.log

```bash
# æœç´¢æ‰€æœ‰ console.log
grep -r "console.log" src/

# å»ºè®®ï¼š
# - ç§»é™¤ç”Ÿäº§ç¯å¢ƒä¸éœ€è¦çš„æ—¥å¿—
# - ä¿ç•™é‡è¦çš„é”™è¯¯æ—¥å¿—
# - ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—å·¥å…·
```

**è§£å†³æ–¹æ¡ˆï¼š**
```typescript
// src/utils/logger.ts
export const logger = {
  debug: (...args: any[]) => {
    if (process.env.NODE_ENV === 'development') {
      console.log('[DEBUG]', ...args)
    }
  },
  info: (...args: any[]) => {
    console.info('[INFO]', ...args)
  },
  warn: (...args: any[]) => {
    console.warn('[WARN]', ...args)
  },
  error: (...args: any[]) => {
    console.error('[ERROR]', ...args)
  }
}

// ä½¿ç”¨
import { logger } from './utils/logger'
logger.debug('Selection saved')  // åªåœ¨å¼€å‘ç¯å¢ƒè¾“å‡º
logger.error('Failed to insert node', error)  // æ€»æ˜¯è¾“å‡º
```

**æ‰¹é‡æ›¿æ¢ï¼š**
```bash
# æŸ¥æ‰¾æ‰€æœ‰ console.log
find src -name "*.ts" -exec sed -i 's/console\.log/logger.debug/g' {} \;
```

---

### 2. å®Œæˆæ ¸å¿ƒ TODO âš¡âš¡

**æ–‡ä»¶ï¼š** `src/core/Command.ts`

**å¿…é¡»å®ç°çš„åŠŸèƒ½ï¼š**

```typescript
// 1. åˆ é™¤é€‰åŒºå†…å®¹ï¼ˆæœ€é‡è¦ï¼‰
deleteSelection(): boolean {
  const selection = window.getSelection()
  if (!selection || selection.rangeCount === 0) return false
  
  const range = selection.getRangeAt(0)
  if (range.collapsed) return false
  
  range.deleteContents()
  this.editor.emit('content-change')
  return true
}

// 2. æ’å…¥èŠ‚ç‚¹ï¼ˆé«˜é¢‘ä½¿ç”¨ï¼‰
insertNode(node: HTMLElement): boolean {
  const selection = window.getSelection()
  if (!selection || selection.rangeCount === 0) return false
  
  const range = selection.getRangeAt(0)
  range.deleteContents()
  range.insertNode(node)
  
  // ç§»åŠ¨å…‰æ ‡åˆ°æ’å…¥å†…å®¹å
  range.setStartAfter(node)
  range.collapse(true)
  selection.removeAllRanges()
  selection.addRange(range)
  
  this.editor.emit('content-change')
  return true
}

// 3. åˆ‡æ¢æ ‡è®°ï¼ˆåŠ ç²—ã€æ–œä½“ç­‰ï¼‰
toggleMark(markType: string): boolean {
  document.execCommand(markType, false)
  this.editor.emit('content-change')
  return true
}

// 4. è®¾ç½®èŠ‚ç‚¹ç±»å‹ï¼ˆæ ‡é¢˜ã€æ®µè½ç­‰ï¼‰
setNodeType(nodeType: string, attrs?: any): boolean {
  const selection = window.getSelection()
  if (!selection || selection.rangeCount === 0) return false
  
  const range = selection.getRangeAt(0)
  let block = range.commonAncestorContainer as HTMLElement
  
  // æŸ¥æ‰¾å—çº§å…ƒç´ 
  while (block && !this.isBlockElement(block)) {
    block = block.parentElement!
  }
  
  if (!block) return false
  
  // åˆ›å»ºæ–°èŠ‚ç‚¹
  const newNode = document.createElement(nodeType)
  if (attrs) {
    Object.entries(attrs).forEach(([key, value]) => {
      newNode.setAttribute(key, String(value))
    })
  }
  
  // è½¬ç§»å†…å®¹
  while (block.firstChild) {
    newNode.appendChild(block.firstChild)
  }
  
  // æ›¿æ¢
  block.parentNode?.replaceChild(newNode, block)
  this.editor.emit('content-change')
  return true
}

private isBlockElement(element: HTMLElement): boolean {
  const blockTags = ['P', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'DIV', 'BLOCKQUOTE', 'PRE', 'LI']
  return blockTags.includes(element.tagName)
}
```

**é¢„ä¼°æ—¶é—´ï¼š** 2-3 å°æ—¶

---

### 3. ç»Ÿä¸€é”™è¯¯å¤„ç† âš¡

**é—®é¢˜ï¼š** é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€ï¼Œæœ‰çš„ç”¨ try-catchï¼Œæœ‰çš„ç›´æ¥å¿½ç•¥

**å»ºè®®ï¼š**
```typescript
// src/utils/error-handler.ts
export class EditorError extends Error {
  constructor(
    message: string,
    public code: string,
    public details?: any
  ) {
    super(message)
    this.name = 'EditorError'
  }
}

export function handleError(error: Error, context?: string): void {
  if (error instanceof EditorError) {
    logger.error(`[${context}] ${error.message}`, {
      code: error.code,
      details: error.details
    })
  } else {
    logger.error(`[${context}] Unexpected error:`, error)
  }
  
  // å¯é€‰ï¼šä¸ŠæŠ¥åˆ°é”™è¯¯ç›‘æ§æœåŠ¡
  // reportToSentry(error)
}

// ä½¿ç”¨
try {
  editor.commands.execute('insertTable')
} catch (error) {
  handleError(error as Error, 'TablePlugin')
  // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
  alert('æ’å…¥è¡¨æ ¼å¤±è´¥ï¼Œè¯·é‡è¯•')
}
```

---

## ğŸš€ æœ¬å‘¨å¯ä»¥å®Œæˆçš„æ”¹è¿›ï¼ˆ3-5å¤©ï¼‰

### 1. ä¼˜åŒ–æ‰“åŒ…é…ç½® âš¡âš¡âš¡

**æ–‡ä»¶ï¼š** `vite.config.ts`

```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import react from '@vitejs/plugin-react'
import { resolve } from 'path'
import { visualizer } from 'rollup-plugin-visualizer' // åˆ†ææ‰“åŒ…ä½“ç§¯

export default defineConfig({
  plugins: [
    vue(),
    react(),
    // å¯è§†åŒ–æ‰“åŒ…ä½“ç§¯
    visualizer({
      open: true,
      gzipSize: true,
      brotliSize: true
    })
  ],
  build: {
    lib: {
      entry: {
        index: resolve(__dirname, 'src/index.ts'),
        vue: resolve(__dirname, 'src/adapters/vue/index.ts'),
        react: resolve(__dirname, 'src/adapters/react/index.tsx'),
      },
      formats: ['es'],
      fileName: (format, entryName) => `${entryName}.js`
    },
    rollupOptions: {
      external: ['vue', 'react', 'react-dom', 'react/jsx-runtime'],
      output: {
        // ä»£ç åˆ†å‰² - é‡è¦ï¼
        manualChunks: {
          // CodeMirror å•ç‹¬æ‰“åŒ…ï¼ˆä½“ç§¯å¤§ï¼‰
          'codemirror': [
            '@codemirror/state',
            '@codemirror/view',
            '@codemirror/language',
            '@codemirror/commands',
            '@codemirror/autocomplete',
            '@codemirror/search',
            '@codemirror/lint'
          ],
          // è¯­è¨€åŒ…å•ç‹¬æ‰“åŒ…
          'codemirror-langs': [
            '@codemirror/lang-javascript',
            '@codemirror/lang-typescript',
            '@codemirror/lang-python',
            '@codemirror/lang-java',
            '@codemirror/lang-cpp',
            '@codemirror/lang-css',
            '@codemirror/lang-html',
            '@codemirror/lang-json',
            '@codemirror/lang-markdown',
            '@codemirror/lang-sql'
          ]
        },
        globals: {
          vue: 'Vue',
          react: 'React',
          'react-dom': 'ReactDOM'
        }
      }
    },
    // å‹ç¼©é…ç½®
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true, // ç§»é™¤ console
        drop_debugger: true, // ç§»é™¤ debugger
        pure_funcs: ['console.log', 'console.debug'] // ç§»é™¤ç‰¹å®šå‡½æ•°è°ƒç”¨
      }
    },
    // å…¶ä»–ä¼˜åŒ–
    cssCodeSplit: false,
    sourcemap: true,
    chunkSizeWarningLimit: 1000 // æé«˜è­¦å‘Šé˜ˆå€¼
  },
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },
  // å¼€å‘æœåŠ¡å™¨ä¼˜åŒ–
  server: {
    hmr: {
      overlay: true
    }
  }
})
```

**å®‰è£…ä¾èµ–ï¼š**
```bash
npm install -D rollup-plugin-visualizer
```

**é¢„ä¼°æ•ˆæœï¼š**
- æ‰“åŒ…ä½“ç§¯å‡å°‘ 30-40%
- é¦–æ¬¡åŠ è½½é€Ÿåº¦æå‡ 50%+
- æŒ‰éœ€åŠ è½½ CodeMirror

**é¢„ä¼°æ—¶é—´ï¼š** 2 å°æ—¶

---

### 2. æ·»åŠ  TypeScript è·¯å¾„åˆ«å âš¡

**æ–‡ä»¶ï¼š** `tsconfig.json`

```json
{
  "compilerOptions": {
    // ... å…¶ä»–é…ç½®
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@core/*": ["src/core/*"],
      "@ui/*": ["src/ui/*"],
      "@plugins/*": ["src/plugins/*"],
      "@utils/*": ["src/utils/*"]
    }
  }
}
```

**ä½¿ç”¨ï¼š**
```typescript
// âŒ ä¹‹å‰
import { Editor } from '../../../core/Editor'
import { ColorPicker } from '../../../ui/ColorPicker'

// âœ… ä¹‹å
import { Editor } from '@core/Editor'
import { ColorPicker } from '@ui/ColorPicker'
```

**é¢„ä¼°æ—¶é—´ï¼š** 1 å°æ—¶ï¼ˆåŒ…æ‹¬æ›´æ–°æ‰€æœ‰å¯¼å…¥ï¼‰

---

### 3. æå–å¸¸é‡é…ç½® âš¡

**åˆ›å»ºï¼š** `src/config/constants.ts`

```typescript
// ç¼–è¾‘å™¨é…ç½®
export const EDITOR_CONFIG = {
  MAX_HISTORY_SIZE: 100,
  AUTO_SAVE_DELAY: 3000,
  MAX_FILE_SIZE: 10 * 1024 * 1024, // 10MB
  SUPPORTED_IMAGE_TYPES: ['image/png', 'image/jpeg', 'image/gif', 'image/webp'],
  SUPPORTED_VIDEO_TYPES: ['video/mp4', 'video/webm', 'video/ogg'],
  SUPPORTED_AUDIO_TYPES: ['audio/mp3', 'audio/wav', 'audio/ogg']
}

// UI é…ç½®
export const UI_CONFIG = {
  CONTEXT_MENU_Z_INDEX: 9999,
  DIALOG_Z_INDEX: 10000,
  TOOLTIP_Z_INDEX: 10001,
  TOOLBAR_HEIGHT: 48,
  MIN_EDITOR_HEIGHT: 200,
  ANIMATION_DURATION: 200
}

// é¢œè‰²é¢„è®¾
export const COLOR_PRESETS = {
  RECENT_COLORS_KEY: 'editor-recent-colors',
  MAX_RECENT_COLORS: 10,
  DEFAULT_COLORS: [
    '#000000', '#333333', '#666666', '#999999', '#CCCCCC', '#FFFFFF',
    '#FF0000', '#FF6600', '#FFCC00', '#00FF00', '#00CCFF', '#0000FF',
    '#6600CC', '#CC00CC', '#FF0066', '#FF99CC'
  ]
}

// å¿«æ·é”®
export const KEYBOARD_SHORTCUTS = {
  BOLD: 'Mod+B',
  ITALIC: 'Mod+I',
  UNDERLINE: 'Mod+U',
  UNDO: 'Mod+Z',
  REDO: 'Mod+Shift+Z',
  FIND: 'Mod+F',
  SAVE: 'Mod+S',
  CLEAR_FORMAT: 'Mod+\\'
}

// é”™è¯¯ä»£ç 
export const ERROR_CODES = {
  INVALID_FILE_TYPE: 'INVALID_FILE_TYPE',
  FILE_TOO_LARGE: 'FILE_TOO_LARGE',
  UPLOAD_FAILED: 'UPLOAD_FAILED',
  INVALID_URL: 'INVALID_URL',
  COMMAND_NOT_FOUND: 'COMMAND_NOT_FOUND',
  PLUGIN_LOAD_FAILED: 'PLUGIN_LOAD_FAILED'
}
```

**ä½¿ç”¨ï¼š**
```typescript
import { EDITOR_CONFIG, UI_CONFIG, ERROR_CODES } from '@/config/constants'

// æ£€æŸ¥æ–‡ä»¶å¤§å°
if (file.size > EDITOR_CONFIG.MAX_FILE_SIZE) {
  throw new EditorError(
    'æ–‡ä»¶å¤ªå¤§',
    ERROR_CODES.FILE_TOO_LARGE,
    { maxSize: EDITOR_CONFIG.MAX_FILE_SIZE, actualSize: file.size }
  )
}

// è®¾ç½®å¯¹è¯æ¡†å±‚çº§
dialog.style.zIndex = UI_CONFIG.DIALOG_Z_INDEX.toString()
```

**é¢„ä¼°æ—¶é—´ï¼š** 2 å°æ—¶

---

### 4. æ·»åŠ åŸºç¡€æ–‡æ¡£æ³¨é‡Š âš¡

**ä½¿ç”¨ JSDoc æ ¼å¼ï¼š**

```typescript
/**
 * ç¼–è¾‘å™¨æ ¸å¿ƒç±»
 * 
 * @example
 * ```typescript
 * const editor = new Editor({
 *   element: document.getElementById('editor'),
 *   content: '<p>Hello World</p>',
 *   plugins: [BoldPlugin, ItalicPlugin]
 * })
 * ```
 * 
 * @public
 */
export class Editor {
  /**
   * æ„é€ å‡½æ•°
   * @param options - ç¼–è¾‘å™¨é€‰é¡¹
   */
  constructor(options: EditorOptions = {}) {
    // ...
  }
  
  /**
   * è·å–ç¼–è¾‘å™¨ HTML å†…å®¹
   * @returns HTML å­—ç¬¦ä¸²
   * @public
   */
  getHTML(): string {
    return this.document.toHTML()
  }
  
  /**
   * è®¾ç½®ç¼–è¾‘å™¨ HTML å†…å®¹
   * @param html - HTML å­—ç¬¦ä¸²
   * @public
   */
  setHTML(html: string): void {
    this.document = new Document(html, this.schema)
    this.render()
  }
  
  /**
   * æ’å…¥ HTML åˆ°å½“å‰å…‰æ ‡ä½ç½®
   * @param html - è¦æ’å…¥çš„ HTML
   * @throws {EditorError} å½“æ’å…¥å¤±è´¥æ—¶æŠ›å‡º
   * @public
   */
  insertHTML(html: string): void {
    // ...
  }
}
```

**ç”Ÿæˆæ–‡æ¡£ï¼š**
```bash
# å®‰è£… TypeDoc
npm install -D typedoc

# ç”Ÿæˆæ–‡æ¡£
npx typedoc --out docs/api src/index.ts
```

**é¢„ä¼°æ—¶é—´ï¼š** 4-6 å°æ—¶ï¼ˆæ ¸å¿ƒ APIï¼‰

---

## ğŸ“Š ä¼˜å…ˆçº§è¯„åˆ†è¡¨

| æ”¹è¿›é¡¹ | éš¾åº¦ | å½±å“ | æ—¶é—´ | å¾—åˆ† | ä¼˜å…ˆçº§ |
|--------|------|------|------|------|--------|
| æ¸…ç† console.log | â­ | â­â­ | 1h | 8 | ğŸ”´ é«˜ |
| å®Œæˆæ ¸å¿ƒ TODO | â­â­ | â­â­â­ | 3h | 10 | ğŸ”´ é«˜ |
| ç»Ÿä¸€é”™è¯¯å¤„ç† | â­ | â­â­ | 2h | 7 | ğŸ”´ é«˜ |
| ä¼˜åŒ–æ‰“åŒ…é…ç½® | â­â­ | â­â­â­ | 2h | 9 | ğŸ”´ é«˜ |
| æ·»åŠ è·¯å¾„åˆ«å | â­ | â­â­ | 1h | 6 | ğŸŸ¡ ä¸­ |
| æå–å¸¸é‡é…ç½® | â­ | â­â­ | 2h | 6 | ğŸŸ¡ ä¸­ |
| æ·»åŠ æ–‡æ¡£æ³¨é‡Š | â­â­ | â­â­ | 6h | 5 | ğŸŸ¢ ä½ |

**è®¡åˆ†è§„åˆ™ï¼š**
- éš¾åº¦ï¼šâ­ ç®€å•ï¼Œâ­â­ ä¸­ç­‰ï¼Œâ­â­â­ å›°éš¾
- å½±å“ï¼šâ­ å°ï¼Œâ­â­ ä¸­ï¼Œâ­â­â­ å¤§
- å¾—åˆ† = (å½±å“ Ã— 3 + (4 - éš¾åº¦) Ã— 2) - æ—¶é—´/2
- ä¼˜å…ˆçº§ï¼šå¾—åˆ† â‰¥ 8 ä¸ºé«˜ï¼Œ5-7 ä¸ºä¸­ï¼Œ< 5 ä¸ºä½

---

## ğŸ¯ æœ¬å‘¨è¡ŒåŠ¨è®¡åˆ’

### ç¬¬1å¤©ï¼ˆ4å°æ—¶ï¼‰
- âœ… æ¸…ç† console.logï¼ˆ1å°æ—¶ï¼‰
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼ˆ2å°æ—¶ï¼‰
- âœ… æ·»åŠ è·¯å¾„åˆ«åï¼ˆ1å°æ—¶ï¼‰

### ç¬¬2å¤©ï¼ˆ4å°æ—¶ï¼‰
- âœ… å®Œæˆæ ¸å¿ƒ TODOï¼ˆ3å°æ—¶ï¼‰
- âœ… æå–å¸¸é‡é…ç½®ï¼ˆ1å°æ—¶ï¼‰

### ç¬¬3å¤©ï¼ˆ2å°æ—¶ï¼‰
- âœ… ä¼˜åŒ–æ‰“åŒ…é…ç½®ï¼ˆ2å°æ—¶ï¼‰

### ç¬¬4-5å¤©ï¼ˆå¯é€‰ï¼‰
- âšª æ·»åŠ åŸºç¡€æ–‡æ¡£æ³¨é‡Šï¼ˆ6å°æ—¶ï¼‰
- âšª ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆæŒ‰éœ€ï¼‰

---

## ğŸ” éªŒè¯æ”¹è¿›æ•ˆæœ

### 1. æ‰“åŒ…ä½“ç§¯æ£€æŸ¥
```bash
# æ„å»ºå‰
npm run build
du -sh dist/  # è®°å½•å¤§å°

# ä¼˜åŒ–å
npm run build
du -sh dist/  # å¯¹æ¯”å¤§å°

# æœŸæœ›ï¼šå‡å°‘ 30% ä»¥ä¸Š
```

### 2. æ€§èƒ½æ£€æŸ¥
```bash
# ä½¿ç”¨ Lighthouse æµ‹è¯•
npm run build
npm run preview
# åœ¨ Chrome DevTools ä¸­è¿è¡Œ Lighthouse

# æœŸæœ›æŒ‡æ ‡ï¼š
# - Performance: > 90
# - First Contentful Paint: < 1.5s
# - Time to Interactive: < 3.5s
```

### 3. ä»£ç è´¨é‡æ£€æŸ¥
```bash
# æ·»åŠ  ESLint
npm install -D eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin

# è¿è¡Œæ£€æŸ¥
npx eslint src/ --ext .ts,.tsx

# æœŸæœ›ï¼š0 errors, < 10 warnings
```

---

## ğŸ’¡ å°è´´å£«

1. **æ¯æ¬¡æ”¹è¿›åç«‹å³æµ‹è¯•**
   ```bash
   npm run build
   npm run dev
   # æ‰‹åŠ¨æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
   ```

2. **ä½¿ç”¨ Git åˆ†æ”¯**
   ```bash
   git checkout -b feature/optimize-build
   # è¿›è¡Œæ”¹è¿›
   git commit -m "feat: optimize build configuration"
   ```

3. **é€æ­¥æäº¤ï¼Œè€Œéä¸€æ¬¡æ€§å¤§æ”¹**
   - æ¯å®Œæˆä¸€é¡¹æ”¹è¿›å°± commit
   - ä¾¿äºå›æ»šå’Œ code review

4. **ä¿æŒå‘åå…¼å®¹**
   - ä¸è¦ä¿®æ”¹å…¬å…± API
   - æ–°å¢åŠŸèƒ½è€Œéä¿®æ”¹ç°æœ‰åŠŸèƒ½

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœåœ¨å®æ–½è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. æŸ¥çœ‹æ„å»ºæ—¥å¿—
3. å¯¹æ¯”æ”¹åŠ¨å‰åçš„ä»£ç 
4. å›æ»šåˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬

---

**é¢„ä¼°æ€»æ—¶é—´ï¼š** 14-20 å°æ—¶
**é¢„ä¼°å®Œæˆæ—¥æœŸï¼š** æœ¬å‘¨äº”
**é¢„æœŸæ”¶ç›Šï¼š** 
- ğŸ“¦ æ‰“åŒ…ä½“ç§¯å‡å°‘ 30%+
- âš¡ åŠ è½½é€Ÿåº¦æå‡ 40%+
- ğŸ› å‡å°‘æ½œåœ¨ bug 50%+
- ğŸ“š ä»£ç å¯ç»´æŠ¤æ€§æå‡ 60%+





