<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åª’ä½“æ’å…¥æµ‹è¯•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
      max-width: 1200px;
      margin: 50px auto;
      padding: 0 20px;
    }
    
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    
    #editor {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      min-height: 400px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .test-buttons {
      margin: 20px 0;
      display: flex;
      gap: 10px;
    }
    
    .test-button {
      padding: 10px 20px;
      background: #4f46e5;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .test-button:hover {
      background: #4338ca;
    }
    
    .status {
      margin: 20px 0;
      padding: 15px;
      background: #f3f4f6;
      border-radius: 6px;
      font-family: monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .log-entry {
      margin: 2px 0;
      padding: 2px;
    }
    
    .log-error {
      color: red;
    }
    
    .log-success {
      color: green;
    }
    
    .log-info {
      color: blue;
    }
  </style>
</head>
<body>
  <h1>ğŸ¯ åª’ä½“æ’å…¥åŠŸèƒ½æµ‹è¯•</h1>
  
  <div class="test-buttons">
    <button class="test-button" onclick="testImageDirect()">ç›´æ¥æ’å…¥å›¾ç‰‡</button>
    <button class="test-button" onclick="testVideoDirect()">ç›´æ¥æ’å…¥è§†é¢‘</button>
    <button class="test-button" onclick="testAudioDirect()">ç›´æ¥æ’å…¥éŸ³é¢‘</button>
    <button class="test-button" onclick="testImageCommand()">é€šè¿‡å‘½ä»¤æ’å…¥å›¾ç‰‡</button>
    <button class="test-button" onclick="testVideoCommand()">é€šè¿‡å‘½ä»¤æ’å…¥è§†é¢‘</button>
    <button class="test-button" onclick="testAudioCommand()">é€šè¿‡å‘½ä»¤æ’å…¥éŸ³é¢‘</button>
    <button class="test-button" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
  </div>
  
  <div id="status" class="status">
    <div class="log-entry log-info">ç­‰å¾…åˆå§‹åŒ–...</div>
  </div>
  
  <!-- ç¼–è¾‘å™¨å®¹å™¨ -->
  <div id="editor"></div>
  
  <script type="module">
    const statusEl = document.getElementById('status');
    
    function log(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      statusEl.appendChild(entry);
      statusEl.scrollTop = statusEl.scrollHeight;
      console.log(`[${type}] ${message}`);
    }
    
    window.clearLogs = () => {
      statusEl.innerHTML = '';
      log('æ—¥å¿—å·²æ¸…ç©º', 'info');
    };
    
    // å¯¼å…¥æ ·å¼
    const styles = [
      '/src/styles/editor.css',
      '/src/styles/reset.css',
      '/src/styles/table.css'
    ];
    
    for (const href of styles) {
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = href;
      document.head.appendChild(link);
    }
    
    try {
      log('å¼€å§‹å¯¼å…¥ç¼–è¾‘å™¨æ¨¡å—...', 'info');
      
      // å¯¼å…¥ç¼–è¾‘å™¨
      const { Editor } = await import('/src/core/Editor.ts');
      log('Editor ç±»å¯¼å…¥æˆåŠŸ', 'success');
      
      // åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹
      log('åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹...', 'info');
      const editor = new Editor({
        element: '#editor'
      });
      
      log('ç¼–è¾‘å™¨åˆ›å»ºæˆåŠŸ', 'success');
      
      // è®¾ç½®åˆå§‹å†…å®¹
      editor.setHTML(`
        <h2>åª’ä½“æ’å…¥æµ‹è¯•</h2>
        <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•å„ç§åª’ä½“æ’å…¥åŠŸèƒ½ã€‚</p>
        <p>ä¸‹é¢ä¼šæ˜¾ç¤ºæ’å…¥çš„åª’ä½“å†…å®¹ï¼š</p>
      `);
      
      // æš´éœ²åˆ°å…¨å±€
      window.editor = editor;
      
      // æ£€æŸ¥å‘½ä»¤æ˜¯å¦æ³¨å†Œ
      log('æ£€æŸ¥å·²æ³¨å†Œçš„å‘½ä»¤...', 'info');
      if (editor.commands) {
        log(`Commands å¯¹è±¡å­˜åœ¨: ${typeof editor.commands}`, 'info');
        
        // æ£€æŸ¥ç‰¹å®šå‘½ä»¤
        const commandsToCheck = ['insertImage', 'insertVideo', 'insertAudio'];
        for (const cmd of commandsToCheck) {
          const hasCommand = editor.commands.get ? editor.commands.get(cmd) : false;
          log(`å‘½ä»¤ '${cmd}': ${hasCommand ? 'å·²æ³¨å†Œ' : 'æœªæ³¨å†Œ'}`, hasCommand ? 'success' : 'error');
        }
      } else {
        log('Commands å¯¹è±¡ä¸å­˜åœ¨ï¼', 'error');
      }
      
      // æµ‹è¯•å‡½æ•°ï¼šç›´æ¥æ’å…¥HTML
      window.testImageDirect = () => {
        log('ç›´æ¥æ’å…¥å›¾ç‰‡ HTML...', 'info');
        const html = `<img src="https://via.placeholder.com/300x200" alt="æµ‹è¯•å›¾ç‰‡" style="max-width: 100%; height: auto; display: block; margin: 10px auto;">`;
        
        try {
          if (editor.insertHTML) {
            editor.insertHTML(html);
            log('ä½¿ç”¨ editor.insertHTML() æˆåŠŸ', 'success');
          } else {
            // å›é€€åˆ° execCommand
            editor.contentElement.focus();
            const success = document.execCommand('insertHTML', false, html);
            log(`ä½¿ç”¨ document.execCommand(): ${success}`, success ? 'success' : 'error');
          }
        } catch (e) {
          log(`æ’å…¥å¤±è´¥: ${e.message}`, 'error');
        }
      };
      
      window.testVideoDirect = () => {
        log('ç›´æ¥æ’å…¥è§†é¢‘ HTML...', 'info');
        const html = `<video controls style="max-width: 100%; height: auto; display: block; margin: 10px auto;">
          <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
          æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ ‡ç­¾ã€‚
        </video>`;
        
        try {
          if (editor.insertHTML) {
            editor.insertHTML(html);
            log('ä½¿ç”¨ editor.insertHTML() æˆåŠŸ', 'success');
          } else {
            editor.contentElement.focus();
            const success = document.execCommand('insertHTML', false, html);
            log(`ä½¿ç”¨ document.execCommand(): ${success}`, success ? 'success' : 'error');
          }
        } catch (e) {
          log(`æ’å…¥å¤±è´¥: ${e.message}`, 'error');
        }
      };
      
      window.testAudioDirect = () => {
        log('ç›´æ¥æ’å…¥éŸ³é¢‘ HTML...', 'info');
        const html = `<audio controls style="width: 100%; max-width: 400px; display: block; margin: 10px auto;">
          <source src="https://www.w3schools.com/html/horse.mp3" type="audio/mpeg">
          æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ ‡ç­¾ã€‚
        </audio>`;
        
        try {
          if (editor.insertHTML) {
            editor.insertHTML(html);
            log('ä½¿ç”¨ editor.insertHTML() æˆåŠŸ', 'success');
          } else {
            editor.contentElement.focus();
            const success = document.execCommand('insertHTML', false, html);
            log(`ä½¿ç”¨ document.execCommand(): ${success}`, success ? 'success' : 'error');
          }
        } catch (e) {
          log(`æ’å…¥å¤±è´¥: ${e.message}`, 'error');
        }
      };
      
      // æµ‹è¯•å‡½æ•°ï¼šé€šè¿‡å‘½ä»¤æ’å…¥
      window.testImageCommand = () => {
        log('é€šè¿‡å‘½ä»¤æ’å…¥å›¾ç‰‡...', 'info');
        try {
          if (editor.commands && editor.commands.execute) {
            editor.commands.execute('insertImage');
            log('å‘½ä»¤æ‰§è¡ŒæˆåŠŸ', 'success');
          } else {
            log('Commands.execute ä¸å­˜åœ¨', 'error');
          }
        } catch (e) {
          log(`å‘½ä»¤æ‰§è¡Œå¤±è´¥: ${e.message}`, 'error');
        }
      };
      
      window.testVideoCommand = () => {
        log('é€šè¿‡å‘½ä»¤æ’å…¥è§†é¢‘...', 'info');
        try {
          if (editor.commands && editor.commands.execute) {
            editor.commands.execute('insertVideo');
            log('å‘½ä»¤æ‰§è¡ŒæˆåŠŸ', 'success');
          } else {
            log('Commands.execute ä¸å­˜åœ¨', 'error');
          }
        } catch (e) {
          log(`å‘½ä»¤æ‰§è¡Œå¤±è´¥: ${e.message}`, 'error');
        }
      };
      
      window.testAudioCommand = () => {
        log('é€šè¿‡å‘½ä»¤æ’å…¥éŸ³é¢‘...', 'info');
        try {
          if (editor.commands && editor.commands.execute) {
            editor.commands.execute('insertAudio');
            log('å‘½ä»¤æ‰§è¡ŒæˆåŠŸ', 'success');
          } else {
            log('Commands.execute ä¸å­˜åœ¨', 'error');
          }
        } catch (e) {
          log(`å‘½ä»¤æ‰§è¡Œå¤±è´¥: ${e.message}`, 'error');
        }
      };
      
      log('æ‰€æœ‰æµ‹è¯•å‡½æ•°å·²å‡†å¤‡å°±ç»ª', 'success');
      
    } catch (error) {
      log(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
      console.error(error);
    }
  </script>
</body>
</html>