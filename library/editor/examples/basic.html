<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Rich Text Editor - åŸºç¡€ç¤ºä¾‹</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .demo-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }
        
        .editor-container {
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            min-height: 200px;
            padding: 16px;
            margin: 10px 0;
        }
        
        .status {
            margin-top: 10px;
            padding: 10px;
            background: #f3f4f6;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .toolbar {
            padding: 8px;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
            display: flex;
            gap: 8px;
        }
        
        .toolbar button {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        .toolbar button:hover {
            background: #f3f4f6;
        }
        
        .toolbar button.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
    </style>
</head>
<body>
    <h1>Enhanced Rich Text Editor</h1>
    <p>è¿™æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ŒåŸºäº Quill æ¶æ„è®¾è®¡ï¼Œæä¾›æ›´å¼ºå¤§çš„åŠŸèƒ½å’Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p>
    
    <div class="demo-container">
        <h2>åŸºç¡€ç¼–è¾‘å™¨</h2>
        <p>å½“å‰å®ç°äº†æ ¸å¿ƒçš„äº‹ä»¶ç³»ç»Ÿã€Delta æ“ä½œæ ¼å¼å’Œé€‰åŒºç®¡ç†ã€‚</p>
        
        <div class="toolbar">
            <button onclick="insertText()">æ’å…¥æ–‡æœ¬</button>
            <button onclick="getContent()">è·å–å†…å®¹</button>
            <button onclick="getSelection()">è·å–é€‰åŒº</button>
            <button onclick="clearContent()">æ¸…ç©ºå†…å®¹</button>
            <span style="border-left: 1px solid #d1d5db; margin: 0 8px; height: 20px;"></span>
            <button onclick="formatBold()"><strong>B</strong></button>
            <button onclick="formatItalic()"><em>I</em></button>
            <button onclick="formatUnderline()"><u>U</u></button>
        </div>
        
        <div id="editor" class="editor-container" contenteditable="true" 
             placeholder="å¼€å§‹ç¼–å†™...">
            <p>æ¬¢è¿ä½¿ç”¨å¢å¼ºç‰ˆå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼</p>
            <p>è¿™æ˜¯ä¸€ä¸ª<strong>æ¼”ç¤º</strong>æ®µè½ï¼Œå±•ç¤ºäº†åŸºç¡€çš„<em>æ–‡æœ¬æ ¼å¼</em>ã€‚</p>
            <ul>
                <li>æ”¯æŒåˆ—è¡¨</li>
                <li>æ”¯æŒ<u>ä¸‹åˆ’çº¿</u></li>
                <li>æ”¯æŒ<s>åˆ é™¤çº¿</s></li>
            </ul>
        </div>
        
        <div id="status" class="status">
            çŠ¶æ€ï¼šç¼–è¾‘å™¨å·²åˆå§‹åŒ–
        </div>
    </div>
    
    <div class="demo-container">
        <h2>Delta æ“ä½œç¤ºä¾‹</h2>
        <p>Delta æ˜¯æè¿°å¯Œæ–‡æœ¬æ–‡æ¡£å’Œå˜æ›´çš„æ ¼å¼ã€‚</p>
        
        <div id="delta-demo">
            <button onclick="deltaDemo()">è¿è¡Œ Delta ç¤ºä¾‹</button>
            <pre id="delta-output" style="background: #f3f4f6; padding: 10px; border-radius: 4px; margin-top: 10px;"></pre>
        </div>
    </div>
    
    <div class="demo-container">
        <h2>å¼€å‘è¿›åº¦</h2>
        <ul>
            <li>âœ… é¡¹ç›®æ¶æ„è®¾è®¡</li>
            <li>âœ… åŸºç¡€é…ç½®å’Œå·¥å…·é“¾</li>
            <li>ğŸ”„ æ ¸å¿ƒç¼–è¾‘å™¨å¼•æ“ï¼ˆè¿›è¡Œä¸­ï¼‰</li>
            <li>â³ åŸºç¡€æ ¼å¼åŒ–åŠŸèƒ½</li>
            <li>â³ æ’ä»¶ç³»ç»Ÿ</li>
            <li>â³ UI ç»„ä»¶åº“</li>
            <li>â³ é«˜çº§åŠŸèƒ½æ’ä»¶</li>
            <li>â³ æ¡†æ¶é›†æˆ</li>
            <li>â³ æ–‡æ¡£å’Œç¤ºä¾‹</li>
        </ul>
    </div>

    <script type="module">
        // æ¨¡æ‹Ÿç¼–è¾‘å™¨åŠŸèƒ½ï¼ˆå®é™…å®ç°å°†åœ¨ TypeScript ä¸­ï¼‰

        // æ¨¡æ‹Ÿ Delta ç±»
        class MockDelta {
            constructor(ops = []) {
                this.ops = Array.isArray(ops) ? ops : (ops.ops || []);
            }

            insert(text, attributes) {
                const op = { insert: text };
                if (attributes) op.attributes = attributes;
                this.ops.push(op);
                return this;
            }

            retain(length, attributes) {
                const op = { retain: length };
                if (attributes) op.attributes = attributes;
                this.ops.push(op);
                return this;
            }

            delete(length) {
                this.ops.push({ delete: length });
                return this;
            }

            compose(other) {
                // ç®€åŒ–çš„ç»„åˆå®ç°
                const result = new MockDelta([...this.ops]);
                other.ops.forEach(op => result.ops.push(op));
                return result;
            }

            transform(other) {
                // ç®€åŒ–çš„å˜æ¢å®ç°
                return new MockDelta([...other.ops]);
            }

            length() {
                return this.ops.reduce((len, op) => {
                    if (typeof op.insert === 'string') return len + op.insert.length;
                    if (op.retain) return len + op.retain;
                    if (op.delete) return len + op.delete;
                    return len + 1;
                }, 0);
            }
        }

        // æ¨¡æ‹Ÿç¼–è¾‘å™¨çŠ¶æ€
        let editorContent = new MockDelta();
        let currentSelection = null;

        const editor = document.getElementById('editor');
        const status = document.getElementById('status');

        // ç›‘å¬ç¼–è¾‘å™¨å˜åŒ–
        editor.addEventListener('input', function() {
            const text = this.textContent || '';
            editorContent = new MockDelta().insert(text);
            updateStatus('å†…å®¹å·²æ›´æ–°');
        });

        // ç›‘å¬é€‰åŒºå˜åŒ–
        document.addEventListener('selectionchange', function() {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                if (editor.contains(range.commonAncestorContainer)) {
                    currentSelection = {
                        start: range.startOffset,
                        end: range.endOffset,
                        text: selection.toString()
                    };
                    updateStatus(`é€‰åŒº: ${currentSelection.text || '(ç©º)'}`);
                }
            }
        });

        function updateStatus(message) {
            status.textContent = `çŠ¶æ€ï¼š${message}`;
        }

        // å…¨å±€å‡½æ•°ä¾›æŒ‰é’®è°ƒç”¨
        window.insertText = function() {
            const text = prompt('è¾“å…¥è¦æ’å…¥çš„æ–‡æœ¬:');
            if (text) {
                document.execCommand('insertText', false, text);
                updateStatus(`æ’å…¥æ–‡æœ¬: ${text}`);
            }
        };

        window.getContent = function() {
            const delta = editorContent;
            const info = `ç¼–è¾‘å™¨å†…å®¹:
æ–‡æœ¬: ${editor.textContent}
Delta æ“ä½œæ•°: ${delta.ops.length}
å†…å®¹é•¿åº¦: ${delta.length()}`;
            alert(info);
        };

        window.getSelection = function() {
            const selection = window.getSelection();
            const text = selection.toString();
            const info = currentSelection ?
                `å½“å‰é€‰åŒº:
æ–‡æœ¬: ${text || '(æ— é€‰åŒº)'}
èµ·å§‹: ${currentSelection.start}
ç»“æŸ: ${currentSelection.end}` :
                'å½“å‰é€‰åŒº: (æ— é€‰åŒº)';
            alert(info);
        };

        window.clearContent = function() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå†…å®¹å—ï¼Ÿ')) {
                editor.innerHTML = '<p><br></p>';
                editorContent = new MockDelta();
                updateStatus('å†…å®¹å·²æ¸…ç©º');
            }
        };

        window.deltaDemo = function() {
            const output = document.getElementById('delta-output');

            // å®é™…è¿è¡Œ Delta æ“ä½œ
            const delta = new MockDelta()
                .insert('Hello ')
                .insert('World', { bold: true })
                .insert('!\n');

            const change = new MockDelta()
                .retain(6)
                .delete(5)
                .insert('JavaScript', { bold: true, color: 'blue' });

            const result = delta.compose(change);

            const otherChange = new MockDelta()
                .retain(6)
                .insert('Beautiful ');

            const transformed = change.transform(otherChange);

            const demo = `// åˆ›å»º Delta å®ä¾‹
const delta = new Delta()
  .insert('Hello ')
  .insert('World', { bold: true })
  .insert('!\\n');

console.log('Delta æ“ä½œ:', ${JSON.stringify(delta.ops, null, 2)});

// ç»„åˆæ“ä½œ
const change = new Delta()
  .retain(6)  // ä¿ç•™å‰6ä¸ªå­—ç¬¦
  .delete(5)  // åˆ é™¤5ä¸ªå­—ç¬¦
  .insert('JavaScript', { bold: true, color: 'blue' });

const result = delta.compose(change);
console.log('ç»„åˆç»“æœ:', ${JSON.stringify(result.ops, null, 2)});

// å˜æ¢æ“ä½œ
const otherChange = new Delta()
  .retain(6)
  .insert('Beautiful ');

const transformed = change.transform(otherChange);
console.log('å˜æ¢ç»“æœ:', ${JSON.stringify(transformed.ops, null, 2)});

// ç»Ÿè®¡ä¿¡æ¯
åŸå§‹é•¿åº¦: ${delta.length()}
å˜æ›´åé•¿åº¦: ${result.length()}`;

            output.textContent = demo;
            updateStatus('Delta ç¤ºä¾‹å·²è¿è¡Œ');
        };

        // æ·»åŠ æ ¼å¼åŒ–æŒ‰é’®åŠŸèƒ½
        window.formatBold = function() {
            document.execCommand('bold');
            updateStatus('åº”ç”¨ç²—ä½“æ ¼å¼');
        };

        window.formatItalic = function() {
            document.execCommand('italic');
            updateStatus('åº”ç”¨æ–œä½“æ ¼å¼');
        };

        window.formatUnderline = function() {
            document.execCommand('underline');
            updateStatus('åº”ç”¨ä¸‹åˆ’çº¿æ ¼å¼');
        };

        updateStatus('ç¼–è¾‘å™¨å·²åˆå§‹åŒ–');
    </script>
</body>
</html>
