/**
 * Code Highlighting Plugin Styles
 * 
 * Styles for syntax highlighted code blocks.
 */

// ============================================================================
// Code Block Container
// ============================================================================

.code-block-container {
  position: relative;
  margin: var(--ere-spacing-4) 0;
  border: 1px solid var(--ere-gray-300);
  border-radius: var(--ere-border-radius-md);
  background: var(--ere-gray-50);
  overflow: hidden;
  
  // Language label
  .code-block-language {
    position: absolute;
    top: var(--ere-spacing-2);
    left: var(--ere-spacing-3);
    font-size: var(--ere-font-size-sm);
    font-weight: var(--ere-font-weight-medium);
    color: var(--ere-gray-600);
    background: var(--ere-gray-100);
    padding: 0.125rem 0.5rem;
    border-radius: var(--ere-border-radius);
    z-index: 2;
  }
  
  // Copy button
  .code-block-copy {
    position: absolute;
    top: var(--ere-spacing-2);
    right: var(--ere-spacing-3);
    font-size: var(--ere-font-size-sm);
    color: var(--ere-gray-600);
    background: var(--ere-gray-100);
    border: 1px solid var(--ere-gray-300);
    border-radius: var(--ere-border-radius);
    padding: 0.25rem 0.5rem;
    cursor: pointer;
    transition: all var(--ere-transition-duration) var(--ere-transition-timing);
    z-index: 2;
    
    &:hover {
      background: var(--ere-gray-200);
      border-color: var(--ere-gray-400);
    }
    
    &:active {
      background: var(--ere-gray-300);
    }
  }
  
  // Pre element
  pre {
    margin: 0;
    padding: var(--ere-spacing-4);
    padding-top: calc(var(--ere-spacing-4) + 1.5rem); // Space for language label
    background: transparent;
    border: none;
    border-radius: 0;
    overflow-x: auto;
    font-family: var(--ere-font-family-mono);
    font-size: var(--ere-font-size-sm);
    line-height: 1.5;
    
    // Code element
    code {
      background: transparent;
      padding: 0;
      border-radius: 0;
      font-family: inherit;
      font-size: inherit;
      white-space: pre;
    }
  }
  
  // Line numbers support
  &.line-numbers {
    pre {
      padding-left: calc(var(--ere-spacing-4) + 3rem);
      
      &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 3rem;
        height: 100%;
        background: var(--ere-gray-100);
        border-right: 1px solid var(--ere-gray-300);
      }
    }
  }
}

// ============================================================================
// Dark Theme Support
// ============================================================================

[data-theme="dark"] {
  .code-block-container {
    background: var(--ere-gray-800);
    border-color: var(--ere-gray-600);
    
    .code-block-language {
      background: var(--ere-gray-700);
      color: var(--ere-gray-300);
    }
    
    .code-block-copy {
      background: var(--ere-gray-700);
      border-color: var(--ere-gray-600);
      color: var(--ere-gray-300);
      
      &:hover {
        background: var(--ere-gray-600);
        border-color: var(--ere-gray-500);
      }
      
      &:active {
        background: var(--ere-gray-500);
      }
    }
    
    &.line-numbers pre::before {
      background: var(--ere-gray-700);
      border-color: var(--ere-gray-600);
    }
  }
}

// ============================================================================
// Prism.js Theme Overrides
// ============================================================================

// Base token styles
.token {
  &.comment,
  &.prolog,
  &.doctype,
  &.cdata {
    color: var(--ere-gray-500);
    font-style: italic;
  }
  
  &.punctuation {
    color: var(--ere-gray-700);
  }
  
  &.property,
  &.tag,
  &.boolean,
  &.number,
  &.constant,
  &.symbol,
  &.deleted {
    color: #d73a49;
  }
  
  &.selector,
  &.attr-name,
  &.string,
  &.char,
  &.builtin,
  &.inserted {
    color: #032f62;
  }
  
  &.operator,
  &.entity,
  &.url,
  .language-css &.string,
  .style &.string {
    color: #d73a49;
  }
  
  &.atrule,
  &.attr-value,
  &.keyword {
    color: #d73a49;
  }
  
  &.function,
  &.class-name {
    color: #6f42c1;
  }
  
  &.regex,
  &.important,
  &.variable {
    color: #e36209;
  }
}

// Dark theme token styles
[data-theme="dark"] {
  .token {
    &.comment,
    &.prolog,
    &.doctype,
    &.cdata {
      color: var(--ere-gray-400);
    }
    
    &.punctuation {
      color: var(--ere-gray-300);
    }
    
    &.property,
    &.tag,
    &.boolean,
    &.number,
    &.constant,
    &.symbol,
    &.deleted {
      color: #ff7b72;
    }
    
    &.selector,
    &.attr-name,
    &.string,
    &.char,
    &.builtin,
    &.inserted {
      color: #a5d6ff;
    }
    
    &.operator,
    &.entity,
    &.url,
    .language-css &.string,
    .style &.string {
      color: #ff7b72;
    }
    
    &.atrule,
    &.attr-value,
    &.keyword {
      color: #ff7b72;
    }
    
    &.function,
    &.class-name {
      color: #d2a8ff;
    }
    
    &.regex,
    &.important,
    &.variable {
      color: #ffa657;
    }
  }
}

// ============================================================================
// Line Numbers Plugin Support
// ============================================================================

.line-numbers {
  position: relative;
  padding-left: 3.8em;
  counter-reset: linenumber;
  
  > code {
    position: relative;
    white-space: inherit;
  }
  
  .line-numbers-rows {
    position: absolute;
    pointer-events: none;
    top: 0;
    font-size: 100%;
    left: -3.8em;
    width: 3em;
    letter-spacing: -1px;
    border-right: 1px solid var(--ere-gray-300);
    user-select: none;
    
    > span {
      display: block;
      counter-increment: linenumber;
      
      &:before {
        content: counter(linenumber);
        color: var(--ere-gray-500);
        display: block;
        padding-right: 0.8em;
        text-align: right;
      }
    }
  }
}

[data-theme="dark"] {
  .line-numbers .line-numbers-rows {
    border-color: var(--ere-gray-600);
    
    > span:before {
      color: var(--ere-gray-400);
    }
  }
}

// ============================================================================
// Responsive Design
// ============================================================================

@media (max-width: $breakpoint-md) {
  .code-block-container {
    margin: var(--ere-spacing-3) 0;
    
    .code-block-language,
    .code-block-copy {
      font-size: 0.75rem;
      padding: 0.125rem 0.375rem;
    }
    
    pre {
      padding: var(--ere-spacing-3);
      padding-top: calc(var(--ere-spacing-3) + 1.25rem);
      font-size: 0.75rem;
    }
    
    &.line-numbers pre {
      padding-left: calc(var(--ere-spacing-3) + 2.5rem);
      
      &::before {
        width: 2.5rem;
      }
    }
  }
}

// ============================================================================
// Print Styles
// ============================================================================

@media print {
  .code-block-container {
    .code-block-copy {
      display: none !important;
    }
    
    pre {
      white-space: pre-wrap;
      word-break: break-word;
    }
  }
}
