<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图片编辑功能测试</title>
  <link rel="stylesheet" href="./dist/editor.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      margin-top: 0;
      color: #333;
    }
    
    .instructions {
      background: #e8f4fd;
      border-left: 4px solid #2196F3;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    
    .instructions h3 {
      margin-top: 0;
      color: #1976D2;
    }
    
    .instructions ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    
    .instructions li {
      margin: 5px 0;
    }
    
    .editor-container {
      min-height: 400px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .test-buttons {
      margin: 20px 0;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    button {
      padding: 8px 16px;
      background: #2196F3;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    button:hover {
      background: #1976D2;
    }
    
    .console-output {
      background: #f0f0f0;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
    }
    
    .console-output .log-entry {
      margin: 2px 0;
    }
    
    .console-output .log-info {
      color: #2196F3;
    }
    
    .console-output .log-success {
      color: #4CAF50;
    }
    
    .console-output .log-warning {
      color: #FF9800;
    }
    
    .console-output .log-error {
      color: #F44336;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🖼️ 图片编辑功能测试</h1>
    
    <div class="instructions">
      <h3>使用说明：</h3>
      <ul>
        <li><strong>点击图片</strong>：选中图片并显示调整大小的手柄</li>
        <li><strong>拖动手柄</strong>：调整图片尺寸（角点保持比例，边缘自由调整）</li>
        <li><strong>右键点击图片</strong>：打开功能菜单</li>
        <li><strong>双击图片</strong>：打开属性对话框</li>
      </ul>
      <h3>右键菜单功能：</h3>
      <ul>
        <li>🎨 <strong>滤镜效果</strong>：黑白、复古、模糊、增亮、对比度、反色</li>
        <li>📐 <strong>尺寸调整</strong>：预设尺寸或自定义大小</li>
        <li>↔️ <strong>对齐方式</strong>：左对齐、居中、右对齐</li>
        <li>📝 <strong>文字环绕</strong>：无环绕、左侧环绕、右侧环绕</li>
        <li>🖼️ <strong>边框样式</strong>：细边框、中等、粗边框、圆角</li>
        <li>🌑 <strong>阴影效果</strong>：小、中、大阴影</li>
      </ul>
    </div>
    
    <div class="test-buttons">
      <button onclick="insertTestImage()">插入测试图片</button>
      <button onclick="insertRandomImage()">插入随机图片</button>
      <button onclick="insertMultipleImages()">插入多张图片</button>
      <button onclick="clearEditor()">清空编辑器</button>
      <button onclick="checkPluginStatus()">检查插件状态</button>
      <button onclick="clearConsole()">清空控制台</button>
    </div>
    
    <div id="editor" class="editor-container"></div>
    
    <div id="console" class="console-output">
      <div class="log-entry log-info">控制台输出...</div>
    </div>
  </div>

  <script type="module">
    // 导入编辑器
    import { Editor } from './dist/editor.es.js';
    
    // 日志输出函数
    function log(message, type = 'info') {
      const consoleDiv = document.getElementById('console');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      consoleDiv.appendChild(entry);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
      
      // 同时输出到浏览器控制台
      console.log(message);
    }
    
    // 清空控制台
    window.clearConsole = function() {
      document.getElementById('console').innerHTML = '<div class="log-entry log-info">控制台已清空</div>';
    };
    
    // 初始化编辑器
    log('正在初始化编辑器...', 'info');
    
    const editor = new Editor({
      element: '#editor',
      placeholder: '开始输入内容，或点击上方按钮插入图片...',
      autofocus: false,
      plugins: 'all',
      content: '<p>欢迎使用图片编辑功能！请点击上方按钮插入图片进行测试。</p>'
    });
    
    // 将编辑器实例暴露到全局
    window.editor = editor;
    
    log('编辑器初始化完成', 'success');
    
    // 监听编辑器事件
    const editorElement = document.querySelector('#editor .ldesign-editor-content');
    
    if (editorElement) {
      // 监听点击事件
      editorElement.addEventListener('click', (e) => {
        if (e.target.tagName === 'IMG') {
          log(`点击了图片: ${e.target.src.substring(0, 50)}...`, 'info');
        }
      });
      
      // 监听右键事件
      editorElement.addEventListener('contextmenu', (e) => {
        if (e.target.tagName === 'IMG') {
          log(`右键点击图片: ${e.target.src.substring(0, 50)}...`, 'info');
        }
      });
      
      // 监听双击事件
      editorElement.addEventListener('dblclick', (e) => {
        if (e.target.tagName === 'IMG') {
          log(`双击了图片: ${e.target.src.substring(0, 50)}...`, 'info');
        }
      });
    }
    
    // 插入测试图片
    window.insertTestImage = function() {
      const html = `<img src="https://picsum.photos/400/300" alt="测试图片" title="这是一张测试图片">`;
      editor.insertHTML(html);
      log('已插入测试图片', 'success');
    };
    
    // 插入随机图片
    window.insertRandomImage = function() {
      const width = 300 + Math.floor(Math.random() * 200);
      const height = 200 + Math.floor(Math.random() * 200);
      const html = `<img src="https://picsum.photos/${width}/${height}?random=${Date.now()}" alt="随机图片">`;
      editor.insertHTML(html);
      log(`已插入随机图片 (${width}x${height})`, 'success');
    };
    
    // 插入多张图片
    window.insertMultipleImages = function() {
      const html = `
        <p>以下是多张不同样式的图片：</p>
        <img src="https://picsum.photos/300/200?random=1" alt="图片1" style="margin: 10px;">
        <img src="https://picsum.photos/250/250?random=2" alt="图片2" style="margin: 10px; border: 2px solid blue;">
        <img src="https://picsum.photos/350/200?random=3" alt="图片3" style="margin: 10px; filter: grayscale(100%);">
      `;
      editor.insertHTML(html);
      log('已插入多张图片', 'success');
    };
    
    // 清空编辑器
    window.clearEditor = function() {
      editor.setContent('<p>编辑器内容已清空</p>');
      log('编辑器已清空', 'warning');
    };
    
    // 检查插件状态
    window.checkPluginStatus = function() {
      log('检查插件状态...', 'info');
      
      // 检查插件管理器
      if (editor.plugins) {
        const allPlugins = editor.plugins.getAll();
        log(`已加载 ${allPlugins.length} 个插件`, 'success');
        
        // 查找特定插件
        const imageResizePlugin = editor.plugins.get('imageResize');
        const mediaContextMenuPlugin = editor.plugins.get('MediaContextMenu');
        
        if (imageResizePlugin) {
          log('✓ ImageResizePlugin 已加载', 'success');
        } else {
          log('✗ ImageResizePlugin 未找到', 'error');
        }
        
        if (mediaContextMenuPlugin) {
          log('✓ MediaContextMenuPlugin 已加载', 'success');
        } else {
          log('✗ MediaContextMenuPlugin 未找到', 'error');
        }
        
        // 列出所有插件名称
        allPlugins.forEach(plugin => {
          log(`  - ${plugin.name}`, 'info');
        });
      } else {
        log('插件管理器不可用', 'error');
      }
      
      // 检查命令
      const commands = editor.commands.getCommands();
      log(`已注册 ${Object.keys(commands).length} 个命令`, 'info');
      
      // 检查媒体相关命令
      if (commands.insertImage) {
        log('✓ insertImage 命令已注册', 'success');
      }
      if (commands.insertVideo) {
        log('✓ insertVideo 命令已注册', 'success');
      }
      if (commands.insertAudio) {
        log('✓ insertAudio 命令已注册', 'success');
      }
    };
    
    // 初始状态检查
    setTimeout(() => {
      checkPluginStatus();
    }, 1000);
  </script>
</body>
</html>