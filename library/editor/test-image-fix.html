<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½æµ‹è¯•</title>
  <link rel="stylesheet" href="./dist/index.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    
    #editor {
      border: 1px solid #ddd;
      border-radius: 8px;
      min-height: 500px;
      padding: 20px;
      background: white;
    }
    
    .test-info {
      background: #f0f9ff;
      border: 1px solid #bae6fd;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .test-info h2 {
      margin-top: 0;
      color: #0369a1;
    }
    
    .test-info ul {
      margin-bottom: 0;
      line-height: 1.8;
    }
    
    .console-output {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 6px;
      margin-top: 20px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 13px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .console-line {
      margin-bottom: 5px;
    }
    
    .console-line.info {
      color: #58a6ff;
    }
    
    .console-line.success {
      color: #7ee83f;
    }
    
    .console-line.error {
      color: #f85149;
    }
  </style>
</head>
<body>
  <h1>ğŸ“¸ å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½æµ‹è¯•</h1>
  
  <div class="test-info">
    <h2>æµ‹è¯•è¯´æ˜</h2>
    <ul>
      <li><strong>æ’å…¥å›¾ç‰‡ï¼š</strong> åœ¨ç¼–è¾‘å™¨ä¸­ç²˜è´´å›¾ç‰‡URLæˆ–ä½¿ç”¨å·¥å…·æ æ’å…¥</li>
      <li><strong>å³é”®èœå•ï¼š</strong> å³é”®ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹ç¼–è¾‘èœå•</li>
      <li><strong>æ»¤é•œæ•ˆæœï¼š</strong> é€‰æ‹©æ»¤é•œé€‰é¡¹ï¼Œå›¾ç‰‡åº”ç«‹å³åº”ç”¨æ•ˆæœ</li>
      <li><strong>è°ƒæ•´å¤§å°ï¼š</strong> é€‰æ‹©å¤§å°é€‰é¡¹ï¼Œå›¾ç‰‡åº”ç«‹å³è°ƒæ•´</li>
      <li><strong>å¯¹é½æ–¹å¼ï¼š</strong> é€‰æ‹©å¯¹é½é€‰é¡¹ï¼Œå›¾ç‰‡åº”ç«‹å³æ”¹å˜ä½ç½®</li>
    </ul>
  </div>
  
  <div id="editor" class="ldesign-editor-content" contenteditable="true">
    <p>è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç¼–è¾‘å™¨ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å›¾ç‰‡å¹¶æµ‹è¯•ç¼–è¾‘åŠŸèƒ½ã€‚</p>
    
    <p>ä¸‹é¢æ˜¯ä¸€å¼ ç¤ºä¾‹å›¾ç‰‡ï¼Œå³é”®ç‚¹å‡»å®ƒæµ‹è¯•åŠŸèƒ½ï¼š</p>
    
    <div class="ldesign-image-wrapper" style="display: inline-block;">
      <img src="https://picsum.photos/600/400?random=1" alt="æµ‹è¯•å›¾ç‰‡" style="max-width: 100%; height: auto;">
    </div>
    
    <p>ä½ ä¹Ÿå¯ä»¥æ·»åŠ æ›´å¤šå›¾ç‰‡è¿›è¡Œæµ‹è¯•ã€‚</p>
  </div>
  
  <div class="console-output" id="console">
    <div class="console-line info">æ§åˆ¶å°è¾“å‡ºï¼š</div>
  </div>
  
  <script type="module">
    // å¯¼å…¥å›¾ç‰‡å¢å¼ºæ’ä»¶
    import { ImageWrapper } from './src/plugins/image-enhanced.js';
    import { getImageContextMenu } from './src/components/ImageContextMenu.js';
    
    // æ•è·æ§åˆ¶å°è¾“å‡º
    const consoleOutput = document.getElementById('console');
    const originalLog = console.log;
    const originalError = console.error;
    
    console.log = function(...args) {
      originalLog.apply(console, args);
      const line = document.createElement('div');
      line.className = 'console-line success';
      line.textContent = 'âœ“ ' + args.join(' ');
      consoleOutput.appendChild(line);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    };
    
    console.error = function(...args) {
      originalError.apply(console, args);
      const line = document.createElement('div');
      line.className = 'console-line error';
      line.textContent = 'âœ— ' + args.join(' ');
      consoleOutput.appendChild(line);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    };
    
    // åˆå§‹åŒ–ç¼–è¾‘å™¨
    const editor = document.getElementById('editor');
    
    // ä¸ºç°æœ‰å›¾ç‰‡æ·»åŠ å¢å¼ºåŠŸèƒ½
    function enhanceImages() {
      const images = editor.querySelectorAll('img');
      images.forEach(img => {
        if (!img.closest('.ldesign-image-wrapper')) {
          new ImageWrapper(img);
          console.log('å›¾ç‰‡å·²å¢å¼º:', img.src);
        }
      });
    }
    
    // åˆå§‹åŒ–
    enhanceImages();
    
    // ç›‘å¬æ–°å›¾ç‰‡æ’å…¥
    const observer = new MutationObserver((mutations) => {
      mutations.forEach(mutation => {
        mutation.addedNodes.forEach(node => {
          if (node.nodeName === 'IMG') {
            new ImageWrapper(node);
            console.log('æ–°å›¾ç‰‡å·²å¢å¼º:', node.src);
          } else if (node.querySelectorAll) {
            const imgs = node.querySelectorAll('img');
            imgs.forEach(img => {
              if (!img.closest('.ldesign-image-wrapper')) {
                new ImageWrapper(img);
                console.log('æ–°å›¾ç‰‡å·²å¢å¼º:', img.src);
              }
            });
          }
        });
      });
    });
    
    observer.observe(editor, {
      childList: true,
      subtree: true
    });
    
    console.log('ç¼–è¾‘å™¨å·²åˆå§‹åŒ–ï¼Œå›¾ç‰‡ç¼–è¾‘åŠŸèƒ½å·²å¯ç”¨');
    
    // æµ‹è¯•æ»¤é•œåŠŸèƒ½
    window.testFilter = function(filterName) {
      const wrapper = document.querySelector('.ldesign-image-wrapper.active');
      if (wrapper) {
        const img = wrapper.querySelector('img');
        if (img) {
          // ç›´æ¥åº”ç”¨æ»¤é•œ
          switch(filterName) {
            case 'blur':
              img.style.filter = 'blur(4px)';
              break;
            case 'grayscale':
              img.style.filter = 'grayscale(1)';
              break;
            case 'sepia':
              img.style.filter = 'sepia(1)';
              break;
            case 'brightness':
              img.style.filter = 'brightness(1.3)';
              break;
            case 'none':
              img.style.filter = '';
              break;
          }
          console.log('æ»¤é•œå·²åº”ç”¨:', filterName);
        }
      } else {
        console.error('è¯·å…ˆç‚¹å‡»é€‰ä¸­ä¸€å¼ å›¾ç‰‡');
      }
    };
    
    // æµ‹è¯•å¤§å°è°ƒæ•´
    window.testSize = function(size) {
      const wrapper = document.querySelector('.ldesign-image-wrapper.active');
      if (wrapper) {
        const img = wrapper.querySelector('img');
        if (img) {
          img.style.width = size;
          img.style.height = 'auto';
          wrapper.style.width = size;
          console.log('å›¾ç‰‡å¤§å°å·²è°ƒæ•´ä¸º:', size);
        }
      } else {
        console.error('è¯·å…ˆç‚¹å‡»é€‰ä¸­ä¸€å¼ å›¾ç‰‡');
      }
    };
    
    // æ·»åŠ å¿«æ·æµ‹è¯•æŒ‰é’®
    const testButtons = document.createElement('div');
    testButtons.style.marginTop = '20px';
    testButtons.innerHTML = `
      <button onclick="testFilter('blur')">æµ‹è¯•æ¨¡ç³Š</button>
      <button onclick="testFilter('grayscale')">æµ‹è¯•é»‘ç™½</button>
      <button onclick="testFilter('sepia')">æµ‹è¯•è¤è‰²</button>
      <button onclick="testFilter('brightness')">æµ‹è¯•å¢äº®</button>
      <button onclick="testFilter('none')">æ¸…é™¤æ»¤é•œ</button>
      <button onclick="testSize('50%')">50%å¤§å°</button>
      <button onclick="testSize('75%')">75%å¤§å°</button>
      <button onclick="testSize('100%')">100%å¤§å°</button>
    `;
    document.body.appendChild(testButtons);
  </script>
</body>
</html>