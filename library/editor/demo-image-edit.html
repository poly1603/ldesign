<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图片编辑功能完整演示 - LDesign Editor</title>
  <link rel="stylesheet" href="./dist/editor.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
    }
    
    .editor-wrapper {
      padding: 30px;
    }
    
    #editor {
      min-height: 500px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      background: white;
    }
    
    /* 确保编辑器内的图片样式正确 */
    #editor .ldesign-editor-content {
      padding: 20px;
    }
    
    #editor .ldesign-editor-content img {
      max-width: 100%;
      cursor: pointer;
      /* 默认左对齐 */
      display: inline-block;
      vertical-align: top;
    }
    
    /* 自定义右键菜单样式 */
    .custom-context-menu {
      position: fixed;
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      padding: 4px 0;
      min-width: 200px;
      z-index: 10000;
      display: none;
      font-size: 14px;
    }
    
    .custom-context-menu.show {
      display: block;
    }
    
    .menu-item {
      padding: 8px 16px 8px 40px;
      cursor: pointer;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .menu-item:hover {
      background: #f5f5f5;
    }
    
    .menu-item.has-submenu::after {
      content: '▶';
      position: absolute;
      right: 10px;
      font-size: 10px;
      color: #999;
    }
    
    .menu-item-icon {
      position: absolute;
      left: 12px;
      font-size: 16px;
    }
    
    .menu-separator {
      height: 1px;
      background: #e0e0e0;
      margin: 4px 0;
    }
    
    .submenu {
      position: absolute;
      left: 100%;
      top: 0;
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      padding: 4px 0;
      min-width: 180px;
      display: none;
    }
    
    .menu-item:hover .submenu {
      display: block;
    }
    
    .toolbar {
      background: #f8fafc;
      padding: 15px 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 8px 16px;
      background: white;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }
    
    .btn:hover {
      background: #f1f5f9;
      border-color: #94a3b8;
      transform: translateY(-1px);
    }
    
    .btn-primary {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    
    .btn-primary:hover {
      background: #2563eb;
    }
    
    /* 图片调整大小覆盖层样式 */
    .image-resize-overlay {
      position: absolute;
      border: 2px solid #3b82f6;
      pointer-events: none;
      z-index: 9999;
    }
    
    .image-resize-handle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: white;
      border: 2px solid #3b82f6;
      border-radius: 2px;
      pointer-events: all;
      cursor: pointer;
    }
    
    .handle-nw { top: -5px; left: -5px; cursor: nw-resize; }
    .handle-n { top: -5px; left: 50%; transform: translateX(-50%); cursor: n-resize; }
    .handle-ne { top: -5px; right: -5px; cursor: ne-resize; }
    .handle-e { top: 50%; right: -5px; transform: translateY(-50%); cursor: e-resize; }
    .handle-se { bottom: -5px; right: -5px; cursor: se-resize; }
    .handle-s { bottom: -5px; left: 50%; transform: translateX(-50%); cursor: s-resize; }
    .handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; }
    .handle-w { top: 50%; left: -5px; transform: translateY(-50%); cursor: w-resize; }
    
    .image-resize-dimensions {
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🖼️ 图片编辑功能完整演示</h1>
      <p>点击图片调整大小 • 右键打开功能菜单 • 支持滤镜、对齐、文字环绕等</p>
    </div>
    
    <div class="editor-wrapper">
      <div class="toolbar">
        <button class="btn" onclick="insertImage()">
          <span>🖼️</span> 插入图片
        </button>
        <button class="btn" onclick="insertMultipleImages()">
          <span>📸</span> 插入多张图片
        </button>
        <button class="btn" onclick="insertImageWithFloat()">
          <span>📝</span> 文字环绕示例
        </button>
        <button class="btn" onclick="clearEditor()">
          <span>🗑️</span> 清空
        </button>
      </div>
      
      <div id="editor"></div>
    </div>
  </div>

  <!-- 自定义右键菜单 -->
  <div id="contextMenu" class="custom-context-menu">
    <!-- 菜单内容将通过 JavaScript 动态生成 -->
  </div>

  <script type="module">
    import { Editor } from './dist/editor.es.js';
    
    // 初始化编辑器
    const editor = new Editor({
      element: '#editor',
      placeholder: '开始输入内容...',
      content: `
        <h2>欢迎使用 LDesign Editor!</h2>
        <p>这是一个功能强大的富文本编辑器，支持多种文本格式和功能。</p>
        <img src="https://picsum.photos/400/300?random=1" alt="示例图片" style="margin: 10px 0;">
        <p>点击图片可以调整大小，右键图片可以打开功能菜单。</p>
      `
    });
    
    window.editor = editor;
    
    // 自定义右键菜单实现
    class CustomContextMenu {
      constructor() {
        this.menu = document.getElementById('contextMenu');
        this.currentTarget = null;
        this.init();
      }
      
      init() {
        // 监听右键事件
        document.querySelector('#editor').addEventListener('contextmenu', (e) => {
          if (e.target.tagName === 'IMG') {
            e.preventDefault();
            e.stopPropagation();
            this.show(e.clientX, e.clientY, e.target);
          } else {
            this.hide();
          }
        });
        
        // 点击其他地方隐藏菜单
        document.addEventListener('click', () => {
          this.hide();
        });
      }
      
      show(x, y, target) {
        this.currentTarget = target;
        this.menu.innerHTML = this.generateMenuHTML();
        this.menu.classList.add('show');
        
        // 定位菜单
        this.menu.style.left = x + 'px';
        this.menu.style.top = y + 'px';
        
        // 确保菜单不超出视口
        const rect = this.menu.getBoundingClientRect();
        if (rect.right > window.innerWidth) {
          this.menu.style.left = (x - rect.width) + 'px';
        }
        if (rect.bottom > window.innerHeight) {
          this.menu.style.top = (y - rect.height) + 'px';
        }
        
        this.bindMenuEvents();
      }
      
      hide() {
        this.menu.classList.remove('show');
      }
      
      generateMenuHTML() {
        return `
          <div class="menu-item" data-action="resize-small">
            <span class="menu-item-icon">📏</span>
            调整大小
          </div>
          <div class="menu-separator"></div>
          <div class="menu-item has-submenu">
            <span class="menu-item-icon">↔️</span>
            对齐方式
            <div class="submenu">
              <div class="menu-item" data-action="align-left">左对齐</div>
              <div class="menu-item" data-action="align-center">居中</div>
              <div class="menu-item" data-action="align-right">右对齐</div>
            </div>
          </div>
          <div class="menu-item has-submenu">
            <span class="menu-item-icon">🎨</span>
            滤镜效果
            <div class="submenu">
              <div class="menu-item" data-action="filter-none">无滤镜</div>
              <div class="menu-separator"></div>
              <div class="menu-item" data-action="filter-grayscale">黑白</div>
              <div class="menu-item" data-action="filter-sepia">复古</div>
              <div class="menu-item" data-action="filter-blur">模糊</div>
              <div class="menu-item" data-action="filter-brightness">增亮</div>
              <div class="menu-item" data-action="filter-contrast">对比度增强</div>
              <div class="menu-item" data-action="filter-invert">反色</div>
            </div>
          </div>
          <div class="menu-item has-submenu">
            <span class="menu-item-icon">📝</span>
            文字环绕
            <div class="submenu">
              <div class="menu-item" data-action="float-none">无环绕</div>
              <div class="menu-item" data-action="float-left">左侧环绕</div>
              <div class="menu-item" data-action="float-right">右侧环绕</div>
            </div>
          </div>
          <div class="menu-separator"></div>
          <div class="menu-item" data-action="copy">
            <span class="menu-item-icon">📋</span>
            复制图片
          </div>
          <div class="menu-item" data-action="replace">
            <span class="menu-item-icon">🔄</span>
            替换图片
          </div>
          <div class="menu-separator"></div>
          <div class="menu-item" data-action="properties">
            <span class="menu-item-icon">ℹ️</span>
            图片属性
          </div>
          <div class="menu-item" data-action="delete">
            <span class="menu-item-icon">🗑️</span>
            删除
          </div>
        `;
      }
      
      bindMenuEvents() {
        this.menu.querySelectorAll('[data-action]').forEach(item => {
          item.addEventListener('click', (e) => {
            e.stopPropagation();
            const action = item.dataset.action;
            this.handleAction(action);
            this.hide();
          });
        });
      }
      
      handleAction(action) {
        if (!this.currentTarget) return;
        
        switch(action) {
          // 对齐方式
          case 'align-left':
            this.currentTarget.style.display = 'block';
            this.currentTarget.style.marginLeft = '0';
            this.currentTarget.style.marginRight = 'auto';
            break;
          case 'align-center':
            this.currentTarget.style.display = 'block';
            this.currentTarget.style.marginLeft = 'auto';
            this.currentTarget.style.marginRight = 'auto';
            break;
          case 'align-right':
            this.currentTarget.style.display = 'block';
            this.currentTarget.style.marginLeft = 'auto';
            this.currentTarget.style.marginRight = '0';
            break;
            
          // 滤镜效果
          case 'filter-none':
            this.currentTarget.style.filter = 'none';
            break;
          case 'filter-grayscale':
            this.currentTarget.style.filter = 'grayscale(100%)';
            break;
          case 'filter-sepia':
            this.currentTarget.style.filter = 'sepia(100%)';
            break;
          case 'filter-blur':
            this.currentTarget.style.filter = 'blur(3px)';
            break;
          case 'filter-brightness':
            this.currentTarget.style.filter = 'brightness(1.5)';
            break;
          case 'filter-contrast':
            this.currentTarget.style.filter = 'contrast(1.5)';
            break;
          case 'filter-invert':
            this.currentTarget.style.filter = 'invert(100%)';
            break;
            
          // 文字环绕
          case 'float-none':
            this.currentTarget.style.float = 'none';
            this.currentTarget.style.margin = '10px 0';
            break;
          case 'float-left':
            this.currentTarget.style.float = 'left';
            this.currentTarget.style.margin = '0 20px 20px 0';
            break;
          case 'float-right':
            this.currentTarget.style.float = 'right';
            this.currentTarget.style.margin = '0 0 20px 20px';
            break;
            
          // 其他操作
          case 'delete':
            this.currentTarget.remove();
            break;
          case 'properties':
            const alt = prompt('请输入图片描述 (Alt):', this.currentTarget.alt || '');
            if (alt !== null) {
              this.currentTarget.alt = alt;
            }
            const title = prompt('请输入图片标题 (Title):', this.currentTarget.title || '');
            if (title !== null) {
              this.currentTarget.title = title;
            }
            break;
          case 'replace':
            const newSrc = prompt('请输入新的图片URL:', '');
            if (newSrc) {
              this.currentTarget.src = newSrc;
            }
            break;
          case 'copy':
            // 复制图片URL到剪贴板
            navigator.clipboard.writeText(this.currentTarget.src);
            alert('图片URL已复制到剪贴板');
            break;
          case 'resize-small':
            const width = prompt('请输入图片宽度 (像素):', this.currentTarget.width || 'auto');
            if (width !== null) {
              this.currentTarget.style.width = isNaN(width) ? width : width + 'px';
            }
            break;
        }
      }
    }
    
    // 初始化右键菜单
    const contextMenu = new CustomContextMenu();
    
    // 图片调整大小功能
    class ImageResizer {
      constructor() {
        this.currentImage = null;
        this.isResizing = false;
        this.startX = 0;
        this.startY = 0;
        this.startWidth = 0;
        this.startHeight = 0;
        this.handle = '';
        this.overlay = null;
        this.init();
      }
      
      init() {
        const editorContent = document.querySelector('#editor .ldesign-editor-content');
        if (!editorContent) return;
        
        // 点击图片显示调整手柄
        editorContent.addEventListener('click', (e) => {
          if (e.target.tagName === 'IMG') {
            this.showResizeHandles(e.target);
          } else {
            this.hideResizeHandles();
          }
        });
        
        // 鼠标移动
        document.addEventListener('mousemove', (e) => {
          if (this.isResizing) {
            this.resize(e);
          }
        });
        
        // 鼠标释放
        document.addEventListener('mouseup', () => {
          this.isResizing = false;
        });
      }
      
      showResizeHandles(img) {
        this.hideResizeHandles();
        this.currentImage = img;
        
        // 创建覆盖层
        this.overlay = document.createElement('div');
        this.overlay.className = 'image-resize-overlay';
        
        // 创建8个调整手柄
        const handles = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];
        handles.forEach(handle => {
          const handleEl = document.createElement('div');
          handleEl.className = `image-resize-handle handle-${handle}`;
          handleEl.addEventListener('mousedown', (e) => {
            e.preventDefault();
            this.startResize(e, handle);
          });
          this.overlay.appendChild(handleEl);
        });
        
        // 添加尺寸显示
        const dimensions = document.createElement('div');
        dimensions.className = 'image-resize-dimensions';
        dimensions.textContent = `${img.width} × ${img.height}`;
        this.overlay.appendChild(dimensions);
        
        // 定位覆盖层
        this.updateOverlayPosition();
        
        // 添加到页面
        document.body.appendChild(this.overlay);
      }
      
      hideResizeHandles() {
        if (this.overlay) {
          this.overlay.remove();
          this.overlay = null;
        }
        this.currentImage = null;
      }
      
      updateOverlayPosition() {
        if (!this.overlay || !this.currentImage) return;
        
        const rect = this.currentImage.getBoundingClientRect();
        this.overlay.style.left = rect.left + window.scrollX + 'px';
        this.overlay.style.top = rect.top + window.scrollY + 'px';
        this.overlay.style.width = rect.width + 'px';
        this.overlay.style.height = rect.height + 'px';
      }
      
      startResize(e, handle) {
        this.isResizing = true;
        this.handle = handle;
        this.startX = e.clientX;
        this.startY = e.clientY;
        this.startWidth = this.currentImage.width;
        this.startHeight = this.currentImage.height;
      }
      
      resize(e) {
        if (!this.currentImage) return;
        
        const dx = e.clientX - this.startX;
        const dy = e.clientY - this.startY;
        
        let newWidth = this.startWidth;
        let newHeight = this.startHeight;
        
        // 根据手柄位置计算新尺寸
        if (this.handle.includes('e')) newWidth = this.startWidth + dx;
        if (this.handle.includes('w')) newWidth = this.startWidth - dx;
        if (this.handle.includes('s')) newHeight = this.startHeight + dy;
        if (this.handle.includes('n')) newHeight = this.startHeight - dy;
        
        // 限制最小尺寸
        newWidth = Math.max(50, newWidth);
        newHeight = Math.max(50, newHeight);
        
        // 应用新尺寸
        this.currentImage.width = newWidth;
        this.currentImage.height = newHeight;
        
        // 更新覆盖层
        this.updateOverlayPosition();
        
        // 更新尺寸显示
        const dimensions = this.overlay.querySelector('.image-resize-dimensions');
        if (dimensions) {
          dimensions.textContent = `${newWidth} × ${newHeight}`;
        }
      }
    }
    
    // 初始化图片调整大小功能
    const imageResizer = new ImageResizer();
    
    // 工具函数
    window.insertImage = function() {
      const url = prompt('请输入图片URL:', 'https://picsum.photos/400/300?random=' + Date.now());
      if (url) {
        editor.insertHTML(`<img src="${url}" alt="插入的图片">`);
      }
    };
    
    window.insertMultipleImages = function() {
      const html = `
        <p>多张图片展示：</p>
        <img src="https://picsum.photos/300/200?random=${Date.now()}" alt="图片1" style="margin: 10px;">
        <img src="https://picsum.photos/300/200?random=${Date.now()+1}" alt="图片2" style="margin: 10px;">
        <img src="https://picsum.photos/300/200?random=${Date.now()+2}" alt="图片3" style="margin: 10px;">
      `;
      editor.insertHTML(html);
    };
    
    window.insertImageWithFloat = function() {
      const html = `
        <h3>文字环绕效果示例</h3>
        <img src="https://picsum.photos/200/200?random=${Date.now()}" alt="左浮动图片" style="float: left; margin: 0 20px 20px 0;">
        <p>这是一段示例文字，展示了图片左浮动时的文字环绕效果。当图片设置为左浮动后，文字会自动环绕在图片的右侧和下方。这种布局方式常用于文章配图，可以让内容更加生动有趣。你可以右键点击图片，选择不同的环绕方式来改变布局效果。</p>
        <p>继续添加更多文字内容，以便更好地展示文字环绕的效果。文字会根据图片的位置自动调整排版，形成美观的布局。</p>
        <div style="clear: both;"></div>
      `;
      editor.insertHTML(html);
    };
    
    window.clearEditor = function() {
      if (confirm('确定要清空编辑器内容吗？')) {
        editor.setContent('<p>编辑器已清空</p>');
      }
    };
  </script>
</body>
</html>