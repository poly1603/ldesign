<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½å®Œæ•´æ¼”ç¤º - LDesign Editor</title>
  <link rel="stylesheet" href="./dist/editor.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
    }
    
    .editor-wrapper {
      padding: 30px;
    }
    
    #editor {
      min-height: 500px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      background: white;
    }
    
    /* ç¡®ä¿ç¼–è¾‘å™¨å†…çš„å›¾ç‰‡æ ·å¼æ­£ç¡® */
    #editor .ldesign-editor-content {
      padding: 20px;
    }
    
    #editor .ldesign-editor-content img {
      max-width: 100%;
      cursor: pointer;
      /* é»˜è®¤å·¦å¯¹é½ */
      display: inline-block;
      vertical-align: top;
    }
    
    /* è‡ªå®šä¹‰å³é”®èœå•æ ·å¼ */
    .custom-context-menu {
      position: fixed;
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      padding: 4px 0;
      min-width: 200px;
      z-index: 10000;
      display: none;
      font-size: 14px;
    }
    
    .custom-context-menu.show {
      display: block;
    }
    
    .menu-item {
      padding: 8px 16px 8px 40px;
      cursor: pointer;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .menu-item:hover {
      background: #f5f5f5;
    }
    
    .menu-item.has-submenu::after {
      content: 'â–¶';
      position: absolute;
      right: 10px;
      font-size: 10px;
      color: #999;
    }
    
    .menu-item-icon {
      position: absolute;
      left: 12px;
      font-size: 16px;
    }
    
    .menu-separator {
      height: 1px;
      background: #e0e0e0;
      margin: 4px 0;
    }
    
    .submenu {
      position: absolute;
      left: 100%;
      top: 0;
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      padding: 4px 0;
      min-width: 180px;
      display: none;
    }
    
    .menu-item:hover .submenu {
      display: block;
    }
    
    .toolbar {
      background: #f8fafc;
      padding: 15px 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 8px 16px;
      background: white;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }
    
    .btn:hover {
      background: #f1f5f9;
      border-color: #94a3b8;
      transform: translateY(-1px);
    }
    
    .btn-primary {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    
    .btn-primary:hover {
      background: #2563eb;
    }
    
    /* å›¾ç‰‡è°ƒæ•´å¤§å°è¦†ç›–å±‚æ ·å¼ */
    .image-resize-overlay {
      position: absolute;
      border: 2px solid #3b82f6;
      pointer-events: none;
      z-index: 9999;
    }
    
    .image-resize-handle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: white;
      border: 2px solid #3b82f6;
      border-radius: 2px;
      pointer-events: all;
      cursor: pointer;
    }
    
    .handle-nw { top: -5px; left: -5px; cursor: nw-resize; }
    .handle-n { top: -5px; left: 50%; transform: translateX(-50%); cursor: n-resize; }
    .handle-ne { top: -5px; right: -5px; cursor: ne-resize; }
    .handle-e { top: 50%; right: -5px; transform: translateY(-50%); cursor: e-resize; }
    .handle-se { bottom: -5px; right: -5px; cursor: se-resize; }
    .handle-s { bottom: -5px; left: 50%; transform: translateX(-50%); cursor: s-resize; }
    .handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; }
    .handle-w { top: 50%; left: -5px; transform: translateY(-50%); cursor: w-resize; }
    
    .image-resize-dimensions {
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ–¼ï¸ å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½å®Œæ•´æ¼”ç¤º</h1>
      <p>ç‚¹å‡»å›¾ç‰‡è°ƒæ•´å¤§å° â€¢ å³é”®æ‰“å¼€åŠŸèƒ½èœå• â€¢ æ”¯æŒæ»¤é•œã€å¯¹é½ã€æ–‡å­—ç¯ç»•ç­‰</p>
    </div>
    
    <div class="editor-wrapper">
      <div class="toolbar">
        <button class="btn" onclick="insertImage()">
          <span>ğŸ–¼ï¸</span> æ’å…¥å›¾ç‰‡
        </button>
        <button class="btn" onclick="insertMultipleImages()">
          <span>ğŸ“¸</span> æ’å…¥å¤šå¼ å›¾ç‰‡
        </button>
        <button class="btn" onclick="insertImageWithFloat()">
          <span>ğŸ“</span> æ–‡å­—ç¯ç»•ç¤ºä¾‹
        </button>
        <button class="btn" onclick="clearEditor()">
          <span>ğŸ—‘ï¸</span> æ¸…ç©º
        </button>
      </div>
      
      <div id="editor"></div>
    </div>
  </div>

  <!-- è‡ªå®šä¹‰å³é”®èœå• -->
  <div id="contextMenu" class="custom-context-menu">
    <!-- èœå•å†…å®¹å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
  </div>

  <script type="module">
    import { Editor } from './dist/editor.es.js';
    
    // åˆå§‹åŒ–ç¼–è¾‘å™¨
    const editor = new Editor({
      element: '#editor',
      placeholder: 'å¼€å§‹è¾“å…¥å†…å®¹...',
      content: `
        <h2>æ¬¢è¿ä½¿ç”¨ LDesign Editor!</h2>
        <p>è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ”¯æŒå¤šç§æ–‡æœ¬æ ¼å¼å’ŒåŠŸèƒ½ã€‚</p>
        <img src="https://picsum.photos/400/300?random=1" alt="ç¤ºä¾‹å›¾ç‰‡" style="margin: 10px 0;">
        <p>ç‚¹å‡»å›¾ç‰‡å¯ä»¥è°ƒæ•´å¤§å°ï¼Œå³é”®å›¾ç‰‡å¯ä»¥æ‰“å¼€åŠŸèƒ½èœå•ã€‚</p>
      `
    });
    
    window.editor = editor;
    
    // è‡ªå®šä¹‰å³é”®èœå•å®ç°
    class CustomContextMenu {
      constructor() {
        this.menu = document.getElementById('contextMenu');
        this.currentTarget = null;
        this.init();
      }
      
      init() {
        // ç›‘å¬å³é”®äº‹ä»¶
        document.querySelector('#editor').addEventListener('contextmenu', (e) => {
          if (e.target.tagName === 'IMG') {
            e.preventDefault();
            e.stopPropagation();
            this.show(e.clientX, e.clientY, e.target);
          } else {
            this.hide();
          }
        });
        
        // ç‚¹å‡»å…¶ä»–åœ°æ–¹éšè—èœå•
        document.addEventListener('click', () => {
          this.hide();
        });
      }
      
      show(x, y, target) {
        this.currentTarget = target;
        this.menu.innerHTML = this.generateMenuHTML();
        this.menu.classList.add('show');
        
        // å®šä½èœå•
        this.menu.style.left = x + 'px';
        this.menu.style.top = y + 'px';
        
        // ç¡®ä¿èœå•ä¸è¶…å‡ºè§†å£
        const rect = this.menu.getBoundingClientRect();
        if (rect.right > window.innerWidth) {
          this.menu.style.left = (x - rect.width) + 'px';
        }
        if (rect.bottom > window.innerHeight) {
          this.menu.style.top = (y - rect.height) + 'px';
        }
        
        this.bindMenuEvents();
      }
      
      hide() {
        this.menu.classList.remove('show');
      }
      
      generateMenuHTML() {
        return `
          <div class="menu-item" data-action="resize-small">
            <span class="menu-item-icon">ğŸ“</span>
            è°ƒæ•´å¤§å°
          </div>
          <div class="menu-separator"></div>
          <div class="menu-item has-submenu">
            <span class="menu-item-icon">â†”ï¸</span>
            å¯¹é½æ–¹å¼
            <div class="submenu">
              <div class="menu-item" data-action="align-left">å·¦å¯¹é½</div>
              <div class="menu-item" data-action="align-center">å±…ä¸­</div>
              <div class="menu-item" data-action="align-right">å³å¯¹é½</div>
            </div>
          </div>
          <div class="menu-item has-submenu">
            <span class="menu-item-icon">ğŸ¨</span>
            æ»¤é•œæ•ˆæœ
            <div class="submenu">
              <div class="menu-item" data-action="filter-none">æ— æ»¤é•œ</div>
              <div class="menu-separator"></div>
              <div class="menu-item" data-action="filter-grayscale">é»‘ç™½</div>
              <div class="menu-item" data-action="filter-sepia">å¤å¤</div>
              <div class="menu-item" data-action="filter-blur">æ¨¡ç³Š</div>
              <div class="menu-item" data-action="filter-brightness">å¢äº®</div>
              <div class="menu-item" data-action="filter-contrast">å¯¹æ¯”åº¦å¢å¼º</div>
              <div class="menu-item" data-action="filter-invert">åè‰²</div>
            </div>
          </div>
          <div class="menu-item has-submenu">
            <span class="menu-item-icon">ğŸ“</span>
            æ–‡å­—ç¯ç»•
            <div class="submenu">
              <div class="menu-item" data-action="float-none">æ— ç¯ç»•</div>
              <div class="menu-item" data-action="float-left">å·¦ä¾§ç¯ç»•</div>
              <div class="menu-item" data-action="float-right">å³ä¾§ç¯ç»•</div>
            </div>
          </div>
          <div class="menu-separator"></div>
          <div class="menu-item" data-action="copy">
            <span class="menu-item-icon">ğŸ“‹</span>
            å¤åˆ¶å›¾ç‰‡
          </div>
          <div class="menu-item" data-action="replace">
            <span class="menu-item-icon">ğŸ”„</span>
            æ›¿æ¢å›¾ç‰‡
          </div>
          <div class="menu-separator"></div>
          <div class="menu-item" data-action="properties">
            <span class="menu-item-icon">â„¹ï¸</span>
            å›¾ç‰‡å±æ€§
          </div>
          <div class="menu-item" data-action="delete">
            <span class="menu-item-icon">ğŸ—‘ï¸</span>
            åˆ é™¤
          </div>
        `;
      }
      
      bindMenuEvents() {
        this.menu.querySelectorAll('[data-action]').forEach(item => {
          item.addEventListener('click', (e) => {
            e.stopPropagation();
            const action = item.dataset.action;
            this.handleAction(action);
            this.hide();
          });
        });
      }
      
      handleAction(action) {
        if (!this.currentTarget) return;
        
        switch(action) {
          // å¯¹é½æ–¹å¼
          case 'align-left':
            this.currentTarget.style.display = 'block';
            this.currentTarget.style.marginLeft = '0';
            this.currentTarget.style.marginRight = 'auto';
            break;
          case 'align-center':
            this.currentTarget.style.display = 'block';
            this.currentTarget.style.marginLeft = 'auto';
            this.currentTarget.style.marginRight = 'auto';
            break;
          case 'align-right':
            this.currentTarget.style.display = 'block';
            this.currentTarget.style.marginLeft = 'auto';
            this.currentTarget.style.marginRight = '0';
            break;
            
          // æ»¤é•œæ•ˆæœ
          case 'filter-none':
            this.currentTarget.style.filter = 'none';
            break;
          case 'filter-grayscale':
            this.currentTarget.style.filter = 'grayscale(100%)';
            break;
          case 'filter-sepia':
            this.currentTarget.style.filter = 'sepia(100%)';
            break;
          case 'filter-blur':
            this.currentTarget.style.filter = 'blur(3px)';
            break;
          case 'filter-brightness':
            this.currentTarget.style.filter = 'brightness(1.5)';
            break;
          case 'filter-contrast':
            this.currentTarget.style.filter = 'contrast(1.5)';
            break;
          case 'filter-invert':
            this.currentTarget.style.filter = 'invert(100%)';
            break;
            
          // æ–‡å­—ç¯ç»•
          case 'float-none':
            this.currentTarget.style.float = 'none';
            this.currentTarget.style.margin = '10px 0';
            break;
          case 'float-left':
            this.currentTarget.style.float = 'left';
            this.currentTarget.style.margin = '0 20px 20px 0';
            break;
          case 'float-right':
            this.currentTarget.style.float = 'right';
            this.currentTarget.style.margin = '0 0 20px 20px';
            break;
            
          // å…¶ä»–æ“ä½œ
          case 'delete':
            this.currentTarget.remove();
            break;
          case 'properties':
            const alt = prompt('è¯·è¾“å…¥å›¾ç‰‡æè¿° (Alt):', this.currentTarget.alt || '');
            if (alt !== null) {
              this.currentTarget.alt = alt;
            }
            const title = prompt('è¯·è¾“å…¥å›¾ç‰‡æ ‡é¢˜ (Title):', this.currentTarget.title || '');
            if (title !== null) {
              this.currentTarget.title = title;
            }
            break;
          case 'replace':
            const newSrc = prompt('è¯·è¾“å…¥æ–°çš„å›¾ç‰‡URL:', '');
            if (newSrc) {
              this.currentTarget.src = newSrc;
            }
            break;
          case 'copy':
            // å¤åˆ¶å›¾ç‰‡URLåˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(this.currentTarget.src);
            alert('å›¾ç‰‡URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            break;
          case 'resize-small':
            const width = prompt('è¯·è¾“å…¥å›¾ç‰‡å®½åº¦ (åƒç´ ):', this.currentTarget.width || 'auto');
            if (width !== null) {
              this.currentTarget.style.width = isNaN(width) ? width : width + 'px';
            }
            break;
        }
      }
    }
    
    // åˆå§‹åŒ–å³é”®èœå•
    const contextMenu = new CustomContextMenu();
    
    // å›¾ç‰‡è°ƒæ•´å¤§å°åŠŸèƒ½
    class ImageResizer {
      constructor() {
        this.currentImage = null;
        this.isResizing = false;
        this.startX = 0;
        this.startY = 0;
        this.startWidth = 0;
        this.startHeight = 0;
        this.handle = '';
        this.overlay = null;
        this.init();
      }
      
      init() {
        const editorContent = document.querySelector('#editor .ldesign-editor-content');
        if (!editorContent) return;
        
        // ç‚¹å‡»å›¾ç‰‡æ˜¾ç¤ºè°ƒæ•´æ‰‹æŸ„
        editorContent.addEventListener('click', (e) => {
          if (e.target.tagName === 'IMG') {
            this.showResizeHandles(e.target);
          } else {
            this.hideResizeHandles();
          }
        });
        
        // é¼ æ ‡ç§»åŠ¨
        document.addEventListener('mousemove', (e) => {
          if (this.isResizing) {
            this.resize(e);
          }
        });
        
        // é¼ æ ‡é‡Šæ”¾
        document.addEventListener('mouseup', () => {
          this.isResizing = false;
        });
      }
      
      showResizeHandles(img) {
        this.hideResizeHandles();
        this.currentImage = img;
        
        // åˆ›å»ºè¦†ç›–å±‚
        this.overlay = document.createElement('div');
        this.overlay.className = 'image-resize-overlay';
        
        // åˆ›å»º8ä¸ªè°ƒæ•´æ‰‹æŸ„
        const handles = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];
        handles.forEach(handle => {
          const handleEl = document.createElement('div');
          handleEl.className = `image-resize-handle handle-${handle}`;
          handleEl.addEventListener('mousedown', (e) => {
            e.preventDefault();
            this.startResize(e, handle);
          });
          this.overlay.appendChild(handleEl);
        });
        
        // æ·»åŠ å°ºå¯¸æ˜¾ç¤º
        const dimensions = document.createElement('div');
        dimensions.className = 'image-resize-dimensions';
        dimensions.textContent = `${img.width} Ã— ${img.height}`;
        this.overlay.appendChild(dimensions);
        
        // å®šä½è¦†ç›–å±‚
        this.updateOverlayPosition();
        
        // æ·»åŠ åˆ°é¡µé¢
        document.body.appendChild(this.overlay);
      }
      
      hideResizeHandles() {
        if (this.overlay) {
          this.overlay.remove();
          this.overlay = null;
        }
        this.currentImage = null;
      }
      
      updateOverlayPosition() {
        if (!this.overlay || !this.currentImage) return;
        
        const rect = this.currentImage.getBoundingClientRect();
        this.overlay.style.left = rect.left + window.scrollX + 'px';
        this.overlay.style.top = rect.top + window.scrollY + 'px';
        this.overlay.style.width = rect.width + 'px';
        this.overlay.style.height = rect.height + 'px';
      }
      
      startResize(e, handle) {
        this.isResizing = true;
        this.handle = handle;
        this.startX = e.clientX;
        this.startY = e.clientY;
        this.startWidth = this.currentImage.width;
        this.startHeight = this.currentImage.height;
      }
      
      resize(e) {
        if (!this.currentImage) return;
        
        const dx = e.clientX - this.startX;
        const dy = e.clientY - this.startY;
        
        let newWidth = this.startWidth;
        let newHeight = this.startHeight;
        
        // æ ¹æ®æ‰‹æŸ„ä½ç½®è®¡ç®—æ–°å°ºå¯¸
        if (this.handle.includes('e')) newWidth = this.startWidth + dx;
        if (this.handle.includes('w')) newWidth = this.startWidth - dx;
        if (this.handle.includes('s')) newHeight = this.startHeight + dy;
        if (this.handle.includes('n')) newHeight = this.startHeight - dy;
        
        // é™åˆ¶æœ€å°å°ºå¯¸
        newWidth = Math.max(50, newWidth);
        newHeight = Math.max(50, newHeight);
        
        // åº”ç”¨æ–°å°ºå¯¸
        this.currentImage.width = newWidth;
        this.currentImage.height = newHeight;
        
        // æ›´æ–°è¦†ç›–å±‚
        this.updateOverlayPosition();
        
        // æ›´æ–°å°ºå¯¸æ˜¾ç¤º
        const dimensions = this.overlay.querySelector('.image-resize-dimensions');
        if (dimensions) {
          dimensions.textContent = `${newWidth} Ã— ${newHeight}`;
        }
      }
    }
    
    // åˆå§‹åŒ–å›¾ç‰‡è°ƒæ•´å¤§å°åŠŸèƒ½
    const imageResizer = new ImageResizer();
    
    // å·¥å…·å‡½æ•°
    window.insertImage = function() {
      const url = prompt('è¯·è¾“å…¥å›¾ç‰‡URL:', 'https://picsum.photos/400/300?random=' + Date.now());
      if (url) {
        editor.insertHTML(`<img src="${url}" alt="æ’å…¥çš„å›¾ç‰‡">`);
      }
    };
    
    window.insertMultipleImages = function() {
      const html = `
        <p>å¤šå¼ å›¾ç‰‡å±•ç¤ºï¼š</p>
        <img src="https://picsum.photos/300/200?random=${Date.now()}" alt="å›¾ç‰‡1" style="margin: 10px;">
        <img src="https://picsum.photos/300/200?random=${Date.now()+1}" alt="å›¾ç‰‡2" style="margin: 10px;">
        <img src="https://picsum.photos/300/200?random=${Date.now()+2}" alt="å›¾ç‰‡3" style="margin: 10px;">
      `;
      editor.insertHTML(html);
    };
    
    window.insertImageWithFloat = function() {
      const html = `
        <h3>æ–‡å­—ç¯ç»•æ•ˆæœç¤ºä¾‹</h3>
        <img src="https://picsum.photos/200/200?random=${Date.now()}" alt="å·¦æµ®åŠ¨å›¾ç‰‡" style="float: left; margin: 0 20px 20px 0;">
        <p>è¿™æ˜¯ä¸€æ®µç¤ºä¾‹æ–‡å­—ï¼Œå±•ç¤ºäº†å›¾ç‰‡å·¦æµ®åŠ¨æ—¶çš„æ–‡å­—ç¯ç»•æ•ˆæœã€‚å½“å›¾ç‰‡è®¾ç½®ä¸ºå·¦æµ®åŠ¨åï¼Œæ–‡å­—ä¼šè‡ªåŠ¨ç¯ç»•åœ¨å›¾ç‰‡çš„å³ä¾§å’Œä¸‹æ–¹ã€‚è¿™ç§å¸ƒå±€æ–¹å¼å¸¸ç”¨äºæ–‡ç« é…å›¾ï¼Œå¯ä»¥è®©å†…å®¹æ›´åŠ ç”ŸåŠ¨æœ‰è¶£ã€‚ä½ å¯ä»¥å³é”®ç‚¹å‡»å›¾ç‰‡ï¼Œé€‰æ‹©ä¸åŒçš„ç¯ç»•æ–¹å¼æ¥æ”¹å˜å¸ƒå±€æ•ˆæœã€‚</p>
        <p>ç»§ç»­æ·»åŠ æ›´å¤šæ–‡å­—å†…å®¹ï¼Œä»¥ä¾¿æ›´å¥½åœ°å±•ç¤ºæ–‡å­—ç¯ç»•çš„æ•ˆæœã€‚æ–‡å­—ä¼šæ ¹æ®å›¾ç‰‡çš„ä½ç½®è‡ªåŠ¨è°ƒæ•´æ’ç‰ˆï¼Œå½¢æˆç¾è§‚çš„å¸ƒå±€ã€‚</p>
        <div style="clear: both;"></div>
      `;
      editor.insertHTML(html);
    };
    
    window.clearEditor = function() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºç¼–è¾‘å™¨å†…å®¹å—ï¼Ÿ')) {
        editor.setContent('<p>ç¼–è¾‘å™¨å·²æ¸…ç©º</p>');
      }
    };
  </script>
</body>
</html>