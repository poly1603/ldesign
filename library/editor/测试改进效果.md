# 🧪 测试改进效果指南

本指南帮助你快速验证所有改进是否正常工作。

---

## 🚀 快速开始

### 1. 安装依赖（如果还没有）
```bash
npm install
```

### 2. 开发模式测试
```bash
npm run dev
```

打开浏览器访问 `http://localhost:5173`

---

## ✅ 功能测试清单

### 测试 1：撤销/重做功能 ⭐新增
1. 在编辑器中输入一些文字
2. 按 `Ctrl+Z` (Windows) 或 `Cmd+Z` (Mac) 撤销
3. 按 `Ctrl+Shift+Z` 或 `Cmd+Shift+Z` 重做
4. 观察内容是否正确恢复

**预期结果：** ✅ 撤销和重做功能正常工作

---

### 测试 2：格式化功能
1. 选中一段文字
2. 点击工具栏的加粗按钮（或按 `Ctrl+B`）
3. 再次点击加粗按钮（应该取消加粗）
4. 测试斜体（`Ctrl+I`）和下划线（`Ctrl+U`）

**预期结果：** ✅ 格式化切换正常

---

### 测试 3：日志系统 ⭐新增
1. 打开浏览器开发者工具（F12）
2. 查看 Console 面板
3. 执行一些操作（如加粗、插入图片等）
4. 观察日志输出

**开发环境预期输出：**
```
[DEBUG] [Editor] Loading plugins...
[DEBUG] [CommandManager] Executing command: "bold"
[DEBUG] [History] State saved
```

**生产环境：** 不应该看到 `[DEBUG]` 日志

---

### 测试 4：错误处理 ⭐新增
1. 尝试上传一个超大文件（>10MB）
2. 观察错误提示

**预期结果：** ✅ 显示友好的错误消息："文件太大，请选择较小的文件"

---

### 测试 5：插入和删除
1. 在编辑器中选中一段文字
2. 按 `Delete` 或 `Backspace`
3. 插入一张图片
4. 插入一个表格

**预期结果：** ✅ 所有操作正常

---

## 📦 构建测试

### 1. 构建项目
```bash
npm run build
```

### 2. 检查输出
```bash
# Windows PowerShell
Get-ChildItem dist -Recurse | Measure-Object -Property Length -Sum

# 或者使用 Git Bash
du -sh dist/
ls -lh dist/
```

### 3. 检查代码分割
查看 `dist/chunks/` 目录，应该看到：
```
dist/
├── chunks/
│   ├── codemirror-core-xxxxx.js    ✅ CodeMirror 核心
│   ├── codemirror-langs-xxxxx.js   ✅ CodeMirror 语言包
│   ├── ai-xxxxx.js                 ✅ AI 功能
│   ├── plugins-formatting-xxxxx.js ✅ 格式化插件
│   ├── plugins-media-xxxxx.js      ✅ 媒体插件
│   ├── plugins-table-xxxxx.js      ✅ 表格插件
│   ├── core-xxxxx.js               ✅ 核心模块
│   └── ui-xxxxx.js                 ✅ UI 组件
├── editor.css
├── index.js
├── vue.js
└── react.js
```

**预期结果：** ✅ 代码已按模块分割

---

### 4. 预览生产构建
```bash
npm run preview
```

访问显示的 URL（通常是 `http://localhost:4173`）

### 5. 检查生产环境日志
1. 打开浏览器开发者工具
2. 查看 Console
3. 执行一些操作

**预期结果：** ❌ 不应该看到 `[DEBUG]` 日志，只有 `[ERROR]` 和 `[WARN]`

---

## 🔍 代码检查

### 1. 检查新增文件
```bash
# 查看新增的文件
ls src/config/constants.ts
ls src/utils/logger.ts
ls src/utils/error-handler.ts
ls src/core/History.ts
```

**预期结果：** ✅ 所有文件都存在

### 2. 验证路径别名
创建一个测试文件：
```typescript
// test-imports.ts
import { Editor } from '@core/Editor'
import { logger } from '@utils/logger'
import { EDITOR_CONFIG } from '@config/constants'
import { BoldPlugin } from '@plugins/formatting'

console.log('All imports work!')
```

**预期结果：** ✅ 没有 TypeScript 错误

---

## 📊 性能对比

### 对比打包体积

#### 改进前（估计）
```
dist/Editor-xxxxx.js: ~800KB
总体积: ~1.2MB
```

#### 改进后（预期）
```
dist/index.js: ~300KB
dist/chunks/codemirror-*.js: ~400KB (按需加载)
总体积: ~850KB (-30%)
```

### 对比加载时间

#### 测试方法
1. 打开 Chrome DevTools
2. 切换到 Network 面板
3. 刷新页面
4. 查看 DOMContentLoaded 和 Load 时间

**预期提升：** 40-50% 更快

---

## 🎯 功能完整性检查

### 核心功能
- [x] 基础编辑（输入、删除）
- [x] 格式化（加粗、斜体、下划线）
- [x] 撤销/重做 ⭐
- [x] 插入图片
- [x] 插入表格
- [x] 插入链接

### 新增功能
- [x] 统一日志系统 ⭐
- [x] 错误处理 ⭐
- [x] 历史记录 ⭐
- [x] 路径别名 ⭐

---

## 🐛 常见问题排查

### 问题 1：撤销/重做不工作
**排查步骤：**
1. 检查 History 类是否正确初始化
2. 查看 Console 是否有错误
3. 确认 `editor.commands.history` 存在

**解决方案：**
```typescript
// 检查
console.log(editor.commands.history)
console.log(editor.commands.canUndo())
```

---

### 问题 2：日志不显示
**排查步骤：**
1. 确认在开发模式（`npm run dev`）
2. 检查浏览器 Console 过滤器
3. 查看 `logger.ts` 中的环境检测

**解决方案：**
```typescript
// 临时强制启用日志
// src/utils/logger.ts
this.isDevelopment = true
```

---

### 问题 3：构建失败
**排查步骤：**
1. 检查构建日志
2. 确认所有新文件都存在
3. 检查 TypeScript 错误

**解决方案：**
```bash
# 清理并重新构建
rm -rf dist node_modules
npm install
npm run build
```

---

### 问题 4：路径别名不工作
**排查步骤：**
1. 检查 `tsconfig.json` 中的 `paths` 配置
2. 检查 `vite.config.ts` 中的 `alias` 配置
3. 重启开发服务器

**解决方案：**
```bash
# 重启服务器
npm run dev
```

---

## 📈 性能测试

### 使用 Lighthouse 测试

1. 打开 Chrome DevTools
2. 切换到 Lighthouse 面板
3. 运行测试
4. 查看结果

**目标分数：**
- Performance: > 90
- First Contentful Paint: < 1.5s
- Time to Interactive: < 3.5s

---

## ✨ 验收标准

所有以下项目都应该通过：

### 功能性
- ✅ 所有编辑功能正常工作
- ✅ 撤销/重做功能正常
- ✅ 格式化功能正常
- ✅ 插入功能正常

### 性能
- ✅ 打包体积减少 > 25%
- ✅ 首屏加载时间减少 > 30%
- ✅ 代码正确分割

### 代码质量
- ✅ 没有 TypeScript 错误
- ✅ 没有 Console 错误
- ✅ 日志系统正常工作
- ✅ 路径别名正常工作

---

## 🎉 测试完成

如果所有测试都通过，恭喜你！改进已成功完成。

### 下一步建议
1. 提交代码到 Git
2. 部署到测试环境
3. 进行用户测试
4. 继续第二期优化

---

## 📝 测试报告模板

```markdown
## 测试报告

**测试日期：** YYYY-MM-DD
**测试人员：** [你的名字]
**环境：** Windows/Mac/Linux

### 功能测试
- [ ] 撤销/重做：通过/失败
- [ ] 格式化：通过/失败
- [ ] 插入：通过/失败
- [ ] 删除：通过/失败

### 性能测试
- 打包体积：
  - 改进前：_____ KB
  - 改进后：_____ KB
  - 减少：_____ %

- 加载时间：
  - 改进前：_____ ms
  - 改进后：_____ ms
  - 提升：_____ %

### 代码质量
- [ ] TypeScript 编译：通过/失败
- [ ] 日志系统：通过/失败
- [ ] 路径别名：通过/失败

### 遇到的问题
1. [描述问题]
2. [描述问题]

### 总体评价
[你的评价]
```

---

**祝测试顺利！** 🎊




