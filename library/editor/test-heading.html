<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>测试 Heading 插件</title>
  <link rel="stylesheet" href="./dist/style.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      margin-bottom: 20px;
      color: #333;
    }
    #editor {
      min-height: 400px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .test-buttons {
      margin: 20px 0;
      display: flex;
      gap: 10px;
    }
    button {
      padding: 8px 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    pre {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>测试 Heading 插件</h1>
    
    <div class="test-buttons">
      <button onclick="testHeadingCommands()">测试标题命令</button>
      <button onclick="listAllCommands()">列出所有命令</button>
      <button onclick="listAllPlugins()">列出所有插件</button>
      <button onclick="manualSetHeading3()">手动设置标题3</button>
    </div>
    
    <div id="editor"></div>
    
    <h2>测试结果：</h2>
    <pre id="output"></pre>
  </div>

  <script type="module">
    import { Editor } from './dist/editor.esm.js';
    
    // 全局暴露
    window.Editor = Editor;
    
    // 创建编辑器实例
    const editor = new Editor({
      element: document.getElementById('editor'),
      placeholder: '开始输入内容...',
      content: '<p>这是一段普通文本，选中后点击测试按钮。</p>'
    });
    
    window.editor = editor;
    
    // 测试函数
    window.testHeadingCommands = function() {
      const output = document.getElementById('output');
      let results = [];
      
      // 测试每个标题命令是否存在
      const headingCommands = [
        'setParagraph',
        'setHeading1', 
        'setHeading2',
        'setHeading3',
        'setHeading4',
        'setHeading5',
        'setHeading6'
      ];
      
      results.push('=== 测试标题命令 ===\n');
      
      headingCommands.forEach(cmd => {
        const exists = editor.commands.get(cmd) !== undefined;
        results.push(`命令 "${cmd}": ${exists ? '✅ 已注册' : '❌ 未找到'}`);
        
        if (exists) {
          // 尝试执行命令
          try {
            const success = editor.commands.execute(cmd);
            results.push(`  执行结果: ${success ? '成功' : '失败'}`);
          } catch (error) {
            results.push(`  执行错误: ${error.message}`);
          }
        }
      });
      
      output.textContent = results.join('\n');
    };
    
    window.listAllCommands = function() {
      const output = document.getElementById('output');
      const commands = editor.commands.getCommands();
      
      let results = ['=== 所有已注册的命令 ===\n'];
      
      if (commands.length === 0) {
        results.push('没有找到任何命令！');
      } else {
        commands.sort().forEach(cmd => {
          results.push(`- ${cmd}`);
        });
        results.push(`\n总计: ${commands.length} 个命令`);
      }
      
      output.textContent = results.join('\n');
    };
    
    window.listAllPlugins = function() {
      const output = document.getElementById('output');
      const plugins = editor.plugins.getAll();
      
      let results = ['=== 所有已加载的插件 ===\n'];
      
      if (plugins.length === 0) {
        results.push('没有找到任何插件！');
      } else {
        plugins.forEach(plugin => {
          results.push(`- ${plugin.name}`);
          
          // 列出插件的命令
          if (plugin.config && plugin.config.commands) {
            const cmdNames = Object.keys(plugin.config.commands);
            if (cmdNames.length > 0) {
              results.push(`  命令: ${cmdNames.join(', ')}`);
            }
          }
        });
        results.push(`\n总计: ${plugins.length} 个插件`);
      }
      
      output.textContent = results.join('\n');
    };
    
    window.manualSetHeading3 = function() {
      const output = document.getElementById('output');
      let results = ['=== 手动设置标题3 ===\n'];
      
      try {
        // 方法1：通过命令执行
        const cmdExists = editor.commands.get('setHeading3') !== undefined;
        results.push(`命令 "setHeading3" 存在: ${cmdExists}`);
        
        if (cmdExists) {
          const success = editor.commands.execute('setHeading3');
          results.push(`通过命令执行: ${success ? '成功' : '失败'}`);
        }
        
        // 方法2：直接使用 execCommand
        results.push('\n尝试直接使用 document.execCommand:');
        const success1 = document.execCommand('formatBlock', false, 'H3');
        results.push(`formatBlock H3: ${success1}`);
        
        const success2 = document.execCommand('formatBlock', false, '<h3>');
        results.push(`formatBlock <h3>: ${success2}`);
        
        const success3 = document.execCommand('formatBlock', false, 'h3');
        results.push(`formatBlock h3: ${success3}`);
        
      } catch (error) {
        results.push(`错误: ${error.message}`);
      }
      
      output.textContent = results.join('\n');
    };
    
    // 初始显示所有命令
    setTimeout(() => {
      listAllCommands();
    }, 100);
  </script>
</body>
</html>