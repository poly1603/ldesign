<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UIç»„ä»¶åŠ¨ç”»æµ‹è¯•</title>
  <link rel="stylesheet" href="./src/ui/enhanced/DropdownMenu.css">
  <link rel="stylesheet" href="./src/ui/enhanced/DialogModal.css">
  <link rel="stylesheet" href="./src/ui/enhanced/Popover.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      font-size: 32px;
      margin-bottom: 12px;
      color: #1a1a1a;
    }

    .subtitle {
      font-size: 16px;
      color: #666;
      margin-bottom: 40px;
    }

    .test-section {
      margin-bottom: 48px;
      padding-bottom: 48px;
      border-bottom: 2px solid #f0f0f0;
    }

    .test-section:last-child {
      border-bottom: none;
    }

    .test-section h2 {
      font-size: 24px;
      margin-bottom: 8px;
      color: #333;
    }

    .test-section p {
      color: #666;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .button-group {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .test-button {
      padding: 12px 24px;
      font-size: 15px;
      font-weight: 500;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .test-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .test-button:active {
      transform: translateY(0);
    }

    .test-button.secondary {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .test-button.secondary:hover {
      background: #f0f4ff;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .demo-text {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-top: 20px;
      color: #555;
      line-height: 1.8;
    }

    .status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      margin-left: 12px;
    }

    .status.success {
      background: #d4edda;
      color: #155724;
    }

    .status.info {
      background: #d1ecf1;
      color: #0c5460;
    }

    /* ç¡®ä¿åŠ¨ç”»æ•ˆæœæ›´æ˜æ˜¾ */
    .dropdown-menu {
      --dropdown-shadow-open: 0 10px 40px rgba(0, 0, 0, 0.25);
    }

    .dialog-modal {
      --dialog-shadow-open: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .popover {
      --popover-shadow-open: 0 8px 32px rgba(0, 0, 0, 0.25);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¨ UI ç»„ä»¶åŠ¨ç”»æµ‹è¯•</h1>
    <p class="subtitle">æµ‹è¯•å¢å¼ºå‹ UI ç»„ä»¶çš„æ‰“å¼€å’Œå…³é—­åŠ¨ç”»æ•ˆæœ - ç°åœ¨åŒ…å« Scale + TranslateY åŠ¨ç”»</p>

    <!-- Dropdown Menu Test -->
    <div class="test-section">
      <h2>1. Dropdown Menu <span class="status info">ä¸‹æ‹‰èœå•</span></h2>
      <p>æµ‹è¯•ä¸‹æ‹‰èœå•çš„ <strong>ç¼©æ”¾(scale) + ä½ç§»(translateY)</strong> ç»„åˆåŠ¨ç”»ã€‚æ³¨æ„è§‚å¯Ÿæ‰“å¼€æ—¶çš„å±•å¼€æ•ˆæœå’Œå…³é—­æ—¶çš„æ”¶ç¼©æ•ˆæœã€‚</p>
      <div class="button-group">
        <button class="test-button" id="dropdownBtn">æ‰“å¼€ä¸‹æ‹‰èœå•</button>
        <button class="test-button secondary" id="dropdownBtn2">å¦ä¸€ä¸ªä¸‹æ‹‰èœå•</button>
      </div>
    </div>

    <!-- Dialog Modal Test -->
    <div class="test-section">
      <h2>2. Dialog Modal <span class="status info">å¯¹è¯æ¡†</span></h2>
      <p>æµ‹è¯•æ¨¡æ€å¯¹è¯æ¡†çš„ <strong>ç¼©æ”¾(scale) + ä½ç§»(translateY)</strong> å¼¹æ€§åŠ¨ç”»ã€‚å¯¹è¯æ¡†ä¼šä»å°å˜å¤§å¹¶ä¼´éšå‘ä¸Šç§»åŠ¨ã€‚</p>
      <div class="button-group">
        <button class="test-button" id="dialogBtn">æ‰“å¼€å¯¹è¯æ¡†</button>
        <button class="test-button secondary" id="dialogBtn2">æ‰“å¼€å¦ä¸€ä¸ªå¯¹è¯æ¡†</button>
      </div>
    </div>

    <!-- Popover Test -->
    <div class="test-section">
      <h2>3. Popover <span class="status info">å¼¹å‡ºæç¤º</span></h2>
      <p>æµ‹è¯• Popover çš„ <strong>ç¼©æ”¾(scale) + è½»å¾®ä½ç§»</strong> åŠ¨ç”»æ•ˆæœã€‚</p>
      <div class="button-group">
        <button class="test-button" id="popoverBtn">ç‚¹å‡»æ˜¾ç¤º Popover</button>
        <button class="test-button secondary" id="popoverBtn2">æ‚¬åœæ˜¾ç¤º Popover</button>
      </div>
    </div>
  </div>

  <script type="module">
    // ç®€å•çš„æµ‹è¯•ä»£ç 
    document.addEventListener('DOMContentLoaded', () => {
      // æµ‹è¯•ä¸‹æ‹‰èœå•
      const dropdownBtn = document.getElementById('dropdownBtn');
      dropdownBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        
        // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ä¸‹æ‹‰èœå•
        const menu = document.createElement('div');
        menu.className = 'dropdown-menu';
        menu.innerHTML = `
          <div class="dropdown-items">
            <div class="dropdown-item">
              <span class="dropdown-item-icon">ğŸ“„</span>
              <span class="dropdown-item-label">é€‰é¡¹ 1</span>
            </div>
            <div class="dropdown-item">
              <span class="dropdown-item-icon">âœï¸</span>
              <span class="dropdown-item-label">é€‰é¡¹ 2</span>
            </div>
            <div class="dropdown-item">
              <span class="dropdown-item-icon">ğŸ—‘ï¸</span>
              <span class="dropdown-item-label">é€‰é¡¹ 3</span>
            </div>
          </div>
        `;
        
        document.body.appendChild(menu);
        
        // å®šä½
        const rect = dropdownBtn.getBoundingClientRect();
        menu.style.position = 'fixed';
        menu.style.top = rect.bottom + 'px';
        menu.style.left = rect.left + 'px';
        menu.style.display = 'block';
        
        // è§¦å‘åŠ¨ç”»
        void menu.offsetHeight; // å¼ºåˆ¶é‡æ’
        requestAnimationFrame(() => {
          menu.classList.add('dropdown-menu-open');
        });
        
        // ç‚¹å‡»å¤–éƒ¨å…³é—­
        const closeHandler = (e) => {
          if (!menu.contains(e.target) && e.target !== dropdownBtn) {
            menu.classList.remove('dropdown-menu-open');
            setTimeout(() => {
              menu.remove();
            }, 300);
            document.removeEventListener('click', closeHandler);
          }
        };
        
        setTimeout(() => {
          document.addEventListener('click', closeHandler);
        }, 0);
      });

      // æµ‹è¯•å¯¹è¯æ¡†
      const dialogBtn = document.getElementById('dialogBtn');
      dialogBtn.addEventListener('click', () => {
        // åˆ›å»ºé®ç½©å’Œå¯¹è¯æ¡†
        const overlay = document.createElement('div');
        overlay.className = 'dialog-overlay';
        overlay.style.display = 'flex';
        
        const modal = document.createElement('div');
        modal.className = 'dialog-modal';
        modal.innerHTML = `
          <div class="dialog-header">
            <h2 class="dialog-title">æµ‹è¯•å¯¹è¯æ¡†</h2>
            <button class="dialog-close-btn">Ã—</button>
          </div>
          <div class="dialog-body">
            <div class="dialog-content">
              è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å¯¹è¯æ¡†ã€‚è§‚å¯Ÿæ‰“å¼€æ—¶çš„ç¼©æ”¾å’Œä½ç§»åŠ¨ç”»æ•ˆæœã€‚
              å¯¹è¯æ¡†ä» scale(0.85) translateY(-20px) åŠ¨ç”»åˆ° scale(1) translateY(0)ã€‚
            </div>
          </div>
          <div class="dialog-footer">
            <button class="dialog-btn dialog-btn-secondary">å–æ¶ˆ</button>
            <button class="dialog-btn dialog-btn-primary">ç¡®å®š</button>
          </div>
        `;
        
        overlay.appendChild(modal);
        document.body.appendChild(overlay);
        
        // è§¦å‘åŠ¨ç”»
        void overlay.offsetHeight; // å¼ºåˆ¶é‡æ’
        requestAnimationFrame(() => {
          overlay.classList.add('dialog-overlay-open');
          modal.classList.add('dialog-modal-open');
        });
        
        // å…³é—­å¤„ç†
        const closeDialog = () => {
          overlay.classList.remove('dialog-overlay-open');
          modal.classList.remove('dialog-modal-open');
          setTimeout(() => {
            overlay.remove();
          }, 300);
        };
        
        modal.querySelector('.dialog-close-btn').addEventListener('click', closeDialog);
        modal.querySelector('.dialog-btn-secondary').addEventListener('click', closeDialog);
        modal.querySelector('.dialog-btn-primary').addEventListener('click', closeDialog);
        overlay.addEventListener('click', (e) => {
          if (e.target === overlay) closeDialog();
        });
      });

      // æµ‹è¯• Popover
      const popoverBtn = document.getElementById('popoverBtn');
      let popover = null;
      
      popoverBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        
        if (popover) {
          // å…³é—­ç°æœ‰çš„
          popover.classList.remove('popover-visible');
          setTimeout(() => {
            popover.remove();
            popover = null;
          }, 250);
        } else {
          // åˆ›å»ºæ–°çš„
          popover = document.createElement('div');
          popover.className = 'popover popover-bottom';
          popover.innerHTML = `
            <div class="popover-arrow"></div>
            <div class="popover-content">
              <strong>Popover å†…å®¹</strong><br>
              è§‚å¯Ÿ scale(0.9) + translateY(-5px) çš„åŠ¨ç”»æ•ˆæœ
            </div>
          `;
          
          document.body.appendChild(popover);
          
          // å®šä½
          const rect = popoverBtn.getBoundingClientRect();
          popover.style.position = 'fixed';
          popover.style.top = (rect.bottom + 8) + 'px';
          popover.style.left = (rect.left + rect.width / 2 - 150) + 'px';
          popover.style.display = 'block';
          popover.style.width = '300px';
          
          // è§¦å‘åŠ¨ç”»
          void popover.offsetHeight; // å¼ºåˆ¶é‡æ’
          requestAnimationFrame(() => {
            popover.classList.add('popover-visible');
          });
          
          // ç‚¹å‡»å¤–éƒ¨å…³é—­
          const closeHandler = (e) => {
            if (popover && !popover.contains(e.target) && e.target !== popoverBtn) {
              popover.classList.remove('popover-visible');
              setTimeout(() => {
                if (popover) {
                  popover.remove();
                  popover = null;
                }
              }, 250);
              document.removeEventListener('click', closeHandler);
            }
          };
          
          setTimeout(() => {
            document.addEventListener('click', closeHandler);
          }, 0);
        }
      });

      // æ‚¬åœæ˜¾ç¤º Popover
      const popoverBtn2 = document.getElementById('popoverBtn2');
      let hoverPopover = null;
      let hoverTimeout = null;
      
      popoverBtn2.addEventListener('mouseenter', () => {
        if (hoverTimeout) clearTimeout(hoverTimeout);
        
        if (!hoverPopover) {
          hoverPopover = document.createElement('div');
          hoverPopover.className = 'popover popover-top';
          hoverPopover.innerHTML = `
            <div class="popover-arrow"></div>
            <div class="popover-content">
              æ‚¬åœè§¦å‘çš„ Popover<br>
              é¼ æ ‡ç§»å¼€åä¼šè‡ªåŠ¨å…³é—­
            </div>
          `;
          
          document.body.appendChild(hoverPopover);
          
          // å®šä½
          const rect = popoverBtn2.getBoundingClientRect();
          hoverPopover.style.position = 'fixed';
          hoverPopover.style.width = '200px';
          
          // å…ˆè®¾ç½®ä½ç½®ä»¥è·å–é«˜åº¦
          hoverPopover.style.display = 'block';
          const popoverHeight = hoverPopover.offsetHeight;
          hoverPopover.style.top = (rect.top - popoverHeight - 8) + 'px';
          hoverPopover.style.left = (rect.left + rect.width / 2 - 100) + 'px';
          
          // è§¦å‘åŠ¨ç”»
          void hoverPopover.offsetHeight; // å¼ºåˆ¶é‡æ’
          requestAnimationFrame(() => {
            hoverPopover.classList.add('popover-visible');
          });
        }
      });
      
      popoverBtn2.addEventListener('mouseleave', () => {
        if (hoverPopover) {
          hoverTimeout = setTimeout(() => {
            if (hoverPopover) {
              hoverPopover.classList.remove('popover-visible');
              setTimeout(() => {
                if (hoverPopover) {
                  hoverPopover.remove();
                  hoverPopover = null;
                }
              }, 250);
            }
          }, 200);
        }
      });

      console.log('âœ¨ åŠ¨ç”»æµ‹è¯•é¡µé¢å·²åŠ è½½');
      console.log('ğŸ“Œ æç¤ºï¼š');
      console.log('- ä¸‹æ‹‰èœå•ï¼šscale(0.95) + translateY(-10px) â†’ scale(1) + translateY(0)');
      console.log('- å¯¹è¯æ¡†ï¼šscale(0.85) + translateY(-20px) â†’ scale(1) + translateY(0)');
      console.log('- Popoverï¼šscale(0.9) + translateY(-5px) â†’ scale(1) + translateY(0)');
    });
  </script>
</body>
</html>