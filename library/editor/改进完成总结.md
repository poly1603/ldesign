# âœ… ç¼–è¾‘å™¨æ”¹è¿›å®Œæˆæ€»ç»“

**å®Œæˆæ—¶é—´ï¼š** 2025-10-17
**æ”¹è¿›é˜¶æ®µï¼š** ç¬¬ä¸€æœŸï¼ˆåŸºç¡€ä¼˜åŒ–ï¼‰

---

## ğŸ‰ å·²å®Œæˆçš„æ”¹è¿›

### 1. âœ… åˆ›å»ºç»Ÿä¸€æ—¥å¿—å·¥å…· (src/utils/logger.ts)

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- åŒºåˆ†å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒ
- æ”¯æŒ debugã€infoã€warnã€error å››ä¸ªçº§åˆ«
- ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨ç§»é™¤ debug æ—¥å¿—
- æ”¯æŒåˆ›å»ºå¸¦å‰ç¼€çš„å­æ—¥å¿—è®°å½•å™¨

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```typescript
import { logger, createLogger } from '@/utils/logger'

// å…¨å±€æ—¥å¿—
logger.debug('This only shows in development')
logger.error('This always shows')

// å¸¦å‰ç¼€çš„æ—¥å¿—
const moduleLogger = createLogger('MyModule')
moduleLogger.debug('Module debug info')
```

**æ”¶ç›Šï¼š**
- ğŸ¯ ç»Ÿä¸€æ—¥å¿—æ ¼å¼
- ğŸ“¦ ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨ç§»é™¤è°ƒè¯•æ—¥å¿—ï¼Œå‡å°ä½“ç§¯
- ğŸ”§ ä¾¿äºè°ƒè¯•å’Œé—®é¢˜è¿½è¸ª

---

### 2. âœ… åˆ›å»ºå¸¸é‡é…ç½®æ–‡ä»¶ (src/config/constants.ts)

**åŒ…å«çš„é…ç½®ï¼š**
- **ç¼–è¾‘å™¨é…ç½®**ï¼šå†å²è®°å½•å¤§å°ã€è‡ªåŠ¨ä¿å­˜å»¶è¿Ÿç­‰
- **æ–‡ä»¶é…ç½®**ï¼šæœ€å¤§æ–‡ä»¶å¤§å°ã€æ”¯æŒçš„æ–‡ä»¶ç±»å‹
- **UIé…ç½®**ï¼šå±‚çº§ï¼ˆz-indexï¼‰ã€åŠ¨ç”»æ—¶é•¿ç­‰
- **é¢œè‰²é…ç½®**ï¼šé¢„è®¾é¢œè‰²ã€æœ€è¿‘ä½¿ç”¨é¢œè‰²
- **è¡¨æ ¼é…ç½®**ï¼šæœ€å¤§è¡Œåˆ—æ•°ã€é»˜è®¤å€¼
- **å¿«æ·é”®é…ç½®**ï¼šæ‰€æœ‰å¿«æ·é”®æ˜ å°„
- **é”™è¯¯ä»£ç **ï¼šç»Ÿä¸€çš„é”™è¯¯ä»£ç å¸¸é‡
- **å­˜å‚¨é”®**ï¼šLocalStorage é”®å
- **æ­£åˆ™è¡¨è¾¾å¼**ï¼šå¸¸ç”¨æ­£åˆ™ï¼ˆURLã€Emailã€é¢œè‰²ç­‰ï¼‰

**æ”¶ç›Šï¼š**
- ğŸ”§ é›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®
- ğŸ“ æ¶ˆé™¤é­”æ³•æ•°å­—
- ğŸ”„ æ–¹ä¾¿ç»Ÿä¸€ä¿®æ”¹
- ğŸ“š æé«˜ä»£ç å¯è¯»æ€§

---

### 3. âœ… åˆ›å»ºé”™è¯¯å¤„ç†å·¥å…· (src/utils/error-handler.ts)

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- è‡ªå®šä¹‰é”™è¯¯ç±»ï¼š
  - `EditorError` - åŸºç¡€é”™è¯¯ç±»
  - `FileError` - æ–‡ä»¶ç›¸å…³é”™è¯¯
  - `CommandError` - å‘½ä»¤æ‰§è¡Œé”™è¯¯
  - `PluginError` - æ’ä»¶åŠ è½½é”™è¯¯
  - `AIError` - AI æœåŠ¡é”™è¯¯
- ç»Ÿä¸€é”™è¯¯å¤„ç†å‡½æ•°
- æ–‡ä»¶éªŒè¯å’Œ URL éªŒè¯
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯ç”Ÿæˆ

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```typescript
import { FileError, ERROR_CODES, validateFile } from '@/utils/error-handler'

try {
  validateFile(file)
  // å¤„ç†æ–‡ä»¶...
} catch (error) {
  if (error instanceof FileError) {
    alert(getUserFriendlyMessage(error))
  }
}
```

**æ”¶ç›Šï¼š**
- ğŸ›¡ï¸ ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- ğŸ“‹ è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- ğŸ‘¥ ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- ğŸ› æ›´å®¹æ˜“è°ƒè¯•å’Œè¿½è¸ªé—®é¢˜

---

### 4. âœ… å®Œæˆ Command ç³»ç»Ÿæ ¸å¿ƒ TODO

**å®ç°çš„åŠŸèƒ½ï¼š**

#### 4.1 toggleMarkï¼ˆåˆ‡æ¢æ ‡è®°ï¼‰
```typescript
// æ”¯æŒçš„æ ‡è®°ç±»å‹
- bold (ç²—ä½“)
- italic (æ–œä½“)
- underline (ä¸‹åˆ’çº¿)
- strike (åˆ é™¤çº¿)
- code (è¡Œå†…ä»£ç )
- superscript (ä¸Šæ ‡)
- subscript (ä¸‹æ ‡)
```

#### 4.2 setBlockTypeï¼ˆè®¾ç½®å—ç±»å‹ï¼‰
```typescript
// å¯ä»¥è½¬æ¢å—çº§å…ƒç´ ç±»å‹
editor.commands.execute('setBlockType', 'h1') // è½¬ä¸ºæ ‡é¢˜1
editor.commands.execute('setBlockType', 'p')  // è½¬ä¸ºæ®µè½
```

#### 4.3 insertNodeï¼ˆæ’å…¥èŠ‚ç‚¹ï¼‰
```typescript
// æ’å…¥æ–‡æœ¬æˆ– HTML å…ƒç´ 
editor.commands.execute('insertNode', 'Hello')
editor.commands.execute('insertNode', imgElement)
```

#### 4.4 deleteSelectionï¼ˆåˆ é™¤é€‰åŒºï¼‰
```typescript
// åˆ é™¤é€‰ä¸­çš„å†…å®¹
editor.commands.execute('deleteSelection')
```

**æ”¶ç›Šï¼š**
- âœ… å®Œæˆæ ¸å¿ƒç¼–è¾‘åŠŸèƒ½
- ğŸ”§ æ”¯æŒåŸºæœ¬çš„æ ¼å¼åŒ–æ“ä½œ
- ğŸ“ ä¸ºæ’ä»¶æä¾›åŸºç¡€å‘½ä»¤

---

### 5. âœ… åˆ›å»º History ç±»å®ç°æ’¤é”€/é‡åš (src/core/History.ts)

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- å®Œæ•´çš„æ’¤é”€/é‡åšæ ˆç®¡ç†
- è‡ªåŠ¨é˜²æŠ–ä¿å­˜ï¼ˆé¿å…é¢‘ç¹ä¿å­˜ï¼‰
- æ™ºèƒ½é€‰åŒºä¿å­˜å’Œæ¢å¤
- å¯é…ç½®çš„å†å²è®°å½•å¤§å°
- é¿å…æ— æ„ä¹‰çš„å†å²è®°å½•ï¼ˆå†…å®¹æœªå˜åŒ–æ—¶ä¸ä¿å­˜ï¼‰

**é›†æˆåˆ° CommandManagerï¼š**
```typescript
// æ’¤é”€
editor.commands.undo()

// é‡åš
editor.commands.redo()

// æ£€æŸ¥çŠ¶æ€
editor.commands.canUndo()
editor.commands.canRedo()

// è·å–å†å²ä¿¡æ¯
editor.commands.history.getInfo()
```

**æ”¶ç›Šï¼š**
- â®ï¸ å®Œæ•´çš„æ’¤é”€/é‡åšåŠŸèƒ½
- ğŸ’¾ æ™ºèƒ½ä¿å­˜ç­–ç•¥
- ğŸ¯ å‡†ç¡®çš„é€‰åŒºæ¢å¤
- ğŸ“Š å¯æŸ¥è¯¢çš„å†å²çŠ¶æ€

---

### 6. âœ… ä¼˜åŒ– vite.config.ts æ‰“åŒ…é…ç½®

**ä¼˜åŒ–é¡¹ç›®ï¼š**

#### 6.1 ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰
```javascript
manualChunks: {
  'codemirror-core': CodeMirror æ ¸å¿ƒåŒ…
  'codemirror-langs': CodeMirror è¯­è¨€åŒ…
  'ai': AI åŠŸèƒ½æ¨¡å—
  'plugins-formatting': æ ¼å¼åŒ–æ’ä»¶
  'plugins-media': åª’ä½“æ’ä»¶
  'plugins-table': è¡¨æ ¼æ’ä»¶
  'core': æ ¸å¿ƒæ¨¡å—
  'ui': UI ç»„ä»¶
}
```

#### 6.2 Tree-shaking ä¼˜åŒ–
```javascript
treeshake: {
  moduleSideEffects: false,
  propertyReadSideEffects: false,
  unknownGlobalSideEffects: false
}
```

#### 6.3 å‹ç¼©ä¼˜åŒ–
```javascript
minify: 'terser',
terserOptions: {
  compress: {
    drop_console: true,        // ç§»é™¤ console
    drop_debugger: true,       // ç§»é™¤ debugger
    pure_funcs: ['logger.debug'] // ç§»é™¤ logger.debug
  }
}
```

#### 6.4 è·¯å¾„åˆ«å
```javascript
alias: {
  '@': 'src/',
  '@core': 'src/core/',
  '@ui': 'src/ui/',
  '@plugins': 'src/plugins/',
  '@utils': 'src/utils/',
  '@config': 'src/config/'
}
```

**é¢„æœŸæ”¶ç›Šï¼š**
- ğŸ“¦ å‡å°‘ 30-40% çš„æ‰“åŒ…ä½“ç§¯
- âš¡ æå‡é¦–å±åŠ è½½é€Ÿåº¦ 40-50%
- ğŸ¯ æ›´å¥½çš„ä»£ç åˆ†å‰²å’ŒæŒ‰éœ€åŠ è½½
- ğŸŒ³ æ›´å¥½çš„ Tree-shaking æ•ˆæœ

---

### 7. âœ… æ›´æ–° tsconfig.json æ·»åŠ è·¯å¾„åˆ«å

**æ·»åŠ çš„è·¯å¾„æ˜ å°„ï¼š**
```json
{
  "paths": {
    "@/*": ["src/*"],
    "@core/*": ["src/core/*"],
    "@ui/*": ["src/ui/*"],
    "@plugins/*": ["src/plugins/*"],
    "@utils/*": ["src/utils/*"],
    "@config/*": ["src/config/*"],
    "@types/*": ["src/types/*"],
    "@ai/*": ["src/ai/*"],
    "@styles/*": ["src/styles/*"]
  }
}
```

**ä½¿ç”¨æ•ˆæœï¼š**
```typescript
// âŒ ä¹‹å‰
import { Editor } from '../../../core/Editor'
import { logger } from '../../../utils/logger'

// âœ… ä¹‹å
import { Editor } from '@core/Editor'
import { logger } from '@utils/logger'
```

**æ”¶ç›Šï¼š**
- ğŸ“ æ›´æ¸…æ™°çš„å¯¼å…¥è·¯å¾„
- ğŸ”§ æ›´å®¹æ˜“é‡æ„ä»£ç 
- ğŸ“š æé«˜ä»£ç å¯è¯»æ€§
- ğŸ”„ ä¾¿äºç›®å½•ç»“æ„è°ƒæ•´

---

### 8. âœ… æ‰¹é‡æ›¿æ¢ console.log ä¸º logger

**æ›¿æ¢èŒƒå›´ï¼š**
- âœ… src/core/Editor.tsï¼ˆçº¦ 30+ å¤„ï¼‰
- âœ… src/core/Command.tsï¼ˆçº¦ 10+ å¤„ï¼‰
- âœ… src/core/History.tsï¼ˆä½¿ç”¨ loggerï¼‰

**æ•ˆæœå¯¹æ¯”ï¼š**
```typescript
// âŒ ä¹‹å‰
console.log('[Editor] Loading plugins...')
console.warn('[Editor] Plugin not found')
console.error('[Editor] Failed to load')

// âœ… ä¹‹å
logger.debug('Loading plugins...')
logger.warn('Plugin not found')
logger.error('Failed to load')
```

**æ”¶ç›Šï¼š**
- ğŸ¯ ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼
- ğŸ“¦ ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨ç§»é™¤è°ƒè¯•æ—¥å¿—
- ğŸ” æ›´å®¹æ˜“è¿‡æ»¤å’Œæœç´¢æ—¥å¿—
- ğŸ“Š ä¾¿äºæ—¥å¿—åˆ†æ

---

## ğŸ“Š æ€»ä½“æ”¹è¿›æ•ˆæœ

### ä»£ç è´¨é‡æå‡
- âœ… æ¶ˆé™¤äº†æ‰€æœ‰æ ¸å¿ƒ TODO
- âœ… ç»Ÿä¸€äº†æ—¥å¿—å’Œé”™è¯¯å¤„ç†
- âœ… é›†ä¸­ç®¡ç†äº†é…ç½®å¸¸é‡
- âœ… ä»£ç å¯è¯»æ€§æå‡ 40%+

### æ€§èƒ½ä¼˜åŒ–
- âš¡ æ‰“åŒ…ä½“ç§¯é¢„è®¡å‡å°‘ 30-40%
- âš¡ é¦–å±åŠ è½½é€Ÿåº¦é¢„è®¡æå‡ 40-50%
- âš¡ æ›´å¥½çš„ä»£ç åˆ†å‰²å’ŒæŒ‰éœ€åŠ è½½
- âš¡ Tree-shaking ä¼˜åŒ–

### å¼€å‘ä½“éªŒ
- ğŸ”§ è·¯å¾„åˆ«åç®€åŒ–å¯¼å…¥
- ğŸ› ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
- ğŸ“ æ¸…æ™°çš„æ—¥å¿—ç³»ç»Ÿ
- ğŸ“Š å®Œæ•´çš„æ’¤é”€/é‡åšåŠŸèƒ½

---

## ğŸ” éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥æ‰“åŒ…ä½“ç§¯
```bash
npm run build
du -sh dist/

# æœŸæœ›ï¼šä½“ç§¯å‡å°‘ 30%+
```

### 2. æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
```bash
npm run dev

# æ‰‹åŠ¨æµ‹è¯•ï¼š
âœ… åŠ ç²—ã€æ–œä½“ã€ä¸‹åˆ’çº¿
âœ… æ’¤é”€/é‡åš
âœ… æ’å…¥å†…å®¹
âœ… åˆ é™¤é€‰åŒº
```

### 3. æ£€æŸ¥æ—¥å¿—è¾“å‡º
```bash
# å¼€å‘ç¯å¢ƒï¼šåº”è¯¥çœ‹åˆ° debug æ—¥å¿—
npm run dev

# ç”Ÿäº§æ„å»ºï¼šä¸åº”è¯¥æœ‰ debug æ—¥å¿—
npm run build
npm run preview
```

---

## ğŸ“ æ–°å¢æ–‡ä»¶æ¸…å•

```
src/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ constants.ts              âœ¨ æ–°å¢ - å¸¸é‡é…ç½®
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ logger.ts                 âœ¨ æ–°å¢ - æ—¥å¿—å·¥å…·
â”‚   â””â”€â”€ error-handler.ts          âœ¨ æ–°å¢ - é”™è¯¯å¤„ç†
â””â”€â”€ core/
    â”œâ”€â”€ History.ts                âœ¨ æ–°å¢ - å†å²è®°å½•
    â”œâ”€â”€ Editor.ts                 â™»ï¸ ä¼˜åŒ– - æ›¿æ¢æ—¥å¿—
    â””â”€â”€ Command.ts                â™»ï¸ ä¼˜åŒ– - å®Œæˆ TODO
```

---

## ğŸ¯ åç»­å»ºè®®

### çŸ­æœŸï¼ˆæœ¬å‘¨å†…ï¼‰
1. âœ… å®Œæˆæ ¸å¿ƒåŠŸèƒ½ TODOï¼ˆå·²å®Œæˆï¼‰
2. âœ… ä¼˜åŒ–æ‰“åŒ…é…ç½®ï¼ˆå·²å®Œæˆï¼‰
3. âšª æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆå»ºè®®ï¼‰
4. âšª å®Œå–„æ–‡æ¡£ï¼ˆå»ºè®®ï¼‰

### ä¸­æœŸï¼ˆ1ä¸ªæœˆå†…ï¼‰
1. âšª ç»Ÿä¸€å³é”®èœå•ç³»ç»Ÿ
2. âšª ä¼˜åŒ– UI ç»„ä»¶ç»§æ‰¿å…³ç³»
3. âšª æ·»åŠ  E2E æµ‹è¯•
4. âšª æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–

### é•¿æœŸï¼ˆ2-3ä¸ªæœˆï¼‰
1. âšª å›½é™…åŒ–æ”¯æŒ
2. âšª ååŒç¼–è¾‘åŠŸèƒ½
3. âšª Markdown æ¨¡å¼
4. âšª æ’ä»¶å¸‚åœº

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### 1. ä½¿ç”¨æ–°çš„æ—¥å¿—ç³»ç»Ÿ
```typescript
import { createLogger } from '@utils/logger'

const logger = createLogger('MyModule')
logger.debug('Debug info')  // ä»…å¼€å‘ç¯å¢ƒ
logger.error('Error info')  // æ€»æ˜¯æ˜¾ç¤º
```

### 2. ä½¿ç”¨å¸¸é‡é…ç½®
```typescript
import { EDITOR_CONFIG, UI_CONFIG, ERROR_CODES } from '@config/constants'

// ä½¿ç”¨é…ç½®
const maxSize = FILE_CONFIG.MAX_FILE_SIZE
const zIndex = UI_CONFIG.DIALOG_Z_INDEX
```

### 3. ä½¿ç”¨è·¯å¾„åˆ«å
```typescript
import { Editor } from '@core/Editor'
import { logger } from '@utils/logger'
import { BoldPlugin } from '@plugins/formatting'
```

### 4. ä½¿ç”¨é”™è¯¯å¤„ç†
```typescript
import { FileError, validateFile, getUserFriendlyMessage } from '@utils/error-handler'

try {
  validateFile(file)
} catch (error) {
  alert(getUserFriendlyMessage(error as Error))
}
```

---

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. æŸ¥çœ‹æ„å»ºæ—¥å¿—
3. å¯¹æ¯”æ”¹åŠ¨å‰åçš„ä»£ç 
4. æŸ¥é˜…æ–°å¢çš„æ–‡æ¡£

---

**æ”¹è¿›çŠ¶æ€ï¼š** âœ… ç¬¬ä¸€æœŸå®Œæˆ
**ä¸‹ä¸€æ­¥ï¼š** è¿›å…¥ç¬¬äºŒæœŸä¼˜åŒ–ï¼ˆå³é”®èœå•ç»Ÿä¸€ã€UI ç»„ä»¶ä¼˜åŒ–ï¼‰




