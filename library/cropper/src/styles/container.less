/**
 * @ldesign/cropper 容器样式
 * 
 * 定义裁剪器容器和布局相关样式
 */

// ============================================================================
// 主容器样式
// ============================================================================

.lcropper-container {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background-color: var(--lcropper-container-bg);
  border-radius: var(--lcropper-container-radius);
  
  // 确保子元素正确定位
  &::before {
    content: '';
    display: block;
    width: 100%;
    height: 0;
    padding-bottom: 100%; // 默认1:1比例
  }
  
  // 响应式比例
  &.lcropper-aspect-16-9::before {
    padding-bottom: 56.25%; // 16:9
  }
  
  &.lcropper-aspect-4-3::before {
    padding-bottom: 75%; // 4:3
  }
  
  &.lcropper-aspect-3-2::before {
    padding-bottom: 66.67%; // 3:2
  }
  
  &.lcropper-aspect-1-1::before {
    padding-bottom: 100%; // 1:1
  }
  
  &.lcropper-aspect-2-3::before {
    padding-bottom: 150%; // 2:3
  }
  
  &.lcropper-aspect-9-16::before {
    padding-bottom: 177.78%; // 9:16
  }
  
  // 自由比例时不使用padding-bottom
  &.lcropper-aspect-free::before {
    display: none;
  }
}

// ============================================================================
// 内容区域
// ============================================================================

.lcropper-content {
  .fill-parent();
  z-index: var(--lcropper-z-canvas);
  
  // 内容居中
  .flex-center();
  
  // 防止内容溢出
  overflow: hidden;
}

// ============================================================================
// 视口区域
// ============================================================================

.lcropper-viewport {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  
  // 视口背景
  background-color: var(--lcropper-canvas-bg);
  background-image: 
    linear-gradient(45deg, #f0f0f0 25%, transparent 25%),
    linear-gradient(-45deg, #f0f0f0 25%, transparent 25%),
    linear-gradient(45deg, transparent 75%, #f0f0f0 75%),
    linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
  background-size: 20px 20px;
  background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
  
  // 深色主题下的背景
  .lcropper-theme-dark & {
    background-color: var(--lcropper-canvas-bg);
    background-image: 
      linear-gradient(45deg, #333 25%, transparent 25%),
      linear-gradient(-45deg, #333 25%, transparent 25%),
      linear-gradient(45deg, transparent 75%, #333 75%),
      linear-gradient(-45deg, transparent 75%, #333 75%);
  }
}

// ============================================================================
// 图片容器
// ============================================================================

.lcropper-image-container {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  
  // 图片居中显示
  .flex-center();
}

.lcropper-image {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  display: block;
  
  // 图片变换
  transform-origin: center center;
  transition: transform var(--lcropper-transition-normal);
  
  // 图片质量优化
  image-rendering: -webkit-optimize-contrast;
  image-rendering: crisp-edges;
  
  // 防止图片被选中
  .no-select();
  
  // 防止图片拖拽
  -webkit-user-drag: none;
  -khtml-user-drag: none;
  -moz-user-drag: none;
  -o-user-drag: none;
  user-drag: none;
}

// ============================================================================
// 遮罩层
// ============================================================================

.lcropper-mask {
  .fill-parent();
  background-color: var(--lcropper-mask-bg);
  z-index: var(--lcropper-z-crop-area);
  pointer-events: none;
  
  // 遮罩动画
  transition: background-color var(--lcropper-transition-fast);
  
  // 裁剪区域透明
  .lcropper-crop-hole {
    position: absolute;
    background-color: transparent;
    
    // 使用mix-blend-mode创建透明效果
    mix-blend-mode: multiply;
    
    // 或者使用clip-path（现代浏览器）
    // clip-path: polygon(0% 0%, 0% 100%, 40% 100%, 40% 40%, 60% 40%, 60% 100%, 100% 100%, 100% 0%);
  }
}

// ============================================================================
// 网格线
// ============================================================================

.lcropper-grid {
  .fill-parent();
  pointer-events: none;
  z-index: var(--lcropper-z-crop-area);
  opacity: 0;
  transition: opacity var(--lcropper-transition-fast);
  
  // 显示网格
  &.lcropper-grid-visible {
    opacity: 1;
  }
  
  // 网格线
  .lcropper-grid-line {
    position: absolute;
    background-color: var(--lcropper-grid-color);
    
    // 垂直线
    &.lcropper-grid-vertical {
      width: var(--lcropper-grid-width);
      height: 100%;
      top: 0;
      
      &:nth-child(1) { left: 33.33%; }
      &:nth-child(2) { left: 66.67%; }
    }
    
    // 水平线
    &.lcropper-grid-horizontal {
      width: 100%;
      height: var(--lcropper-grid-width);
      left: 0;
      
      &:nth-child(3) { top: 33.33%; }
      &:nth-child(4) { top: 66.67%; }
    }
  }
}

// ============================================================================
// 参考线
// ============================================================================

.lcropper-guides {
  .fill-parent();
  pointer-events: none;
  z-index: var(--lcropper-z-crop-area);
  opacity: 0;
  transition: opacity var(--lcropper-transition-fast);
  
  // 显示参考线
  &.lcropper-guides-visible {
    opacity: 1;
  }
  
  // 参考线
  .lcropper-guide {
    position: absolute;
    border: var(--lcropper-guide-width) var(--lcropper-guide-style) var(--lcropper-guide-color);
    
    // 垂直参考线
    &.lcropper-guide-vertical {
      width: 0;
      height: 100%;
      top: 0;
      border-left: var(--lcropper-guide-width) var(--lcropper-guide-style) var(--lcropper-guide-color);
      border-right: none;
      border-top: none;
      border-bottom: none;
    }
    
    // 水平参考线
    &.lcropper-guide-horizontal {
      width: 100%;
      height: 0;
      left: 0;
      border-top: var(--lcropper-guide-width) var(--lcropper-guide-style) var(--lcropper-guide-color);
      border-left: none;
      border-right: none;
      border-bottom: none;
    }
  }
}

// ============================================================================
// 缩放控制
// ============================================================================

.lcropper-zoom-container {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  
  // 缩放变换
  transform-origin: center center;
  transition: transform var(--lcropper-transition-normal);
  
  // 缩放级别
  &.lcropper-zoom-fit {
    transform: scale(1);
  }
  
  &.lcropper-zoom-fill {
    transform: scale(1.2);
  }
  
  &.lcropper-zoom-custom {
    // 自定义缩放通过JavaScript设置
  }
}

// ============================================================================
// 拖拽状态
// ============================================================================

.lcropper-container {
  // 拖拽中状态
  &.lcropper-dragging {
    cursor: grabbing;
    
    .lcropper-image {
      cursor: grabbing;
    }
    
    // 禁用过渡动画
    * {
      transition: none !important;
    }
  }
  
  // 可拖拽状态
  &.lcropper-draggable {
    .lcropper-image {
      cursor: grab;
    }
  }
  
  // 缩放中状态
  &.lcropper-zooming {
    .lcropper-image {
      cursor: zoom-in;
    }
  }
  
  // 旋转中状态
  &.lcropper-rotating {
    .lcropper-image {
      cursor: crosshair;
    }
  }
}

// ============================================================================
// 响应式容器
// ============================================================================

.lcropper-container {
  // 移动端优化
  .mobile-only({
    // 增加触摸区域
    padding: 10px;
    
    // 调整背景网格大小
    .lcropper-viewport {
      background-size: 15px 15px;
      background-position: 0 0, 0 7.5px, 7.5px -7.5px, -7.5px 0px;
    }
  });
  
  // 平板端优化
  .tablet-only({
    .lcropper-viewport {
      background-size: 18px 18px;
      background-position: 0 0, 0 9px, 9px -9px, -9px 0px;
    }
  });
}

// ============================================================================
// 性能优化
// ============================================================================

.lcropper-container {
  // 启用硬件加速
  transform: translateZ(0);
  will-change: transform;
  
  .lcropper-image {
    // 启用硬件加速
    transform: translateZ(0);
    will-change: transform;
  }
  
  .lcropper-crop-area {
    // 启用硬件加速
    transform: translateZ(0);
    will-change: transform, width, height, top, left;
  }
}
