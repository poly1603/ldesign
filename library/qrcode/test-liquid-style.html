<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Liquid Style QRCode Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      color: white;
      margin-bottom: 30px;
      text-align: center;
    }

    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
      max-width: 1200px;
      width: 100%;
    }

    .qr-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 40px;
      margin-bottom: 30px;
    }

    .qr-card {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }

    .qr-card h3 {
      margin-bottom: 15px;
      color: #333;
      font-size: 18px;
    }

    .qr-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px 0;
      min-height: 250px;
      background: #f9fafb;
      border-radius: 8px;
      padding: 20px;
    }

    .description {
      font-size: 14px;
      color: #6b7280;
      margin-top: 10px;
      line-height: 1.5;
    }

    .controls {
      margin-top: 20px;
      padding: 20px;
      background: #f3f4f6;
      border-radius: 8px;
    }

    button {
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      margin: 5px;
      transition: opacity 0.3s;
    }

    button:hover {
      opacity: 0.9;
    }

    .status {
      margin-top: 10px;
      padding: 10px;
      border-radius: 6px;
      font-size: 14px;
    }

    .status.success {
      background: #d4edda;
      color: #155724;
    }

    .status.error {
      background: #f8d7da;
      color: #721c24;
    }

    .status.info {
      background: #d1ecf1;
      color: #0c5460;
    }

    input[type="text"], select {
      width: 100%;
      padding: 8px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      margin-bottom: 10px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #374151;
    }

    .debug-info {
      background: #fef3c7;
      border: 1px solid #fbbf24;
      border-radius: 6px;
      padding: 15px;
      margin-top: 20px;
    }

    .debug-info h4 {
      color: #92400e;
      margin-bottom: 10px;
    }

    .debug-info pre {
      background: white;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>🧪 Liquid Style QRCode Test</h1>
  
  <div class="container">
    <div class="qr-grid">
      <!-- Standard Rounded Style (Reference) -->
      <div class="qr-card">
        <h3>✅ Standard Rounded (Reference)</h3>
        <div class="qr-container" id="rounded-qr"></div>
        <p class="description">
          标准圆角样式，作为对比参考
        </p>
      </div>

      <!-- Current Liquid Style -->
      <div class="qr-card">
        <h3>💧 Current Liquid Style</h3>
        <div class="qr-container" id="liquid-current"></div>
        <p class="description">
          当前的液体流动样式实现
        </p>
      </div>

      <!-- Smooth Flow Style -->
      <div class="qr-card">
        <h3>🌊 Smooth Flow Style</h3>
        <div class="qr-container" id="smooth-flow"></div>
        <p class="description">
          平滑流动样式（使用 smooth-flow）
        </p>
      </div>

      <!-- Liquid with Different Params -->
      <div class="qr-card">
        <h3>🔧 Liquid with Adjusted Params</h3>
        <div class="qr-container" id="liquid-adjusted"></div>
        <p class="description">
          调整参数后的液体样式
        </p>
      </div>
    </div>

    <!-- Controls Section -->
    <div class="controls">
      <h3>🎮 测试控制面板</h3>
      
      <label for="test-content">二维码内容：</label>
      <input type="text" id="test-content" value="https://github.com" />
      
      <label for="error-level">纠错级别：</label>
      <select id="error-level">
        <option value="L">Low (7%)</option>
        <option value="M">Medium (15%)</option>
        <option value="Q">Quartile (25%)</option>
        <option value="H" selected>High (30%)</option>
      </select>
      
      <label for="module-size">模块大小：</label>
      <select id="module-size">
        <option value="200">200px</option>
        <option value="250" selected>250px</option>
        <option value="300">300px</option>
      </select>
      
      <div style="margin-top: 15px;">
        <button onclick="regenerateAll()">🔄 重新生成全部</button>
        <button onclick="testScanability()">📱 测试可扫描性</button>
        <button onclick="downloadAll()">💾 下载全部</button>
        <button onclick="compareStyles()">🔍 对比样式</button>
      </div>
      
      <div id="status-display"></div>
    </div>

    <!-- Debug Information -->
    <div class="debug-info">
      <h4>🐛 调试信息</h4>
      <pre id="debug-output">等待生成...</pre>
    </div>
  </div>

  <script type="module">
    import { createQRCode } from '@ldesign/qrcode';

    const qrInstances = {};
    let debugInfo = {};

    function updateStatus(message, type = 'info') {
      const statusDisplay = document.getElementById('status-display');
      statusDisplay.className = `status ${type}`;
      statusDisplay.textContent = message;
    }

    function updateDebug(info) {
      debugInfo = { ...debugInfo, ...info };
      document.getElementById('debug-output').textContent = JSON.stringify(debugInfo, null, 2);
    }

    async function initRoundedQR() {
      const container = document.getElementById('rounded-qr');
      const content = document.getElementById('test-content').value;
      const errorLevel = document.getElementById('error-level').value;
      const size = parseInt(document.getElementById('module-size').value);
      
      if (qrInstances.rounded) {
        qrInstances.rounded.destroy();
      }
      
      qrInstances.rounded = createQRCode({
        content,
        container,
        errorCorrectionLevel: errorLevel,
        style: {
          size,
          dotStyle: 'rounded',
          gradient: {
            type: 'linear',
            colors: ['#667eea', '#764ba2'],
            direction: 45
          }
        }
      });
      
      updateDebug({ rounded: { style: 'rounded', generated: true } });
    }

    async function initCurrentLiquid() {
      const container = document.getElementById('liquid-current');
      const content = document.getElementById('test-content').value;
      const errorLevel = document.getElementById('error-level').value;
      const size = parseInt(document.getElementById('module-size').value);
      
      if (qrInstances.liquidCurrent) {
        qrInstances.liquidCurrent.destroy();
      }
      
      try {
        qrInstances.liquidCurrent = createQRCode({
          content,
          container,
          errorCorrectionLevel: errorLevel,
          style: {
            size,
            dotStyle: 'liquid',
            gradient: {
              type: 'linear',
              colors: ['#ec4899', '#8b5cf6'],
              direction: 90
            }
          }
        });
        
        updateDebug({ 
          liquidCurrent: { 
            style: 'liquid', 
            generated: true,
            renderMethod: 'renderSmoothFlow' 
          } 
        });
      } catch (error) {
        console.error('Error creating liquid style:', error);
        updateDebug({ 
          liquidCurrent: { 
            error: error.message,
            stack: error.stack 
          } 
        });
      }
    }

    async function initSmoothFlow() {
      const container = document.getElementById('smooth-flow');
      const content = document.getElementById('test-content').value;
      const errorLevel = document.getElementById('error-level').value;
      const size = parseInt(document.getElementById('module-size').value);
      
      if (qrInstances.smoothFlow) {
        qrInstances.smoothFlow.destroy();
      }
      
      try {
        qrInstances.smoothFlow = createQRCode({
          content,
          container,
          errorCorrectionLevel: errorLevel,
          style: {
            size,
            dotStyle: 'smooth-flow', // Try explicit smooth-flow
            gradient: {
              type: 'linear',
              colors: ['#3498db', '#2980b9'],
              direction: 45
            }
          }
        });
        
        updateDebug({ 
          smoothFlow: { 
            style: 'smooth-flow', 
            generated: true 
          } 
        });
      } catch (error) {
        console.error('Error creating smooth flow:', error);
        updateDebug({ 
          smoothFlow: { 
            error: error.message 
          } 
        });
      }
    }

    async function initAdjustedLiquid() {
      const container = document.getElementById('liquid-adjusted');
      const content = document.getElementById('test-content').value;
      const errorLevel = document.getElementById('error-level').value;
      const size = parseInt(document.getElementById('module-size').value);
      
      if (qrInstances.liquidAdjusted) {
        qrInstances.liquidAdjusted.destroy();
      }
      
      try {
        // Try with different parameters
        qrInstances.liquidAdjusted = createQRCode({
          content,
          container,
          errorCorrectionLevel: errorLevel,
          style: {
            size,
            dotStyle: 'liquid',
            fgColor: '#000000', // Pure black for better contrast
            bgColor: '#ffffff', // Pure white background
            cornerRadius: 0.5 // Maximum corner radius
          }
        });
        
        updateDebug({ 
          liquidAdjusted: { 
            style: 'liquid', 
            generated: true,
            adjustments: 'Pure colors, max corner radius'
          } 
        });
      } catch (error) {
        console.error('Error creating adjusted liquid:', error);
        updateDebug({ 
          liquidAdjusted: { 
            error: error.message 
          } 
        });
      }
    }

    async function regenerateAll() {
      updateStatus('正在重新生成所有二维码...', 'info');
      
      try {
        await initRoundedQR();
        await initCurrentLiquid();
        await initSmoothFlow();
        await initAdjustedLiquid();
        
        updateStatus('✅ 所有二维码已重新生成', 'success');
      } catch (error) {
        updateStatus('❌ 生成过程中出现错误: ' + error.message, 'error');
      }
    }

    async function testScanability() {
      updateStatus('开始测试可扫描性...', 'info');
      
      // This would normally integrate with a QR scanner library
      // For now, we'll just provide instructions
      updateStatus('请使用手机扫描器测试每个二维码', 'info');
      
      updateDebug({
        scanTest: {
          instruction: '使用手机相机或专业扫描器测试',
          expectedContent: document.getElementById('test-content').value
        }
      });
    }

    async function downloadAll() {
      updateStatus('正在下载所有二维码...', 'info');
      
      try {
        if (qrInstances.rounded) {
          qrInstances.rounded.download({ fileName: 'test-rounded', format: 'png' });
        }
        if (qrInstances.liquidCurrent) {
          qrInstances.liquidCurrent.download({ fileName: 'test-liquid-current', format: 'png' });
        }
        if (qrInstances.smoothFlow) {
          qrInstances.smoothFlow.download({ fileName: 'test-smooth-flow', format: 'png' });
        }
        if (qrInstances.liquidAdjusted) {
          qrInstances.liquidAdjusted.download({ fileName: 'test-liquid-adjusted', format: 'png' });
        }
        
        updateStatus('✅ 下载已开始', 'success');
      } catch (error) {
        updateStatus('❌ 下载失败: ' + error.message, 'error');
      }
    }

    function compareStyles() {
      updateStatus('分析样式差异...', 'info');
      
      const analysis = {
        rounded: {
          description: '标准圆角样式',
          pros: '可扫描性好，视觉效果平衡',
          cons: '较为普通'
        },
        liquid: {
          description: '液体流动样式',
          pros: '独特的有机外观，艺术感强',
          cons: '可能影响扫描性能，复杂路径计算'
        },
        smoothFlow: {
          description: '平滑流动样式',
          pros: '模块自然融合，现代感',
          cons: '需要优化渲染算法'
        },
        adjusted: {
          description: '调整后的液体样式',
          pros: '纯色对比度高',
          cons: '可能失去渐变效果'
        }
      };
      
      updateDebug({ styleComparison: analysis });
      updateStatus('✅ 样式分析完成，查看调试信息', 'success');
    }

    // Make functions global for onclick handlers
    window.regenerateAll = regenerateAll;
    window.testScanability = testScanability;
    window.downloadAll = downloadAll;
    window.compareStyles = compareStyles;

    // Initialize on load
    document.addEventListener('DOMContentLoaded', () => {
      console.log('Initializing Liquid Style Test...');
      regenerateAll();
    });
  </script>
</body>
</html>