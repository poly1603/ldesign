<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>React QR Code Demo - All Features</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    #root {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }
    
    .header h1 {
      font-size: 3em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    
    .demo-card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    
    .demo-title {
      font-size: 1.4em;
      font-weight: 600;
      color: #333;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .demo-tag {
      font-size: 0.6em;
      background: #667eea;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
    }
    
    .controls {
      margin-bottom: 20px;
    }
    
    .control-group {
      margin-bottom: 15px;
    }
    
    .control-group label {
      display: block;
      margin-bottom: 5px;
      color: #555;
      font-weight: 500;
    }
    
    .control-group input,
    .control-group select,
    .control-group textarea {
      width: 100%;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
    }
    
    .control-group input:focus,
    .control-group select:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    
    .button:hover {
      background: #5a67d8;
    }
    
    .button-secondary {
      background: #48bb78;
    }
    
    .button-danger {
      background: #f56565;
    }
    
    .qr-display {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 200px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .batch-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .batch-item {
      text-align: center;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 8px;
    }
    
    .progress-bar {
      width: 100%;
      height: 20px;
      background: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: #48bb78;
      transition: width 0.3s;
    }
    
    @keyframes qrcode-fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes qrcode-scale-in {
      from { transform: scale(0); }
      to { transform: scale(1); }
    }
    
    @keyframes qrcode-rotate-in {
      from { 
        transform: rotate(-180deg) scale(0);
        opacity: 0;
      }
      to { 
        transform: rotate(0) scale(1);
        opacity: 1;
      }
    }
    
    .qrcode-fade-in {
      animation: qrcode-fade-in 1s ease-in-out;
    }
    
    .qrcode-scale-in {
      animation: qrcode-scale-in 0.5s ease-in-out;
    }
    
    .qrcode-rotate-in {
      animation: qrcode-rotate-in 0.8s ease-in-out;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <!-- React and Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState, useRef, useEffect, useCallback, createContext, useContext, forwardRef, useImperativeHandle } = React;
    
    // Mock QRCode Component
    const QRCode = forwardRef(({ 
      content, 
      size = 200, 
      dotStyle = 'square',
      animated = false,
      animationType = 'fade',
      onReady,
      onClick
    }, ref) => {
      const canvasRef = useRef(null);
      const [animationClass, setAnimationClass] = useState('');
      
      const generate = useCallback(() => {
        if (canvasRef.current) {
          const ctx = canvasRef.current.getContext('2d');
          canvasRef.current.width = size;
          canvasRef.current.height = size;
          
          // Background
          ctx.fillStyle = '#ffffff';
          ctx.fillRect(0, 0, size, size);
          
          // QR pattern
          ctx.fillStyle = '#000000';
          const moduleSize = size / 25;
          for (let i = 0; i < 25; i++) {
            for (let j = 0; j < 25; j++) {
              if (Math.random() > 0.3) {
                if (dotStyle === 'dots') {
                  ctx.beginPath();
                  ctx.arc(i * moduleSize + moduleSize/2, j * moduleSize + moduleSize/2, moduleSize/2.5, 0, Math.PI * 2);
                  ctx.fill();
                } else if (dotStyle === 'rounded') {
                  const radius = moduleSize / 4;
                  ctx.beginPath();
                  ctx.roundRect(i * moduleSize, j * moduleSize, moduleSize - 1, moduleSize - 1, radius);
                  ctx.fill();
                } else {
                  ctx.fillRect(i * moduleSize, j * moduleSize, moduleSize - 1, moduleSize - 1);
                }
              }
            }
          }
          
          if (onReady) onReady({ canvas: canvasRef.current });
        }
      }, [size, dotStyle, onReady]);
      
      const download = useCallback((fileName = 'qrcode') => {
        if (canvasRef.current) {
          const link = document.createElement('a');
          link.download = fileName + '.png';
          link.href = canvasRef.current.toDataURL();
          link.click();
        }
      }, []);
      
      const refresh = useCallback(() => {
        if (animated) {
          setAnimationClass('');
          setTimeout(() => {
            setAnimationClass(`qrcode-${animationType}-in`);
          }, 10);
        }
        generate();
      }, [animated, animationType, generate]);
      
      useImperativeHandle(ref, () => ({
        download,
        refresh
      }));
      
      useEffect(() => {
        if (animated) {
          setAnimationClass(`qrcode-${animationType}-in`);
        }
        generate();
      }, [content, animated, animationType, generate]);
      
      return (
        <div className={animationClass} onClick={onClick}>
          <canvas ref={canvasRef} />
        </div>
      );
    });
    
    // Mock useQRCode Hook
    const useQRCode = (initialConfig = {}) => {
      const containerRef = useRef(null);
      const [isReady, setIsReady] = useState(false);
      const [isGenerating, setIsGenerating] = useState(false);
      
      const generate = useCallback((config = {}) => {
        setIsGenerating(true);
        setTimeout(() => {
          if (containerRef.current) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 200;
            canvas.height = 200;
            
            ctx.fillStyle = config.bgColor || '#ffffff';
            ctx.fillRect(0, 0, 200, 200);
            
            ctx.fillStyle = config.fgColor || '#000000';
            const moduleSize = 8;
            for (let i = 0; i < 25; i++) {
              for (let j = 0; j < 25; j++) {
                if (Math.random() > 0.3) {
                  ctx.fillRect(i * moduleSize, j * moduleSize, moduleSize - 1, moduleSize - 1);
                }
              }
            }
            
            containerRef.current.innerHTML = '';
            containerRef.current.appendChild(canvas);
            setIsReady(true);
          }
          setIsGenerating(false);
        }, 500);
      }, []);
      
      const download = useCallback((fileName = 'qrcode') => {
        const canvas = containerRef.current?.querySelector('canvas');
        if (canvas) {
          const link = document.createElement('a');
          link.download = fileName + '.png';
          link.href = canvas.toDataURL();
          link.click();
        }
      }, []);
      
      return { containerRef, isReady, isGenerating, generate, download };
    };
    
    // Mock useBatchQRCode Hook
    const useBatchQRCode = () => {
      const [items, setItems] = useState([]);
      const [isGenerating, setIsGenerating] = useState(false);
      const [progress, setProgress] = useState(0);
      
      const addItem = useCallback((content) => {
        const id = 'qr-' + Date.now() + '-' + Math.random();
        setItems(prev => [...prev, { id, content, status: 'pending' }]);
        return id;
      }, []);
      
      const generateAll = useCallback(() => {
        setIsGenerating(true);
        setProgress(0);
        
        setItems(prevItems => {
          const updatedItems = [...prevItems];
          let completed = 0;
          
          updatedItems.forEach((item, index) => {
            setTimeout(() => {
              item.status = 'generating';
              
              setTimeout(() => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = 150;
                canvas.height = 150;
                
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, 150, 150);
                
                ctx.fillStyle = '#000000';
                for (let i = 0; i < 25; i++) {
                  for (let j = 0; j < 25; j++) {
                    if (Math.random() > 0.3) {
                      ctx.fillRect(i * 6, j * 6, 5, 5);
                    }
                  }
                }
                
                item.dataURL = canvas.toDataURL();
                item.status = 'success';
                
                completed++;
                setProgress((completed / updatedItems.length) * 100);
                
                if (completed === updatedItems.length) {
                  setIsGenerating(false);
                }
              }, 300);
            }, index * 200);
          });
          
          return updatedItems;
        });
      }, []);
      
      const clear = useCallback(() => {
        setItems([]);
        setProgress(0);
      }, []);
      
      return { items, isGenerating, progress, addItem, generateAll, clear };
    };
    
    // QRCode Context
    const QRCodeContext = createContext({});
    
    const QRCodeProvider = ({ children, theme = 'light' }) => {
      return (
        <QRCodeContext.Provider value={{ theme }}>
          {children}
        </QRCodeContext.Provider>
      );
    };
    
    // HOC Example Component
    const withQRCode = (Component) => {
      return (props) => {
        const [dataURL, setDataURL] = useState('');
        
        const generate = useCallback((content) => {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = 200;
          canvas.height = 200;
          
          ctx.fillStyle = '#ffffff';
          ctx.fillRect(0, 0, 200, 200);
          ctx.fillStyle = '#000000';
          
          for (let i = 0; i < 25; i++) {
            for (let j = 0; j < 25; j++) {
              if (Math.random() > 0.3) {
                ctx.fillRect(i * 8, j * 8, 7, 7);
              }
            }
          }
          
          setDataURL(canvas.toDataURL());
        }, []);
        
        return <Component {...props} qrcode={{ generate, dataURL }} />;
      };
    };
    
    // Main App Component
    const App = () => {
      const [componentContent, setComponentContent] = useState('https://example.com');
      const [dotStyle, setDotStyle] = useState('square');
      const [animationType, setAnimationType] = useState('');
      const componentRef = useRef(null);
      
      const [hookConfig, setHookConfig] = useState({
        content: 'Hook QR Code',
        fgColor: '#000000',
        bgColor: '#ffffff'
      });
      const hookQR = useQRCode();
      
      const [batchInput, setBatchInput] = useState('Item 1\nItem 2\nItem 3');
      const batchQR = useBatchQRCode();
      
      const { theme } = useContext(QRCodeContext);
      
      const handleComponentDownload = () => {
        if (componentRef.current) {
          componentRef.current.download('component-qr');
        }
      };
      
      const handleAddBatchItems = () => {
        const items = batchInput.split('\n').filter(item => item.trim());
        items.forEach(item => batchQR.addItem(item.trim()));
        setBatchInput('');
      };
      
      useEffect(() => {
        hookQR.generate(hookConfig);
      }, []);
      
      return (
        <div>
          <div className="header">
            <h1>⚛️ React QR Code Library</h1>
            <p>Complete demonstration: Components, Hooks, HOC, Context & More</p>
            <p style={{ fontSize: '0.9em', opacity: 0.8 }}>Theme: {theme}</p>
          </div>
          
          {/* Component Demo */}
          <div className="demo-card">
            <h2 className="demo-title">
              Component Usage
              <span className="demo-tag">Component</span>
            </h2>
            <div className="controls">
              <div className="control-group">
                <label>Content:</label>
                <input 
                  value={componentContent} 
                  onChange={(e) => setComponentContent(e.target.value)}
                  placeholder="Enter content"
                />
              </div>
              <div className="control-group">
                <label>Style:</label>
                <select value={dotStyle} onChange={(e) => setDotStyle(e.target.value)}>
                  <option value="square">Square</option>
                  <option value="dots">Dots</option>
                  <option value="rounded">Rounded</option>
                </select>
              </div>
              <div className="control-group">
                <label>Animation:</label>
                <select value={animationType} onChange={(e) => setAnimationType(e.target.value)}>
                  <option value="">None</option>
                  <option value="fade">Fade</option>
                  <option value="scale">Scale</option>
                  <option value="rotate">Rotate</option>
                </select>
              </div>
            </div>
            <div className="qr-display">
              <QRCode
                ref={componentRef}
                content={componentContent}
                dotStyle={dotStyle}
                animated={!!animationType}
                animationType={animationType || 'fade'}
                size={200}
                onReady={(instance) => console.log('QR Ready:', instance)}
                onClick={() => alert('QR Clicked!')}
              />
            </div>
            <button className="button" onClick={handleComponentDownload}>Download</button>
            <button className="button button-secondary" onClick={() => componentRef.current?.refresh()}>
              Refresh
            </button>
          </div>
          
          {/* Hook Demo */}
          <div className="demo-card">
            <h2 className="demo-title">
              Hook Usage
              <span className="demo-tag">useQRCode</span>
            </h2>
            <div className="controls">
              <div className="control-group">
                <label>Content:</label>
                <input 
                  value={hookConfig.content} 
                  onChange={(e) => setHookConfig({...hookConfig, content: e.target.value})}
                />
              </div>
              <div className="control-group">
                <label>Colors:</label>
                <div style={{ display: 'flex', gap: '10px' }}>
                  <input 
                    type="color" 
                    value={hookConfig.fgColor}
                    onChange={(e) => setHookConfig({...hookConfig, fgColor: e.target.value})}
                    style={{ width: '50%' }}
                  />
                  <input 
                    type="color" 
                    value={hookConfig.bgColor}
                    onChange={(e) => setHookConfig({...hookConfig, bgColor: e.target.value})}
                    style={{ width: '50%' }}
                  />
                </div>
              </div>
            </div>
            <div className="qr-display" ref={hookQR.containerRef}></div>
            <div>
              {hookQR.isGenerating && <span>Generating...</span>}
              {hookQR.isReady && <span>✅ Ready</span>}
            </div>
            <button className="button" onClick={() => hookQR.generate(hookConfig)}>Generate</button>
            <button className="button button-secondary" onClick={() => hookQR.download('hook-qr')}>
              Download
            </button>
          </div>
          
          {/* Batch Demo */}
          <div className="demo-card">
            <h2 className="demo-title">
              Batch Generation
              <span className="demo-tag">useBatchQRCode</span>
            </h2>
            <div className="controls">
              <div className="control-group">
                <label>Add Items (one per line):</label>
                <textarea 
                  value={batchInput}
                  onChange={(e) => setBatchInput(e.target.value)}
                  rows="3"
                  placeholder="Item 1&#10;Item 2&#10;Item 3"
                />
              </div>
            </div>
            <button className="button" onClick={handleAddBatchItems}>Add Items</button>
            <button className="button button-secondary" onClick={batchQR.generateAll}>Generate All</button>
            <button className="button button-danger" onClick={batchQR.clear}>Clear All</button>
            
            {batchQR.isGenerating && (
              <div className="progress-bar">
                <div className="progress-fill" style={{ width: batchQR.progress + '%' }}></div>
              </div>
            )}
            
            <div className="batch-grid">
              {batchQR.items.map(item => (
                <div key={item.id} className="batch-item">
                  {item.dataURL ? (
                    <img src={item.dataURL} alt="QR" style={{ width: '100%' }} />
                  ) : (
                    <div style={{ width: '100%', height: '150px', background: '#f0f0f0' }}></div>
                  )}
                  <div>{item.status}</div>
                  <div style={{ fontSize: '12px' }}>{item.content}</div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };
    
    // Enhanced Component with HOC
    const EnhancedDemo = withQRCode(({ qrcode }) => {
      const [content, setContent] = useState('HOC Example');
      
      return (
        <div className="demo-card">
          <h2 className="demo-title">
            Higher Order Component
            <span className="demo-tag">withQRCode</span>
          </h2>
          <div className="controls">
            <div className="control-group">
              <label>Content:</label>
              <input 
                value={content} 
                onChange={(e) => setContent(e.target.value)}
                placeholder="Enter content"
              />
            </div>
          </div>
          <button className="button" onClick={() => qrcode.generate(content)}>Generate</button>
          {qrcode.dataURL && (
            <div className="qr-display">
              <img src={qrcode.dataURL} alt="QR Code" />
            </div>
          )}
        </div>
      );
    });
    
    // Root Component
    const Root = () => {
      return (
        <QRCodeProvider theme="light">
          <App />
          <EnhancedDemo />
        </QRCodeProvider>
      );
    };
    
    // Render
    ReactDOM.render(<Root />, document.getElementById('root'));
  </script>
</body>
</html>