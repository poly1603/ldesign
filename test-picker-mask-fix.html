<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Picker遮罩修复测试</title>
  <style>
    body {
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #f5f5f5;
    }
    
    .test-container {
      display: flex;
      gap: 40px;
      flex-wrap: wrap;
      align-items: flex-start;
    }
    
    .test-section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .test-section h3 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #1d4ed8;
      padding-bottom: 10px;
    }
    
    .control-panel {
      margin-top: 20px;
      padding: 15px;
      background: #f9fafb;
      border-radius: 6px;
    }
    
    .control-group {
      margin-bottom: 15px;
    }
    
    .control-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #4b5563;
    }
    
    .control-group input,
    .control-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 14px;
    }
    
    button {
      background: #1d4ed8;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-top: 10px;
      font-size: 14px;
    }
    
    button:hover {
      background: #1e40af;
    }
    
    button.secondary {
      background: #6b7280;
    }
    
    button.secondary:hover {
      background: #4b5563;
    }
    
    .status {
      margin-top: 15px;
      padding: 10px;
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .debug-info {
      margin-top: 15px;
      padding: 10px;
      background: #f3f4f6;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .mask-visual {
      margin-top: 15px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      padding: 10px;
    }
    
    .mask-visual h4 {
      margin-top: 0;
      color: #6b7280;
      font-size: 14px;
    }
    
    /* 自定义picker样式测试 */
    .custom-mask-test {
      --ldesign-picker-mask-gradient-top: linear-gradient(to bottom, 
        rgba(255,0,0,0.5) 0%, 
        rgba(255,0,0,0.3) 50%, 
        rgba(255,0,0,0) 100%) !important;
      --ldesign-picker-mask-gradient-bottom: linear-gradient(to top, 
        rgba(0,0,255,0.5) 0%, 
        rgba(0,0,255,0.3) 50%, 
        rgba(0,0,255,0) 100%) !important;
    }
    
    .force-mask-visible {
      --ldesign-picker-mask-gradient-top: linear-gradient(to bottom, 
        rgba(0,0,0,0.8) 0%, 
        rgba(0,0,0,0.5) 30%, 
        rgba(0,0,0,0.2) 60%, 
        rgba(0,0,0,0) 100%) !important;
      --ldesign-picker-mask-gradient-bottom: linear-gradient(to top, 
        rgba(0,0,0,0.8) 0%, 
        rgba(0,0,0,0.5) 30%, 
        rgba(0,0,0,0.2) 60%, 
        rgba(0,0,0,0) 100%) !important;
    }
  </style>
  <script type="module">
    import './packages/webcomponent/dist/index.js';
  </script>
</head>
<body>
  <h1>🔧 Picker遮罩修复测试</h1>
  
  <div class="test-container">
    <!-- 原始Picker -->
    <div class="test-section">
      <h3>1. 原始Picker（默认遮罩）</h3>
      <ldesign-picker
        id="picker1"
        options="苹果,橙子,香蕉,葡萄,西瓜,草莓,芒果,菠萝,荔枝,龙眼"
        show-mask="true"
        value="香蕉"
        style="width: 150px"
      ></ldesign-picker>
      <div class="status">默认遮罩设置（白色渐变）</div>
    </div>
    
    <!-- 彩色遮罩测试 -->
    <div class="test-section">
      <h3>2. 彩色遮罩测试</h3>
      <ldesign-picker
        id="picker2"
        class="custom-mask-test"
        options="周一,周二,周三,周四,周五,周六,周日"
        show-mask="true"
        value="周三"
        style="width: 150px"
      ></ldesign-picker>
      <div class="status">红蓝渐变遮罩（用于验证遮罩位置）</div>
    </div>
    
    <!-- 强制显示遮罩 -->
    <div class="test-section">
      <h3>3. 强制黑色遮罩</h3>
      <ldesign-picker
        id="picker3"
        class="force-mask-visible"
        options="1月,2月,3月,4月,5月,6月,7月,8月,9月,10月,11月,12月"
        show-mask="true"
        value="6月"
        style="width: 150px"
      ></ldesign-picker>
      <div class="status">黑色半透明遮罩（高对比度）</div>
    </div>
    
    <!-- 暗黑主题测试 -->
    <div class="test-section" style="background: #1f2937;">
      <h3 style="color: white;">4. 暗黑主题</h3>
      <ldesign-picker
        id="picker4"
        theme="dark"
        options="选项1,选项2,选项3,选项4,选项5,选项6,选项7,选项8"
        show-mask="true"
        value="选项4"
        style="width: 150px"
      ></ldesign-picker>
      <div class="status" style="background: #374151; color: white; border-color: #60a5fa;">暗黑主题遮罩</div>
    </div>
  </div>
  
  <!-- 控制面板 -->
  <div class="test-section" style="margin-top: 30px;">
    <h3>🎛️ 遮罩调试工具</h3>
    
    <div class="control-panel">
      <div class="control-group">
        <label>遮罩透明度：</label>
        <input type="range" id="maskOpacity" min="0" max="1" step="0.05" value="0.95">
        <span id="opacityValue">0.95</span>
      </div>
      
      <div class="control-group">
        <label>遮罩高度（%）：</label>
        <input type="range" id="maskHeight" min="10" max="50" step="5" value="35">
        <span id="heightValue">35%</span>
      </div>
      
      <div class="control-group">
        <label>顶部遮罩颜色：</label>
        <select id="topMaskColor">
          <option value="white">白色</option>
          <option value="black">黑色</option>
          <option value="red">红色</option>
          <option value="blue">蓝色</option>
          <option value="custom">自定义渐变</option>
        </select>
      </div>
      
      <div class="control-group">
        <label>底部遮罩颜色：</label>
        <select id="bottomMaskColor">
          <option value="white">白色</option>
          <option value="black">黑色</option>
          <option value="red">红色</option>
          <option value="blue">蓝色</option>
          <option value="custom">自定义渐变</option>
        </select>
      </div>
      
      <button onclick="applyMaskSettings()">应用设置</button>
      <button onclick="resetMaskSettings()" class="secondary">重置</button>
      <button onclick="inspectMasks()">检查遮罩元素</button>
      <button onclick="toggleMasks()" class="secondary">切换遮罩显示</button>
    </div>
    
    <div class="mask-visual">
      <h4>遮罩预览：</h4>
      <div style="position: relative; height: 200px; background: #f9fafb; border-radius: 4px; overflow: hidden;">
        <div id="topMaskPreview" style="position: absolute; top: 0; left: 0; right: 0; height: 35%; background: linear-gradient(to bottom, white 0%, transparent 100%);"></div>
        <div id="bottomMaskPreview" style="position: absolute; bottom: 0; left: 0; right: 0; height: 35%; background: linear-gradient(to top, white 0%, transparent 100%);"></div>
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #6b7280;">内容区域</div>
      </div>
    </div>
    
    <div class="debug-info" id="debugInfo">
      点击"检查遮罩元素"查看详细信息...
    </div>
  </div>
  
  <script>
    // 遮罩设置应用函数
    function applyMaskSettings() {
      const opacity = document.getElementById('maskOpacity').value;
      const height = document.getElementById('maskHeight').value;
      const topColor = document.getElementById('topMaskColor').value;
      const bottomColor = document.getElementById('bottomMaskColor').value;
      
      // 获取所有picker
      const pickers = document.querySelectorAll('ldesign-picker');
      
      pickers.forEach(picker => {
        const shadowRoot = picker.shadowRoot;
        if (!shadowRoot) return;
        
        // 更新遮罩样式
        const masks = shadowRoot.querySelectorAll('.ldesign-picker__mask');
        masks.forEach(mask => {
          mask.style.opacity = opacity;
          mask.style.height = `${height}%`;
        });
        
        // 更新顶部遮罩颜色
        const topMask = shadowRoot.querySelector('.ldesign-picker__mask--top');
        if (topMask) {
          topMask.style.background = getGradient(topColor, 'top');
        }
        
        // 更新底部遮罩颜色
        const bottomMask = shadowRoot.querySelector('.ldesign-picker__mask--bottom');
        if (bottomMask) {
          bottomMask.style.background = getGradient(bottomColor, 'bottom');
        }
      });
      
      // 更新预览
      updatePreview();
      
      // 更新显示值
      document.getElementById('opacityValue').textContent = opacity;
      document.getElementById('heightValue').textContent = `${height}%`;
      
      console.log('遮罩设置已应用:', { opacity, height, topColor, bottomColor });
    }
    
    // 获取渐变样式
    function getGradient(color, direction) {
      const isTop = direction === 'top';
      const gradientDir = isTop ? 'to bottom' : 'to top';
      
      const gradients = {
        white: `linear-gradient(${gradientDir}, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%)`,
        black: `linear-gradient(${gradientDir}, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%)`,
        red: `linear-gradient(${gradientDir}, rgba(255,0,0,0.6) 0%, rgba(255,0,0,0) 100%)`,
        blue: `linear-gradient(${gradientDir}, rgba(0,0,255,0.6) 0%, rgba(0,0,255,0) 100%)`,
        custom: `linear-gradient(${gradientDir}, rgba(128,128,128,0.9) 0%, rgba(128,128,128,0.5) 30%, rgba(128,128,128,0.2) 60%, rgba(128,128,128,0) 100%)`
      };
      
      return gradients[color] || gradients.white;
    }
    
    // 更新预览
    function updatePreview() {
      const topColor = document.getElementById('topMaskColor').value;
      const bottomColor = document.getElementById('bottomMaskColor').value;
      const height = document.getElementById('maskHeight').value;
      const opacity = document.getElementById('maskOpacity').value;
      
      const topPreview = document.getElementById('topMaskPreview');
      const bottomPreview = document.getElementById('bottomMaskPreview');
      
      topPreview.style.background = getGradient(topColor, 'top');
      topPreview.style.height = `${height}%`;
      topPreview.style.opacity = opacity;
      
      bottomPreview.style.background = getGradient(bottomColor, 'bottom');
      bottomPreview.style.height = `${height}%`;
      bottomPreview.style.opacity = opacity;
    }
    
    // 重置设置
    function resetMaskSettings() {
      document.getElementById('maskOpacity').value = '0.95';
      document.getElementById('maskHeight').value = '35';
      document.getElementById('topMaskColor').value = 'white';
      document.getElementById('bottomMaskColor').value = 'white';
      
      // 移除自定义样式
      const pickers = document.querySelectorAll('ldesign-picker');
      pickers.forEach(picker => {
        const shadowRoot = picker.shadowRoot;
        if (!shadowRoot) return;
        
        const masks = shadowRoot.querySelectorAll('.ldesign-picker__mask');
        masks.forEach(mask => {
          mask.style.opacity = '';
          mask.style.height = '';
          mask.style.background = '';
        });
      });
      
      updatePreview();
      console.log('遮罩设置已重置');
    }
    
    // 检查遮罩元素
    function inspectMasks() {
      const debugInfo = document.getElementById('debugInfo');
      let info = '=== 遮罩元素检查结果 ===\n\n';
      
      const pickers = document.querySelectorAll('ldesign-picker');
      pickers.forEach((picker, index) => {
        info += `Picker #${index + 1} (${picker.id || '无ID'}):\n`;
        
        const shadowRoot = picker.shadowRoot;
        if (!shadowRoot) {
          info += '  ❌ 无法访问Shadow DOM\n';
          return;
        }
        
        const topMask = shadowRoot.querySelector('.ldesign-picker__mask--top');
        const bottomMask = shadowRoot.querySelector('.ldesign-picker__mask--bottom');
        
        if (topMask) {
          const topStyles = window.getComputedStyle(topMask);
          info += `  ✅ 顶部遮罩:\n`;
          info += `     - 显示: ${topStyles.display}\n`;
          info += `     - 位置: ${topStyles.position}\n`;
          info += `     - 高度: ${topStyles.height}\n`;
          info += `     - 透明度: ${topStyles.opacity}\n`;
          info += `     - z-index: ${topStyles.zIndex}\n`;
          info += `     - 背景: ${topStyles.background.substring(0, 50)}...\n`;
        } else {
          info += '  ❌ 未找到顶部遮罩\n';
        }
        
        if (bottomMask) {
          const bottomStyles = window.getComputedStyle(bottomMask);
          info += `  ✅ 底部遮罩:\n`;
          info += `     - 显示: ${bottomStyles.display}\n`;
          info += `     - 位置: ${bottomStyles.position}\n`;
          info += `     - 高度: ${bottomStyles.height}\n`;
          info += `     - 透明度: ${bottomStyles.opacity}\n`;
          info += `     - z-index: ${bottomStyles.zIndex}\n`;
          info += `     - 背景: ${bottomStyles.background.substring(0, 50)}...\n`;
        } else {
          info += '  ❌ 未找到底部遮罩\n';
        }
        
        info += '\n';
      });
      
      debugInfo.textContent = info;
      console.log(info);
    }
    
    // 切换遮罩显示
    function toggleMasks() {
      const pickers = document.querySelectorAll('ldesign-picker');
      pickers.forEach(picker => {
        const currentValue = picker.getAttribute('show-mask');
        picker.setAttribute('show-mask', currentValue === 'false' ? 'true' : 'false');
      });
      
      console.log('遮罩显示状态已切换');
    }
    
    // 监听滑块变化
    document.getElementById('maskOpacity').addEventListener('input', (e) => {
      document.getElementById('opacityValue').textContent = e.target.value;
    });
    
    document.getElementById('maskHeight').addEventListener('input', (e) => {
      document.getElementById('heightValue').textContent = `${e.target.value}%`;
    });
    
    // 页面加载完成后检查
    window.addEventListener('load', () => {
      setTimeout(() => {
        console.log('页面加载完成，自动检查遮罩...');
        inspectMasks();
      }, 500);
    });
  </script>
</body>
</html>