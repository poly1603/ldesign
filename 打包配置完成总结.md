# @ldesign/builder å’Œ Packages æ‰“åŒ…é…ç½®å®Œæˆæ€»ç»“

## âœ… ä¸»è¦æˆæœ

### 1. æˆåŠŸä¿®å¤å¹¶æ„å»º @ldesign/builder

**ä¿®å¤çš„å…³é”®é—®é¢˜ï¼š**

1. **Zod Schema æ¨¡å—å¯¼å‡ºé”™è¯¯**
   - é—®é¢˜ï¼šåœ¨ if è¯­å¥å—å†…ä½¿ç”¨ export å¯¼è‡´è¯­æ³•é”™è¯¯
   - è§£å†³ï¼šé‡æ„ä¸ºé¡¶å±‚å¯¼å‡ºï¼Œä½¿ç”¨å˜é‡å­˜å‚¨ä¸åŒå®ç°

2. **ç±»å‹ç³»ç»Ÿé”™è¯¯**ï¼ˆå…±ä¿®å¤ 6 å¤„ï¼‰
   - `BuildStats.totalSize` ç±»å‹ä» number æ”¹ä¸º SizeInfo å¯¹è±¡
   - `ModuleInfo` æ¥å£æ·»åŠ ç¼ºå¤±çš„å±æ€§ï¼ˆrenderedLength, originalLengthç­‰ï¼‰
   - ESBuild/Swc é€‚é…å™¨çš„ stats å¯¹è±¡ç»“æ„ä¿®æ­£
   - å¤šä¸ªç­–ç•¥æ–‡ä»¶çš„æ ¼å¼æ¯”è¾ƒé€»è¾‘ä¿®å¤

3. **åŠ¨æ€ require é—®é¢˜**
   - é—®é¢˜ï¼šESM æ¨¡å—ä¸æ”¯æŒåŠ¨æ€ require Node.js å†…ç½®æ¨¡å—
   - è§£å†³ï¼šå°† `require('os')` æ”¹ä¸ºé¡¶å±‚ `import os from 'os'`
   - è§£å†³ï¼šå°† `require('fast-glob')` çš„å‘½åå¯¼å…¥æ”¹ä¸ºé»˜è®¤å¯¼å…¥

**æ„å»ºç»“æœï¼š**
```
âœ… ESM Build success - ç”Ÿæˆ .js æ–‡ä»¶
âœ… CJS Build success - ç”Ÿæˆ .cjs æ–‡ä»¶  
âœ… DTS Build success - ç”Ÿæˆ .d.ts å’Œ .d.cts ç±»å‹å£°æ˜æ–‡ä»¶
```

äº§ç‰©ç›®å½•å®Œæ•´åŒ…å«ï¼š
- `adapters/` - å„æ‰“åŒ…å™¨é€‚é…å™¨ï¼ˆRollup, Rolldown, ESBuild, SWCï¼‰
- `cli/` - å‘½ä»¤è¡Œæ¥å£
- `core/` - æ ¸å¿ƒæ„å»ºé€»è¾‘
- `plugins/` - æ’ä»¶ç³»ç»Ÿ
- `strategies/` - æ¡†æ¶ç­–ç•¥ï¼ˆVue, React, Svelteç­‰ï¼‰
- `types/` - TypeScript ç±»å‹å®šä¹‰
- `utils/` - å·¥å…·å‡½æ•°

### 2. åˆ›å»ºé€šç”¨æ‰“åŒ…é…ç½®æ¨¡æ¿

**æ¨¡æ¿ä½ç½®ï¼š** `packages/ldesign.config.template.ts`

**æ”¯æŒçš„åŠŸèƒ½ï¼š**
- âœ… ESM æ ¼å¼ï¼ˆè¾“å‡ºåˆ° `es/` ç›®å½•ï¼‰
- âœ… CJS æ ¼å¼ï¼ˆè¾“å‡ºåˆ° `lib/` ç›®å½•ï¼‰
- âœ… UMD æ ¼å¼ï¼ˆè¾“å‡ºåˆ° `dist/` ç›®å½•ï¼‰
- âœ… TypeScript å£°æ˜æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆ
- âœ… Source Map æ”¯æŒ
- âœ… å¤–éƒ¨ä¾èµ–é…ç½®
- âœ… ä¿ç•™ç›®å½•ç»“æ„é€‰é¡¹

### 3. ç¤ºä¾‹é…ç½®å·²åˆ›å»º

ä¸º `packages/shared` åˆ›å»ºäº†å®Œæ•´çš„é…ç½®æ–‡ä»¶ `ldesign.config.ts`ï¼Œå¯ä½œä¸ºå…¶ä»–åŒ…çš„å‚è€ƒã€‚

## ğŸ“‹ é…ç½®æ ‡å‡†

### æ¯ä¸ªåŒ…éœ€è¦çš„æ–‡ä»¶

1. **ldesign.config.ts** ï¼ˆå¿…éœ€ï¼‰
```typescript
import { defineConfig } from '@ldesign/builder'

export default defineConfig({
  input: 'src/index.ts',
  output: {
    format: ['esm', 'cjs', 'umd'],
    esm: { dir: 'es' },
    cjs: { dir: 'lib' },
    umd: { dir: 'dist', name: 'LDesignåŒ…å' },
  },
  dts: true,
  sourcemap: true,
  clean: true,
  external: [/* å¤–éƒ¨ä¾èµ– */],
})
```

2. **package.json é…ç½®**ï¼ˆå¿…éœ€æ›´æ–°ï¼‰
```json
{
  "type": "module",
  "main": "./lib/index.cjs",
  "module": "./es/index.js",
  "types": "./es/index.d.ts",
  "exports": {
    ".": {
      "types": "./es/index.d.ts",
      "import": "./es/index.js",
      "require": "./lib/index.cjs"
    }
  },
  "scripts": {
    "build": "ldesign-builder build --format esm,cjs,umd"
  }
}
```

## ğŸ“¦ å¾…é…ç½®çš„åŒ…åˆ—è¡¨ï¼ˆ23ä¸ªï¼‰

```
packages/
â”œâ”€â”€ api/          â³ å¾…é…ç½®
â”œâ”€â”€ animation/    â³ å¾…é…ç½®
â”œâ”€â”€ auth/         â³ å¾…é…ç½® (å·²æœ‰ builder.config.ts)
â”œâ”€â”€ cache/        â³ å¾…é…ç½® (å·²æœ‰ ldesign.config.ts)
â”œâ”€â”€ color/        â³ å¾…é…ç½®
â”œâ”€â”€ crypto/       â³ å¾…é…ç½®
â”œâ”€â”€ device/       â³ å¾…é…ç½®
â”œâ”€â”€ engine/       â³ å¾…é…ç½®
â”œâ”€â”€ file/         â³ å¾…é…ç½®
â”œâ”€â”€ http/         â³ å¾…é…ç½® (å·²æœ‰ ldesign.config.ts)
â”œâ”€â”€ i18n/         â³ å¾…é…ç½®
â”œâ”€â”€ icons/        â³ å¾…é…ç½®
â”œâ”€â”€ logger/       â³ å¾…é…ç½®
â”œâ”€â”€ notification/ â³ å¾…é…ç½®
â”œâ”€â”€ permission/   â³ å¾…é…ç½®
â”œâ”€â”€ router/       â³ å¾…é…ç½®
â”œâ”€â”€ shared/       âœ… å·²é…ç½®
â”œâ”€â”€ size/         â³ å¾…é…ç½®
â”œâ”€â”€ storage/      â³ å¾…é…ç½®
â”œâ”€â”€ store/        â³ å¾…é…ç½®
â”œâ”€â”€ template/     â³ å¾…é…ç½®
â”œâ”€â”€ validator/    â³ å¾…é…ç½®
â””â”€â”€ websocket/    â³ å¾…é…ç½®
```

## ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œæŒ‡å—

### æ­¥éª¤ 1: ç¡®ä¿ Builder å·²æ„å»º

```bash
cd tools/builder
npm run build
```

### æ­¥éª¤ 2: ä¸ºæ¯ä¸ªåŒ…åˆ›å»ºé…ç½®

å¯¹æ¯ä¸ªåŒ…æ‰§è¡Œï¼š

```bash
cd packages/[åŒ…å]

# 1. å¤åˆ¶é…ç½®æ¨¡æ¿
cp ../ldesign.config.template.ts ./ldesign.config.ts

# 2. ç¼–è¾‘é…ç½®æ–‡ä»¶
#    - ä¿®æ”¹ output.umd.name ä¸ºåŒ…çš„å…·ä½“åç§°
#    - æ·»åŠ åŒ…ç‰¹å®šçš„ external ä¾èµ–

# 3. æ›´æ–° package.json
#    - ç¡®ä¿ scripts.build ä½¿ç”¨ ldesign-builder
#    - æ›´æ–° exports å­—æ®µ

# 4. æµ‹è¯•æ‰“åŒ…
npm run build

# 5. éªŒè¯äº§ç‰©
ls es/    # ESM æ ¼å¼
ls lib/   # CJS æ ¼å¼  
ls dist/  # UMD æ ¼å¼
```

### æ­¥éª¤ 3: æ‰¹é‡é…ç½®è„šæœ¬ï¼ˆå¯é€‰ï¼‰

å¯ä»¥åˆ›å»ºä¸€ä¸ªè„šæœ¬æ‰¹é‡ä¸ºæ‰€æœ‰åŒ…åˆ›å»ºé…ç½®ï¼š

```bash
# åˆ›å»ºæ‰¹é‡é…ç½®è„šæœ¬
node scripts/setup-packages.js
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ‰“åŒ…é¡ºåº**
   - å…ˆæ‰“åŒ…æ²¡æœ‰å†…éƒ¨ä¾èµ–çš„åŒ…ï¼ˆå¦‚ shared, loggerï¼‰
   - å†æ‰“åŒ…ä¾èµ–å…¶ä»–åŒ…çš„åŒ…
   - å»ºè®®é¡ºåºï¼šshared â†’ logger â†’ http â†’ cache â†’ auth â†’ ...

2. **ç‰¹æ®ŠåŒ…å¤„ç†**
   - **Vue ç»„ä»¶åŒ…**ï¼šéœ€è¦æ·»åŠ  Vue æ’ä»¶é…ç½®
   - **React ç»„ä»¶åŒ…**ï¼šéœ€è¦é…ç½® JSX/TSX
   - **Engine åŒ…**ï¼šå¯èƒ½éœ€è¦ç‰¹æ®Šçš„ WebGL/Canvas é…ç½®

3. **UMD å‘½åè§„èŒƒ**
   - shared â†’ LDesignShared
   - auth â†’ LDesignAuth
   - http â†’ LDesignHttp
   - éµå¾ª CamelCaseï¼Œä¿æŒä¸€è‡´æ€§

4. **External ä¾èµ–åŸåˆ™**
   - Vue, React ç­‰æ¡†æ¶å¿…é¡» external
   - æ‰€æœ‰ @ldesign/* åŒ…å¿…é¡» external
   - lodash-es ç­‰å·¥å…·åº“å»ºè®® external
   - å°å‹å·¥å…·åº“å¯ä»¥æ‰“åŒ…è¿›å»

## ğŸ“Š é¢„æœŸäº§ç‰©ç»“æ„

æ¯ä¸ªåŒ…æ‰“åŒ…ååº”è¯¥æœ‰ï¼š

```
package/
â”œâ”€â”€ es/                    # ESM æ ¼å¼
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ index.d.ts
â”‚   â””â”€â”€ [å­æ¨¡å—...]
â”œâ”€â”€ lib/                   # CJS æ ¼å¼
â”‚   â”œâ”€â”€ index.cjs
â”‚   â”œâ”€â”€ index.d.ts
â”‚   â””â”€â”€ [å­æ¨¡å—...]
â”œâ”€â”€ dist/                  # UMD æ ¼å¼
â”‚   â”œâ”€â”€ index.js          # æœªå‹ç¼©
â”‚   â””â”€â”€ index.min.js      # å‹ç¼©ç‰ˆï¼ˆå¦‚éœ€è¦ï¼‰
â””â”€â”€ package.json
```

## ğŸ” è´¨é‡æ£€æŸ¥æ¸…å•

æ‰“åŒ…å®Œæˆåæ£€æŸ¥ï¼š

- [ ] ESM æ–‡ä»¶èƒ½æ­£å¸¸ import
- [ ] CJS æ–‡ä»¶èƒ½æ­£å¸¸ require
- [ ] UMD æ–‡ä»¶èƒ½åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨
- [ ] TypeScript ç±»å‹å£°æ˜æ–‡ä»¶å­˜åœ¨
- [ ] Source maps æ­£ç¡®ç”Ÿæˆ
- [ ] æ²¡æœ‰æ„å¤–æ‰“åŒ…è¿›å»çš„ä¾èµ–
- [ ] äº§ç‰©å¤§å°åˆç†
- [ ] æ²¡æœ‰ console è­¦å‘Šæˆ–é”™è¯¯

## ğŸ“ˆ é¡¹ç›®çŠ¶æ€

**å½“å‰è¿›åº¦ï¼š** 30% 

- âœ… Builder å·¥å…·å®Œæˆå¹¶éªŒè¯
- âœ… é…ç½®æ¨¡æ¿åˆ›å»ºå®Œæˆ
- âœ… ç¤ºä¾‹é…ç½®åˆ›å»ºå®Œæˆ
- â³ ç­‰å¾…æ‰¹é‡é…ç½®23ä¸ªåŒ…
- â³ ç­‰å¾…æµ‹è¯•å’ŒéªŒè¯

**é¢„è®¡å‰©ä½™å·¥ä½œé‡ï¼š** 
- é…ç½®æ‰€æœ‰åŒ…ï¼šçº¦2-3å°æ—¶
- æµ‹è¯•å’Œä¿®å¤é—®é¢˜ï¼šçº¦1-2å°æ—¶
- éªŒè¯å’Œæ–‡æ¡£ï¼šçº¦30åˆ†é’Ÿ

---

**ç”Ÿæˆæ—¶é—´ï¼š** ${new Date().toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' })}

**éœ€è¦å¸®åŠ©ï¼Ÿ** å‚è€ƒ `BUILDER_PACKAGES_SETUP_REPORT.md` è·å–æ›´å¤šæŠ€æœ¯ç»†èŠ‚


